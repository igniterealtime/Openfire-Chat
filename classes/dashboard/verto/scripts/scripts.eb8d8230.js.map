{"version":3,"file":"scripts.js","sources":["../../.tmp/concat/scripts/scripts.js"],"names":["createAudioMeter","audioContext","clipLevel","averaging","clipLag","processor","createScriptProcessor","onaudioprocess","volumeAudioProcess","clipping","lastClip","volume","connect","destination","checkClipping","this","window","performance","now","shutdown","disconnect","event","x","buf","inputBuffer","getChannelData","bufLength","length","sum","i","Math","abs","rms","sqrt","max","$","JsonRpcClient","options","self","extend","ajaxUrl","socketUrl","onmessage","login","passwd","sessid","loginParams","userVariables","getSocket","onmessage_cb","_getSocket","ws_cnt","wsOnMessage","_wsOnMessage","prototype","_ws_socket","_ws_callbacks","_current_id","speedTest","bytes","cb","socket","speedCB","speedBytes","send","loops","rem","data","Array","join","call","method","params","success_cb","error_cb","request","jsonrpc","id","e","console","log","_wsCall","ajax","type","url","toJSON","dataType","cache","success","error","result","jqXHR","textStatus","errorThrown","response","parseJSON","responseText","err","notify","batch","callback","all_done_cb","_batchObject","_execute","socketReady","readyState","closeSocket","onclose","w","close","loginData","connectSocket","to","clearTimeout","authing","WebSocket","ws_sleep","onWSClose","setTimeout","onopen","onWSConnect","req","q","pop","stopRetrying","request_json","push","request_obj","orig_req","code","onWSLogin","eventData","reply","msg","up_dur","parseInt","substring","down_dur","up_kps","toFixed","down_kps","info","upDur","downDur","upKPS","downKPS","jsonrpcclient","_requests","batch_request","handlers","undefined","_batchCb","jQuery","findLine","sdpLines","prefix","substr","findLineInRange","startLine","endLine","realEndLine","indexOf","toLowerCase","getCodecPayloadType","sdpLine","pattern","RegExp","match","setCompat","checkCompat","onStreamError","doCallback","onStreamSuccess","stream","onICE","candidate","mediaData","candidateList","func","arg","callbacks","onICEComplete","onChannelError","onICESDP","sdp","SDP","stereoHack","onRemoteStream","useVideo","style","display","iOS","navigator","platform","setAttribute","element","useAudio","FSRTCattachMediaStream","remoteStream","onOfferSDP","getMediaParams","obj","audio","useMic","videoParams","screenShare","audioParams","deviceId","exact","localVideo","getUserMedia","constraints","video","onsuccess","localVideoStream","onerror","bestFrameRate","vertoBestFrameRate","minFrameRate","useCamera","mozGetUserMedia","dowin","confirm","width","min","minWidth","maxWidth","height","minHeight","maxHeight","mediaSource","opt","sourceId","maxFrameRate","mandatory","optional","frameRate","ideal","FSRTCPeerConnection","ice_handler","done","gathering","peer","localDescription","createOffer","sessionDescription","serializeSdp","setLocalDescription","onSdpError","createAnswer","setRemoteDescription","RTCSessionDescription","offerSDP","onSdpSuccess","onAnswerSDP","openOffererChannel","onChannelMessage","_openOffererChannel","channel","createDataChannel","reliable","setChannelEvents","onChannelOpened","onChannelClosed","warn","config","default_ice","urls","iceServers","RTCPeerConnection","onicecandidate","attachStream","addStream","attachStreams","streams","onaddstream","remoteMediaStream","oninactive","onRemoteStreamEnded","addAnswerSDP","cbSuccess","cbError","addICE","addIceCandidate","RTCIceCandidate","sdpMLineIndex","sendData","message","stop","active","streaming","URL","createObjectURL","media","n","getMedia","video_constraints","FSRTC","useStereo","userData","audioEnabled","videoEnabled","profile","offerToReceiveAudio","useSpeak","offerToReceiveVideo","validRes","local","on","opusPayload","split","opusIndex","fmtpLineIndex","toString","concat","srcObject","src","answer","onSuccess","onError","stopPeer","localStream","tracks","getTracks","forEach","track","index","getMute","setMute","what","audioTracks","getAudioTracks","len","enabled","getVideoMute","setVideoMute","videoTracks","getVideoTracks","remoteSDP","debug","mediaParams","screen","offerToSendAudio","resSupported","h","bestResSupported","resList","resI","ttl","checkRes","cam","res","localStorage","setItem","getValidRes","cached","getItem","checkPerms","runtime","check_audio","check_video","drop_bad","verto","eventSUBS","mark_ready","j","ready","readyHandler","do_subscribe","subChannels","sparams","eventChannel","handler","serno","SERNO","isnew","createMainModeratorMethods","conf","listVideoLayouts","modCommand","play","file","deaf","memberID","undeaf","record","stopRecord","snapshot","hasVid","setVideoLayout","layout","canvasID","kick","muteMic","muteVideo","presenter","videoFloor","banner","text","escape","volumeDown","volumeUp","gainDown","gainUp","transfer","exten","sendChat","rpcClient","laData","chatChannel","action","checkStateChange","oldS","newS","state","purge","states","name","find_name","audioOutDevices","source","generateGUID","crypto","Uint16Array","getRandomValues","S4","num","ret","replace","c","r","random","v","saved","tag","localTag","deviceParams","onResCheck","ringSleep","dialogs","handleMessage","o","ringFile","ringer","logout","body","sendMethod","processReply","unauthorizedChannels","subscribedChannels","subscribe","subParams","unsubscribe","handle","unsubChannels","sendChannels","repl","u","broadcast","callID","setState","hangup","dialog","newCall","args","direction","outbound","invite","rtc","handleAnswer","handleMedia","handleDisplay","handleInfo","attach","inbound","recovering","wantVideo","list","key","onMessage","pvtEvent","sendMessage","sub","onEvent","from","clientReady","del_array","array","hashArray","vha","hash","reorder","a","clear","add","val","insertAt","redraw","del","get","order","arrayLen","asArray","each","dump","html","str","JSON","stringify","liveArray","context","la","lastSerno","binding","user_obj","userObj","_add","_del","_reorder","_clear","errs","onChange","checkSerno","onErr","bootstrap","init","bootObj","modify","ok","eventHandler","packet","wireSerno","hashKey","arrIndex","destroy","sendCommand","cmd","command","changepage","heartbeat","hb_pid","liveTable","jq","genRow","tmp","oldStatus","genArray","dt","lt","dataTable","fnDestroy","iserr","aoColumns","sTitle","fnClearTable","fnAddData","fnAdjustColumnSizing","fnUpdate","fnDeleteRow","hide","show","CONFMAN_SERNO","onBroadcast","onLaChange","onLaRow","modChannel","infoChannel","infoCallback","chatCallback","value","application","destroyed","modfuncs","confMan","genMainMod","play_id","stop_id","recording_id","snapshot_id","rec_stop_id","div_id","change_video_layout","canvas_id","canvasCount","vlayout_id","vlselect_id","vlhtml","append","click","prompt","genControls","rowid","kick_id","canvas_in_next_id","canvas_in_prev_id","canvas_out_next_id","canvas_out_prev_id","canvas_in_set_id","canvas_out_set_id","layer_set_id","layer_next_id","layer_prev_id","tmute_id","tvmute_id","vbanner_id","tvpresenter_id","tvfloor_id","box_id","gainup_id","gaindn_id","volup_id","voldn_id","transfer_id","mouseover","mouse","mouseout","xten","cid","tableID","statusID","mainModID","atitle","awidth","role","displayID","selectmenu","empty","Option","responseData","rdata","sort","b","ga","gb","lastTimeout","row_callback","nRow","aData","iDisplayIndex","iDisplayIndexFull","$row","laChannel","laName","confEvent","laChange","aaData","sWidth","bAutoWidth","bDestroy","bSort","bInfo","bFilter","bLengthChange","bPaginate","iDisplayLength","oLanguage","sEmptyTable","fnRowCallback","lastState","answered","audioStream","document","getElementById","videoStream","RTCcallbacks","display_direction","remote_caller_id_name","caller_id_name","remote_caller_id_number","caller_id_number","callee_id_name","callee_id_number","destination_number","requesting","answering","location","reload","onStream","permissionCallback","onGranted","onDenied","cause","ring","dialogParams","noDialogParams","setAudioPlaybackDevice","sinkId","devname","setSinkId","then","errorMessage","ringing","stopRinging","onDialogState","early","speaker","trying","remove","holdState","held","causeCode","indicateRing","attr","dtmf","digits","rtt","pobj","chars","txt","dest","replaceCallID","hold","unhold","toggleHold","gotAnswer","gotEarly","cidString","enc","party","display_name","display_number","ENUM","s","map","Object","freeze","new","unloadJobs","bind","f","haltClosure","warnOnUnload","videoDevices","audioInDevices","checkDevices","gotDevices","deviceInfos","deviceInfo","kind","label","aud_in","aud_out","vid","Xstream","handleError","checkTypes","devs","has_audio","has_video","mediaDevices","enumerateDevices","refreshDevices","skipPermCheck","skipDeviceCheck","status","genUUID","exports","module","define","amd","g","global","adapter","t","require","Error","l",1,"SDPUtils","generateIdentifier","localCName","splitLines","blob","trim","line","splitSections","parts","part","matchPrefix","filter","parseCandidate","foundation","component","protocol","priority","ip","port","relatedAddress","relatedPort","tcpType","writeCandidate","toUpperCase","ufrag","parseIceOptions","parseRtpMap","parsed","payloadType","shift","clockRate","numChannels","writeRtpMap","codec","pt","preferredPayloadType","parseExtmap","uri","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","parameters","keys","param","parseRtcpFb","parameter","writeRtcpFb","lines","rtcpFeedback","fb","parseSsrcMedia","sp","ssrc","colon","attribute","getMid","mediaSection","mid","parseFingerprint","algorithm","getDtlsParameters","sessionpart","fingerprints","writeDtlsParameters","setupType","fp","getIceParameters","iceParameters","usernameFragment","password","writeIceParameters","parseRtpParameters","description","codecs","headerExtensions","fecMechanisms","rtcp","mline","rtpmapline","fmtps","writeRtpDescription","caps","maxptime","extension","parseRtpEncodingParameters","secondarySsrc","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","flows","apt","encParam","codecPayloadType","rtx","parse","fec","mechanism","bandwidth","maxBitrate","parseRtcpParameters","rtcpParameters","remoteSsrc","cname","rsize","reducedSize","compound","mux","parseMsid","spec","planB","generateSessionId","writeSessionBoilerplate","sessId","sessionId","writeMediaSection","transceiver","iceGatherer","getLocalParameters","dtlsTransport","rtpSender","rtpReceiver","msid","sendEncodingParameters","getDirection","getKind","isRejected",2,"adapterFactory","./adapter_factory.js",3,"dependencies","utils","logging","browserDetails","detectBrowser","extractVersion","disableLog","disableWarnings","chromeShim","edgeShim","firefoxShim","safariShim","browser","shimPeerConnection","browserShim","shimGetUserMedia","shimMediaStream","shimCreateObjectURL","shimSourceObject","shimOnTrack","shimGetSendersWithDtmf","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","./chrome/chrome_shim","./edge/edge_shim","./firefox/firefox_shim","./safari/safari_shim","./utils",4,"MediaStream","webkitMediaStream","defineProperty","_ontrack","set","removeEventListener","_ontrackpoly","addEventListener","te","receiver","getReceivers","find","Event","dispatchEvent","getSenders","_senders","origAddStream","origRemoveStream","removeStream","addTrack","pc","signalingState","DOMException","slice","arguments","alreadyExists","_streams","oldStream","newStream","sender",{"end":{"file":"../../.tmp/concat/scripts/scripts.js","comments_before":[],"nlb":false,"endpos":176078,"endcol":20,"endline":5559,"pos":176074,"col":16,"line":5559,"value":"dtmf","type":"name"},"start":{"file":"../../.tmp/concat/scripts/scripts.js","comments_before":[],"nlb":false,"endpos":176078,"endcol":20,"endline":5559,"pos":176074,"col":16,"line":5559,"value":"dtmf","type":"name"},"name":"dtmf"},"_dtmf","createDTMFSender","apply","splice","RTCRtpSender","origGetSenders","senders","_pc","HTMLMediaElement","_srcObject","revokeObjectURL","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","server","hasOwnProperty","generateCertificate","iceTransportPolicy","iceTransports","webkitRTCPeerConnection","origGetStats","getStats","selector","successCallback","errorCallback","fixChromeStats_","standardReport","reports","report","standardStats","timestamp","localcandidate","remotecandidate","names","stat","makeMapStats","stats","Map","successCallbackWrapper_","Promise","resolve","reject","version","nativeMethod","promise","opts","nativeAddIceCandidate","../utils.js","./getusermedia",5,"constraintsToChrome_","cc","oldname_","charAt","oc","mix","advanced","shimConstraints_","remap","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","devices","d","dev","some","shimError_","PermissionDeniedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","constraint","constraintName","getUserMedia_","webkitGetUserMedia","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","echoCancellation","origGetUserMedia","cs",6,"shimRTCPeerConnection","RTCIceGatherer","origMSTEnabled","getOwnPropertyDescriptor","ev","replaceTrack","setTrack","../utils","./rtcpeerconnection_shim",7,8,"sortTracks","filterIceServers","edgeVersion","hasTurn","isString","validTurn","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","findCodecByPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","rCodec","lHeaderExtension","rHeaderExtension","isActionAllowedInSignalingState","offer","_eventTarget","createDocumentFragment","needNegotiation","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","canTrickleIceCandidates","localStreams","remoteStreams","getLocalStreams","getRemoteStreams","remoteDescription","iceConnectionState","iceGatheringState","iceOptions","gatherPolicy","usingBundle","bundlePolicy","_config","transceivers","_localIceCandidatesBuffer","_sdpSessionId","_emitGatheringStateChange","_emitBufferedCandidates","sections","end","complete","every","iceGatheringStateChange","getConfiguration","_createTransceiver","hasBundleTransport","iceTransport","recvEncodingParameters","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","clonedStream","clone","idx","clonedTrack","_createIceGatherer","onlocalcandidate","evt","sdpMid","cand","_pendingOffer","RTCIceTransport","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","writable","_disposeIceAndDtlsTransports","ondtlssttatechange","_transceive","recv","encodings","p","receive","isIceLite","rejected","isDatachannel","remoteIceParameters","remoteDtlsParameters","start","_updateSignalingState","TypeError","hasCallback","receiverList","remoteMsid","isComplete","cands","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","sid","item","trackEvent","getRemoteCandidates","addRemoteCandidate","newState","closed","connecting","checking","connected","completed","disconnected","failed","offerOptions","numAudioTracks","numVideoTracks","desc","localTrack","hasRtx","mLineIndex","promises","fixStatsType","inboundrtp","outboundrtp","candidatepair","results","all",9,"mozSrcObject","mozRTCPeerConnection","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","assign",10,"InternalError","NotSupportedError","SecurityError","The operation is insecure.","constraintsToFF37_","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints",11,"_localStreams","getStreamById","_remoteStreams","_addTrack","removeTrack","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","deprecated",12,"logDisabled_","deprecationWarnings_","bool","oldMethod","newMethod","uastring","expr","pos","userAgent","nativeCreateObjectURL","nativeRevokeObjectURL","newId","dsc","nativeSetAttribute","getScreenConstraints","screen_constraints","chromeMediaSource","chromeMediaSourceId","postMessage","iframe","isLoaded","contentWindow","captureSourceId","loadIFrame","loadCallback","createElement","onload","documentElement","appendChild","getScreenId","onIFrameCallback","chromeExtensionStatus","mozMediaSource","domain","k","m","String","fromCharCode","charCodeAt","unescape","encodeURIComponent","md5","vertoApp","angular","constant","languages","dialects","en","en_GB","en_US","it","it_IT","fr","fr_FR","fr_CA","pt_BR","pt_PT","de","de_DE","es","es_ES","pl","pl_PL","ru","ru_RU","sv","sv_SV","sv_FI","da","da_DK","id_ID","zh","zh_CN","zh_TW","zh_HK","$routeProvider","gravatarServiceProvider","$translateProvider","configLanguages","when","title","templateUrl","controller","otherwise","redirectTo","defaults","default","reg_langs","useStaticFilesLoader","suffix","registerAvailableLanguageKeys","preferredLanguage","determinePreferredLanguage","fallbackLanguage","useSanitizeValueStrategy","run","$rootScope","$location","toastr","$on","next","current","path","previous","$$route","safeProtocol","promptInput","input","isFunction","$scope","$timeout","storage","splashscreen","progress_percentage","interrupt_next","errors","link","activity","checkProgressState","current_progress","soft","interrupt","calculate","getProgressMessage","$http","Fullscreen","$anchorScroll","$translate","scrollToChatBottom","querySelector","scrollTop","scrollHeight","clearConferenceChat","members","messages","CLEAN_MESSAGE","getResByLayout","layoutsData","confLayoutsData","resIDS","clearMembersResID","preserve","member","resID","reservationID","confResID","findMemberByUUID","uuid","found","translateMember","number","email","addMember","shortPrompt","$watch","activePane","chat_counter","created_at","Date","$apply","chatStatus","resIDs","currentLayout","layoutName","openId","watcher","master","memberIdx","conferenceMemberID","mutedMic","muted","mutedVideo","$applyAsync","closeChat","toggleModMenu","confRole","preventDefault","sendConferenceChat","confKick","confMuteMic","confMuteVideo","confPresenter","setResevartionId","confVideoFloor","confBanner","instant","confCanvasIn","setCanvasIn","confCanvasOut","setCanvasOut","confLayer","setLayer","confResetBanner","confVolumeDown","confVolumeUp","confGainDown","confGainUp","confTransfer","disableOnKeydownDtmf","enableOnKeydownDtmf","confToggleDeaf","origin","pathname","contributors","re","githash","CallHistory","eventQueue","onHold","cur_call","dialpadNumber","called_number","mirrorInput","videoCall","warning","process","search","autocall","call_history","history_control","all_control","has_history","userStatus","calling","clearCallHistory","viewCallsList","calls","call_list","fillDialpadNumber","preview","loading","cancelled","testSpeedJoin","testSpeed","cancel","$modal","buildCanvasesData","canvases","callTemplate","dialpadTemplate","incall","openChat","toggleDialpad","openModal","cbMuteVideo","cbMuteMic","confChangeVideoLayout","videoLayout","$emit","confChangeSpeaker","speakerId","selectedSpeaker","confPopup","href","curCall","webcam","offsetWidth","offsetHeight","y","popup","open","moveTo","screenshare","shareCall","screenshareHangup","pluginUrl","allowHtml","$broadcast","preRoute","$q","$window","ws_modalInstance","backdrop","keyboard","showReconnectModal","autoBand","gapiClientLoaded","gapi","client","plus","people","userId","execute","handleEmailResponse","resp","primaryEmail","emails","displayName","image","sinkIdCallback","deviceName","onKeydownDtmfHistory","caracter","onKeydownDtmfEnabled","dtmfWidget","dtmfHistory","callState","language","use","addClass","dialpad","myVideo","hasClass","redirect","connectCallback","hostname","wsURL","ui_connected","ws_connected","disconnectCallback","reset","auth","signOut","openModalSettings","modalInstance","animation","animationsEnabled","rendered","material","_options","showAbout","showContributors","backspace","toggleCallHistory","removeClass","toggleChat","toggleClass","updateVideoSize","toggleSettings","settingsEl","closeSettings","goFullscreen","fullscreenEnabled","isEnabled","enable","getElementsByTagName","$digest","page_incall","askRecoverCall","events","authResult","load","callActive","call_start","start_time","incomingCall","answerCall","declineCall","selectedVideo","originalPath","unbind","vidQual","bwp","bandDown","bandUp","iconClass","videoQuality","vidRes","$modalInstance","dismiss","ModalWsReconnectController","closeReconnect","instance","$inject","speakerFeature","mydata","copy","unshift","translation","selectedVideoName","changeData","useSTUN","googEchoCancellation","googNoiseSuppression","googHighpassFilter","googAutoGainControl","googAutoGainControl2","changedLanguage","langKey","browserlang","lang","fail_lang","refreshDeviceList","showPreview","speedMsg","isTestingSpeed","resetSettings","factoryReset","checkAutoBand","option","useDedenc","bestres","outgoingBandwidth","incomingBandwidth","checkUseDedRemoteEncoder","checkVideoQuality","resolution","videoResolution","stopMedia","streamObj","mediaStreamSource","createMediaStreamSource","meter","volumes","children","mirrored","selectedAudio","newDevice","AudioContext","endPreview","$interval","int_id","stopInterval","resCheckEnded","directive","restrict","$element","focus","scope","attrs","fadeIn","parent","fadeOut","condition","videoElem","newParent","getElementsByClassName","resize","css","appendTo","regex","regex64","test","videoQualitySource","qqvga","qvga","vga","qvga_wide","vga_wide","hd","hhd","framerate","updateReq","ms","new_w","new_h","aspect","videoContainer","round","vertoService","service","$cookieStore","cleanShareCall","that","cleanCall","confLayouts","chattingWith","last_state","updateResolutions","supportedResolutions","audioDevices","shareDevices","textTo","refreshDevicesCallback","speakerDevices","selectedShare","videoFlag","shareFlag","audioFlag","speakerFlag","canVideo","refreshVideoResolution","resolutions","qual","startConference","pvtData","chatID","fromDisplay","canvasInfo","callId","fromJson","stopConference","ourBootstrap","reloaded","loginFailed","videoOnly","from_msg_name","reattached_sessions","mediaPerm","custom","callerid","dedEnc","avatar","stopSharing","StreamTrack","screenfunc","share_call","upBand","ceil","downBand","from_msg_number","configure","httpRequest","floor","httpReturn","googlelogin","googleclientid","autologin","autologin_done","fn","fn_return","emitNextProgress","$localStorage","verto_data","defaultSettings","$default","$reset","factory","history","addCallToHistory","getCallsFromHistory","checkBrowser","checkMediaPerm","refreshMediaDevices","checkConnectionSpeed","provisionConfig","configResponse","configPromise","checkLogin","checkUserStored","progress","progress_message","calculateProgress","_progress","nextProgress"],"mappings":"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","sourcesContent":["/*\r\n * Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\r\n * Copyright (C) 2005-2014, Anthony Minessale II <anthm@freeswitch.org>\r\n *\r\n * Version: MPL 1.1\r\n *\r\n * The contents of this file are subject to the Mozilla Public License Version\r\n * 1.1 (the \"License\"); you may not use this file except in compliance with\r\n * the License. You may obtain a copy of the License at\r\n * http://www.mozilla.org/MPL/\r\n *\r\n * Software distributed under the License is distributed on an \"AS IS\" basis,\r\n * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\r\n * for the specific language governing rights and limitations under the\r\n * License.\r\n *\r\n * The Original Code is jquery.jsonrpclient.js modified for Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\r\n *\r\n * The Initial Developer of the Original Code is\r\n * Textalk AB http://textalk.se/\r\n * Portions created by the Initial Developer are Copyright (C)\r\n * the Initial Developer. All Rights Reserved.\r\n *\r\n * Contributor(s):\r\n *\r\n * Anthony Minessale II <anthm@freeswitch.org>\r\n *\r\n * jquery.jsonrpclient.js - JSON RPC client code\r\n *\r\n */\r\n/**\r\n * This plugin requires jquery.json.js to be available, or at least the methods $.toJSON and\r\n * $.parseJSON.\r\n *\r\n * The plan is to make use of websockets if they are available, but work just as well with only\r\n * http if not.\r\n *\r\n * Usage example:\r\n *\r\n *   var foo = new $.JsonRpcClient({ ajaxUrl: '/backend/jsonrpc' });\r\n *   foo.call(\r\n *     'bar', [ 'A parameter', 'B parameter' ],\r\n *     function(result) { alert('Foo bar answered: ' + result.my_answer); },\r\n *     function(error)  { console.log('There was an error', error); }\r\n *   );\r\n *\r\n * More examples are available in README.md\r\n */\r\n(function($) {\r\n  /**\r\n   * @fn new\r\n   * @memberof $.JsonRpcClient\r\n   *\r\n   * @param options An object stating the backends:\r\n   *                ajaxUrl    A url (relative or absolute) to a http(s) backend.\r\n   *                socketUrl  A url (relative of absolute) to a ws(s) backend.\r\n   *                onmessage  A socket message handler for other messages (non-responses).\r\n   *                getSocket  A function returning a WebSocket or null.\r\n   *                           It must take an onmessage_cb and bind it to the onmessage event\r\n   *                           (or chain it before/after some other onmessage handler).\r\n   *                           Or, it could return null if no socket is available.\r\n   *                           The returned instance must have readyState <= 1, and if less than 1,\r\n   *                           react to onopen binding.\r\n   */\r\n    $.JsonRpcClient = function(options) {\r\n        var self = this;\r\n        this.options = $.extend({\r\n            ajaxUrl       : null,\r\n            socketUrl     : null, ///< The ws-url for default getSocket.\r\n            onmessage     : null, ///< Other onmessage-handler.\r\n            login         : null, /// auth login\r\n            passwd        : null, /// auth passwd\r\n            sessid        : null,\r\n\t    loginParams   : null,\r\n\t    userVariables : null,\r\n            getSocket     : function(onmessage_cb) { return self._getSocket(onmessage_cb); }\r\n        }, options);\r\n\r\n        self.ws_cnt = 0;\r\n\r\n        // Declare an instance version of the onmessage callback to wrap 'this'.\r\n        this.wsOnMessage = function(event) { self._wsOnMessage(event); };\r\n    };\r\n\r\n    /// Holding the WebSocket on default getsocket.\r\n    $.JsonRpcClient.prototype._ws_socket = null;\r\n\r\n    /// Object <id>: { success_cb: cb, error_cb: cb }\r\n    $.JsonRpcClient.prototype._ws_callbacks = {};\r\n\r\n    /// The next JSON-RPC request id.\r\n    $.JsonRpcClient.prototype._current_id = 1;\r\n\r\n\r\n    $.JsonRpcClient.prototype.speedTest = function (bytes, cb) {\r\n        var socket = this.options.getSocket(this.wsOnMessage);\r\n\tif (socket !== null) {\r\n\t    this.speedCB = cb;\r\n\t    this.speedBytes = bytes;\r\n\t    socket.send(\"#SPU \" + bytes);\r\n\r\n\t    var loops = bytes / 1024;\r\n\t    var rem = bytes % 1024;\r\n\t    var i;\r\n\t    var data = new Array(1024).join(\".\");\r\n\t    for (i = 0; i < loops; i++) {\r\n\t\tsocket.send(\"#SPB \" + data);\r\n\t    }\r\n\t    \r\n\t    if (rem) {\r\n\t\tsocket.send(\"#SPB \" + data);\r\n\t    }\r\n\r\n\t    socket.send(\"#SPE\");\r\n\t}\r\n    };\r\n\r\n\r\n\r\n    /**\r\n     * @fn call\r\n     * @memberof $.JsonRpcClient\r\n     *\r\n     * @param method     The method to run on JSON-RPC server.\r\n     * @param params     The params; an array or object.\r\n     * @param success_cb A callback for successful request.\r\n     * @param error_cb   A callback for error.\r\n     */\r\n    $.JsonRpcClient.prototype.call = function(method, params, success_cb, error_cb) {\r\n    // Construct the JSON-RPC 2.0 request.\r\n\r\n        if (!params) {\r\n            params = {};\r\n        }\r\n\r\n        if (this.options.sessid) {\r\n            params.sessid = this.options.sessid;\r\n        }\r\n\r\n        var request = {\r\n            jsonrpc : '2.0',\r\n            method  : method,\r\n            params  : params,\r\n            id      : this._current_id++  // Increase the id counter to match request/response\r\n        };\r\n\r\n        if (!success_cb) {\r\n            success_cb = function(e){console.log(\"Success: \", e);};\r\n        }\r\n\r\n        if (!error_cb) {\r\n            error_cb = function(e){console.log(\"Error: \", e);};\r\n        }\r\n\r\n        // Try making a WebSocket call.\r\n        var socket = this.options.getSocket(this.wsOnMessage);\r\n        if (socket !== null) {\r\n            this._wsCall(socket, request, success_cb, error_cb);\r\n            return;\r\n        }\r\n\r\n        // No WebSocket, and no HTTP backend?  This won't work.\r\n        if (this.options.ajaxUrl === null) {\r\n            throw \"$.JsonRpcClient.call used with no websocket and no http endpoint.\";\r\n        }\r\n\r\n        $.ajax({\r\n            type     : 'POST',\r\n            url      : this.options.ajaxUrl,\r\n            data     : $.toJSON(request),\r\n            dataType : 'json',\r\n            cache    : false,\r\n\r\n            success  : function(data) {\r\n                if ('error' in data) error_cb(data.error, this);\r\n                success_cb(data.result, this);\r\n            },\r\n\r\n            // JSON-RPC Server could return non-200 on error\r\n            error    : function(jqXHR, textStatus, errorThrown) {\r\n                try {\r\n                    var response = $.parseJSON(jqXHR.responseText);\r\n\r\n                    if ('console' in window) console.log(response);\r\n\r\n                    error_cb(response.error, this);\r\n                } catch (err) {\r\n                    // Perhaps the responseText wasn't really a jsonrpc-error.\r\n                    error_cb({ error: jqXHR.responseText }, this);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Notify sends a command to the server that won't need a response.  In http, there is probably\r\n     * an empty response - that will be dropped, but in ws there should be no response at all.\r\n     *\r\n     * This is very similar to call, but has no id and no handling of callbacks.\r\n     *\r\n     * @fn notify\r\n     * @memberof $.JsonRpcClient\r\n     *\r\n     * @param method     The method to run on JSON-RPC server.\r\n     * @param params     The params; an array or object.\r\n     */\r\n    $.JsonRpcClient.prototype.notify = function(method, params) {\r\n        // Construct the JSON-RPC 2.0 request.\r\n\r\n        if (this.options.sessid) {\r\n            params.sessid = this.options.sessid;\r\n        }\r\n\r\n        var request = {\r\n            jsonrpc: '2.0',\r\n            method:  method,\r\n            params:  params\r\n        };\r\n\r\n        // Try making a WebSocket call.\r\n        var socket = this.options.getSocket(this.wsOnMessage);\r\n        if (socket !== null) {\r\n            this._wsCall(socket, request);\r\n            return;\r\n        }\r\n\r\n        // No WebSocket, and no HTTP backend?  This won't work.\r\n        if (this.options.ajaxUrl === null) {\r\n            throw \"$.JsonRpcClient.notify used with no websocket and no http endpoint.\";\r\n        }\r\n\r\n        $.ajax({\r\n            type     : 'POST',\r\n            url      : this.options.ajaxUrl,\r\n            data     : $.toJSON(request),\r\n            dataType : 'json',\r\n            cache    : false\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Make a batch-call by using a callback.\r\n     *\r\n     * The callback will get an object \"batch\" as only argument.  On batch, you can call the methods\r\n     * \"call\" and \"notify\" just as if it was a normal $.JsonRpcClient object, and all calls will be\r\n     * sent as a batch call then the callback is done.\r\n     *\r\n     * @fn batch\r\n     * @memberof $.JsonRpcClient\r\n     *\r\n     * @param callback    The main function which will get a batch handler to run call and notify on.\r\n     * @param all_done_cb A callback function to call after all results have been handled.\r\n     * @param error_cb    A callback function to call if there is an error from the server.\r\n     *                    Note, that batch calls should always get an overall success, and the\r\n     *                    only error\r\n     */\r\n    $.JsonRpcClient.prototype.batch = function(callback, all_done_cb, error_cb) {\r\n        var batch = new $.JsonRpcClient._batchObject(this, all_done_cb, error_cb);\r\n        callback(batch);\r\n        batch._execute();\r\n    };\r\n\r\n    /**\r\n     * The default getSocket handler.\r\n     *\r\n     * @param onmessage_cb The callback to be bound to onmessage events on the socket.\r\n     *\r\n     * @fn _getSocket\r\n     * @memberof $.JsonRpcClient\r\n     */\r\n\r\n    $.JsonRpcClient.prototype.socketReady = function() {\r\n        if (this._ws_socket === null || this._ws_socket.readyState > 1) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    $.JsonRpcClient.prototype.closeSocket = function() {\r\n\tvar self = this;\r\n        if (self.socketReady()) {\r\n            self._ws_socket.onclose = function (w) {console.log(\"Closing Socket\");};\r\n            self._ws_socket.close();\r\n        }\r\n    };\r\n\r\n    $.JsonRpcClient.prototype.loginData = function(params) {\r\n\tvar self = this;\r\n        self.options.login = params.login;\r\n        self.options.passwd = params.passwd;\r\n\tself.options.loginParams = params.loginParams;\r\n\tself.options.userVariables = params.userVariables;\r\n    };\r\n\r\n    $.JsonRpcClient.prototype.connectSocket = function(onmessage_cb) {\r\n        var self = this;\r\n\r\n        if (self.to) {\r\n            clearTimeout(self.to);\r\n        }\r\n\r\n        if (!self.socketReady()) {\r\n            self.authing = false;\r\n\r\n            if (self._ws_socket) {\r\n                delete self._ws_socket;\r\n            }\r\n\r\n            // No socket, or dying socket, let's get a new one.\r\n            self._ws_socket = new WebSocket(self.options.socketUrl);\r\n\r\n            if (self._ws_socket) {\r\n                // Set up onmessage handler.\r\n                self._ws_socket.onmessage = onmessage_cb;\r\n                self._ws_socket.onclose = function (w) {\r\n                    if (!self.ws_sleep) {\r\n                        self.ws_sleep = 1000;\r\n                    }\r\n\r\n                    if (self.options.onWSClose) {\r\n                        self.options.onWSClose(self);\r\n                    }\r\n\r\n                    console.error(\"Websocket Lost \" + self.ws_cnt + \" sleep: \" + self.ws_sleep + \"msec\");\r\n\r\n                    self.to = setTimeout(function() {\r\n                        console.log(\"Attempting Reconnection....\");\r\n                        self.connectSocket(onmessage_cb);\r\n                    }, self.ws_sleep);\r\n\r\n                    self.ws_cnt++;\r\n\r\n                    if (self.ws_sleep < 3000 && (self.ws_cnt % 10) === 0) {\r\n                        self.ws_sleep += 1000;\r\n                    }\r\n                };\r\n\r\n                // Set up sending of message for when the socket is open.\r\n                self._ws_socket.onopen = function() {\r\n                    if (self.to) {\r\n                        clearTimeout(self.to);\r\n                    }\r\n                    self.ws_sleep = 1000;\r\n                    self.ws_cnt = 0;\r\n                    if (self.options.onWSConnect) {\r\n                        self.options.onWSConnect(self);\r\n                    }\r\n\r\n                    var req;\r\n                    // Send the requests.\r\n                    while ((req = $.JsonRpcClient.q.pop())) {\r\n                        self._ws_socket.send(req);\r\n                    }\r\n                };\r\n            }\r\n        }\r\n\r\n        return self._ws_socket ? true : false;\r\n    };\r\n\r\n    $.JsonRpcClient.prototype.stopRetrying = function() {\r\n      if (self.to)\r\n        clearTimeout(self.to);\r\n    }\r\n\r\n    $.JsonRpcClient.prototype._getSocket = function(onmessage_cb) {\r\n        // If there is no ws url set, we don't have a socket.\r\n        // Likewise, if there is no window.WebSocket.\r\n        if (this.options.socketUrl === null || !(\"WebSocket\" in window)) return null;\r\n\r\n        this.connectSocket(onmessage_cb);\r\n\r\n        return this._ws_socket;\r\n    };\r\n\r\n    /**\r\n     * Queue to save messages delivered when websocket is not ready\r\n     */\r\n    $.JsonRpcClient.q = [];\r\n\r\n    /**\r\n     * Internal handler to dispatch a JRON-RPC request through a websocket.\r\n     *\r\n     * @fn _wsCall\r\n     * @memberof $.JsonRpcClient\r\n     */\r\n    $.JsonRpcClient.prototype._wsCall = function(socket, request, success_cb, error_cb) {\r\n        var request_json = $.toJSON(request);\r\n\r\n        if (socket.readyState < 1) {\r\n            // The websocket is not open yet; we have to set sending of the message in onopen.\r\n            self = this; // In closure below, this is set to the WebSocket.  Use self instead.\r\n            $.JsonRpcClient.q.push(request_json);\r\n        } else {\r\n            // We have a socket and it should be ready to send on.\r\n            socket.send(request_json);\r\n        }\r\n\r\n        // Setup callbacks.  If there is an id, this is a call and not a notify.\r\n        if ('id' in request && typeof success_cb !== 'undefined') {\r\n            this._ws_callbacks[request.id] = { request: request_json, request_obj: request, success_cb: success_cb, error_cb: error_cb };\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Internal handler for the websocket messages.  It determines if the message is a JSON-RPC\r\n     * response, and if so, tries to couple it with a given callback.  Otherwise, it falls back to\r\n     * given external onmessage-handler, if any.\r\n     *\r\n     * @param event The websocket onmessage-event.\r\n     */\r\n    $.JsonRpcClient.prototype._wsOnMessage = function(event) {\r\n        // Check if this could be a JSON RPC message.\r\n        var response;\r\n\r\n\t// Special sub proto\r\n\tif (event.data[0] == \"#\" && event.data[1] == \"S\" && event.data[2] == \"P\") {\r\n\t    if (event.data[3] == \"U\") {\r\n\t\tthis.up_dur = parseInt(event.data.substring(4));\r\n\t    } else if (this.speedCB && event.data[3] == \"D\") {\r\n\t\tthis.down_dur = parseInt(event.data.substring(4));\r\n\r\n\t\tvar up_kps = (((this.speedBytes * 8) / (this.up_dur / 1000)) / 1024).toFixed(0);\r\n\t\tvar down_kps = (((this.speedBytes * 8) / (this.down_dur / 1000)) / 1024).toFixed(0);\r\n\t\t\r\n\t\tconsole.info(\"Speed Test: Up: \" + up_kps + \" Down: \" + down_kps);\r\n\t\tthis.speedCB(event, { upDur: this.up_dur, downDur: this.down_dur, upKPS: up_kps, downKPS: down_kps });\r\n\t\tthis.speedCB = null;\r\n\t    }\r\n\t    \r\n\t    return;\r\n\t}\r\n\r\n\r\n        try {\r\n            response = $.parseJSON(event.data);\r\n\r\n            /// @todo Make using the jsonrcp 2.0 check optional, to use this on JSON-RPC 1 backends.\r\n\r\n            if (typeof response === 'object' &&\r\n                'jsonrpc' in response &&\r\n                response.jsonrpc === '2.0') {\r\n\r\n                /// @todo Handle bad response (without id).\r\n\r\n                // If this is an object with result, it is a response.\r\n                if ('result' in response && this._ws_callbacks[response.id]) {\r\n                    // Get the success callback.\r\n                    var success_cb = this._ws_callbacks[response.id].success_cb;\r\n\r\n    /*\r\n                    // set the sessid if present\r\n                    if ('sessid' in response.result && !this.options.sessid || (this.options.sessid != response.result.sessid)) {\r\n                        this.options.sessid = response.result.sessid;\r\n                        if (this.options.sessid) {\r\n                            console.log(\"setting session UUID to: \" + this.options.sessid);\r\n                        }\r\n                    }\r\n    */\r\n                    // Delete the callback from the storage.\r\n                    delete this._ws_callbacks[response.id];\r\n\r\n                    // Run callback with result as parameter.\r\n                    success_cb(response.result, this);\r\n                    return;\r\n                } else if ('error' in response && this._ws_callbacks[response.id]) {\r\n                // If this is an object with error, it is an error response.\r\n\r\n                // Get the error callback.\r\n                    var error_cb = this._ws_callbacks[response.id].error_cb;\r\n                    var orig_req = this._ws_callbacks[response.id].request;\r\n\r\n                    // if this is an auth request, send the credentials and resend the failed request\r\n                    if (!self.authing && response.error.code == -32000 && self.options.login && self.options.passwd) {\r\n                        self.authing = true;\r\n\r\n                        this.call(\"login\", { login: self.options.login, passwd: self.options.passwd, loginParams: self.options.loginParams,\r\n\t\t\t\t\t     userVariables: self.options.userVariables},\r\n                            this._ws_callbacks[response.id].request_obj.method == \"login\" ?\r\n                            function(e) {\r\n                                self.authing = false;\r\n                                console.log(\"logged in\");\r\n                                delete self._ws_callbacks[response.id];\r\n\r\n                                if (self.options.onWSLogin) {\r\n                                    self.options.onWSLogin(true, self);\r\n                                }\r\n                            }\r\n\r\n                            :\r\n\r\n                            function(e) {\r\n                                self.authing = false;\r\n                                console.log(\"logged in, resending request id: \" + response.id);\r\n                                var socket = self.options.getSocket(self.wsOnMessage);\r\n                                if (socket !== null) {\r\n                                    socket.send(orig_req);\r\n                                }\r\n                                if (self.options.onWSLogin) {\r\n                                    self.options.onWSLogin(true, self);\r\n                                }\r\n                            },\r\n\r\n                            function(e) {\r\n                                console.log(\"error logging in, request id:\", response.id);\r\n                                delete self._ws_callbacks[response.id];\r\n                                error_cb(response.error, this);\r\n                                if (self.options.onWSLogin) {\r\n                                self.options.onWSLogin(false, self);\r\n                                }\r\n                            });\r\n                            return;\r\n                        }\r\n\r\n                        // Delete the callback from the storage.\r\n                        delete this._ws_callbacks[response.id];\r\n\r\n                        // Run callback with the error object as parameter.\r\n                        error_cb(response.error, this);\r\n                        return;\r\n                    }\r\n                }\r\n            } catch (err) {\r\n            // Probably an error while parsing a non json-string as json.  All real JSON-RPC cases are\r\n            // handled above, and the fallback method is called below.\r\n            console.log(\"ERROR: \"+ err);\r\n            return;\r\n        }\r\n\r\n        // This is not a JSON-RPC response.  Call the fallback message handler, if given.\r\n        if (typeof this.options.onmessage === 'function') {\r\n            event.eventData = response;\r\n            if (!event.eventData) {\r\n                event.eventData = {};\r\n            }\r\n\r\n            var reply = this.options.onmessage(event);\r\n\r\n            if (reply && typeof reply === \"object\" && event.eventData.id) {\r\n                var msg = {\r\n                    jsonrpc: \"2.0\",\r\n                    id: event.eventData.id,\r\n                    result: reply\r\n                };\r\n\r\n                var socket = self.options.getSocket(self.wsOnMessage);\r\n                if (socket !== null) {\r\n                    socket.send($.toJSON(msg));\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    /************************************************************************************************\r\n     * Batch object with methods\r\n     ************************************************************************************************/\r\n\r\n    /**\r\n     * Handling object for batch calls.\r\n     */\r\n    $.JsonRpcClient._batchObject = function(jsonrpcclient, all_done_cb, error_cb) {\r\n        // Array of objects to hold the call and notify requests.  Each objects will have the request\r\n        // object, and unless it is a notify, success_cb and error_cb.\r\n        this._requests   = [];\r\n\r\n        this.jsonrpcclient = jsonrpcclient;\r\n        this.all_done_cb = all_done_cb;\r\n        this.error_cb    = typeof error_cb === 'function' ? error_cb : function() {};\r\n\r\n    };\r\n\r\n    /**\r\n     * @sa $.JsonRpcClient.prototype.call\r\n     */\r\n    $.JsonRpcClient._batchObject.prototype.call = function(method, params, success_cb, error_cb) {\r\n\r\n        if (!params) {\r\n            params = {};\r\n        }\r\n\r\n        if (this.options.sessid) {\r\n            params.sessid = this.options.sessid;\r\n        }\r\n\r\n        if (!success_cb) {\r\n            success_cb = function(e){console.log(\"Success: \", e);};\r\n        }\r\n\r\n        if (!error_cb) {\r\n        error_cb = function(e){console.log(\"Error: \", e);};\r\n        }\r\n\r\n        this._requests.push({\r\n            request    : {\r\n            jsonrpc : '2.0',\r\n            method  : method,\r\n            params  : params,\r\n            id      : this.jsonrpcclient._current_id++  // Use the client's id series.\r\n        },\r\n            success_cb : success_cb,\r\n            error_cb   : error_cb\r\n        });\r\n    };\r\n\r\n    /**\r\n     * @sa $.JsonRpcClient.prototype.notify\r\n     */\r\n    $.JsonRpcClient._batchObject.prototype.notify = function(method, params) {\r\n        if (this.options.sessid) {\r\n            params.sessid = this.options.sessid;\r\n        }\r\n\r\n        this._requests.push({\r\n            request    : {\r\n                jsonrpc : '2.0',\r\n                method  : method,\r\n                params  : params\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Executes the batched up calls.\r\n     */\r\n    $.JsonRpcClient._batchObject.prototype._execute = function() {\r\n        var self = this;\r\n\r\n        if (this._requests.length === 0) return; // All done :P\r\n\r\n        // Collect all request data and sort handlers by request id.\r\n        var batch_request = [];\r\n        var handlers = {};\r\n        var i = 0;\r\n        var call;\r\n        var success_cb;\r\n        var error_cb;\r\n\r\n        // If we have a WebSocket, just send the requests individually like normal calls.\r\n        var socket = self.jsonrpcclient.options.getSocket(self.jsonrpcclient.wsOnMessage);\r\n        if (socket !== null) {\r\n            for (i = 0; i < this._requests.length; i++) {\r\n                call = this._requests[i];\r\n                success_cb = ('success_cb' in call) ? call.success_cb : undefined;\r\n                error_cb   = ('error_cb'   in call) ? call.error_cb   : undefined;\r\n                self.jsonrpcclient._wsCall(socket, call.request, success_cb, error_cb);\r\n            }\r\n\r\n            if (typeof all_done_cb === 'function') all_done_cb(result);\r\n            return;\r\n        }\r\n\r\n        for (i = 0; i < this._requests.length; i++) {\r\n            call = this._requests[i];\r\n            batch_request.push(call.request);\r\n\r\n            // If the request has an id, it should handle returns (otherwise it's a notify).\r\n            if ('id' in call.request) {\r\n                handlers[call.request.id] = {\r\n                    success_cb : call.success_cb,\r\n                    error_cb   : call.error_cb\r\n                };\r\n            }\r\n        }\r\n\r\n        success_cb = function(data) { self._batchCb(data, handlers, self.all_done_cb); };\r\n\r\n        // No WebSocket, and no HTTP backend?  This won't work.\r\n        if (self.jsonrpcclient.options.ajaxUrl === null) {\r\n            throw \"$.JsonRpcClient.batch used with no websocket and no http endpoint.\";\r\n        }\r\n\r\n        // Send request\r\n        $.ajax({\r\n            url      : self.jsonrpcclient.options.ajaxUrl,\r\n            data     : $.toJSON(batch_request),\r\n            dataType : 'json',\r\n            cache    : false,\r\n            type     : 'POST',\r\n\r\n            // Batch-requests should always return 200\r\n            error    : function(jqXHR, textStatus, errorThrown) {\r\n                self.error_cb(jqXHR, textStatus, errorThrown);\r\n            },\r\n            success  : success_cb\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Internal helper to match the result array from a batch call to their respective callbacks.\r\n     *\r\n     * @fn _batchCb\r\n     * @memberof $.JsonRpcClient\r\n     */\r\n    $.JsonRpcClient._batchObject.prototype._batchCb = function(result, handlers, all_done_cb) {\r\n        for (var i = 0; i < result.length; i++) {\r\n            var response = result[i];\r\n\r\n            // Handle error\r\n            if ('error' in response) {\r\n                if (response.id === null || !(response.id in handlers)) {\r\n                    // An error on a notify?  Just log it to the console.\r\n                    if ('console' in window) console.log(response);\r\n                } else {\r\n                    handlers[response.id].error_cb(response.error, this);\r\n                }\r\n            } else {\r\n                // Here we should always have a correct id and no error.\r\n                if (!(response.id in handlers) && 'console' in window) {\r\n                    console.log(response);\r\n                } else {\r\n                    handlers[response.id].success_cb(response.result, this);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (typeof all_done_cb === 'function') all_done_cb(result);\r\n    };\r\n\r\n})(jQuery);\r\n\r\n/*\r\n * Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\r\n * Copyright (C) 2005-2014, Anthony Minessale II <anthm@freeswitch.org>\r\n *\r\n * Version: MPL 1.1\r\n *\r\n * The contents of this file are subject to the Mozilla Public License Version\r\n * 1.1 (the \"License\"); you may not use this file except in compliance with\r\n * the License. You may obtain a copy of the License at\r\n * http://www.mozilla.org/MPL/\r\n *\r\n * Software distributed under the License is distributed on an \"AS IS\" basis,\r\n * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\r\n * for the specific language governing rights and limitations under the\r\n * License.\r\n *\r\n * The Original Code is Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\r\n *\r\n * The Initial Developer of the Original Code is\r\n * Anthony Minessale II <anthm@freeswitch.org>\r\n * Portions created by the Initial Developer are Copyright (C)\r\n * the Initial Developer. All Rights Reserved.\r\n *\r\n * Contributor(s):\r\n *\r\n * Anthony Minessale II <anthm@freeswitch.org>\r\n *\r\n * jquery.FSRTC.js - WebRTC Glue code\r\n *\r\n */\r\n\r\n(function($) {\r\n\r\n    // Find the line in sdpLines that starts with |prefix|, and, if specified,\r\n    // contains |substr| (case-insensitive search).\r\n    function findLine(sdpLines, prefix, substr) {\r\n        return findLineInRange(sdpLines, 0, -1, prefix, substr);\r\n    }\r\n\r\n    // Find the line in sdpLines[startLine...endLine - 1] that starts with |prefix|\r\n    // and, if specified, contains |substr| (case-insensitive search).\r\n    function findLineInRange(sdpLines, startLine, endLine, prefix, substr) {\r\n        var realEndLine = (endLine != -1) ? endLine : sdpLines.length;\r\n        for (var i = startLine; i < realEndLine; ++i) {\r\n            if (sdpLines[i].indexOf(prefix) === 0) {\r\n                if (!substr || sdpLines[i].toLowerCase().indexOf(substr.toLowerCase()) !== -1) {\r\n                    return i;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // Gets the codec payload type from an a=rtpmap:X line.\r\n    function getCodecPayloadType(sdpLine) {\r\n        var pattern = new RegExp('a=rtpmap:(\\\\d+) \\\\w+\\\\/\\\\d+');\r\n        var result = sdpLine.match(pattern);\r\n        return (result && result.length == 2) ? result[1] : null;\r\n    }\r\n    \r\n    // Returns a new m= line with the specified codec as the first one.\r\n    function setDefaultCodec(mLine, payload) {\r\n        var elements = mLine.split(' ');\r\n        var newLine = [];\r\n        var index = 0;\r\n        for (var i = 0; i < elements.length; i++) {\r\n            if (index === 3) { // Format of media starts from the fourth.\r\n                newLine[index++] = payload; // Put target payload to the first.\r\n            }\r\n            if (elements[i] !== payload) newLine[index++] = elements[i];\r\n        }\r\n        return newLine.join(' ');\r\n    }\r\n\r\n    $.FSRTC = function(options) {\r\n        this.options = $.extend({\r\n            useVideo: null,\r\n            useStereo: false,\r\n            userData: null,\r\n\t    localVideo: null,\r\n\t    screenShare: false,\r\n\t    useCamera: \"any\",\r\n            iceServers: false,\r\n            videoParams: {},\r\n            audioParams: {},\r\n            callbacks: {\r\n                onICEComplete: function() {},\r\n                onICE: function() {},\r\n                onOfferSDP: function() {}\r\n            },\r\n        }, options);\r\n\r\n\tthis.audioEnabled = true;\r\n\tthis.videoEnabled = true;\r\n\r\n\r\n        this.mediaData = {\r\n            SDP: null,\r\n            profile: {},\r\n            candidateList: []\r\n        };\r\n\r\n\tthis.constraints = {\r\n\t    offerToReceiveAudio: this.options.useSpeak === \"none\" ? false : true,\r\n\t    offerToReceiveVideo: this.options.useVideo ? true : false,\r\n\t};\r\n\r\n        if (self.options.useVideo) {\r\n            self.options.useVideo.style.display = 'none';\r\n        }\r\n\r\n        setCompat();\r\n        checkCompat();\r\n    };\r\n\r\n    $.FSRTC.validRes = [];\r\n\r\n    $.FSRTC.prototype.useVideo = function(obj, local) {\r\n        var self = this;\r\n\r\n        if (obj) {\r\n            self.options.useVideo = obj;\r\n\t    self.options.localVideo = local;\r\n\t    self.constraints.offerToReceiveVideo = true;\r\n        } else {\r\n            self.options.useVideo = null;\r\n\t    self.options.localVideo = null;\r\n\t    self.constraints.offerToReceiveVideo = false;\r\n        }\r\n\r\n        if (self.options.useVideo) {\r\n            self.options.useVideo.style.display = 'none';\r\n        }\r\n    };\r\n\r\n    $.FSRTC.prototype.useStereo = function(on) {\r\n        var self = this;\r\n        self.options.useStereo = on;\r\n    };\r\n\r\n    // Sets Opus in stereo if stereo is enabled, by adding the stereo=1 fmtp param.\r\n    $.FSRTC.prototype.stereoHack = function(sdp) {\r\n        var self = this;\r\n\r\n        if (!self.options.useStereo) {\r\n            return sdp;\r\n        }\r\n\r\n        var sdpLines = sdp.split('\\r\\n');\r\n\r\n        // Find opus payload.\r\n        var opusIndex = findLine(sdpLines, 'a=rtpmap', 'opus/48000'), opusPayload;\r\n\r\n        if (!opusIndex) {\r\n\t    return sdp;\r\n\t} else {\r\n            opusPayload = getCodecPayloadType(sdpLines[opusIndex]);\r\n        }\r\n\r\n        // Find the payload in fmtp line.\r\n        var fmtpLineIndex = findLine(sdpLines, 'a=fmtp:' + opusPayload.toString());\r\n\r\n        if (fmtpLineIndex === null) {\r\n\t    // create an fmtp line\r\n\t    sdpLines[opusIndex] = sdpLines[opusIndex] + '\\r\\na=fmtp:' + opusPayload.toString() + \" stereo=1; sprop-stereo=1\"\r\n\t} else {\r\n            // Append stereo=1 to fmtp line.\r\n            sdpLines[fmtpLineIndex] = sdpLines[fmtpLineIndex].concat('; stereo=1; sprop-stereo=1');\r\n\t}\r\n\r\n        sdp = sdpLines.join('\\r\\n');\r\n        return sdp;\r\n    };\r\n\r\n    function setCompat() {\r\n    }\r\n\r\n    function checkCompat() {\r\n        return true;\r\n    }\r\n\r\n    function onStreamError(self, e) {\r\n        console.log('There has been a problem retrieving the streams - did you allow access? Check Device Resolution', e);\r\n        doCallback(self, \"onError\", e);\r\n    }\r\n\r\n    function onStreamSuccess(self, stream) {\r\n        console.log(\"Stream Success\");\r\n        doCallback(self, \"onStream\", stream);\r\n    }\r\n\r\n    function onICE(self, candidate) {\r\n        self.mediaData.candidate = candidate;\r\n        self.mediaData.candidateList.push(self.mediaData.candidate);\r\n\r\n        doCallback(self, \"onICE\");\r\n    }\r\n\r\n    function doCallback(self, func, arg) {\r\n        if (func in self.options.callbacks) {\r\n            self.options.callbacks[func](self, arg);\r\n        }\r\n    }\r\n\r\n    function onICEComplete(self, candidate) {\r\n        console.log(\"ICE Complete\");\r\n        doCallback(self, \"onICEComplete\");\r\n    }\r\n\r\n    function onChannelError(self, e) {\r\n        console.error(\"Channel Error\", e);\r\n        doCallback(self, \"onError\", e);\r\n    }\r\n\r\n    function onICESDP(self, sdp) {\r\n        self.mediaData.SDP = self.stereoHack(sdp.sdp);\r\n        console.log(\"ICE SDP\");\r\n        doCallback(self, \"onICESDP\");\r\n    }\r\n\r\n    function onAnswerSDP(self, sdp) {\r\n        self.answer.SDP = self.stereoHack(sdp.sdp);\r\n        console.log(\"ICE ANSWER SDP\");\r\n        doCallback(self, \"onAnswerSDP\", self.answer.SDP);\r\n    }\r\n\r\n    function onMessage(self, msg) {\r\n        console.log(\"Message\");\r\n        doCallback(self, \"onICESDP\", msg);\r\n    }\r\n\r\n    FSRTCattachMediaStream = function(element, stream) {\r\n        if (typeof element.srcObject !== 'undefined') {\r\n\t    element.srcObject = stream;\r\n\t} else if (typeof element.src !== 'undefined') {\r\n\t    element.src = URL.createObjectURL(stream);\r\n\t} else {\r\n\t    console.error('Error attaching stream to element.');\r\n\t}\r\n    }\r\n    \r\n    function onRemoteStream(self, stream) {\r\n        if (self.options.useVideo) {\r\n            self.options.useVideo.style.display = 'block';\r\n\r\n\t    // Hacks for Mobile Safari\r\n\t    var iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\r\n\r\n\t    if (iOS) {\r\n\t\tself.options.useVideo.setAttribute(\"playsinline\", true);\r\n\t\tself.options.useVideo.setAttribute(\"controls\", true);\r\n\t    }\r\n        }\r\n\r\n        var element = self.options.useAudio;\r\n        console.log(\"REMOTE STREAM\", stream, element);\r\n\r\n\tFSRTCattachMediaStream(element, stream);\r\n\t\r\n\r\n\t\r\n        //self.options.useAudio.play();\r\n        self.remoteStream = stream;\r\n    }\r\n\r\n    function onOfferSDP(self, sdp) {\r\n        self.mediaData.SDP = self.stereoHack(sdp.sdp);\r\n        console.log(\"Offer SDP\");\r\n        doCallback(self, \"onOfferSDP\");\r\n    }\r\n\r\n    $.FSRTC.prototype.answer = function(sdp, onSuccess, onError) {\r\n        this.peer.addAnswerSDP({\r\n            type: \"answer\",\r\n            sdp: sdp\r\n        },\r\n        onSuccess, onError);\r\n    };\r\n\r\n    $.FSRTC.prototype.stopPeer = function() {\r\n        if (self.peer) {\r\n            console.log(\"stopping peer\");\r\n            self.peer.stop();\r\n        }\r\n    }\r\n\r\n    $.FSRTC.prototype.stop = function() {\r\n        var self = this;\r\n\r\n        if (self.options.useVideo) {\r\n            self.options.useVideo.style.display = 'none';\r\n            self.options.useVideo['src'] = '';\r\n        }\r\n\r\n        if (self.localStream) {\r\n            if(typeof self.localStream.stop == 'function') {\r\n                self.localStream.stop();\r\n            } else {\r\n\t\tif (self.localStream.active){\r\n                    var tracks = self.localStream.getTracks();\r\n                    console.log(tracks);\r\n\t\t    tracks.forEach(function(track, index){\r\n\t\t\tconsole.log(track);\r\n\t\t\ttrack.stop();\r\n\t\t    })\r\n                }\r\n            }\r\n            self.localStream = null;\r\n        }\r\n\r\n        if (self.options.localVideo) {\r\n            self.options.localVideo.style.display = 'none';\r\n            self.options.localVideo['src'] = '';\r\n        }\r\n\r\n\tif (self.options.localVideoStream) {\r\n            if(typeof self.options.localVideoStream.stop == 'function') {\r\n\t        self.options.localVideoStream.stop();\r\n            } else {\r\n\t\tif (self.options.localVideoStream.active){\r\n                    var tracks = self.options.localVideoStream.getTracks();\r\n                    console.log(tracks);\r\n\t\t    tracks.forEach(function(track, index){\r\n\t\t\tconsole.log(track);\r\n\t\t\ttrack.stop();\r\n\t\t    })\r\n                }\r\n            }\r\n        }\r\n\r\n        if (self.peer) {\r\n            console.log(\"stopping peer\");\r\n            self.peer.stop();\r\n        }\r\n    };\r\n\r\n    $.FSRTC.prototype.getMute = function() {\r\n\tvar self = this;\r\n\treturn self.audioEnabled;\r\n    }\r\n\r\n    $.FSRTC.prototype.setMute = function(what) {\r\n\tvar self = this;\r\n\tvar audioTracks = self.localStream.getAudioTracks();\t\r\n\r\n\tfor (var i = 0, len = audioTracks.length; i < len; i++ ) {\r\n\t    switch(what) {\r\n\t    case \"on\":\r\n\t\taudioTracks[i].enabled = true;\r\n\t\tbreak;\r\n\t    case \"off\":\r\n\t\taudioTracks[i].enabled = false;\r\n\t\tbreak;\r\n\t    case \"toggle\":\r\n\t\taudioTracks[i].enabled = !audioTracks[i].enabled;\r\n\t    default:\r\n\t\tbreak;\r\n\t    }\r\n\r\n\t    self.audioEnabled = audioTracks[i].enabled;\r\n\t}\r\n\r\n\treturn !self.audioEnabled;\r\n    }\r\n\r\n    $.FSRTC.prototype.getVideoMute = function() {\r\n\tvar self = this;\r\n\treturn self.videoEnabled;\r\n    }\r\n\r\n    $.FSRTC.prototype.setVideoMute = function(what) {\r\n\tvar self = this;\r\n\tvar videoTracks = self.localStream.getVideoTracks();\t\r\n\r\n\tfor (var i = 0, len = videoTracks.length; i < len; i++ ) {\r\n\t    switch(what) {\r\n\t    case \"on\":\r\n\t\tvideoTracks[i].enabled = true;\r\n\t\tbreak;\r\n\t    case \"off\":\r\n\t\tvideoTracks[i].enabled = false;\r\n\t\tbreak;\r\n\t    case \"toggle\":\r\n\t\tvideoTracks[i].enabled = !videoTracks[i].enabled;\r\n\t    default:\r\n\t\tbreak;\r\n\t    }\r\n\r\n\t    self.videoEnabled = videoTracks[i].enabled;\r\n\t}\r\n\r\n\treturn !self.videoEnabled;\r\n    }\r\n\r\n    $.FSRTC.prototype.createAnswer = function(params) {\r\n        var self = this;\r\n        self.type = \"answer\";\r\n        self.remoteSDP = params.sdp;\r\n        console.debug(\"inbound sdp: \", params.sdp);\r\n\r\n        function onSuccess(stream) {\r\n            self.localStream = stream;\r\n\r\n            self.peer = FSRTCPeerConnection({\r\n                type: self.type,\r\n                attachStream: self.localStream,\r\n                onICE: function(candidate) {\r\n                    return onICE(self, candidate);\r\n                },\r\n                onICEComplete: function() {\r\n                    return onICEComplete(self);\r\n                },\r\n                onRemoteStream: function(stream) {\r\n                    return onRemoteStream(self, stream);\r\n                },\r\n                onICESDP: function(sdp) {\r\n                    return onICESDP(self, sdp);\r\n                },\r\n                onChannelError: function(e) {\r\n                    return onChannelError(self, e);\r\n                },\r\n                constraints: self.constraints,\r\n                iceServers: self.options.iceServers,\r\n                offerSDP: {\r\n                    type: \"offer\",\r\n                    sdp: self.remoteSDP\r\n                }\r\n            });\r\n\r\n            onStreamSuccess(self, stream);\r\n        }\r\n\r\n        function onError(e) {\r\n            onStreamError(self, e);\r\n        }\r\n\r\n\tvar mediaParams = getMediaParams(self);\r\n\r\n\tconsole.log(\"Audio constraints\", mediaParams.audio);\r\n\tconsole.log(\"Video constraints\", mediaParams.video);\r\n\r\n\tif (self.options.useVideo && self.options.localVideo) {\r\n            getUserMedia({\r\n\t\tconstraints: {\r\n                    audio: false,\r\n                    video: {\r\n\t\t\t//mandatory: self.options.videoParams,\r\n\t\t\t//optional: []\r\n                    },\r\n\t\t},\r\n\t\tlocalVideo: self.options.localVideo,\r\n\t\tonsuccess: function(e) {self.options.localVideoStream = e; console.log(\"local video ready\");},\r\n\t\tonerror: function(e) {console.error(\"local video error!\");}\r\n            });\r\n\t}\r\n\r\n        getUserMedia({\r\n            constraints: {\r\n\t\taudio: mediaParams.audio,\r\n\t\tvideo: mediaParams.video\r\n            },\r\n            video: mediaParams.useVideo,\r\n            onsuccess: onSuccess,\r\n            onerror: onError\r\n        });\r\n\r\n\r\n\r\n    };\r\n\r\n    function getMediaParams(obj) {\r\n\r\n\tvar audio;\r\n\r\n\tif (obj.options.useMic && obj.options.useMic === \"none\") {\r\n\t    console.log(\"Microphone Disabled\");\r\n\t    audio = false;\r\n\t} else if (obj.options.videoParams && obj.options.screenShare) {//obj.options.videoParams.chromeMediaSource == 'desktop') {\r\n\t    console.error(\"SCREEN SHARE\", obj.options.videoParams);\r\n\t    audio = false;\r\n\t} else {\r\n\t    audio = {\r\n\t    };\r\n\r\n\t    if (obj.options.audioParams) {\r\n\t        audio = obj.options.audioParams;\r\n            }\r\n\r\n\t    if (obj.options.useMic !== \"any\") {\r\n\t\t//audio.optional = [{sourceId: obj.options.useMic}];\r\n\t\taudio.deviceId = {exact: obj.options.useMic};\r\n\t    }\r\n\t}\r\n\r\n\tif (obj.options.useVideo && obj.options.localVideo) {\r\n            getUserMedia({\r\n\t\tconstraints: {\r\n                    audio: false,\r\n                    video: obj.options.videoParams\r\n                    \r\n\t\t},\r\n\t\tlocalVideo: obj.options.localVideo,\r\n\t\tonsuccess: function(e) {self.options.localVideoStream = e; console.log(\"local video ready\");},\r\n\t\tonerror: function(e) {console.error(\"local video error!\");}\r\n            });\r\n\t}\r\n\r\n\tvar video = {};\r\n\tvar bestFrameRate = obj.options.videoParams.vertoBestFrameRate;\r\n\tvar minFrameRate = obj.options.videoParams.minFrameRate || 15;\r\n\tdelete obj.options.videoParams.vertoBestFrameRate;\r\n\r\n\tif (obj.options.screenShare) {\r\n\t    if (!obj.options.useCamera && !!navigator.mozGetUserMedia) {\r\n\t\t//This is an issue, only FireFox needs to ask this additional question if its screen or window we need a better way\r\n\t\tvar dowin = window.confirm(\"Do you want to share an application window?  If not you can share an entire screen.\");\r\n\r\n\t\tvideo = {\r\n\t\t    width: {min: obj.options.videoParams.minWidth, max: obj.options.videoParams.maxWidth},\r\n\t\t    height: {min: obj.options.videoParams.minHeight, max: obj.options.videoParams.maxHeight},\r\n\t\t    mediaSource: dowin ? \"window\" : \"screen\"\r\n\t\t}\r\n\t    } else {\r\n\t\tvar opt = [];\r\n\t\tif (obj.options.useCamera) {\r\n\t\t    opt.push({sourceId: obj.options.useCamera});\r\n\t\t}\r\n\t\t\r\n\t\tif (bestFrameRate) {\r\n\t\t    opt.push({minFrameRate: bestFrameRate});\r\n\t\t    opt.push({maxFrameRate: bestFrameRate});\r\n\t\t}\r\n\t\t\r\n\t\tvideo = {\r\n\t\t    mandatory: obj.options.videoParams,\r\n\t\t    optional: opt\t\t\r\n\t\t};\r\n\t    }\r\n\t} else {\r\n\r\n\t    video = {\r\n\t\t//mandatory: obj.options.videoParams,\r\n\t\twidth: {min: obj.options.videoParams.minWidth, max: obj.options.videoParams.maxWidth},\r\n\t\theight: {min: obj.options.videoParams.minHeight, max: obj.options.videoParams.maxHeight}\r\n\t    };\r\n\t    \r\n            \r\n\t    \r\n\t    var useVideo = obj.options.useVideo;\r\n\r\n\t    if (useVideo && obj.options.useCamera && obj.options.useCamera !== \"none\") {\r\n\t\t//if (!video.optional) {\r\n\t\t//video.optional = [];\r\n\t\t//}\r\n\r\n\t\t\r\n\t\tif (obj.options.useCamera !== \"any\") {\r\n\t\t    //video.optional.push({sourceId: obj.options.useCamera});\r\n\t\t    video.deviceId = obj.options.useCamera;\r\n\t\t}\r\n\r\n\t\tif (bestFrameRate) {\r\n\t\t    //video.optional.push({minFrameRate: bestFrameRate});\r\n\t\t    //video.optional.push({maxFrameRate: bestFrameRate});\r\n\t\t    video.frameRate = {ideal: bestFrameRate, min: minFrameRate, max: 30};\r\n\t\t}\r\n\r\n\t    } else {\r\n\t\tconsole.log(\"Camera Disabled\");\r\n\t\tvideo = false;\r\n\t\tuseVideo = false;\r\n\t    }\r\n\t}\r\n\r\n\treturn {audio: audio, video: video, useVideo: useVideo};\r\n    }\r\n    \r\n    $.FSRTC.prototype.call = function(profile) {\r\n        checkCompat();\r\n\t\r\n        var self = this;\r\n\tvar screen = false;\r\n\r\n        self.type = \"offer\";\r\n\r\n\tif (self.options.videoParams && self.options.screenShare) { //self.options.videoParams.chromeMediaSource == 'desktop') {\r\n\t    screen = true;\r\n\t}\r\n\r\n        function onSuccess(stream) {\r\n\t    self.localStream = stream;\r\n\t    \r\n\t    if (screen) {\r\n\t\tself.constraints.offerToReceiveVideo = false;\r\n\t\tself.constraints.offerToReceiveAudio = false;\r\n\t\tself.constraints.offerToSendAudio = false;\r\n\t    }\r\n\t    \r\n            self.peer = FSRTCPeerConnection({\r\n                type: self.type,\r\n                attachStream: self.localStream,\r\n                onICE: function(candidate) {\r\n                    return onICE(self, candidate);\r\n                },\r\n                onICEComplete: function() {\r\n                    return onICEComplete(self);\r\n                },\r\n                onRemoteStream: screen ? function(stream) {} : function(stream) {\r\n                    return onRemoteStream(self, stream);\r\n                },\r\n                onOfferSDP: function(sdp) {\r\n                    return onOfferSDP(self, sdp);\r\n                },\r\n                onICESDP: function(sdp) {\r\n                    return onICESDP(self, sdp);\r\n                },\r\n                onChannelError: function(e) {\r\n                    return onChannelError(self, e);\r\n                },\r\n                constraints: self.constraints,\r\n                iceServers: self.options.iceServers,\r\n            });\r\n\r\n            onStreamSuccess(self, stream);\r\n        }\r\n\r\n        function onError(e) {\r\n            onStreamError(self, e);\r\n        }\r\n\r\n\tvar mediaParams = getMediaParams(self);\r\n\r\n\tconsole.log(\"Audio constraints\", mediaParams.audio);\r\n\tconsole.log(\"Video constraints\", mediaParams.video);\r\n\r\n\tif (mediaParams.audio || mediaParams.video) {\r\n\r\n            getUserMedia({\r\n\t\tconstraints: {\r\n                    audio: mediaParams.audio,\r\n                    video: mediaParams.video\r\n\t\t},\r\n\t\tvideo: mediaParams.useVideo,\r\n\t\tonsuccess: onSuccess,\r\n\t\tonerror: onError\r\n            });\r\n\r\n\t} else {\r\n\t    onSuccess(null);\r\n\t}\r\n\r\n\r\n\r\n        /*\r\n        navigator.getUserMedia({\r\n            video: self.options.useVideo,\r\n            audio: true\r\n        }, onSuccess, onError);\r\n        */\r\n\r\n    };\r\n\r\n    // DERIVED from RTCPeerConnection-v1.5\r\n    // 2013, @muazkh - github.com/muaz-khan\r\n    // MIT License - https://www.webrtc-experiment.com/licence/\r\n    // Documentation - https://github.com/muaz-khan/WebRTC-Experiment/tree/master/RTCPeerConnection\r\n    \r\n    function FSRTCPeerConnection(options) {\r\n\tvar gathering = false, done = false;\r\n\tvar config = {};\r\n        var default_ice = {\r\n\t    urls: ['stun:stun.l.google.com:19302']\r\n\t};\r\n\r\n        if (options.iceServers) {\r\n            if (typeof(options.iceServers) === \"boolean\") {\r\n\t\tconfig.iceServers = [default_ice];\r\n            } else {\r\n\t\tconfig.iceServers = options.iceServers;\r\n\t    }\r\n        }\r\n\r\n        var peer = new window.RTCPeerConnection(config);\r\n\r\n        openOffererChannel();\r\n        var x = 0;\r\n\r\n\tfunction ice_handler() {\r\n\r\n\t    done = true;\r\n\t    gathering = null;\r\n\r\n            if (options.onICEComplete) {\r\n                options.onICEComplete();\r\n            }\r\n\t    \r\n            if (options.type == \"offer\") {\r\n                options.onICESDP(peer.localDescription);\r\n            } else {\r\n                if (!x && options.onICESDP) {\r\n                    options.onICESDP(peer.localDescription);\r\n                }\r\n            }\r\n        }\r\n\r\n        peer.onicecandidate = function(event) {\r\n\r\n\t    if (done) {\r\n\t\treturn;\r\n\t    }\r\n\r\n\t    if (!gathering) {\r\n\t\tgathering = setTimeout(ice_handler, 1000);\r\n\t    }\r\n\t    \r\n\t    if (event) {\r\n\t\tif (event.candidate) {\r\n\t\t    options.onICE(event.candidate);\r\n\t\t}\r\n\t    } else {\r\n\t\tdone = true;\r\n\r\n\t\tif (gathering) {\r\n\t\t    clearTimeout(gathering);\r\n\t\t    gathering = null;\r\n\t\t}\r\n\r\n\t\tice_handler();\r\n\t    }\r\n        };\r\n\r\n        // attachStream = MediaStream;\r\n        if (options.attachStream) peer.addStream(options.attachStream);\r\n\r\n        // attachStreams[0] = audio-stream;\r\n        // attachStreams[1] = video-stream;\r\n        // attachStreams[2] = screen-capturing-stream;\r\n        if (options.attachStreams && options.attachStream.length) {\r\n            var streams = options.attachStreams;\r\n            for (var i = 0; i < streams.length; i++) {\r\n                peer.addStream(streams[i]);\r\n            }\r\n        }\r\n\r\n        peer.onaddstream = function(event) {\r\n            var remoteMediaStream = event.stream;\r\n\r\n            // onRemoteStreamEnded(MediaStream)\r\n            remoteMediaStream.oninactive = function () {\r\n                if (options.onRemoteStreamEnded) options.onRemoteStreamEnded(remoteMediaStream);\r\n            };\r\n\r\n            // onRemoteStream(MediaStream)\r\n            if (options.onRemoteStream) options.onRemoteStream(remoteMediaStream);\r\n\r\n            //console.debug('on:add:stream', remoteMediaStream);\r\n        };\r\n\r\n        //var constraints = options.constraints || {\r\n\t  //  offerToReceiveAudio: true,\r\n\t    //offerToReceiveVideo: true   \r\n        //};\r\n\r\n        // onOfferSDP(RTCSessionDescription)\r\n        function createOffer() {\r\n            if (!options.onOfferSDP) return;\r\n\r\n            peer.createOffer(function(sessionDescription) {\r\n                sessionDescription.sdp = serializeSdp(sessionDescription.sdp);\r\n                peer.setLocalDescription(sessionDescription);\r\n                options.onOfferSDP(sessionDescription);\r\n            },\r\n\t\t\t\tonSdpError, options.constraints);\r\n        }\r\n\r\n        // onAnswerSDP(RTCSessionDescription)\r\n        function createAnswer() {\r\n            if (options.type != \"answer\") return;\r\n\r\n            //options.offerSDP.sdp = addStereo(options.offerSDP.sdp);\r\n            peer.setRemoteDescription(new window.RTCSessionDescription(options.offerSDP), onSdpSuccess, onSdpError);\r\n            peer.createAnswer(function(sessionDescription) {\r\n                sessionDescription.sdp = serializeSdp(sessionDescription.sdp);\r\n                peer.setLocalDescription(sessionDescription);\r\n                if (options.onAnswerSDP) {\r\n                    options.onAnswerSDP(sessionDescription);\r\n                }\r\n            },\r\n            onSdpError);\r\n        }\r\n\r\n\r\n        if ((options.onChannelMessage) || !options.onChannelMessage) {\r\n            createOffer();\r\n            createAnswer();\r\n        }\r\n\r\n        // DataChannel Bandwidth\r\n        function setBandwidth(sdp) {\r\n            // remove existing bandwidth lines\r\n            sdp = sdp.replace(/b=AS([^\\r\\n]+\\r\\n)/g, '');\r\n            sdp = sdp.replace(/a=mid:data\\r\\n/g, 'a=mid:data\\r\\nb=AS:1638400\\r\\n');\r\n\r\n            return sdp;\r\n        }\r\n\r\n        // old: FF<>Chrome interoperability management\r\n        function getInteropSDP(sdp) {\r\n            var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),\r\n            extractedChars = '';\r\n\r\n            function getChars() {\r\n                extractedChars += chars[parseInt(Math.random() * 40)] || '';\r\n                if (extractedChars.length < 40) getChars();\r\n\r\n                return extractedChars;\r\n            }\r\n\r\n            // usually audio-only streaming failure occurs out of audio-specific crypto line\r\n            // a=crypto:1 AES_CM_128_HMAC_SHA1_32 --------- kAttributeCryptoVoice\r\n            if (options.onAnswerSDP) sdp = sdp.replace(/(a=crypto:0 AES_CM_128_HMAC_SHA1_32)(.*?)(\\r\\n)/g, '');\r\n\r\n            // video-specific crypto line i.e. SHA1_80\r\n            // a=crypto:1 AES_CM_128_HMAC_SHA1_80 --------- kAttributeCryptoVideo\r\n            var inline = getChars() + '\\r\\n' + (extractedChars = '');\r\n            sdp = sdp.indexOf('a=crypto') == -1 ? sdp.replace(/c=IN/g, 'a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:' + inline + 'c=IN') : sdp;\r\n\r\n            return sdp;\r\n        }\r\n\r\n        function serializeSdp(sdp) {\r\n            return sdp;\r\n        }\r\n\r\n        // DataChannel management\r\n        var channel;\r\n\r\n        function openOffererChannel() {\r\n            if (!options.onChannelMessage) return;\r\n\r\n            _openOffererChannel();\r\n\r\n            return;\r\n        }\r\n\r\n        function _openOffererChannel() {\r\n            channel = peer.createDataChannel(options.channel || 'RTCDataChannel', {\r\n                reliable: false\r\n            });\r\n\r\n            setChannelEvents();\r\n        }\r\n\r\n        function setChannelEvents() {\r\n            channel.onmessage = function(event) {\r\n                if (options.onChannelMessage) options.onChannelMessage(event);\r\n            };\r\n\r\n            channel.onopen = function() {\r\n                if (options.onChannelOpened) options.onChannelOpened(channel);\r\n            };\r\n            channel.onclose = function(event) {\r\n                if (options.onChannelClosed) options.onChannelClosed(event);\r\n\r\n                console.warn('WebRTC DataChannel closed', event);\r\n            };\r\n            channel.onerror = function(event) {\r\n                if (options.onChannelError) options.onChannelError(event);\r\n\r\n                console.error('WebRTC DataChannel error', event);\r\n            };\r\n        }\r\n\r\n        function openAnswererChannel() {\r\n            peer.ondatachannel = function(event) {\r\n                channel = event.channel;\r\n                channel.binaryType = 'blob';\r\n                setChannelEvents();\r\n            };\r\n\r\n            return;\r\n        }\r\n\r\n        // fake:true is also available on chrome under a flag!\r\n        function useless() {\r\n            log('Error in fake:true');\r\n        }\r\n\r\n        function onSdpSuccess() {}\r\n\r\n        function onSdpError(e) {\r\n            if (options.onChannelError) {\r\n                options.onChannelError(e);\r\n            }\r\n            console.error('sdp error:', e);\r\n        }\r\n\r\n        return {\r\n            addAnswerSDP: function(sdp, cbSuccess, cbError) {\r\n\r\n                peer.setRemoteDescription(new window.RTCSessionDescription(sdp), cbSuccess ? cbSuccess : onSdpSuccess, cbError ? cbError : onSdpError);\r\n            },\r\n            addICE: function(candidate) {\r\n                peer.addIceCandidate(new window.RTCIceCandidate({\r\n                    sdpMLineIndex: candidate.sdpMLineIndex,\r\n                    candidate: candidate.candidate\r\n                }));\r\n            },\r\n\r\n            peer: peer,\r\n            channel: channel,\r\n            sendData: function(message) {\r\n                if (channel) {\r\n                    channel.send(message);\r\n                }\r\n            },\r\n\r\n            stop: function() {\r\n                peer.close();\r\n                if (options.attachStream) {\r\n                  if(typeof options.attachStream.stop == 'function') {\r\n                    options.attachStream.stop();\r\n                  } else {\r\n                    options.attachStream.active = false;\r\n                  }\r\n                }\r\n            }\r\n\r\n        };\r\n    }\r\n\r\n    // getUserMedia\r\n    var video_constraints = {\r\n        //mandatory: {},\r\n        //optional: []\r\n    };\r\n\r\n    function getUserMedia(options) {\r\n        var n = navigator,\r\n        media;\r\n        n.getMedia = n.getUserMedia;\r\n        n.getMedia(options.constraints || {\r\n            audio: true,\r\n            video: video_constraints\r\n        },\r\n        streaming, options.onerror ||\r\n        function(e) {\r\n            console.error(e);\r\n        });\r\n\r\n        function streaming(stream) {\r\n            if (options.localVideo) {\r\n                options.localVideo['src'] = window.URL.createObjectURL(stream);\r\n\t\toptions.localVideo.style.display = 'block';\r\n            }\r\n\r\n            if (options.onsuccess) {\r\n                options.onsuccess(stream);\r\n            }\r\n\r\n            media = stream;\r\n        }\r\n\r\n        return media;\r\n    }\r\n\r\n    $.FSRTC.resSupported = function(w, h) {\r\n\tfor (var i in $.FSRTC.validRes) {\r\n\t    if ($.FSRTC.validRes[i][0] == w && $.FSRTC.validRes[i][1] == h) {\r\n\t\treturn true;\r\n\t    }\r\n\t}\r\n\r\n\treturn false;\r\n    }\r\n\r\n    $.FSRTC.bestResSupported = function() {\r\n\tvar w = 0, h = 0;\r\n\r\n\tfor (var i in $.FSRTC.validRes) {\r\n\t    if ($.FSRTC.validRes[i][0] >= w && $.FSRTC.validRes[i][1] >= h) {\r\n\t\tw = $.FSRTC.validRes[i][0];\r\n\t\th = $.FSRTC.validRes[i][1];\r\n\t    }\r\n\t}\r\n\r\n\treturn [w, h];\r\n    }\r\n\r\n    var resList = [[160, 120], [320, 180], [320, 240], [640, 360], [640, 480], [1280, 720], [1920, 1080]];\r\n    var resI = 0;\r\n    var ttl = 0;\r\n\r\n    var checkRes = function (cam, func) {\r\n\r\n\tif (resI >= resList.length) {\r\n            var res = {\r\n               'validRes': $.FSRTC.validRes,\r\n               'bestResSupported': $.FSRTC.bestResSupported()\r\n            };\r\n\t    \r\n\t    localStorage.setItem(\"res_\" + cam, $.toJSON(res));\r\n\t    \r\n\t    if (func) return func(res);\r\n\t    return;\r\n\t}\r\n\r\n\tvar video = {\r\n            //mandatory: {},\r\n            //optional: []\r\n        }\t\r\n\t//FIXME\r\n\tif (cam) {\r\n\t    //video.optional = [{sourceId: cam}];\r\n\t    video.deviceId = {exact: cam};\r\n\t}\r\n\t\r\n\tw = resList[resI][0];\r\n\th = resList[resI][1];\r\n\tresI++;\r\n\r\n\tvideo = {\r\n\t    width: {exact: w},\r\n\t    height: {exact: h}\r\n\t    //\"minWidth\": w,\r\n\t    //\"minHeight\": h,\r\n\t    //\"maxWidth\": w,\r\n\t    //\"maxHeight\": h\r\n\t};\r\n\r\n\tgetUserMedia({\r\n\t    constraints: {\r\n                audio: ttl++ == 0,\r\n                video: video\t    \r\n\t    },\r\n\t    onsuccess: function(e) {\r\n\t\te.getTracks().forEach(function(track) {track.stop();});\r\n\t\tconsole.info(w + \"x\" + h + \" supported.\"); $.FSRTC.validRes.push([w, h]); checkRes(cam, func);},\r\n\t    onerror: function(e) {console.warn( w + \"x\" + h + \" not supported.\"); checkRes(cam, func);}\r\n        });\r\n    }\r\n    \r\n\r\n    $.FSRTC.getValidRes = function (cam, func) {\r\n\tvar used = [];\r\n\tvar cached = localStorage.getItem(\"res_\" + cam);\r\n\t\r\n\tif (cached) {\r\n\t    var cache = $.parseJSON(cached);\r\n\r\n\t    if (cache) {\r\n\t\t$.FSRTC.validRes = cache.validRes;\r\n\t\tconsole.log(\"CACHED RES FOR CAM \" + cam, cache);\r\n\t    } else {\r\n\t\tconsole.error(\"INVALID CACHE\");\r\n\t    }\r\n\t    return func ? func(cache) : null;\r\n\t}\r\n\r\n\r\n\t$.FSRTC.validRes = [];\r\n\tresI = 0;\r\n\r\n\tcheckRes(cam, func);\r\n    }\r\n\r\n    $.FSRTC.checkPerms = function (runtime, check_audio, check_video) {\r\n\tgetUserMedia({\r\n\t    constraints: {\r\n\t\taudio: check_audio,\r\n\t\tvideo: check_video,\r\n\t    },\r\n\t    onsuccess: function(e) {\r\n\r\n\t\te.getTracks().forEach(function(track) {track.stop();});\r\n\t\t\r\n\t\tconsole.info(\"media perm init complete\"); \r\n\t\tif (runtime) {\r\n                    setTimeout(runtime, 100, true);\r\n\t\t}\r\n            },\r\n\t    onerror: function(e) {\r\n\t\tif (check_video && check_audio) {\r\n\t\t    console.error(\"error, retesting with audio params only\");\r\n\t\t    return $.FSRTC.checkPerms(runtime, check_audio, false);\r\n\t\t}\r\n\r\n\t\tconsole.error(\"media perm init error\");\r\n\r\n\t\tif (runtime) {\r\n\t\t    runtime(false)\r\n\t\t}\r\n\t    }\r\n\t});\r\n    }\r\n\r\n})(jQuery);\r\n\r\n\r\n/*\r\n * Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\r\n * Copyright (C) 2005-2014, Anthony Minessale II <anthm@freeswitch.org>\r\n *\r\n * Version: MPL 1.1\r\n *\r\n * The contents of this file are subject to the Mozilla Public License Version\r\n * 1.1 (the \"License\"); you may not use this file except in compliance with\r\n * the License. You may obtain a copy of the License at\r\n * http://www.mozilla.org/MPL/\r\n *\r\n * Software distributed under the License is distributed on an \"AS IS\" basis,\r\n * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\r\n * for the specific language governing rights and limitations under the\r\n * License.\r\n *\r\n * The Original Code is Verto HTML5/Javascript Telephony Signaling and Control Protocol Stack for FreeSWITCH\r\n *\r\n * The Initial Developer of the Original Code is\r\n * Anthony Minessale II <anthm@freeswitch.org>\r\n * Portions created by the Initial Developer are Copyright (C)\r\n * the Initial Developer. All Rights Reserved.\r\n *\r\n * Contributor(s):\r\n *\r\n * Anthony Minessale II <anthm@freeswitch.org>\r\n *\r\n * jquery.verto.js - Main interface\r\n *\r\n */\r\n\r\n(function($) {\r\n    var sources = [];\r\n\r\n    var generateGUID = (typeof(window.crypto) !== 'undefined' && typeof(window.crypto.getRandomValues) !== 'undefined') ?\r\n    function() {\r\n        // If we have a cryptographically secure PRNG, use that\r\n        // http://stackoverflow.com/questions/6906916/collisions-when-generating-uuids-in-javascript\r\n        var buf = new Uint16Array(8);\r\n        window.crypto.getRandomValues(buf);\r\n        var S4 = function(num) {\r\n            var ret = num.toString(16);\r\n            while (ret.length < 4) {\r\n                ret = \"0\" + ret;\r\n            }\r\n            return ret;\r\n        };\r\n        return (S4(buf[0]) + S4(buf[1]) + \"-\" + S4(buf[2]) + \"-\" + S4(buf[3]) + \"-\" + S4(buf[4]) + \"-\" + S4(buf[5]) + S4(buf[6]) + S4(buf[7]));\r\n    }\r\n\r\n    :\r\n\r\n    function() {\r\n        // Otherwise, just use Math.random\r\n        // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#2117523\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n            var r = Math.random() * 16 | 0,\r\n            v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    };\r\n\r\n    /// MASTER OBJ\r\n    $.verto = function(options, callbacks) {\r\n        var verto = this;\r\n\r\n        $.verto.saved.push(verto);\r\n\r\n        verto.options = $.extend({\r\n            login: null,\r\n            passwd: null,\r\n            socketUrl: null,\r\n            tag: null,\r\n\t    localTag: null,\r\n            videoParams: {},\r\n            audioParams: {},\r\n\t    loginParams: {},\r\n\t    deviceParams: {onResCheck: null},\r\n\t    userVariables: {},\r\n            iceServers: false,\r\n            ringSleep: 6000,\r\n\t    sessid: null\r\n        }, options);\r\n\r\n\tif (verto.options.deviceParams.useCamera) {\r\n\t    $.FSRTC.getValidRes(verto.options.deviceParams.useCamera, verto.options.deviceParams.onResCheck);\r\n\t}\r\n\r\n\tif (!verto.options.deviceParams.useMic) {\r\n\t    verto.options.deviceParams.useMic = \"any\";\r\n\t}\r\n\r\n\tif (!verto.options.deviceParams.useSpeak) {\r\n\t    verto.options.deviceParams.useSpeak = \"any\";\r\n\t}\r\n\r\n\tif (verto.options.sessid) {\r\n\t    verto.sessid = verto.options.sessid;\r\n\t} else {\r\n            verto.sessid = localStorage.getItem(\"verto_session_uuid\") || generateGUID();\r\n\t    localStorage.setItem(\"verto_session_uuid\", verto.sessid);\r\n\t}\r\n\r\n        verto.dialogs = {};\r\n        verto.callbacks = callbacks || {};\r\n        verto.eventSUBS = {};\r\n\r\n        verto.rpcClient = new $.JsonRpcClient({\r\n            login: verto.options.login,\r\n            passwd: verto.options.passwd,\r\n            socketUrl: verto.options.socketUrl,\r\n\t    loginParams: verto.options.loginParams,\r\n\t    userVariables: verto.options.userVariables,\r\n            sessid: verto.sessid,\r\n            onmessage: function(e) {\r\n                return verto.handleMessage(e.eventData);\r\n            },\r\n            onWSConnect: function(o) {\r\n                o.call('login', {});\r\n            },\r\n            onWSLogin: function(success) {\r\n                if (verto.callbacks.onWSLogin) {\r\n                    verto.callbacks.onWSLogin(verto, success);\r\n                }\r\n            },\r\n            onWSClose: function(success) {\r\n                if (verto.callbacks.onWSClose) {\r\n                    verto.callbacks.onWSClose(verto, success);\r\n                }\r\n                verto.purge();\r\n            }\r\n        });\r\n\r\n        var tag = verto.options.tag;\r\n        if (typeof(tag) === \"function\") {\r\n          tag = tag();\r\n        }\r\n\r\n        if (verto.options.ringFile && verto.options.tag) {\r\n            verto.ringer = $(\"#\" + tag);\r\n        }\r\n\r\n        verto.rpcClient.call('login', {});\r\n\r\n    };\r\n\r\n\r\n    $.verto.prototype.deviceParams = function(obj) {\r\n        var verto = this;\r\n\r\n\tfor (var i in obj) {\r\n            verto.options.deviceParams[i] = obj[i];\r\n\t}\r\n\r\n\tif (obj.useCamera) {\r\n\t    $.FSRTC.getValidRes(verto.options.deviceParams.useCamera, obj ? obj.onResCheck : undefined);\r\n\t}\r\n    };\r\n\r\n    $.verto.prototype.videoParams = function(obj) {\r\n        var verto = this;\r\n\r\n\tfor (var i in obj) {\r\n            verto.options.videoParams[i] = obj[i];\r\n\t}\r\n    };\r\n\r\n    $.verto.prototype.iceServers = function(obj) {\r\n        var verto = this;\r\n        verto.options.iceServers = obj;\r\n    };\r\n\r\n    $.verto.prototype.loginData = function(params) {\r\n\tvar verto = this;\r\n        verto.options.login = params.login;\r\n        verto.options.passwd = params.passwd;\r\n        verto.rpcClient.loginData(params);\r\n    };\r\n\r\n    $.verto.prototype.logout = function(msg) {\r\n        var verto = this;\r\n        verto.rpcClient.closeSocket();\r\n        if (verto.callbacks.onWSClose) {\r\n            verto.callbacks.onWSClose(verto, false);\r\n        }\r\n        verto.purge();\r\n    };\r\n\r\n    $.verto.prototype.login = function(msg) {\r\n        var verto = this;\r\n        verto.logout();\r\n        verto.rpcClient.call('login', {});\r\n    };\r\n\r\n    $.verto.prototype.message = function(msg) {\r\n        var verto = this;\r\n        var err = 0;\r\n\r\n        if (!msg.to) {\r\n            console.error(\"Missing To\");\r\n            err++;\r\n        }\r\n\r\n        if (!msg.body) {\r\n            console.error(\"Missing Body\");\r\n            err++;\r\n        }\r\n\r\n        if (err) {\r\n            return false;\r\n        }\r\n\r\n        verto.sendMethod(\"verto.info\", {\r\n            msg: msg\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    $.verto.prototype.processReply = function(method, success, e) {\r\n        var verto = this;\r\n        var i;\r\n\r\n        //console.log(\"Response: \" + method, success, e);\r\n\r\n        switch (method) {\r\n        case \"verto.subscribe\":\r\n            for (i in e.unauthorizedChannels) {\r\n                drop_bad(verto, e.unauthorizedChannels[i]);\r\n            }\r\n            for (i in e.subscribedChannels) {\r\n                mark_ready(verto, e.subscribedChannels[i]);\r\n            }\r\n\r\n            break;\r\n        case \"verto.unsubscribe\":\r\n            //console.error(e);\r\n            break;\r\n        }\r\n    };\r\n\r\n    $.verto.prototype.sendMethod = function(method, params) {\r\n        var verto = this;\r\n\r\n        verto.rpcClient.call(method, params,\r\n\r\n        function(e) {\r\n            /* Success */\r\n            verto.processReply(method, true, e);\r\n        },\r\n\r\n        function(e) {\r\n            /* Error */\r\n            verto.processReply(method, false, e);\r\n        });\r\n    };\r\n\r\n    function do_sub(verto, channel, obj) {\r\n\r\n    }\r\n\r\n    function drop_bad(verto, channel) {\r\n        console.error(\"drop unauthorized channel: \" + channel);\r\n        delete verto.eventSUBS[channel];\r\n    }\r\n\r\n    function mark_ready(verto, channel) {\r\n        for (var j in verto.eventSUBS[channel]) {\r\n            verto.eventSUBS[channel][j].ready = true;\r\n            console.log(\"subscribed to channel: \" + channel);\r\n            if (verto.eventSUBS[channel][j].readyHandler) {\r\n                verto.eventSUBS[channel][j].readyHandler(verto, channel);\r\n            }\r\n        }\r\n    }\r\n\r\n    var SERNO = 1;\r\n\r\n    function do_subscribe(verto, channel, subChannels, sparams) {\r\n        var params = sparams || {};\r\n\r\n        var local = params.local;\r\n\r\n        var obj = {\r\n            eventChannel: channel,\r\n            userData: params.userData,\r\n            handler: params.handler,\r\n            ready: false,\r\n            readyHandler: params.readyHandler,\r\n            serno: SERNO++\r\n        };\r\n\r\n        var isnew = false;\r\n\r\n        if (!verto.eventSUBS[channel]) {\r\n            verto.eventSUBS[channel] = [];\r\n            subChannels.push(channel);\r\n            isnew = true;\r\n        }\r\n\r\n        verto.eventSUBS[channel].push(obj);\r\n\r\n        if (local) {\r\n            obj.ready = true;\r\n            obj.local = true;\r\n        }\r\n\r\n        if (!isnew && verto.eventSUBS[channel][0].ready) {\r\n            obj.ready = true;\r\n            if (obj.readyHandler) {\r\n                obj.readyHandler(verto, channel);\r\n            }\r\n        }\r\n\r\n        return {\r\n            serno: obj.serno,\r\n            eventChannel: channel\r\n        };\r\n\r\n    }\r\n\r\n    $.verto.prototype.subscribe = function(channel, sparams) {\r\n        var verto = this;\r\n        var r = [];\r\n        var subChannels = [];\r\n        var params = sparams || {};\r\n\r\n        if (typeof(channel) === \"string\") {\r\n            r.push(do_subscribe(verto, channel, subChannels, params));\r\n        } else {\r\n            for (var i in channel) {\r\n                r.push(do_subscribe(verto, channel, subChannels, params));\r\n            }\r\n        }\r\n\r\n        if (subChannels.length) {\r\n            verto.sendMethod(\"verto.subscribe\", {\r\n                eventChannel: subChannels.length == 1 ? subChannels[0] : subChannels,\r\n                subParams: params.subParams\r\n            });\r\n        }\r\n\r\n        return r;\r\n    };\r\n\r\n    $.verto.prototype.unsubscribe = function(handle) {\r\n        var verto = this;\r\n        var i;\r\n\r\n        if (!handle) {\r\n            for (i in verto.eventSUBS) {\r\n                if (verto.eventSUBS[i]) {\r\n                    verto.unsubscribe(verto.eventSUBS[i]);\r\n                }\r\n            }\r\n        } else {\r\n            var unsubChannels = {};\r\n            var sendChannels = [];\r\n            var channel;\r\n\r\n            if (typeof(handle) == \"string\") {\r\n                delete verto.eventSUBS[handle];\r\n                unsubChannels[handle]++;\r\n            } else {\r\n                for (i in handle) {\r\n                    if (typeof(handle[i]) == \"string\") {\r\n                        channel = handle[i];\r\n                        delete verto.eventSUBS[channel];\r\n                        unsubChannels[channel]++;\r\n                    } else {\r\n                        var repl = [];\r\n                        channel = handle[i].eventChannel;\r\n\r\n                        for (var j in verto.eventSUBS[channel]) {\r\n                            if (verto.eventSUBS[channel][j].serno == handle[i].serno) {} else {\r\n                                repl.push(verto.eventSUBS[channel][j]);\r\n                            }\r\n                        }\r\n\r\n                        verto.eventSUBS[channel] = repl;\r\n\r\n                        if (verto.eventSUBS[channel].length === 0) {\r\n                            delete verto.eventSUBS[channel];\r\n                            unsubChannels[channel]++;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (var u in unsubChannels) {\r\n                console.log(\"Sending Unsubscribe for: \", u);\r\n                sendChannels.push(u);\r\n            }\r\n\r\n            if (sendChannels.length) {\r\n                verto.sendMethod(\"verto.unsubscribe\", {\r\n                    eventChannel: sendChannels.length == 1 ? sendChannels[0] : sendChannels\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    $.verto.prototype.broadcast = function(channel, params) {\r\n        var verto = this;\r\n        var msg = {\r\n            eventChannel: channel,\r\n            data: {}\r\n        };\r\n        for (var i in params) {\r\n            msg.data[i] = params[i];\r\n        }\r\n        verto.sendMethod(\"verto.broadcast\", msg);\r\n    };\r\n\r\n    $.verto.prototype.purge = function(callID) {\r\n        var verto = this;\r\n        var x = 0;\r\n        var i;\r\n\r\n        for (i in verto.dialogs) {\r\n            if (!x) {\r\n                console.log(\"purging dialogs\");\r\n            }\r\n            x++;\r\n            verto.dialogs[i].setState($.verto.enum.state.purge);\r\n        }\r\n\r\n        for (i in verto.eventSUBS) {\r\n            if (verto.eventSUBS[i]) {\r\n                console.log(\"purging subscription: \" + i);\r\n                delete verto.eventSUBS[i];\r\n            }\r\n        }\r\n    };\r\n\r\n    $.verto.prototype.hangup = function(callID) {\r\n        var verto = this;\r\n        if (callID) {\r\n            var dialog = verto.dialogs[callID];\r\n\r\n            if (dialog) {\r\n                dialog.hangup();\r\n            }\r\n        } else {\r\n            for (var i in verto.dialogs) {\r\n                verto.dialogs[i].hangup();\r\n            }\r\n        }\r\n    };\r\n\r\n    $.verto.prototype.newCall = function(args, callbacks) {\r\n        var verto = this;\r\n\r\n        if (!verto.rpcClient.socketReady()) {\r\n            console.error(\"Not Connected...\");\r\n            return;\r\n        }\r\n\r\n        if (args[\"useCamera\"]) {\r\n            verto.options.deviceParams[\"useCamera\"] = args[\"useCamera\"];\r\n        }\r\n\r\n        var dialog = new $.verto.dialog($.verto.enum.direction.outbound, this, args);\r\n\r\n        dialog.invite();\r\n\r\n        if (callbacks) {\r\n            dialog.callbacks = callbacks;\r\n        }\r\n\r\n        return dialog;\r\n    };\r\n\r\n    $.verto.prototype.handleMessage = function(data) {\r\n        var verto = this;\r\n\r\n        if (!(data && data.method)) {\r\n            console.error(\"Invalid Data\", data);\r\n            return;\r\n        }\r\n\r\n        if (data.params.callID) {\r\n            var dialog = verto.dialogs[data.params.callID];\r\n\t    \r\n\t    if (data.method === \"verto.attach\" && dialog) {\r\n\t\tdelete dialog.verto.dialogs[dialog.callID];\r\n\t\tdialog.rtc.stop();\r\n\t\tdialog = null;\r\n\t    }\r\n\r\n            if (dialog) {\r\n\r\n                switch (data.method) {\r\n                case 'verto.bye':\r\n                    dialog.hangup(data.params);\r\n                    break;\r\n                case 'verto.answer':\r\n                    dialog.handleAnswer(data.params);\r\n                    break;\r\n                case 'verto.media':\r\n                    dialog.handleMedia(data.params);\r\n                    break;\r\n                case 'verto.display':\r\n                    dialog.handleDisplay(data.params);\r\n                    break;\r\n                case 'verto.info':\r\n                    dialog.handleInfo(data.params);\r\n                    break;\r\n                default:\r\n                    console.debug(\"INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED\", dialog, data.method);\r\n                    break;\r\n                }\r\n            } else {\r\n\r\n                switch (data.method) {\r\n                case 'verto.attach':\r\n                    data.params.attach = true;\r\n\r\n                    if (data.params.sdp && data.params.sdp.indexOf(\"m=video\") > 0) {\r\n                        data.params.useVideo = true;\r\n                    }\r\n\r\n                    if (data.params.sdp && data.params.sdp.indexOf(\"stereo=1\") > 0) {\r\n                        data.params.useStereo = true;\r\n                    }\r\n\r\n                    dialog = new $.verto.dialog($.verto.enum.direction.inbound, verto, data.params);\r\n                    dialog.setState($.verto.enum.state.recovering);\r\n\r\n                    break;\r\n                case 'verto.invite':\r\n\r\n                    if (data.params.sdp && data.params.sdp.indexOf(\"m=video\") > 0) {\r\n                        data.params.wantVideo = true;\r\n                    }\r\n\r\n                    if (data.params.sdp && data.params.sdp.indexOf(\"stereo=1\") > 0) {\r\n                        data.params.useStereo = true;\r\n                    }\r\n\r\n                    dialog = new $.verto.dialog($.verto.enum.direction.inbound, verto, data.params);\r\n                    break;\r\n                default:\r\n                    console.debug(\"INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED\");\r\n                    break;\r\n                }\r\n            }\r\n\r\n            return {\r\n                method: data.method\r\n            };\r\n        } else {\r\n            switch (data.method) {\r\n            case 'verto.punt':\r\n                verto.purge();\r\n\t\tverto.logout();\r\n\t\tbreak;\r\n            case 'verto.event':\r\n                var list = null;\r\n                var key = null;\r\n\r\n                if (data.params) {\r\n                    key = data.params.eventChannel;\r\n                }\r\n\r\n                if (key) {\r\n                    list = verto.eventSUBS[key];\r\n\r\n                    if (!list) {\r\n                        list = verto.eventSUBS[key.split(\".\")[0]];\r\n                    }\r\n                }\r\n\r\n                if (!list && key && key === verto.sessid) {\r\n                    if (verto.callbacks.onMessage) {\r\n                        verto.callbacks.onMessage(verto, null, $.verto.enum.message.pvtEvent, data.params);\r\n                    }\r\n                } else if (!list && key && verto.dialogs[key]) {\r\n                    verto.dialogs[key].sendMessage($.verto.enum.message.pvtEvent, data.params);\r\n                } else if (!list) {\r\n                    if (!key) {\r\n                        key = \"UNDEFINED\";\r\n                    }\r\n                    console.error(\"UNSUBBED or invalid EVENT \" + key + \" IGNORED\");\r\n                } else {\r\n                    for (var i in list) {\r\n                        var sub = list[i];\r\n\r\n                        if (!sub || !sub.ready) {\r\n                            console.error(\"invalid EVENT for \" + key + \" IGNORED\");\r\n                        } else if (sub.handler) {\r\n                            sub.handler(verto, data.params, sub.userData);\r\n                        } else if (verto.callbacks.onEvent) {\r\n                            verto.callbacks.onEvent(verto, data.params, sub.userData);\r\n                        } else {\r\n                            console.log(\"EVENT:\", data.params);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                break;\r\n\r\n            case \"verto.info\":\r\n                if (verto.callbacks.onMessage) {\r\n                    verto.callbacks.onMessage(verto, null, $.verto.enum.message.info, data.params.msg);\r\n                }\r\n                //console.error(data);\r\n                console.debug(\"MESSAGE from: \" + data.params.msg.from, data.params.msg.body);\r\n\r\n                break;\r\n\r\n            case 'verto.clientReady':\r\n                verto.callbacks.onMessage(verto, null, $.verto.enum.message.clientReady, data.params);\r\n                console.debug(\"CLIENT READY\", data.params);\r\n                break;\r\n\r\n            default:\r\n                console.error(\"INVALID METHOD OR NON-EXISTANT CALL REFERENCE IGNORED\", data.method);\r\n                break;\r\n            }\r\n        }\r\n    };\r\n\r\n    var del_array = function(array, name) {\r\n        var r = [];\r\n        var len = array.length;\r\n\r\n        for (var i = 0; i < len; i++) {\r\n            if (array[i] != name) {\r\n                r.push(array[i]);\r\n            }\r\n        }\r\n\r\n        return r;\r\n    };\r\n\r\n    var hashArray = function() {\r\n        var vha = this;\r\n\r\n        var hash = {};\r\n        var array = [];\r\n\r\n        vha.reorder = function(a) {\r\n            array = a;\r\n            var h = hash;\r\n            hash = {};\r\n\r\n            var len = array.length;\r\n\r\n            for (var i = 0; i < len; i++) {\r\n                var key = array[i];\r\n                if (h[key]) {\r\n                    hash[key] = h[key];\r\n                    delete h[key];\r\n                }\r\n            }\r\n            h = undefined;\r\n        };\r\n\r\n        vha.clear = function() {\r\n            hash = undefined;\r\n            array = undefined;\r\n            hash = {};\r\n            array = [];\r\n        };\r\n\r\n        vha.add = function(name, val, insertAt) {\r\n            var redraw = false;\r\n\r\n            if (!hash[name]) {\r\n                if (insertAt === undefined || insertAt < 0 || insertAt >= array.length) {\r\n                    array.push(name);\r\n                } else {\r\n                    var x = 0;\r\n                    var n = [];\r\n                    var len = array.length;\r\n\r\n                    for (var i = 0; i < len; i++) {\r\n                        if (x++==insertAt) {\r\n                            n.push(name);\r\n                        }\r\n                        n.push(array[i]);\r\n                    }\r\n\r\n                    array = undefined;\r\n                    array = n;\r\n                    n = undefined;\r\n                    redraw = true;\r\n                }\r\n            }\r\n\r\n            hash[name] = val;\r\n\r\n            return redraw;\r\n        };\r\n\r\n        vha.del = function(name) {\r\n            var r = false;\r\n\r\n            if (hash[name]) {\r\n                array = del_array(array, name);\r\n                delete hash[name];\r\n                r = true;\r\n            } else {\r\n                console.error(\"can't del nonexistant key \" + name);\r\n            }\r\n\r\n            return r;\r\n        };\r\n\r\n        vha.get = function(name) {\r\n            return hash[name];\r\n        };\r\n\r\n        vha.order = function() {\r\n            return array;\r\n        };\r\n\r\n        vha.hash = function() {\r\n            return hash;\r\n        };\r\n\r\n        vha.indexOf = function(name) {\r\n            var len = array.length;\r\n\r\n            for (var i = 0; i < len; i++) {\r\n                if (array[i] == name) {\r\n                    return i;\r\n                }\r\n            }\r\n        };\r\n\r\n        vha.arrayLen = function() {\r\n            return array.length;\r\n        };\r\n\r\n        vha.asArray = function() {\r\n            var r = [];\r\n\r\n            var len = array.length;\r\n\r\n            for (var i = 0; i < len; i++) {\r\n                var key = array[i];\r\n                r.push(hash[key]);\r\n            }\r\n\r\n            return r;\r\n        };\r\n\r\n        vha.each = function(cb) {\r\n            var len = array.length;\r\n\r\n            for (var i = 0; i < len; i++) {\r\n                cb(array[i], hash[array[i]]);\r\n            }\r\n        };\r\n\r\n        vha.dump = function(html) {\r\n            var str = \"\";\r\n\r\n            vha.each(function(name, val) {\r\n                str += \"name: \" + name + \" val: \" + JSON.stringify(val) + (html ? \"<br>\" : \"\\n\");\r\n            });\r\n\r\n            return str;\r\n        };\r\n\r\n    };\r\n\r\n    $.verto.liveArray = function(verto, context, name, config) {\r\n        var la = this;\r\n        var lastSerno = 0;\r\n        var binding = null;\r\n        var user_obj = config.userObj;\r\n        var local = false;\r\n\r\n        // Inherit methods of hashArray\r\n        hashArray.call(la);\r\n\r\n        // Save the hashArray add, del, reorder, clear methods so we can make our own.\r\n        la._add = la.add;\r\n        la._del = la.del;\r\n        la._reorder = la.reorder;\r\n        la._clear = la.clear;\r\n\r\n        la.context = context;\r\n        la.name = name;\r\n        la.user_obj = user_obj;\r\n\r\n        la.verto = verto;\r\n        la.broadcast = function(channel, obj) {\r\n            verto.broadcast(channel, obj);\r\n        };\r\n        la.errs = 0;\r\n\r\n        la.clear = function() {\r\n            la._clear();\r\n            lastSerno = 0;\r\n\r\n            if (la.onChange) {\r\n                la.onChange(la, {\r\n                    action: \"clear\"\r\n                });\r\n            }\r\n        };\r\n\r\n        la.checkSerno = function(serno) {\r\n            if (serno < 0) {\r\n                return true;\r\n            }\r\n\r\n            if (lastSerno > 0 && serno != (lastSerno + 1)) {\r\n                if (la.onErr) {\r\n                    la.onErr(la, {\r\n                        lastSerno: lastSerno,\r\n                        serno: serno\r\n                    });\r\n                }\r\n                la.errs++;\r\n                console.debug(la.errs);\r\n                if (la.errs < 3) {\r\n                    la.bootstrap(la.user_obj);\r\n                }\r\n                return false;\r\n            } else {\r\n                lastSerno = serno;\r\n                return true;\r\n            }\r\n        };\r\n\r\n        la.reorder = function(serno, a) {\r\n            if (la.checkSerno(serno)) {\r\n                la._reorder(a);\r\n                if (la.onChange) {\r\n                    la.onChange(la, {\r\n                        serno: serno,\r\n                        action: \"reorder\"\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        la.init = function(serno, val, key, index) {\r\n            if (key === null || key === undefined) {\r\n                key = serno;\r\n            }\r\n            if (la.checkSerno(serno)) {\r\n                if (la.onChange) {\r\n                    la.onChange(la, {\r\n                        serno: serno,\r\n                        action: \"init\",\r\n                        index: index,\r\n                        key: key,\r\n                        data: val\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        la.bootObj = function(serno, val) {\r\n            if (la.checkSerno(serno)) {\r\n\r\n                //la.clear();\r\n                for (var i in val) {\r\n                    la._add(val[i][0], val[i][1]);\r\n                }\r\n\r\n                if (la.onChange) {\r\n                    la.onChange(la, {\r\n                        serno: serno,\r\n                        action: \"bootObj\",\r\n                        data: val,\r\n                        redraw: true\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        // @param serno  La is the serial number for la particular request.\r\n        // @param key    If looking at it as a hash table, la represents the key in the hashArray object where you want to store the val object.\r\n        // @param index  If looking at it as an array, la represents the position in the array where you want to store the val object.\r\n        // @param val    La is the object you want to store at the key or index location in the hash table / array.\r\n        la.add = function(serno, val, key, index) {\r\n            if (key === null || key === undefined) {\r\n                key = serno;\r\n            }\r\n            if (la.checkSerno(serno)) {\r\n                var redraw = la._add(key, val, index);\r\n                if (la.onChange) {\r\n                    la.onChange(la, {\r\n                        serno: serno,\r\n                        action: \"add\",\r\n                        index: index,\r\n                        key: key,\r\n                        data: val,\r\n                        redraw: redraw\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        la.modify = function(serno, val, key, index) {\r\n            if (key === null || key === undefined) {\r\n                key = serno;\r\n            }\r\n            if (la.checkSerno(serno)) {\r\n                la._add(key, val, index);\r\n                if (la.onChange) {\r\n                    la.onChange(la, {\r\n                        serno: serno,\r\n                        action: \"modify\",\r\n                        key: key,\r\n                        data: val,\r\n                        index: index\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        la.del = function(serno, key, index) {\r\n            if (key === null || key === undefined) {\r\n                key = serno;\r\n            }\r\n            if (la.checkSerno(serno)) {\r\n                if (index === null || index < 0 || index === undefined) {\r\n                    index = la.indexOf(key);\r\n                }\r\n                var ok = la._del(key);\r\n\r\n                if (ok && la.onChange) {\r\n                    la.onChange(la, {\r\n                        serno: serno,\r\n                        action: \"del\",\r\n                        key: key,\r\n                        index: index\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        var eventHandler = function(v, e, la) {\r\n            var packet = e.data;\r\n\r\n            //console.error(\"READ:\", packet);\r\n\r\n            if (packet.name != la.name) {\r\n                return;\r\n            }\r\n\r\n            switch (packet.action) {\r\n\r\n            case \"init\":\r\n                la.init(packet.wireSerno, packet.data, packet.hashKey, packet.arrIndex);\r\n                break;\r\n\r\n            case \"bootObj\":\r\n                la.bootObj(packet.wireSerno, packet.data);\r\n                break;\r\n            case \"add\":\r\n                la.add(packet.wireSerno, packet.data, packet.hashKey, packet.arrIndex);\r\n                break;\r\n\r\n            case \"modify\":\r\n                if (! (packet.arrIndex || packet.hashKey)) {\r\n                    console.error(\"Invalid Packet\", packet);\r\n                } else {\r\n                    la.modify(packet.wireSerno, packet.data, packet.hashKey, packet.arrIndex);\r\n                }\r\n                break;\r\n            case \"del\":\r\n                if (! (packet.arrIndex || packet.hashKey)) {\r\n                    console.error(\"Invalid Packet\", packet);\r\n                } else {\r\n                    la.del(packet.wireSerno, packet.hashKey, packet.arrIndex);\r\n                }\r\n                break;\r\n\r\n            case \"clear\":\r\n                la.clear();\r\n                break;\r\n\r\n            case \"reorder\":\r\n                la.reorder(packet.wireSerno, packet.order);\r\n                break;\r\n\r\n            default:\r\n                if (la.checkSerno(packet.wireSerno)) {\r\n                    if (la.onChange) {\r\n                        la.onChange(la, {\r\n                            serno: packet.wireSerno,\r\n                            action: packet.action,\r\n                            data: packet.data\r\n                        });\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n        };\r\n\r\n        if (la.context) {\r\n            binding = la.verto.subscribe(la.context, {\r\n                handler: eventHandler,\r\n                userData: la,\r\n                subParams: config.subParams\r\n            });\r\n        }\r\n\r\n        la.destroy = function() {\r\n            la._clear();\r\n            la.verto.unsubscribe(binding);\r\n        };\r\n\r\n        la.sendCommand = function(cmd, obj) {\r\n            var self = la;\r\n            self.broadcast(self.context, {\r\n                liveArray: {\r\n                    command: cmd,\r\n                    context: self.context,\r\n                    name: self.name,\r\n                    obj: obj\r\n                }\r\n            });\r\n        };\r\n\r\n        la.bootstrap = function(obj) {\r\n            var self = la;\r\n            la.sendCommand(\"bootstrap\", obj);\r\n            //self.heartbeat();\r\n        };\r\n\r\n        la.changepage = function(obj) {\r\n            var self = la;\r\n            self.clear();\r\n            self.broadcast(self.context, {\r\n                liveArray: {\r\n                    command: \"changepage\",\r\n                    context: la.context,\r\n                    name: la.name,\r\n                    obj: obj\r\n                }\r\n            });\r\n        };\r\n\r\n        la.heartbeat = function(obj) {\r\n            var self = la;\r\n\r\n            var callback = function() {\r\n                self.heartbeat.call(self, obj);\r\n            };\r\n            self.broadcast(self.context, {\r\n                liveArray: {\r\n                    command: \"heartbeat\",\r\n                    context: self.context,\r\n                    name: self.name,\r\n                    obj: obj\r\n                }\r\n            });\r\n            self.hb_pid = setTimeout(callback, 30000);\r\n        };\r\n\r\n        la.bootstrap(la.user_obj);\r\n    };\r\n\r\n    $.verto.liveTable = function(verto, context, name, jq, config) {\r\n        var dt;\r\n        var la = new $.verto.liveArray(verto, context, name, {\r\n            subParams: config.subParams\r\n        });\r\n        var lt = this;\r\n\r\n        lt.liveArray = la;\r\n        lt.dataTable = dt;\r\n        lt.verto = verto;\r\n\r\n        lt.destroy = function() {\r\n            if (dt) {\r\n                dt.fnDestroy();\r\n            }\r\n            if (la) {\r\n                la.destroy();\r\n            }\r\n\r\n            dt = null;\r\n            la = null;\r\n        };\r\n\r\n        la.onErr = function(obj, args) {\r\n            console.error(\"Error: \", obj, args);\r\n        };\r\n\r\n\t/* back compat so jsonstatus can always be enabled */\r\n\tfunction genRow(data) {\r\n\t    if (typeof(data[4]) === \"string\" && data[4].indexOf(\"{\") > -1) {\r\n\t\tvar tmp = $.parseJSON(data[4]);\r\n\t\tdata[4] = tmp.oldStatus;\r\n\t\tdata[5] = null;\r\n\t    }\r\n\t    return data;\r\n\t}\r\n\r\n\tfunction genArray(obj) {\r\n\t    var data = obj.asArray();\r\n\r\n            for (var i in data) {\r\n\t\tdata[i] = genRow(data[i]);\r\n\t    }\r\n\r\n\t    return data;\r\n\t}\r\n\r\n\r\n        la.onChange = function(obj, args) {\r\n            var index = 0;\r\n            var iserr = 0;\r\n\r\n            if (!dt) {\r\n                if (!config.aoColumns) {\r\n                    if (args.action != \"init\") {\r\n                        return;\r\n                    }\r\n\r\n                    config.aoColumns = [];\r\n\r\n                    for (var i in args.data) {\r\n                        config.aoColumns.push({\r\n                            \"sTitle\": args.data[i]\r\n                        });\r\n                    }\r\n                }\r\n\r\n                dt = jq.dataTable(config);\r\n            }\r\n\r\n            if (dt && (args.action == \"del\" || args.action == \"modify\")) {\r\n                index = args.index;\r\n\r\n                if (index === undefined && args.key) {\r\n                    index = la.indexOf(args.key);\r\n                }\r\n\r\n                if (index === undefined) {\r\n                    console.error(\"INVALID PACKET Missing INDEX\\n\", args);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (config.onChange) {\r\n                config.onChange(obj, args);\r\n            }\r\n\r\n            try {\r\n                switch (args.action) {\r\n                case \"bootObj\":\r\n                    if (!args.data) {\r\n                        console.error(\"missing data\");\r\n                        return;\r\n                    }\r\n                    dt.fnClearTable();\r\n                    dt.fnAddData(genArray(obj));\r\n                    dt.fnAdjustColumnSizing();\r\n                    break;\r\n                case \"add\":\r\n                    if (!args.data) {\r\n                        console.error(\"missing data\");\r\n                        return;\r\n                    }\r\n                    if (args.redraw > -1) {\r\n                        // specific position, more costly\r\n                        dt.fnClearTable();\r\n                        dt.fnAddData(genArray(obj));\r\n                    } else {\r\n                        dt.fnAddData(genRow(args.data));\r\n                    }\r\n                    dt.fnAdjustColumnSizing();\r\n                    break;\r\n                case \"modify\":\r\n                    if (!args.data) {\r\n                        return;\r\n                    }\r\n                    //console.debug(args, index);\r\n                    dt.fnUpdate(genRow(args.data), index);\r\n                    dt.fnAdjustColumnSizing();\r\n                    break;\r\n                case \"del\":\r\n                    dt.fnDeleteRow(index);\r\n                    dt.fnAdjustColumnSizing();\r\n                    break;\r\n                case \"clear\":\r\n                    dt.fnClearTable();\r\n                    break;\r\n                case \"reorder\":\r\n                    // specific position, more costly\r\n                    dt.fnClearTable();\r\n                    dt.fnAddData(genArray(obj));\r\n                    break;\r\n                case \"hide\":\r\n                    jq.hide();\r\n                    break;\r\n\r\n                case \"show\":\r\n                    jq.show();\r\n                    break;\r\n\r\n                }\r\n            } catch(err) {\r\n                console.error(\"ERROR: \" + err);\r\n                iserr++;\r\n            }\r\n\r\n            if (iserr) {\r\n                obj.errs++;\r\n                if (obj.errs < 3) {\r\n                    obj.bootstrap(obj.user_obj);\r\n                }\r\n            } else {\r\n                obj.errs = 0;\r\n            }\r\n\r\n        };\r\n\r\n        la.onChange(la, {\r\n            action: \"init\"\r\n        });\r\n\r\n    };\r\n\r\n    var CONFMAN_SERNO = 1;\r\n\r\n    /*\r\n        Conference Manager without jQuery table.\r\n     */\r\n\r\n    $.verto.conf = function(verto, params) {\r\n        var conf = this;\r\n\r\n        conf.params = $.extend({\r\n            dialog: null,\r\n            hasVid: false,\r\n            laData: null,\r\n            onBroadcast: null,\r\n            onLaChange: null,\r\n            onLaRow: null\r\n        }, params);\r\n\r\n        conf.verto = verto;\r\n        conf.serno = CONFMAN_SERNO++;\r\n\r\n        createMainModeratorMethods();\r\n\r\n        verto.subscribe(conf.params.laData.modChannel, {\r\n            handler: function(v, e) {\r\n                if (conf.params.onBroadcast) {\r\n                    conf.params.onBroadcast(verto, conf, e.data);\r\n                }\r\n            }\r\n        });\r\n\r\n        verto.subscribe(conf.params.laData.infoChannel, {\r\n            handler: function(v, e) {\r\n                if (typeof(conf.params.infoCallback) === \"function\") {\r\n                    conf.params.infoCallback(v,e);\r\n                }\r\n            }\r\n        });\r\n\r\n        verto.subscribe(conf.params.laData.chatChannel, {\r\n            handler: function(v, e) {\r\n                if (typeof(conf.params.chatCallback) === \"function\") {\r\n                    conf.params.chatCallback(v,e);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    $.verto.conf.prototype.modCommand = function(cmd, id, value) {\r\n        var conf = this;\r\n\r\n        conf.verto.rpcClient.call(\"verto.broadcast\", {\r\n            \"eventChannel\": conf.params.laData.modChannel,\r\n            \"data\": {\r\n                \"application\": \"conf-control\",\r\n                \"command\": cmd,\r\n                \"id\": id,\r\n                \"value\": value\r\n            }\r\n        });\r\n    };\r\n\r\n    $.verto.conf.prototype.destroy = function() {\r\n        var conf = this;\r\n\r\n        conf.destroyed = true;\r\n        conf.params.onBroadcast(conf.verto, conf, 'destroy');\r\n\r\n        if (conf.params.laData.modChannel) {\r\n            conf.verto.unsubscribe(conf.params.laData.modChannel);\r\n        }\r\n\r\n        if (conf.params.laData.chatChannel) {\r\n            conf.verto.unsubscribe(conf.params.laData.chatChannel);\r\n        }\r\n\r\n        if (conf.params.laData.infoChannel) {\r\n            conf.verto.unsubscribe(conf.params.laData.infoChannel);\r\n        }\r\n    };\r\n\r\n    function createMainModeratorMethods() {\r\n        $.verto.conf.prototype.listVideoLayouts = function() {\r\n            this.modCommand(\"list-videoLayouts\", null, null);\r\n        };\r\n\r\n        $.verto.conf.prototype.play = function(file) {\r\n            this.modCommand(\"play\", null, file);\r\n        };\r\n\r\n        $.verto.conf.prototype.stop = function() {\r\n            this.modCommand(\"stop\", null, \"all\");\r\n        };\r\n\r\n        $.verto.conf.prototype.deaf = function(memberID) {\r\n            this.modCommand(\"deaf\", parseInt(memberID));\r\n        };\r\n\r\n        $.verto.conf.prototype.undeaf = function(memberID) {\r\n            this.modCommand(\"undeaf\", parseInt(memberID));\r\n        };\r\n\r\n        $.verto.conf.prototype.record = function(file) {\r\n            this.modCommand(\"recording\", null, [\"start\", file]);\r\n        };\r\n\r\n        $.verto.conf.prototype.stopRecord = function() {\r\n            this.modCommand(\"recording\", null, [\"stop\", \"all\"]);\r\n        };\r\n\r\n        $.verto.conf.prototype.snapshot = function(file) {\r\n            if (!this.params.hasVid) {\r\n                throw 'Conference has no video';\r\n            }\r\n            this.modCommand(\"vid-write-png\", null, file);\r\n        };\r\n\r\n        $.verto.conf.prototype.setVideoLayout = function(layout, canvasID) {\r\n            if (!this.params.hasVid) {\r\n                throw 'Conference has no video';\r\n            }\r\n\t    if (canvasID) {\r\n\t\tthis.modCommand(\"vid-layout\", null, [layout, canvasID]);\r\n\t    } else {\r\n\t\tthis.modCommand(\"vid-layout\", null, layout);\r\n\t    }\r\n        };\r\n\r\n        $.verto.conf.prototype.kick = function(memberID) {\r\n            this.modCommand(\"kick\", parseInt(memberID));\r\n        };\r\n\r\n        $.verto.conf.prototype.muteMic = function(memberID) {\r\n            this.modCommand(\"tmute\", parseInt(memberID));\r\n        };\r\n\r\n        $.verto.conf.prototype.muteVideo = function(memberID) {\r\n            if (!this.params.hasVid) {\r\n                throw 'Conference has no video';\r\n            }\r\n            this.modCommand(\"tvmute\", parseInt(memberID));\r\n        };\r\n\r\n        $.verto.conf.prototype.presenter = function(memberID) {\r\n            if (!this.params.hasVid) {\r\n                throw 'Conference has no video';\r\n            }\r\n            this.modCommand(\"vid-res-id\", parseInt(memberID), \"presenter\");\r\n        };\r\n\r\n        $.verto.conf.prototype.videoFloor = function(memberID) {\r\n            if (!this.params.hasVid) {\r\n                throw 'Conference has no video';\r\n            }\r\n            this.modCommand(\"vid-floor\", parseInt(memberID), \"force\");\r\n        };\r\n\r\n        $.verto.conf.prototype.banner = function(memberID, text) {\r\n            if (!this.params.hasVid) {\r\n                throw 'Conference has no video';\r\n            }\r\n            this.modCommand(\"vid-banner\", parseInt(memberID), escape(text));\r\n        };\r\n\r\n        $.verto.conf.prototype.volumeDown = function(memberID) {\r\n            this.modCommand(\"volume_out\", parseInt(memberID), \"down\");\r\n        };\r\n\r\n        $.verto.conf.prototype.volumeUp = function(memberID) {\r\n            this.modCommand(\"volume_out\", parseInt(memberID), \"up\");\r\n        };\r\n\r\n        $.verto.conf.prototype.gainDown = function(memberID) {\r\n            this.modCommand(\"volume_in\", parseInt(memberID), \"down\");\r\n        };\r\n\r\n        $.verto.conf.prototype.gainUp = function(memberID) {\r\n            this.modCommand(\"volume_in\", parseInt(memberID), \"up\");\r\n        };\r\n\r\n        $.verto.conf.prototype.transfer = function(memberID, exten) {\r\n            this.modCommand(\"transfer\", parseInt(memberID), exten);\r\n        };\r\n\r\n        $.verto.conf.prototype.sendChat = function(message, type) {\r\n            var conf = this;\r\n            conf.verto.rpcClient.call(\"verto.broadcast\", {\r\n                \"eventChannel\": conf.params.laData.chatChannel,\r\n                \"data\": {\r\n                    \"action\": \"send\",\r\n                    \"message\": message,\r\n                    \"type\": type\r\n                }\r\n            });\r\n        };\r\n            \r\n    }\r\n\r\n    $.verto.modfuncs = {};\r\n\r\n    $.verto.confMan = function(verto, params) {\r\n        var confMan = this;\r\n\r\n        confMan.params = $.extend({\r\n            tableID: null,\r\n            statusID: null,\r\n            mainModID: null,\r\n            dialog: null,\r\n            hasVid: false,\r\n            laData: null,\r\n            onBroadcast: null,\r\n            onLaChange: null,\r\n            onLaRow: null\r\n        }, params);\r\n\r\n        confMan.verto = verto;\r\n        confMan.serno = CONFMAN_SERNO++;\r\n\tconfMan.canvasCount = confMan.params.laData.canvasCount;\r\n\t\r\n        function genMainMod(jq) {\r\n            var play_id = \"play_\" + confMan.serno;\r\n            var stop_id = \"stop_\" + confMan.serno;\r\n            var recording_id = \"recording_\" + confMan.serno;\r\n            var snapshot_id = \"snapshot_\" + confMan.serno;\r\n            var rec_stop_id = \"recording_stop\" + confMan.serno;\r\n            var div_id = \"confman_\" + confMan.serno;\r\n\r\n            var html =  \"<div id='\" + div_id + \"'><br>\" +\r\n\t\t\"<button class='ctlbtn' id='\" + play_id + \"'>Play</button>\" +\r\n\t\t\"<button class='ctlbtn' id='\" + stop_id + \"'>Stop</button>\" +\r\n\t\t\"<button class='ctlbtn' id='\" + recording_id + \"'>Record</button>\" +\r\n\t\t\"<button class='ctlbtn' id='\" + rec_stop_id + \"'>Record Stop</button>\" +\r\n\t\t(confMan.params.hasVid ? \"<button class='ctlbtn' id='\" + snapshot_id + \"'>PNG Snapshot</button>\" : \"\") +\r\n\t\t\"<br><br></div>\";\r\n\r\n            jq.html(html);\r\n\r\n\t    $.verto.modfuncs.change_video_layout = function(id, canvas_id) {\t    \r\n\t\tvar val = $(\"#\" + id + \" option:selected\").text();\r\n\t\tif (val !== \"none\") {\r\n                    confMan.modCommand(\"vid-layout\", null, [val, canvas_id]);\r\n\t\t}\r\n\t    };\r\n\r\n\t    if (confMan.params.hasVid) {\r\n\t\tfor (var j = 0; j < confMan.canvasCount; j++) {\r\n\t\t    var vlayout_id = \"confman_vid_layout_\" + j + \"_\" + confMan.serno;\r\n\t\t    var vlselect_id = \"confman_vl_select_\" + j + \"_\" + confMan.serno;\r\n\t\t\r\n\r\n\t\t    var vlhtml =  \"<div id='\" + vlayout_id + \"'><br>\" +\r\n\t\t\t\"<b>Video Layout Canvas \" + (j+1) + \r\n\t\t\t\"</b> <select onChange='$.verto.modfuncs.change_video_layout(\\\"\" + vlayout_id + \"\\\", \\\"\" + (j+1) + \"\\\")' id='\" + vlselect_id + \"'></select> \" +\r\n\t\t\t\"<br><br></div>\";\r\n\t\t    jq.append(vlhtml);\r\n\t\t}\r\n\r\n\t\t$(\"#\" + snapshot_id).click(function() {\r\n                    var file = prompt(\"Please enter file name\", \"\");\r\n\t\t    if (file) {\r\n\t\t\tconfMan.modCommand(\"vid-write-png\", null, file);\r\n\t\t    }\r\n\t\t});\r\n\t    }\r\n\r\n            $(\"#\" + play_id).click(function() {\r\n                var file = prompt(\"Please enter file name\", \"\");\r\n\t\tif (file) {\r\n                    confMan.modCommand(\"play\", null, file);\r\n\t\t}\r\n            });\r\n\r\n            $(\"#\" + stop_id).click(function() {\r\n                confMan.modCommand(\"stop\", null, \"all\");\r\n            });\r\n\r\n            $(\"#\" + recording_id).click(function() {\r\n                var file = prompt(\"Please enter file name\", \"\");\r\n\t\tif (file) {\r\n                    confMan.modCommand(\"recording\", null, [\"start\", file]);\r\n\t\t}\r\n            });\r\n\r\n            $(\"#\" + rec_stop_id).click(function() {\r\n                confMan.modCommand(\"recording\", null, [\"stop\", \"all\"]);\r\n            });\r\n\r\n        }\r\n\r\n        function genControls(jq, rowid) {\r\n            var x = parseInt(rowid);\r\n            var kick_id = \"kick_\" + x;\r\n            var canvas_in_next_id = \"canvas_in_next_\" + x;\r\n            var canvas_in_prev_id = \"canvas_in_prev_\" + x;\r\n            var canvas_out_next_id = \"canvas_out_next_\" + x;\r\n            var canvas_out_prev_id = \"canvas_out_prev_\" + x;\r\n\r\n            var canvas_in_set_id = \"canvas_in_set_\" + x;\r\n            var canvas_out_set_id = \"canvas_out_set_\" + x;\r\n\r\n            var layer_set_id = \"layer_set_\" + x;\r\n            var layer_next_id = \"layer_next_\" + x;\r\n            var layer_prev_id = \"layer_prev_\" + x;\r\n\t    \r\n            var tmute_id = \"tmute_\" + x;\r\n            var tvmute_id = \"tvmute_\" + x;\r\n            var vbanner_id = \"vbanner_\" + x;\r\n            var tvpresenter_id = \"tvpresenter_\" + x;\r\n            var tvfloor_id = \"tvfloor_\" + x;\r\n            var box_id = \"box_\" + x;\r\n            var gainup_id = \"gain_in_up\" + x;\r\n            var gaindn_id = \"gain_in_dn\" + x;\r\n            var volup_id = \"vol_in_up\" + x;\r\n            var voldn_id = \"vol_in_dn\" + x;\r\n            var transfer_id = \"transfer\" + x;\r\n\t    \r\n\r\n            var html = \"<div id='\" + box_id + \"'>\";\r\n\r\n\t    html += \"<b>General Controls</b><hr noshade>\";\r\n\r\n            html += \"<button class='ctlbtn' id='\" + kick_id + \"'>Kick</button>\" +\r\n                \"<button class='ctlbtn' id='\" + tmute_id + \"'>Mute</button>\" +\r\n                \"<button class='ctlbtn' id='\" + gainup_id + \"'>Gain -</button>\" +\r\n                \"<button class='ctlbtn' id='\" + gaindn_id + \"'>Gain +</button>\" +\r\n                \"<button class='ctlbtn' id='\" + voldn_id + \"'>Vol -</button>\" +\r\n                \"<button class='ctlbtn' id='\" + volup_id + \"'>Vol +</button>\" +\r\n                \"<button class='ctlbtn' id='\" + transfer_id + \"'>Transfer</button>\";\r\n\t\t\r\n\t    if (confMan.params.hasVid) {\r\n\t\thtml += \"<br><br><b>Video Controls</b><hr noshade>\";\r\n\r\n\r\n                html += \"<button class='ctlbtn' id='\" + tvmute_id + \"'>VMute</button>\" +\r\n                    \"<button class='ctlbtn' id='\" + tvpresenter_id + \"'>Presenter</button>\" +\r\n                    \"<button class='ctlbtn' id='\" + tvfloor_id + \"'>Vid Floor</button>\" +\r\n                    \"<button class='ctlbtn' id='\" + vbanner_id + \"'>Banner</button>\";\r\n\r\n\t\tif (confMan.canvasCount > 1) {\r\n                    html += \"<br><br><b>Canvas Controls</b><hr noshade>\" +\r\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_in_set_id + \"'>Set Input Canvas</button>\" +\r\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_in_prev_id + \"'>Prev Input Canvas</button>\" +\r\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_in_next_id + \"'>Next Input Canvas</button>\" +\r\n\t\t\t\r\n\t\t    \"<br>\" +\r\n\t\t\t\r\n\t\t    \"<button class='ctlbtn' id='\" + canvas_out_set_id + \"'>Set Watching Canvas</button>\" +\r\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_out_prev_id + \"'>Prev Watching Canvas</button>\" +\r\n\t\t\t\"<button class='ctlbtn' id='\" + canvas_out_next_id + \"'>Next Watching Canvas</button>\";\r\n\t\t}\r\n\t\t\r\n\t\thtml += \"<br>\" +\r\n\r\n                \"<button class='ctlbtn' id='\" + layer_set_id + \"'>Set Layer</button>\" +\r\n                    \"<button class='ctlbtn' id='\" + layer_prev_id + \"'>Prev Layer</button>\" +\r\n                    \"<button class='ctlbtn' id='\" + layer_next_id + \"'>Next Layer</button>\" +\r\n\r\n\r\n\r\n                    \"</div>\";\r\n            }\r\n\r\n            jq.html(html);\r\n\r\n\r\n            if (!jq.data(\"mouse\")) {\r\n                $(\"#\" + box_id).hide();\r\n            }\r\n\r\n            jq.mouseover(function(e) {\r\n                jq.data({\"mouse\": true});\r\n                $(\"#\" + box_id).show();\r\n            });\r\n\r\n            jq.mouseout(function(e) {\r\n                jq.data({\"mouse\": false});\r\n                $(\"#\" + box_id).hide();\r\n            });\r\n\r\n            $(\"#\" + transfer_id).click(function() {\r\n                var xten = prompt(\"Enter Extension\");\r\n\t\tif (xten) {\r\n                    confMan.modCommand(\"transfer\", x, xten);\r\n\t\t}\r\n            });\r\n\r\n            $(\"#\" + kick_id).click(function() {\r\n                confMan.modCommand(\"kick\", x);\r\n            });\r\n\r\n\r\n            $(\"#\" + layer_set_id).click(function() {\r\n                var cid = prompt(\"Please enter layer ID\", \"\");\r\n\t\tif (cid) {\r\n                    confMan.modCommand(\"vid-layer\", x, cid);\r\n\t\t}\r\n            });\r\n\r\n            $(\"#\" + layer_next_id).click(function() {\r\n                confMan.modCommand(\"vid-layer\", x, \"next\");\r\n            });\r\n            $(\"#\" + layer_prev_id).click(function() {\r\n                confMan.modCommand(\"vid-layer\", x, \"prev\");\r\n            });\r\n\r\n            $(\"#\" + canvas_in_set_id).click(function() {\r\n                var cid = prompt(\"Please enter canvas ID\", \"\");\r\n\t\tif (cid) {\r\n                    confMan.modCommand(\"vid-canvas\", x, cid);\r\n\t\t}\r\n            });\r\n\r\n            $(\"#\" + canvas_out_set_id).click(function() {\r\n                var cid = prompt(\"Please enter canvas ID\", \"\");\r\n\t\tif (cid) {\r\n                    confMan.modCommand(\"vid-watching-canvas\", x, cid);\r\n\t\t}\r\n            });\r\n\r\n            $(\"#\" + canvas_in_next_id).click(function() {\r\n                confMan.modCommand(\"vid-canvas\", x, \"next\");\r\n            });\r\n            $(\"#\" + canvas_in_prev_id).click(function() {\r\n                confMan.modCommand(\"vid-canvas\", x, \"prev\");\r\n            });\r\n\r\n\r\n            $(\"#\" + canvas_out_next_id).click(function() {\r\n                confMan.modCommand(\"vid-watching-canvas\", x, \"next\");\r\n            });\r\n            $(\"#\" + canvas_out_prev_id).click(function() {\r\n                confMan.modCommand(\"vid-watching-canvas\", x, \"prev\");\r\n            });\r\n\t    \r\n            $(\"#\" + tmute_id).click(function() {\r\n                confMan.modCommand(\"tmute\", x);\r\n            });\r\n\r\n\t    if (confMan.params.hasVid) {\r\n\t\t$(\"#\" + tvmute_id).click(function() {\r\n                    confMan.modCommand(\"tvmute\", x);\r\n\t\t});\r\n\t\t$(\"#\" + tvpresenter_id).click(function() {\r\n                    confMan.modCommand(\"vid-res-id\", x, \"presenter\");\r\n\t\t});\r\n\t\t$(\"#\" + tvfloor_id).click(function() {\r\n                    confMan.modCommand(\"vid-floor\", x, \"force\");\r\n\t\t});\r\n\t\t$(\"#\" + vbanner_id).click(function() {\r\n                    var text = prompt(\"Please enter text\", \"\");\r\n\t\t    if (text) {\r\n\t\t\tconfMan.modCommand(\"vid-banner\", x, escape(text));\r\n\t\t    }\r\n\t\t});\r\n\t    }\r\n\r\n            $(\"#\" + gainup_id).click(function() {\r\n                confMan.modCommand(\"volume_in\", x, \"up\");\r\n            });\r\n\r\n            $(\"#\" + gaindn_id).click(function() {\r\n                confMan.modCommand(\"volume_in\", x, \"down\");\r\n            });\r\n\r\n            $(\"#\" + volup_id).click(function() {\r\n                confMan.modCommand(\"volume_out\", x, \"up\");\r\n            });\r\n\r\n            $(\"#\" + voldn_id).click(function() {\r\n                confMan.modCommand(\"volume_out\", x, \"down\");\r\n            });\r\n\r\n            return html;\r\n        }\r\n\r\n        var atitle = \"\";\r\n        var awidth = 0;\r\n\r\n        //$(\".jsDataTable\").width(confMan.params.hasVid ? \"900px\" : \"800px\");\r\n\r\n        verto.subscribe(confMan.params.laData.infoChannel, {\r\n            handler: function(v, e) {\r\n                if (typeof(confMan.params.infoCallback) === \"function\") {\r\n                    confMan.params.infoCallback(v,e);\r\n                }\r\n            }\r\n        });\r\n\r\n\tverto.subscribe(confMan.params.laData.chatChannel, {\r\n\t    handler: function(v, e) {\r\n\t\tif (typeof(confMan.params.chatCallback) === \"function\") {\r\n\t\t    confMan.params.chatCallback(v,e);\r\n\t\t}\r\n\t    }\r\n\t});\r\n\r\n        if (confMan.params.laData.role === \"moderator\") {\r\n            atitle = \"Action\";\r\n            awidth = 600;\r\n\r\n            if (confMan.params.mainModID) {\r\n                genMainMod($(confMan.params.mainModID));\r\n                $(confMan.params.displayID).html(\"Moderator Controls Ready<br><br>\");\r\n            } else {\r\n                $(confMan.params.mainModID).html(\"\");\r\n            }\r\n\r\n            verto.subscribe(confMan.params.laData.modChannel, {\r\n                handler: function(v, e) {\r\n                    //console.error(\"MODDATA:\", e.data);\r\n                    if (confMan.params.onBroadcast) {\r\n                        confMan.params.onBroadcast(verto, confMan, e.data);\r\n                    }\r\n\r\n\t\t    if (e.data[\"conf-command\"] === \"list-videoLayouts\") {\r\n\t\t\tfor (var j = 0; j < confMan.canvasCount; j++) {\r\n\t\t\t    var vlselect_id = \"#confman_vl_select_\" + j + \"_\" + confMan.serno;\r\n\t\t\t    var vlayout_id = \"#confman_vid_layout_\" + j + \"_\" + confMan.serno;\r\n\t\t\t    \r\n\t\t\t    var x = 0;\r\n\t\t\t    var options;\r\n\t\t\t    \r\n\t\t\t    $(vlselect_id).selectmenu({});\r\n\t\t\t    $(vlselect_id).selectmenu(\"enable\");\r\n\t\t\t    $(vlselect_id).empty();\r\n\t\t\t    \r\n\t\t\t    $(vlselect_id).append(new Option(\"Choose a Layout\", \"none\"));\r\n\r\n\t\t\t    if (e.data.responseData) {\r\n\t\t\t\tvar rdata = [];\r\n\r\n\t\t\t\tfor (var i in e.data.responseData) {\r\n\t\t\t\t    rdata.push(e.data.responseData[i].name);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\toptions = rdata.sort(function(a, b) {\r\n\t\t\t\t    var ga = a.substring(0, 6) == \"group:\" ? true : false;\r\n\t\t\t\t    var gb = b.substring(0, 6) == \"group:\" ? true : false;\r\n\t\t\t\t    \r\n\t\t\t\t    if ((ga || gb) && ga != gb) {\r\n\t\t\t\t\treturn ga ? -1 : 1;\r\n\t\t\t\t    }\r\n\t\t\t\t    \r\n\t\t\t\t    return ( ( a == b ) ? 0 : ( ( a > b ) ? 1 : -1 ) );\r\n\t\t\t\t});\r\n\r\n\t\t\t\tfor (var i in options) {\r\n\t\t\t\t    $(vlselect_id).append(new Option(options[i], options[i]));\r\n\t\t\t\t    x++;\r\n\t\t\t\t}\r\n\t\t\t    }\r\n\r\n\t\t\t    if (x) {\r\n\t\t\t\t$(vlselect_id).selectmenu('refresh', true);\r\n\t\t\t    } else {\r\n\t\t\t\t$(vlayout_id).hide();\r\n\t\t\t    }\r\n\t\t\t}\r\n\t\t    } else {\r\n\r\n\t\t\tif (!confMan.destroyed && confMan.params.displayID) {\r\n                            $(confMan.params.displayID).html(e.data.response + \"<br><br>\");\r\n                            if (confMan.lastTimeout) {\r\n\t\t\t\tclearTimeout(confMan.lastTimeout);\r\n\t\t\t\tconfMan.lastTimeout = 0;\r\n                            }\r\n                            confMan.lastTimeout = setTimeout(function() { $(confMan.params.displayID).html(confMan.destroyed ? \"\" : \"Moderator Controls Ready<br><br>\");}, 4000);\r\n\t\t\t}\r\n\t\t    }\r\n                }\r\n            });\r\n\r\n\r\n\t    if (confMan.params.hasVid) {\r\n\t\tconfMan.modCommand(\"list-videoLayouts\", null, null);\r\n\t    }\r\n        }\r\n\r\n        var row_callback = null;\r\n\r\n        if (confMan.params.laData.role === \"moderator\") {\r\n            row_callback = function(nRow, aData, iDisplayIndex, iDisplayIndexFull) {\r\n                if (!aData[5]) {\r\n                    var $row = $('td:eq(5)', nRow);\r\n                    genControls($row, aData);\r\n\r\n                    if (confMan.params.onLaRow) {\r\n                        confMan.params.onLaRow(verto, confMan, $row, aData);\r\n                    }\r\n                }\r\n            };\r\n        }\r\n\r\n        confMan.lt = new $.verto.liveTable(verto, confMan.params.laData.laChannel, confMan.params.laData.laName, $(confMan.params.tableID), {\r\n            subParams: {\r\n                callID: confMan.params.dialog ? confMan.params.dialog.callID : null\r\n            },\r\n\r\n            \"onChange\": function(obj, args) {\r\n                $(confMan.params.statusID).text(\"Conference Members: \" + \" (\" + obj.arrayLen() + \" Total)\");\r\n                if (confMan.params.onLaChange) {\r\n                    confMan.params.onLaChange(verto, confMan, $.verto.enum.confEvent.laChange, obj, args);\r\n                }\r\n            },\r\n\r\n            \"aaData\": [],\r\n            \"aoColumns\": [\r\n                {\r\n                    \"sTitle\": \"ID\",\r\n                    \"sWidth\": \"50\"\r\n                },\r\n                {\r\n                    \"sTitle\": \"Number\",\r\n\t\t    \"sWidth\": \"250\"\r\n                },\r\n                {\r\n                    \"sTitle\": \"Name\",\r\n\t\t    \"sWidth\": \"250\"\r\n                },\r\n                {\r\n                    \"sTitle\": \"Codec\",\r\n                    \"sWidth\": \"100\"\r\n                },\r\n                {\r\n                    \"sTitle\": \"Status\",\r\n                    \"sWidth\": confMan.params.hasVid ? \"200px\" : \"150px\"\r\n                },\r\n                {\r\n                    \"sTitle\": atitle,\r\n                    \"sWidth\": awidth,\r\n                }\r\n            ],\r\n            \"bAutoWidth\": true,\r\n            \"bDestroy\": true,\r\n            \"bSort\": false,\r\n            \"bInfo\": false,\r\n            \"bFilter\": false,\r\n            \"bLengthChange\": false,\r\n            \"bPaginate\": false,\r\n            \"iDisplayLength\": 1400,\r\n\r\n            \"oLanguage\": {\r\n                \"sEmptyTable\": \"The Conference is Empty.....\"\r\n            },\r\n\r\n            \"fnRowCallback\": row_callback\r\n\r\n        });\r\n    };\r\n\r\n    $.verto.confMan.prototype.modCommand = function(cmd, id, value) {\r\n        var confMan = this;\r\n\r\n        confMan.verto.rpcClient.call(\"verto.broadcast\", {\r\n            \"eventChannel\": confMan.params.laData.modChannel,\r\n            \"data\": {\r\n\t\t\"application\": \"conf-control\",\r\n\t\t\"command\": cmd,\r\n\t\t\"id\": id,\r\n\t\t\"value\": value\r\n            }\r\n\t});\r\n    };\r\n\r\n    $.verto.confMan.prototype.sendChat = function(message, type) {\r\n        var confMan = this;\r\n        confMan.verto.rpcClient.call(\"verto.broadcast\", {\r\n            \"eventChannel\": confMan.params.laData.chatChannel,\r\n            \"data\": {\r\n\t\t\"action\": \"send\",\r\n\t\t\"message\": message,\r\n\t\t\"type\": type\r\n            }\r\n\t});\r\n    };\r\n\r\n\r\n    $.verto.confMan.prototype.destroy = function() {\r\n        var confMan = this;\r\n\r\n        confMan.destroyed = true;\r\n\r\n        if (confMan.lt) {\r\n            confMan.lt.destroy();\r\n        }\r\n\r\n        if (confMan.params.laData.chatChannel) {\r\n            confMan.verto.unsubscribe(confMan.params.laData.chatChannel);\r\n        }\r\n\r\n        if (confMan.params.laData.modChannel) {\r\n            confMan.verto.unsubscribe(confMan.params.laData.modChannel);\r\n        }\r\n\r\n        if (confMan.params.mainModID) {\r\n            $(confMan.params.mainModID).html(\"\");\r\n        }\r\n    };\r\n\r\n    $.verto.dialog = function(direction, verto, params) {\r\n        var dialog = this;\r\n\r\n        dialog.params = $.extend({\r\n            useVideo: verto.options.useVideo,\r\n            useStereo: verto.options.useStereo,\r\n\t    screenShare: false,\r\n\t    useCamera: false,\r\n\t    useMic: verto.options.deviceParams.useMic,\r\n\t    useSpeak: verto.options.deviceParams.useSpeak,\r\n            tag: verto.options.tag,\r\n            localTag: verto.options.localTag,\r\n            login: verto.options.login,\r\n\t    videoParams: verto.options.videoParams\r\n        }, params);\r\n\t\r\n\r\n\tif (!dialog.params.screenShare) {\r\n\t    dialog.params.useCamera = verto.options.deviceParams.useCamera;\r\n\t}\r\n\r\n        dialog.verto = verto;\r\n        dialog.direction = direction;\r\n        dialog.lastState = null;\r\n        dialog.state = dialog.lastState = $.verto.enum.state.new;\r\n        dialog.callbacks = verto.callbacks;\r\n        dialog.answered = false;\r\n        dialog.attach = params.attach || false;\r\n\tdialog.screenShare = params.screenShare || false;\r\n\tdialog.useCamera = dialog.params.useCamera;\r\n\tdialog.useMic = dialog.params.useMic;\r\n\tdialog.useSpeak = dialog.params.useSpeak;\r\n\t\r\n        if (dialog.params.callID) {\r\n            dialog.callID = dialog.params.callID;\r\n        } else {\r\n            dialog.callID = dialog.params.callID = generateGUID();\r\n        }\r\n\r\n\tif (typeof(dialog.params.tag) === \"function\") {\r\n\t\tdialog.params.tag = dialog.params.tag();\r\n\t}\r\n\t\r\n        if (dialog.params.tag) {\r\n            dialog.audioStream = document.getElementById(dialog.params.tag);\r\n\r\n            if (dialog.params.useVideo) {\r\n                dialog.videoStream = dialog.audioStream;\r\n            }\r\n        } //else conjure one TBD\r\n\r\n        if (dialog.params.localTag) {\r\n\t    dialog.localVideo = document.getElementById(dialog.params.localTag);\r\n\t}\r\n\r\n        dialog.verto.dialogs[dialog.callID] = dialog;\r\n\r\n        var RTCcallbacks = {};\r\n\r\n        if (dialog.direction == $.verto.enum.direction.inbound) {\r\n            if (dialog.params.display_direction === \"outbound\") {\r\n                dialog.params.remote_caller_id_name = dialog.params.caller_id_name;\r\n                dialog.params.remote_caller_id_number = dialog.params.caller_id_number;\r\n            } else {\r\n                dialog.params.remote_caller_id_name = dialog.params.callee_id_name;\r\n                dialog.params.remote_caller_id_number = dialog.params.callee_id_number;\r\n            }\r\n\r\n            if (!dialog.params.remote_caller_id_name) {\r\n                dialog.params.remote_caller_id_name = \"Nobody\";\r\n            }\r\n\r\n            if (!dialog.params.remote_caller_id_number) {\r\n                dialog.params.remote_caller_id_number = \"UNKNOWN\";\r\n            }\r\n\r\n            RTCcallbacks.onMessage = function(rtc, msg) {\r\n                console.debug(msg);\r\n            };\r\n\r\n            RTCcallbacks.onAnswerSDP = function(rtc, sdp) {\r\n                console.error(\"answer sdp\", sdp);\r\n            };\r\n        } else {\r\n            dialog.params.remote_caller_id_name = \"Outbound Call\";\r\n            dialog.params.remote_caller_id_number = dialog.params.destination_number;\r\n        }\r\n\r\n        RTCcallbacks.onICESDP = function(rtc) {\r\n            console.log(\"RECV \" + rtc.type + \" SDP\", rtc.mediaData.SDP);\r\n\r\n\t    if (dialog.state == $.verto.enum.state.requesting || dialog.state == $.verto.enum.state.answering || dialog.state == $.verto.enum.state.active) {\r\n\t\tlocation.reload();\r\n\t\treturn;\r\n\t    }\r\n\r\n            if (rtc.type == \"offer\") {\r\n\t\tif (dialog.state == $.verto.enum.state.active) {\r\n                    dialog.setState($.verto.enum.state.requesting);\r\n\t\t    dialog.sendMethod(\"verto.attach\", {\r\n\t\t\tsdp: rtc.mediaData.SDP\r\n                    });\r\n\t\t} else {\r\n                    dialog.setState($.verto.enum.state.requesting);\r\n\t\t    \r\n                    dialog.sendMethod(\"verto.invite\", {\r\n\t\t\tsdp: rtc.mediaData.SDP\r\n                    });\r\n\t\t}\r\n            } else { //answer\r\n                dialog.setState($.verto.enum.state.answering);\r\n\r\n                dialog.sendMethod(dialog.attach ? \"verto.attach\" : \"verto.answer\", {\r\n                    sdp: dialog.rtc.mediaData.SDP\r\n                });\r\n            }\r\n        };\r\n\r\n        RTCcallbacks.onICE = function(rtc) {\r\n            //console.log(\"cand\", rtc.mediaData.candidate);\r\n            if (rtc.type == \"offer\") {\r\n                console.log(\"offer\", rtc.mediaData.candidate);\r\n                return;\r\n            }\r\n        };\r\n\r\n        RTCcallbacks.onStream = function(rtc, stream) {\r\n            if (dialog.verto.options.permissionCallback &&\r\n                typeof dialog.verto.options.permissionCallback.onGranted === 'function'){\r\n                dialog.verto.options.permissionCallback.onGranted(stream);\r\n            }\r\n            console.log(\"stream started\");\r\n        };\r\n\r\n        RTCcallbacks.onError = function(e) {\r\n            if (dialog.verto.options.permissionCallback &&\r\n                typeof dialog.verto.options.permissionCallback.onDenied === 'function'){\r\n                dialog.verto.options.permissionCallback.onDenied();\r\n            }\r\n            console.error(\"ERROR:\", e);\r\n            dialog.hangup({cause: \"Device or Permission Error\"});\r\n        };\r\n\r\n        dialog.rtc = new $.FSRTC({\r\n            callbacks: RTCcallbacks,\r\n\t    localVideo: dialog.screenShare ? null : dialog.localVideo,\r\n            useVideo: dialog.params.useVideo ? dialog.videoStream : null,\r\n            useAudio: dialog.audioStream,\r\n            useStereo: dialog.params.useStereo,\r\n            videoParams: dialog.params.videoParams,\r\n            audioParams: verto.options.audioParams,\r\n            iceServers: verto.options.iceServers,\r\n\t    screenShare: dialog.screenShare,\r\n\t    useCamera: dialog.useCamera,\r\n\t    useMic: dialog.useMic,\r\n\t    useSpeak: dialog.useSpeak\r\n        });\r\n\r\n        dialog.rtc.verto = dialog.verto;\r\n\r\n        if (dialog.direction == $.verto.enum.direction.inbound) {\r\n            if (dialog.attach) {\r\n                dialog.answer();\r\n            } else {\r\n                dialog.ring();\r\n            }\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.invite = function() {\r\n        var dialog = this;\r\n        dialog.rtc.call();\r\n    };\r\n\r\n    $.verto.dialog.prototype.sendMethod = function(method, obj) {\r\n        var dialog = this;\r\n        obj.dialogParams = {};\r\n\r\n        for (var i in dialog.params) {\r\n\t    if (i == \"sdp\" && method != \"verto.invite\" && method != \"verto.attach\") {\r\n                continue;\r\n\t    }\r\n\t    \r\n\t    if ((obj.noDialogParams && i != \"callID\")) {\r\n\t\tcontinue;\r\n\t    }\r\n\r\n\t    obj.dialogParams[i] = dialog.params[i];\r\n        }\r\n\t\r\n\tdelete obj.noDialogParams;\r\n\r\n        dialog.verto.rpcClient.call(method, obj,\r\n\r\n        function(e) {\r\n            /* Success */\r\n            dialog.processReply(method, true, e);\r\n        },\r\n\r\n        function(e) {\r\n            /* Error */\r\n            dialog.processReply(method, false, e);\r\n        });\r\n    };\r\n\r\n    function checkStateChange(oldS, newS) {\r\n\r\n        if (newS == $.verto.enum.state.purge || $.verto.enum.states[oldS.name][newS.name]) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n\r\n    // Attach audio output device to video element using device/sink ID.                                                                                           \r\n    function find_name(id) {\r\n\tfor (var i in $.verto.audioOutDevices) {\r\n\t    var source = $.verto.audioOutDevices[i];\r\n\t    if (source.id === id) {\r\n\t\treturn(source.label);\r\n\t    }\r\n\t}\r\n\r\n\treturn id;\r\n    }\r\n\r\n    $.verto.dialog.prototype.setAudioPlaybackDevice = function(sinkId, callback, arg) {\r\n\tvar dialog = this;\r\n\tvar element = dialog.audioStream;\r\n\r\n\tif (typeof element.sinkId !== 'undefined') {\r\n\t    var devname = find_name(sinkId);\r\n\t    console.info(\"Dialog: \" + dialog.callID + \" Setting speaker:\", element, devname);\r\n\r\n\t    element.setSinkId(sinkId)\r\n\t\t.then(function() {\r\n\t\t    console.log(\"Dialog: \" + dialog.callID + ' Success, audio output device attached: ' + sinkId);\r\n\t\t    if (callback) {\r\n\t\t\tcallback(true, devname, arg);\r\n\t\t    }\r\n\t\t})\r\n\t\t.catch(function(error) {\r\n\t\t    var errorMessage = error;\r\n\t\t    if (error.name === 'SecurityError') {\r\n\t\t\terrorMessage = \"Dialog: \" + dialog.callID + ' You need to use HTTPS for selecting audio output ' +\r\n\t\t\t    'device: ' + error;\r\n\t\t    }\r\n\t\t    if (callback) {\r\n\t\t\tcallback(false, null, arg);\r\n\t\t    }\r\n\t\t    console.error(errorMessage);\r\n\t\t});\r\n\t} else {\r\n\t    console.warn(\"Dialog: \" + dialog.callID + ' Browser does not support output device selection.');\r\n\t    if (callback) {\r\n\t\tcallback(false, null, arg);\r\n\t    }\r\n\t}\r\n    }\r\n\r\n    $.verto.dialog.prototype.setState = function(state) {\r\n        var dialog = this;\r\n\r\n        if (dialog.state == $.verto.enum.state.ringing) {\r\n            dialog.stopRinging();\r\n        }\r\n\r\n        if (dialog.state == state || !checkStateChange(dialog.state, state)) {\r\n            console.error(\"Dialog \" + dialog.callID + \": INVALID state change from \" + dialog.state.name + \" to \" + state.name);\r\n            dialog.hangup();\r\n            return false;\r\n        }\r\n\r\n        console.log(\"Dialog \" + dialog.callID + \": state change from \" + dialog.state.name + \" to \" + state.name);\r\n\r\n        dialog.lastState = dialog.state;\r\n        dialog.state = state;\r\n\r\n        if (dialog.callbacks.onDialogState) {\r\n            dialog.callbacks.onDialogState(this);\r\n        }\r\n\r\n        switch (dialog.state) {\r\n\r\n        case $.verto.enum.state.early:\r\n        case $.verto.enum.state.active:\r\n\r\n\t    var speaker = dialog.useSpeak;\r\n\t    console.info(\"Using Speaker: \", speaker);\r\n\r\n\t    if (speaker && speaker !== \"any\" && speaker !== \"none\") {\r\n\t\tsetTimeout(function() {\r\n\t\t    dialog.setAudioPlaybackDevice(speaker);\r\n\t\t}, 500);\r\n\t    }\r\n\r\n\t    break;\r\n\r\n        case $.verto.enum.state.trying:\r\n            setTimeout(function() {\r\n                if (dialog.state == $.verto.enum.state.trying) {\r\n                    dialog.setState($.verto.enum.state.hangup);\r\n                }\r\n            }, 30000);\r\n            break;\r\n        case $.verto.enum.state.purge:\r\n            dialog.setState($.verto.enum.state.destroy);\r\n            break;\r\n        case $.verto.enum.state.hangup:\r\n\r\n            if (dialog.lastState.val > $.verto.enum.state.requesting.val && dialog.lastState.val < $.verto.enum.state.hangup.val) {\r\n                dialog.sendMethod(\"verto.bye\", {});\r\n            }\r\n\r\n            dialog.setState($.verto.enum.state.destroy);\r\n            break;\r\n        case $.verto.enum.state.destroy:\r\n\r\n            if (typeof(dialog.verto.options.tag) === \"function\") {\r\n              $('#' + dialog.params.tag).remove();\r\n            }\r\n\r\n            delete dialog.verto.dialogs[dialog.callID];\r\n\t    if (dialog.params.screenShare) {\r\n\t\tdialog.rtc.stopPeer();\r\n\t    } else {\r\n\t\tdialog.rtc.stop();\r\n\t    }\r\n            break;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    $.verto.dialog.prototype.processReply = function(method, success, e) {\r\n        var dialog = this;\r\n\r\n        //console.log(\"Response: \" + method + \" State:\" + dialog.state.name, success, e);\r\n\r\n        switch (method) {\r\n\r\n        case \"verto.answer\":\r\n        case \"verto.attach\":\r\n            if (success) {\r\n                dialog.setState($.verto.enum.state.active);\r\n            } else {\r\n                dialog.hangup();\r\n            }\r\n            break;\r\n        case \"verto.invite\":\r\n            if (success) {\r\n                dialog.setState($.verto.enum.state.trying);\r\n            } else {\r\n                dialog.setState($.verto.enum.state.destroy);\r\n            }\r\n            break;\r\n\r\n        case \"verto.bye\":\r\n            dialog.hangup();\r\n            break;\r\n\r\n        case \"verto.modify\":\r\n            if (e.holdState) {\r\n                if (e.holdState == \"held\") {\r\n                    if (dialog.state != $.verto.enum.state.held) {\r\n                        dialog.setState($.verto.enum.state.held);\r\n                    }\r\n                } else if (e.holdState == \"active\") {\r\n                    if (dialog.state != $.verto.enum.state.active) {\r\n                        dialog.setState($.verto.enum.state.active);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (success) {}\r\n\r\n            break;\r\n\r\n        default:\r\n            break;\r\n        }\r\n\r\n    };\r\n\r\n    $.verto.dialog.prototype.hangup = function(params) {\r\n        var dialog = this;\r\n\r\n        if (params) {\r\n            if (params.causeCode) {\r\n\t\tdialog.causeCode = params.causeCode;\r\n            }\r\n\r\n            if (params.cause) {\r\n\t\tdialog.cause = params.cause;\r\n            }\r\n        }\r\n\r\n\tif (!dialog.cause && !dialog.causeCode) {\r\n\t    dialog.cause = \"NORMAL_CLEARING\";\r\n\t}\r\n\r\n        if (dialog.state.val >= $.verto.enum.state.new.val && dialog.state.val < $.verto.enum.state.hangup.val) {\r\n            dialog.setState($.verto.enum.state.hangup);\r\n        } else if (dialog.state.val < $.verto.enum.state.destroy) {\r\n            dialog.setState($.verto.enum.state.destroy);\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.stopRinging = function() {\r\n        var dialog = this;\r\n        if (dialog.verto.ringer) {\r\n            dialog.verto.ringer.stop();\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.indicateRing = function() {\r\n        var dialog = this;\r\n\r\n        if (dialog.verto.ringer) {\r\n            dialog.verto.ringer.attr(\"src\", dialog.verto.options.ringFile)[0].play();\r\n\r\n            setTimeout(function() {\r\n                dialog.stopRinging();\r\n                if (dialog.state == $.verto.enum.state.ringing) {\r\n                    dialog.indicateRing();\r\n                }\r\n            },\r\n            dialog.verto.options.ringSleep);\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.ring = function() {\r\n        var dialog = this;\r\n\r\n        dialog.setState($.verto.enum.state.ringing);\r\n        dialog.indicateRing();\r\n    };\r\n\r\n    $.verto.dialog.prototype.useVideo = function(on) {\r\n        var dialog = this;\r\n\r\n        dialog.params.useVideo = on;\r\n\r\n        if (on) {\r\n            dialog.videoStream = dialog.audioStream;\r\n        } else {\r\n            dialog.videoStream = null;\r\n        }\r\n\r\n        dialog.rtc.useVideo(dialog.videoStream, dialog.localVideo);\r\n\r\n    };\r\n\r\n    $.verto.dialog.prototype.setMute = function(what) {\r\n\tvar dialog = this;\r\n\treturn dialog.rtc.setMute(what);\r\n    };\r\n\r\n    $.verto.dialog.prototype.getMute = function() {\r\n\tvar dialog = this; \r\n\treturn dialog.rtc.getMute();\r\n    };\r\n\r\n    $.verto.dialog.prototype.setVideoMute = function(what) {\r\n\tvar dialog = this;\r\n\treturn dialog.rtc.setVideoMute(what);\r\n    };\r\n\r\n    $.verto.dialog.prototype.getVideoMute = function() {\r\n\tvar dialog = this; \r\n\treturn dialog.rtc.getVideoMute();\r\n    };\r\n\r\n    $.verto.dialog.prototype.useStereo = function(on) {\r\n        var dialog = this;\r\n\r\n        dialog.params.useStereo = on;\r\n        dialog.rtc.useStereo(on);\r\n    };\r\n\r\n    $.verto.dialog.prototype.dtmf = function(digits) {\r\n        var dialog = this;\r\n        if (digits) {\r\n            dialog.sendMethod(\"verto.info\", {\r\n                dtmf: digits\r\n            });\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.rtt = function(obj) {\r\n        var dialog = this;\r\n\tvar pobj = {};\r\n\r\n\tif (!obj) {\r\n\t    return false;\r\n\t}\r\n\r\n\tpobj.code = obj.code;\r\n\tpobj.chars = obj.chars;\r\n\r\n\r\n        if (pobj.chars || pobj.code) {\r\n            dialog.sendMethod(\"verto.info\", {\r\n                txt: obj,\r\n\t\tnoDialogParams: true\r\n            });\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.transfer = function(dest, params) {\r\n        var dialog = this;\r\n        if (dest) {\r\n            dialog.sendMethod(\"verto.modify\", {\r\n                action: \"transfer\",\r\n                destination: dest,\r\n                params: params\r\n            });\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.replace = function(replaceCallID, params) {\r\n        var dialog = this;\r\n        if (replaceCallID) {\r\n            dialog.sendMethod(\"verto.modify\", {\r\n                action: \"replace\",\r\n                replaceCallID: replaceCallID,\r\n                params: params\r\n            });\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.hold = function(params) {\r\n        var dialog = this;\r\n\r\n        dialog.sendMethod(\"verto.modify\", {\r\n            action: \"hold\",\r\n            params: params\r\n        });\r\n    };\r\n\r\n    $.verto.dialog.prototype.unhold = function(params) {\r\n        var dialog = this;\r\n\r\n        dialog.sendMethod(\"verto.modify\", {\r\n            action: \"unhold\",\r\n            params: params\r\n        });\r\n    };\r\n\r\n    $.verto.dialog.prototype.toggleHold = function(params) {\r\n        var dialog = this;\r\n\r\n        dialog.sendMethod(\"verto.modify\", {\r\n            action: \"toggleHold\",\r\n            params: params\r\n        });\r\n    };\r\n\r\n    $.verto.dialog.prototype.message = function(msg) {\r\n        var dialog = this;\r\n        var err = 0;\r\n\r\n        msg.from = dialog.params.login;\r\n\r\n        if (!msg.to) {\r\n            console.error(\"Missing To\");\r\n            err++;\r\n        }\r\n\r\n        if (!msg.body) {\r\n            console.error(\"Missing Body\");\r\n            err++;\r\n        }\r\n\r\n        if (err) {\r\n            return false;\r\n        }\r\n\r\n        dialog.sendMethod(\"verto.info\", {\r\n            msg: msg\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    $.verto.dialog.prototype.answer = function(params) {\r\n        var dialog = this;\r\n\t\r\n        if (!dialog.answered) {\r\n\t    if (!params) {\r\n\t\tparams = {};\r\n\t    }\r\n\r\n\t    params.sdp = dialog.params.sdp;\r\n\r\n            if (params) {\r\n                if (params.useVideo) {\r\n                    dialog.useVideo(true);\r\n                }\r\n\t\tdialog.params.callee_id_name = params.callee_id_name;\r\n\t\tdialog.params.callee_id_number = params.callee_id_number;\r\n\r\n\t\tif (params.useCamera) {\r\n\t\t    dialog.useCamera = params.useCamera;\r\n\t\t}\r\n\r\n\t\tif (params.useMic) {\r\n\t\t    dialog.useMic = params.useMic;\r\n\t\t}\r\n\r\n\t\tif (params.useSpeak) {\r\n\t\t    dialog.useSpeak = params.useSpeak;\r\n\t\t}\r\n            }\r\n\t    \r\n            dialog.rtc.createAnswer(params);\r\n            dialog.answered = true;\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.handleAnswer = function(params) {\r\n        var dialog = this;\r\n\r\n        dialog.gotAnswer = true;\r\n\r\n        if (dialog.state.val >= $.verto.enum.state.active.val) {\r\n            return;\r\n        }\r\n\r\n        if (dialog.state.val >= $.verto.enum.state.early.val) {\r\n            dialog.setState($.verto.enum.state.active);\r\n        } else {\r\n            if (dialog.gotEarly) {\r\n                console.log(\"Dialog \" + dialog.callID + \" Got answer while still establishing early media, delaying...\");\r\n            } else {\r\n                console.log(\"Dialog \" + dialog.callID + \" Answering Channel\");\r\n                dialog.rtc.answer(params.sdp, function() {\r\n                    dialog.setState($.verto.enum.state.active);\r\n                }, function(e) {\r\n                    console.error(e);\r\n                    dialog.hangup();\r\n                });\r\n                console.log(\"Dialog \" + dialog.callID + \"ANSWER SDP\", params.sdp);\r\n            }\r\n        }\r\n\r\n\r\n    };\r\n\r\n    $.verto.dialog.prototype.cidString = function(enc) {\r\n        var dialog = this;\r\n        var party = dialog.params.remote_caller_id_name + (enc ? \" &lt;\" : \" <\") + dialog.params.remote_caller_id_number + (enc ? \"&gt;\" : \">\");\r\n        return party;\r\n    };\r\n\r\n    $.verto.dialog.prototype.sendMessage = function(msg, params) {\r\n        var dialog = this;\r\n\r\n        if (dialog.callbacks.onMessage) {\r\n            dialog.callbacks.onMessage(dialog.verto, dialog, msg, params);\r\n        }\r\n    };\r\n\r\n    $.verto.dialog.prototype.handleInfo = function(params) {\r\n        var dialog = this;\r\n\r\n        dialog.sendMessage($.verto.enum.message.info, params);\r\n\r\n    };\r\n\r\n    $.verto.dialog.prototype.handleDisplay = function(params) {\r\n        var dialog = this;\r\n\r\n        if (params.display_name) {\r\n            dialog.params.remote_caller_id_name = params.display_name;\r\n        }\r\n        if (params.display_number) {\r\n            dialog.params.remote_caller_id_number = params.display_number;\r\n        }\r\n\r\n        dialog.sendMessage($.verto.enum.message.display, {});\r\n    };\r\n\r\n    $.verto.dialog.prototype.handleMedia = function(params) {\r\n        var dialog = this;\r\n\r\n        if (dialog.state.val >= $.verto.enum.state.early.val) {\r\n            return;\r\n        }\r\n\r\n        dialog.gotEarly = true;\r\n\r\n        dialog.rtc.answer(params.sdp, function() {\r\n            console.log(\"Dialog \" + dialog.callID + \"Establishing early media\");\r\n            dialog.setState($.verto.enum.state.early);\r\n\r\n            if (dialog.gotAnswer) {\r\n                console.log(\"Dialog \" + dialog.callID + \"Answering Channel\");\r\n                dialog.setState($.verto.enum.state.active);\r\n            }\r\n        }, function(e) {\r\n            console.error(e);\r\n            dialog.hangup();\r\n        });\r\n        console.log(\"Dialog \" + dialog.callID + \"EARLY SDP\", params.sdp);\r\n    };\r\n\r\n    $.verto.ENUM = function(s) {\r\n        var i = 0,\r\n        o = {};\r\n        s.split(\" \").map(function(x) {\r\n            o[x] = {\r\n                name: x,\r\n                val: i++\r\n            };\r\n        });\r\n        return Object.freeze(o);\r\n    };\r\n\r\n    $.verto.enum = {};\r\n\r\n    $.verto.enum.states = Object.freeze({\r\n        new: {\r\n            requesting: 1,\r\n            recovering: 1,\r\n            ringing: 1,\r\n            destroy: 1,\r\n            answering: 1,\r\n\t    hangup: 1\r\n        },\r\n        requesting: {\r\n            trying: 1,\r\n            hangup: 1,\r\n\t    active: 1\r\n        },\r\n        recovering: {\r\n            answering: 1,\r\n            hangup: 1\r\n        },\r\n        trying: {\r\n            active: 1,\r\n            early: 1,\r\n            hangup: 1\r\n        },\r\n        ringing: {\r\n            answering: 1,\r\n            hangup: 1\r\n        },\r\n        answering: {\r\n            active: 1,\r\n            hangup: 1\r\n        },\r\n        active: {\r\n            answering: 1,\r\n            requesting: 1,\r\n            hangup: 1,\r\n            held: 1\r\n        },\r\n        held: {\r\n            hangup: 1,\r\n            active: 1\r\n        },\r\n        early: {\r\n            hangup: 1,\r\n            active: 1\r\n        },\r\n        hangup: {\r\n            destroy: 1\r\n        },\r\n        destroy: {},\r\n        purge: {\r\n            destroy: 1\r\n        }\r\n    });\r\n\r\n    $.verto.enum.state = $.verto.ENUM(\"new requesting trying recovering ringing answering early active held hangup destroy purge\");\r\n    $.verto.enum.direction = $.verto.ENUM(\"inbound outbound\");\r\n    $.verto.enum.message = $.verto.ENUM(\"display info pvtEvent clientReady\");\r\n\r\n    $.verto.enum = Object.freeze($.verto.enum);\r\n\r\n    $.verto.saved = [];\r\n    \r\n    $.verto.unloadJobs = [];\r\n\r\n    $(window).bind('beforeunload', function() {\r\n\tfor (var f in $.verto.unloadJobs) {\r\n\t    $.verto.unloadJobs[f]();\r\n\t}\r\n\r\n        if ($.verto.haltClosure)\r\n          return $.verto.haltClosure();\r\n\r\n        for (var i in $.verto.saved) {\r\n            var verto = $.verto.saved[i];\r\n            if (verto) {\r\n                verto.purge();\r\n                verto.logout();\r\n            }\r\n        }\r\n\r\n        return $.verto.warnOnUnload;\r\n    });\r\n\r\n    $.verto.videoDevices = [];\r\n    $.verto.audioInDevices = [];\r\n    $.verto.audioOutDevices = [];\r\n\r\n    var checkDevices = function(runtime) {\r\n\tconsole.info(\"enumerating devices\");\r\n\tvar aud_in = [], aud_out = [], vid = [];\t\r\n\tvar has_video = 0, has_audio = 0;\r\n\tvar Xstream;\r\n\r\n\tfunction gotDevices(deviceInfos) {\r\n\t      // Handles being called several times to update labels. Preserve values.\r\n\t    for (var i = 0; i !== deviceInfos.length; ++i) {\r\n\t\tvar deviceInfo = deviceInfos[i];\r\n\t\tvar text = \"\";\r\n\r\n\t\tconsole.log(deviceInfo);\r\n\t\tconsole.log(deviceInfo.kind + \": \" + deviceInfo.label + \" id = \" + deviceInfo.deviceId);\r\n\r\n\t\tif (deviceInfo.kind === 'audioinput') {\r\n\t\t    text = deviceInfo.label || 'microphone ' + (aud_in.length + 1);\r\n\t\t    aud_in.push({id: deviceInfo.deviceId, kind: \"audio_in\", label: text});\r\n\t\t} else if (deviceInfo.kind === 'audiooutput') {\r\n\t\t    text = deviceInfo.label || 'speaker ' + (aud_out.length + 1);\r\n\t\t    aud_out.push({id: deviceInfo.deviceId, kind: \"audio_out\", label: text});\r\n\t\t} else if (deviceInfo.kind === 'videoinput') {\r\n\t\t    text = deviceInfo.label || 'camera ' + (vid.length + 1);\r\n\t\t    vid.push({id: deviceInfo.deviceId, kind: \"video\", label: text});\r\n\t\t} else {\r\n\t\t    console.log('Some other kind of source/device: ', deviceInfo);\r\n\t\t}\r\n\t    }\r\n\r\n\r\n\t    $.verto.videoDevices = vid;\r\n\t    $.verto.audioInDevices = aud_in;\r\n\t    $.verto.audioOutDevices = aud_out;\r\n\t    \r\n\t    console.info(\"Audio IN Devices\", $.verto.audioInDevices);\r\n\t    console.info(\"Audio Out Devices\", $.verto.audioOutDevices);\r\n\t    console.info(\"Video Devices\", $.verto.videoDevices);\r\n\r\n\t    if (Xstream) {\r\n\t\tXstream.getTracks().forEach(function(track) {track.stop();});\r\n\t    }\r\n\r\n\t    if (runtime) {\r\n\t\truntime(true);\r\n\t    }\r\n\t}\r\n\r\n\r\n\t\r\n\r\n\tfunction handleError(error) {\r\n\t    console.log('device enumeration error: ', error);\r\n\t    if (runtime) runtime(false);\r\n\t}\r\n\r\n\r\n\tfunction checkTypes(devs) {\r\n\t    for (var i = 0; i !== devs.length; ++i) {\r\n\r\n\t\tif (devs[i].kind === 'audioinput') {\r\n\t\t    has_audio++;\r\n\t\t} else if (devs[i].kind === 'videoinput') {\r\n\t\t    has_video++;\r\n\t\t}\r\n\t    }\r\n\r\n\t    navigator.getUserMedia({ audio: (has_audio > 0 ? true : false), video: (has_video > 0 ? true : false)},\r\n\t\t\t\t   function(stream) {\r\n\t\t\t\t       Xstream = stream;\r\n\t\t\t\t       navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(handleError);\r\n\t\t\t\t   },\r\n\t\t\t\t   function(err) {\r\n\t\t\t\t       console.log(\"The following error occurred: \" + err.name);\r\n\t\t\t\t   }\r\n\t\t\t\t  );\r\n\t}\r\n\r\n\tnavigator.mediaDevices.enumerateDevices().then(checkTypes).catch(handleError);\r\n\r\n  };\r\n\r\n    $.verto.refreshDevices = function(runtime) {\r\n\tcheckDevices(runtime);\r\n    }\r\n\r\n    $.verto.init = function(obj, runtime) {\r\n\tif (!obj) {\r\n\t    obj = {};\r\n\t}\r\n\r\n\tif (!obj.skipPermCheck && !obj.skipDeviceCheck) {\r\n\t    $.FSRTC.checkPerms(function(status) {\r\n\t\tcheckDevices(runtime);\r\n\t    }, true, true);\r\n\t} else if (obj.skipPermCheck && !obj.skipDeviceCheck) {\r\n\t    checkDevices(runtime);\r\n\t} else if (!obj.skipPermCheck && obj.skipDeviceCheck) {\r\n\t    $.FSRTC.checkPerms(function(status) {\r\n\t\truntime(status);\r\n\t    }, true, true);\r\n\t} else {\r\n\t    runtime(null);\r\n\t}\r\n\r\n    }\r\n\r\n    $.verto.genUUID = function () {\r\n\treturn generateGUID();\r\n    }\r\n\r\n\r\n})(jQuery);\r\n\r\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\r\n /* eslint-env node */\r\n'use strict';\r\n\r\n// SDP helpers.\r\nvar SDPUtils = {};\r\n\r\n// Generate an alphanumeric identifier for cname or mids.\r\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\r\nSDPUtils.generateIdentifier = function() {\r\n  return Math.random().toString(36).substr(2, 10);\r\n};\r\n\r\n// The RTCP CNAME used by all peerconnections from the same JS.\r\nSDPUtils.localCName = SDPUtils.generateIdentifier();\r\n\r\n// Splits SDP into lines, dealing with both CRLF and LF.\r\nSDPUtils.splitLines = function(blob) {\r\n  return blob.trim().split('\\n').map(function(line) {\r\n    return line.trim();\r\n  });\r\n};\r\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\r\nSDPUtils.splitSections = function(blob) {\r\n  var parts = blob.split('\\nm=');\r\n  return parts.map(function(part, index) {\r\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\r\n  });\r\n};\r\n\r\n// Returns lines that start with a certain prefix.\r\nSDPUtils.matchPrefix = function(blob, prefix) {\r\n  return SDPUtils.splitLines(blob).filter(function(line) {\r\n    return line.indexOf(prefix) === 0;\r\n  });\r\n};\r\n\r\n// Parses an ICE candidate line. Sample input:\r\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\r\n// rport 55996\"\r\nSDPUtils.parseCandidate = function(line) {\r\n  var parts;\r\n  // Parse both variants.\r\n  if (line.indexOf('a=candidate:') === 0) {\r\n    parts = line.substring(12).split(' ');\r\n  } else {\r\n    parts = line.substring(10).split(' ');\r\n  }\r\n\r\n  var candidate = {\r\n    foundation: parts[0],\r\n    component: parseInt(parts[1], 10),\r\n    protocol: parts[2].toLowerCase(),\r\n    priority: parseInt(parts[3], 10),\r\n    ip: parts[4],\r\n    port: parseInt(parts[5], 10),\r\n    // skip parts[6] == 'typ'\r\n    type: parts[7]\r\n  };\r\n\r\n  for (var i = 8; i < parts.length; i += 2) {\r\n    switch (parts[i]) {\r\n      case 'raddr':\r\n        candidate.relatedAddress = parts[i + 1];\r\n        break;\r\n      case 'rport':\r\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\r\n        break;\r\n      case 'tcptype':\r\n        candidate.tcpType = parts[i + 1];\r\n        break;\r\n      default: // extension handling, in particular ufrag\r\n        candidate[parts[i]] = parts[i + 1];\r\n        break;\r\n    }\r\n  }\r\n  return candidate;\r\n};\r\n\r\n// Translates a candidate object into SDP candidate attribute.\r\nSDPUtils.writeCandidate = function(candidate) {\r\n  var sdp = [];\r\n  sdp.push(candidate.foundation);\r\n  sdp.push(candidate.component);\r\n  sdp.push(candidate.protocol.toUpperCase());\r\n  sdp.push(candidate.priority);\r\n  sdp.push(candidate.ip);\r\n  sdp.push(candidate.port);\r\n\r\n  var type = candidate.type;\r\n  sdp.push('typ');\r\n  sdp.push(type);\r\n  if (type !== 'host' && candidate.relatedAddress &&\r\n      candidate.relatedPort) {\r\n    sdp.push('raddr');\r\n    sdp.push(candidate.relatedAddress); // was: relAddr\r\n    sdp.push('rport');\r\n    sdp.push(candidate.relatedPort); // was: relPort\r\n  }\r\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\r\n    sdp.push('tcptype');\r\n    sdp.push(candidate.tcpType);\r\n  }\r\n  if (candidate.ufrag) {\r\n    sdp.push('ufrag');\r\n    sdp.push(candidate.ufrag);\r\n  }\r\n  return 'candidate:' + sdp.join(' ');\r\n};\r\n\r\n// Parses an ice-options line, returns an array of option tags.\r\n// a=ice-options:foo bar\r\nSDPUtils.parseIceOptions = function(line) {\r\n  return line.substr(14).split(' ');\r\n}\r\n\r\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\r\n// a=rtpmap:111 opus/48000/2\r\nSDPUtils.parseRtpMap = function(line) {\r\n  var parts = line.substr(9).split(' ');\r\n  var parsed = {\r\n    payloadType: parseInt(parts.shift(), 10) // was: id\r\n  };\r\n\r\n  parts = parts[0].split('/');\r\n\r\n  parsed.name = parts[0];\r\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\r\n  // was: channels\r\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\r\n  return parsed;\r\n};\r\n\r\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\r\n// RTCRtpCodecParameters.\r\nSDPUtils.writeRtpMap = function(codec) {\r\n  var pt = codec.payloadType;\r\n  if (codec.preferredPayloadType !== undefined) {\r\n    pt = codec.preferredPayloadType;\r\n  }\r\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\r\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\r\n};\r\n\r\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\r\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\r\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\r\nSDPUtils.parseExtmap = function(line) {\r\n  var parts = line.substr(9).split(' ');\r\n  return {\r\n    id: parseInt(parts[0], 10),\r\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\r\n    uri: parts[1]\r\n  };\r\n};\r\n\r\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\r\n// RTCRtpHeaderExtension.\r\nSDPUtils.writeExtmap = function(headerExtension) {\r\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\r\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\r\n          ? '/' + headerExtension.direction\r\n          : '') +\r\n      ' ' + headerExtension.uri + '\\r\\n';\r\n};\r\n\r\n// Parses an ftmp line, returns dictionary. Sample input:\r\n// a=fmtp:96 vbr=on;cng=on\r\n// Also deals with vbr=on; cng=on\r\nSDPUtils.parseFmtp = function(line) {\r\n  var parsed = {};\r\n  var kv;\r\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\r\n  for (var j = 0; j < parts.length; j++) {\r\n    kv = parts[j].trim().split('=');\r\n    parsed[kv[0].trim()] = kv[1];\r\n  }\r\n  return parsed;\r\n};\r\n\r\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\nSDPUtils.writeFmtp = function(codec) {\r\n  var line = '';\r\n  var pt = codec.payloadType;\r\n  if (codec.preferredPayloadType !== undefined) {\r\n    pt = codec.preferredPayloadType;\r\n  }\r\n  if (codec.parameters && Object.keys(codec.parameters).length) {\r\n    var params = [];\r\n    Object.keys(codec.parameters).forEach(function(param) {\r\n      params.push(param + '=' + codec.parameters[param]);\r\n    });\r\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\r\n  }\r\n  return line;\r\n};\r\n\r\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\r\n// a=rtcp-fb:98 nack rpsi\r\nSDPUtils.parseRtcpFb = function(line) {\r\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\r\n  return {\r\n    type: parts.shift(),\r\n    parameter: parts.join(' ')\r\n  };\r\n};\r\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\r\nSDPUtils.writeRtcpFb = function(codec) {\r\n  var lines = '';\r\n  var pt = codec.payloadType;\r\n  if (codec.preferredPayloadType !== undefined) {\r\n    pt = codec.preferredPayloadType;\r\n  }\r\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\r\n    // FIXME: special handling for trr-int?\r\n    codec.rtcpFeedback.forEach(function(fb) {\r\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\r\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\r\n          '\\r\\n';\r\n    });\r\n  }\r\n  return lines;\r\n};\r\n\r\n// Parses an RFC 5576 ssrc media attribute. Sample input:\r\n// a=ssrc:3735928559 cname:something\r\nSDPUtils.parseSsrcMedia = function(line) {\r\n  var sp = line.indexOf(' ');\r\n  var parts = {\r\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\r\n  };\r\n  var colon = line.indexOf(':', sp);\r\n  if (colon > -1) {\r\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\r\n    parts.value = line.substr(colon + 1);\r\n  } else {\r\n    parts.attribute = line.substr(sp + 1);\r\n  }\r\n  return parts;\r\n};\r\n\r\n// Extracts the MID (RFC 5888) from a media section.\r\n// returns the MID or undefined if no mid line was found.\r\nSDPUtils.getMid = function(mediaSection) {\r\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\r\n  if (mid) {\r\n    return mid.substr(6);\r\n  }\r\n}\r\n\r\nSDPUtils.parseFingerprint = function(line) {\r\n  var parts = line.substr(14).split(' ');\r\n  return {\r\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\r\n    value: parts[1]\r\n  };\r\n};\r\n\r\n// Extracts DTLS parameters from SDP media section or sessionpart.\r\n// FIXME: for consistency with other functions this should only\r\n//   get the fingerprint line as input. See also getIceParameters.\r\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\r\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\r\n      'a=fingerprint:');\r\n  // Note: a=setup line is ignored since we use the 'auto' role.\r\n  // Note2: 'algorithm' is not case sensitive except in Edge.\r\n  return {\r\n    role: 'auto',\r\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\r\n  };\r\n};\r\n\r\n// Serializes DTLS parameters to SDP.\r\nSDPUtils.writeDtlsParameters = function(params, setupType) {\r\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\r\n  params.fingerprints.forEach(function(fp) {\r\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\r\n  });\r\n  return sdp;\r\n};\r\n// Parses ICE information from SDP media section or sessionpart.\r\n// FIXME: for consistency with other functions this should only\r\n//   get the ice-ufrag and ice-pwd lines as input.\r\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\r\n  var lines = SDPUtils.splitLines(mediaSection);\r\n  // Search in session part, too.\r\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\r\n  var iceParameters = {\r\n    usernameFragment: lines.filter(function(line) {\r\n      return line.indexOf('a=ice-ufrag:') === 0;\r\n    })[0].substr(12),\r\n    password: lines.filter(function(line) {\r\n      return line.indexOf('a=ice-pwd:') === 0;\r\n    })[0].substr(10)\r\n  };\r\n  return iceParameters;\r\n};\r\n\r\n// Serializes ICE parameters to SDP.\r\nSDPUtils.writeIceParameters = function(params) {\r\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\r\n      'a=ice-pwd:' + params.password + '\\r\\n';\r\n};\r\n\r\n// Parses the SDP media section and returns RTCRtpParameters.\r\nSDPUtils.parseRtpParameters = function(mediaSection) {\r\n  var description = {\r\n    codecs: [],\r\n    headerExtensions: [],\r\n    fecMechanisms: [],\r\n    rtcp: []\r\n  };\r\n  var lines = SDPUtils.splitLines(mediaSection);\r\n  var mline = lines[0].split(' ');\r\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\r\n    var pt = mline[i];\r\n    var rtpmapline = SDPUtils.matchPrefix(\r\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\r\n    if (rtpmapline) {\r\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\r\n      var fmtps = SDPUtils.matchPrefix(\r\n          mediaSection, 'a=fmtp:' + pt + ' ');\r\n      // Only the first a=fmtp:<pt> is considered.\r\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\r\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\r\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\r\n        .map(SDPUtils.parseRtcpFb);\r\n      description.codecs.push(codec);\r\n      // parse FEC mechanisms from rtpmap lines.\r\n      switch (codec.name.toUpperCase()) {\r\n        case 'RED':\r\n        case 'ULPFEC':\r\n          description.fecMechanisms.push(codec.name.toUpperCase());\r\n          break;\r\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\r\n          break;\r\n      }\r\n    }\r\n  }\r\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\r\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\r\n  });\r\n  // FIXME: parse rtcp.\r\n  return description;\r\n};\r\n\r\n// Generates parts of the SDP media section describing the capabilities /\r\n// parameters.\r\nSDPUtils.writeRtpDescription = function(kind, caps) {\r\n  var sdp = '';\r\n\r\n  // Build the mline.\r\n  sdp += 'm=' + kind + ' ';\r\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\r\n  sdp += ' UDP/TLS/RTP/SAVPF ';\r\n  sdp += caps.codecs.map(function(codec) {\r\n    if (codec.preferredPayloadType !== undefined) {\r\n      return codec.preferredPayloadType;\r\n    }\r\n    return codec.payloadType;\r\n  }).join(' ') + '\\r\\n';\r\n\r\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\r\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\r\n\r\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\r\n  caps.codecs.forEach(function(codec) {\r\n    sdp += SDPUtils.writeRtpMap(codec);\r\n    sdp += SDPUtils.writeFmtp(codec);\r\n    sdp += SDPUtils.writeRtcpFb(codec);\r\n  });\r\n  var maxptime = 0;\r\n  caps.codecs.forEach(function(codec) {\r\n    if (codec.maxptime > maxptime) {\r\n      maxptime = codec.maxptime;\r\n    }\r\n  });\r\n  if (maxptime > 0) {\r\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\r\n  }\r\n  sdp += 'a=rtcp-mux\\r\\n';\r\n\r\n  caps.headerExtensions.forEach(function(extension) {\r\n    sdp += SDPUtils.writeExtmap(extension);\r\n  });\r\n  // FIXME: write fecMechanisms.\r\n  return sdp;\r\n};\r\n\r\n// Parses the SDP media section and returns an array of\r\n// RTCRtpEncodingParameters.\r\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\r\n  var encodingParameters = [];\r\n  var description = SDPUtils.parseRtpParameters(mediaSection);\r\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\r\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\r\n\r\n  // filter a=ssrc:... cname:, ignore PlanB-msid\r\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n  .map(function(line) {\r\n    return SDPUtils.parseSsrcMedia(line);\r\n  })\r\n  .filter(function(parts) {\r\n    return parts.attribute === 'cname';\r\n  });\r\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\r\n  var secondarySsrc;\r\n\r\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\r\n  .map(function(line) {\r\n    var parts = line.split(' ');\r\n    parts.shift();\r\n    return parts.map(function(part) {\r\n      return parseInt(part, 10);\r\n    });\r\n  });\r\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\r\n    secondarySsrc = flows[0][1];\r\n  }\r\n\r\n  description.codecs.forEach(function(codec) {\r\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\r\n      var encParam = {\r\n        ssrc: primarySsrc,\r\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\r\n        rtx: {\r\n          ssrc: secondarySsrc\r\n        }\r\n      };\r\n      encodingParameters.push(encParam);\r\n      if (hasRed) {\r\n        encParam = JSON.parse(JSON.stringify(encParam));\r\n        encParam.fec = {\r\n          ssrc: secondarySsrc,\r\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\r\n        };\r\n        encodingParameters.push(encParam);\r\n      }\r\n    }\r\n  });\r\n  if (encodingParameters.length === 0 && primarySsrc) {\r\n    encodingParameters.push({\r\n      ssrc: primarySsrc\r\n    });\r\n  }\r\n\r\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\r\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\r\n  if (bandwidth.length) {\r\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\r\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\r\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\r\n      // use formula from JSEP to convert b=AS to TIAS value.\r\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\r\n          - (50 * 40 * 8);\r\n    } else {\r\n      bandwidth = undefined;\r\n    }\r\n    encodingParameters.forEach(function(params) {\r\n      params.maxBitrate = bandwidth;\r\n    });\r\n  }\r\n  return encodingParameters;\r\n};\r\n\r\n// parses http://draft.ortc.org/#rtcrtcpparameters*\r\nSDPUtils.parseRtcpParameters = function(mediaSection) {\r\n  var rtcpParameters = {};\r\n\r\n  var cname;\r\n  // Gets the first SSRC. Note that with RTX there might be multiple\r\n  // SSRCs.\r\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n      .map(function(line) {\r\n        return SDPUtils.parseSsrcMedia(line);\r\n      })\r\n      .filter(function(obj) {\r\n        return obj.attribute === 'cname';\r\n      })[0];\r\n  if (remoteSsrc) {\r\n    rtcpParameters.cname = remoteSsrc.value;\r\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\r\n  }\r\n\r\n  // Edge uses the compound attribute instead of reducedSize\r\n  // compound is !reducedSize\r\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\r\n  rtcpParameters.reducedSize = rsize.length > 0;\r\n  rtcpParameters.compound = rsize.length === 0;\r\n\r\n  // parses the rtcp-mux attrbute.\r\n  // Note that Edge does not support unmuxed RTCP.\r\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\r\n  rtcpParameters.mux = mux.length > 0;\r\n\r\n  return rtcpParameters;\r\n};\r\n\r\n// parses either a=msid: or a=ssrc:... msid lines and returns\r\n// the id of the MediaStream and MediaStreamTrack.\r\nSDPUtils.parseMsid = function(mediaSection) {\r\n  var parts;\r\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\r\n  if (spec.length === 1) {\r\n    parts = spec[0].substr(7).split(' ');\r\n    return {stream: parts[0], track: parts[1]};\r\n  }\r\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\r\n  .map(function(line) {\r\n    return SDPUtils.parseSsrcMedia(line);\r\n  })\r\n  .filter(function(parts) {\r\n    return parts.attribute === 'msid';\r\n  });\r\n  if (planB.length > 0) {\r\n    parts = planB[0].value.split(' ');\r\n    return {stream: parts[0], track: parts[1]};\r\n  }\r\n};\r\n\r\n// Generate a session ID for SDP.\r\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\r\n// recommends using a cryptographically random +ve 64-bit value\r\n// but right now this should be acceptable and within the right range\r\nSDPUtils.generateSessionId = function() {\r\n  return Math.random().toString().substr(2, 21);\r\n};\r\n\r\n// Write boilder plate for start of SDP\r\n// sessId argument is optional - if not supplied it will\r\n// be generated randomly\r\nSDPUtils.writeSessionBoilerplate = function(sessId) {\r\n  var sessionId;\r\n  if (sessId) {\r\n    sessionId = sessId;\r\n  } else {\r\n    sessionId = SDPUtils.generateSessionId();\r\n  }\r\n  // FIXME: sess-id should be an NTP timestamp.\r\n  return 'v=0\\r\\n' +\r\n      'o=thisisadapterortc ' + sessionId + ' 2 IN IP4 127.0.0.1\\r\\n' +\r\n      's=-\\r\\n' +\r\n      't=0 0\\r\\n';\r\n};\r\n\r\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\r\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\r\n\r\n  // Map ICE parameters (ufrag, pwd) to SDP.\r\n  sdp += SDPUtils.writeIceParameters(\r\n      transceiver.iceGatherer.getLocalParameters());\r\n\r\n  // Map DTLS parameters to SDP.\r\n  sdp += SDPUtils.writeDtlsParameters(\r\n      transceiver.dtlsTransport.getLocalParameters(),\r\n      type === 'offer' ? 'actpass' : 'active');\r\n\r\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\r\n\r\n  if (transceiver.direction) {\r\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\r\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\r\n    sdp += 'a=sendrecv\\r\\n';\r\n  } else if (transceiver.rtpSender) {\r\n    sdp += 'a=sendonly\\r\\n';\r\n  } else if (transceiver.rtpReceiver) {\r\n    sdp += 'a=recvonly\\r\\n';\r\n  } else {\r\n    sdp += 'a=inactive\\r\\n';\r\n  }\r\n\r\n  if (transceiver.rtpSender) {\r\n    // spec.\r\n    var msid = 'msid:' + stream.id + ' ' +\r\n        transceiver.rtpSender.track.id + '\\r\\n';\r\n    sdp += 'a=' + msid;\r\n\r\n    // for Chrome.\r\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n        ' ' + msid;\r\n    if (transceiver.sendEncodingParameters[0].rtx) {\r\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n          ' ' + msid;\r\n      sdp += 'a=ssrc-group:FID ' +\r\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\r\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n          '\\r\\n';\r\n    }\r\n  }\r\n  // FIXME: this should be written by writeRtpDescription.\r\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\r\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\r\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\r\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\r\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\r\n  }\r\n  return sdp;\r\n};\r\n\r\n// Gets the direction from the mediaSection or the sessionpart.\r\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\r\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\r\n  var lines = SDPUtils.splitLines(mediaSection);\r\n  for (var i = 0; i < lines.length; i++) {\r\n    switch (lines[i]) {\r\n      case 'a=sendrecv':\r\n      case 'a=sendonly':\r\n      case 'a=recvonly':\r\n      case 'a=inactive':\r\n        return lines[i].substr(2);\r\n      default:\r\n        // FIXME: What should happen here?\r\n    }\r\n  }\r\n  if (sessionpart) {\r\n    return SDPUtils.getDirection(sessionpart);\r\n  }\r\n  return 'sendrecv';\r\n};\r\n\r\nSDPUtils.getKind = function(mediaSection) {\r\n  var lines = SDPUtils.splitLines(mediaSection);\r\n  var mline = lines[0].split(' ');\r\n  return mline[0].substr(2);\r\n};\r\n\r\nSDPUtils.isRejected = function(mediaSection) {\r\n  return mediaSection.split(' ', 2)[1] === '0';\r\n};\r\n\r\n// Expose public methods.\r\nmodule.exports = SDPUtils;\r\n\r\n},{}],2:[function(require,module,exports){\r\n(function (global){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n\r\n'use strict';\r\n\r\nvar adapterFactory = require('./adapter_factory.js');\r\nmodule.exports = adapterFactory({window: global.window});\r\n\r\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\r\n},{\"./adapter_factory.js\":3}],3:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n\r\n'use strict';\r\n\r\n// Shimming starts here.\r\nmodule.exports = function(dependencies) {\r\n  var window = dependencies && dependencies.window;\r\n\r\n  // Utils.\r\n  var utils = require('./utils');\r\n  var logging = utils.log;\r\n  var browserDetails = utils.detectBrowser(window);\r\n\r\n  // Export to the adapter global object visible in the browser.\r\n  var adapter = {\r\n    browserDetails: browserDetails,\r\n    extractVersion: utils.extractVersion,\r\n    disableLog: utils.disableLog,\r\n    disableWarnings: utils.disableWarnings\r\n  };\r\n\r\n  // Uncomment the line below if you want logging to occur, including logging\r\n  // for the switch statement below. Can also be turned on in the browser via\r\n  // adapter.disableLog(false), but then logging from the switch statement below\r\n  // will not appear.\r\n  // require('./utils').disableLog(false);\r\n\r\n  // Browser shims.\r\n  var chromeShim = require('./chrome/chrome_shim') || null;\r\n  var edgeShim = require('./edge/edge_shim') || null;\r\n  var firefoxShim = require('./firefox/firefox_shim') || null;\r\n  var safariShim = require('./safari/safari_shim') || null;\r\n\r\n  // Shim browser if found.\r\n  switch (browserDetails.browser) {\r\n    case 'chrome':\r\n      if (!chromeShim || !chromeShim.shimPeerConnection) {\r\n        logging('Chrome shim is not included in this adapter release.');\r\n        return adapter;\r\n      }\r\n      logging('adapter.js shimming chrome.');\r\n      // Export to the adapter global object visible in the browser.\r\n      adapter.browserShim = chromeShim;\r\n\r\n      chromeShim.shimGetUserMedia(window);\r\n      chromeShim.shimMediaStream(window);\r\n      utils.shimCreateObjectURL(window);\r\n      chromeShim.shimSourceObject(window);\r\n      chromeShim.shimPeerConnection(window);\r\n      chromeShim.shimOnTrack(window);\r\n      chromeShim.shimGetSendersWithDtmf(window);\r\n      break;\r\n    case 'firefox':\r\n      if (!firefoxShim || !firefoxShim.shimPeerConnection) {\r\n        logging('Firefox shim is not included in this adapter release.');\r\n        return adapter;\r\n      }\r\n      logging('adapter.js shimming firefox.');\r\n      // Export to the adapter global object visible in the browser.\r\n      adapter.browserShim = firefoxShim;\r\n\r\n      firefoxShim.shimGetUserMedia(window);\r\n      utils.shimCreateObjectURL(window);\r\n      firefoxShim.shimSourceObject(window);\r\n      firefoxShim.shimPeerConnection(window);\r\n      firefoxShim.shimOnTrack(window);\r\n      break;\r\n    case 'edge':\r\n      if (!edgeShim || !edgeShim.shimPeerConnection) {\r\n        logging('MS edge shim is not included in this adapter release.');\r\n        return adapter;\r\n      }\r\n      logging('adapter.js shimming edge.');\r\n      // Export to the adapter global object visible in the browser.\r\n      adapter.browserShim = edgeShim;\r\n\r\n      edgeShim.shimGetUserMedia(window);\r\n      utils.shimCreateObjectURL(window);\r\n      edgeShim.shimPeerConnection(window);\r\n      edgeShim.shimReplaceTrack(window);\r\n      break;\r\n    case 'safari':\r\n      if (!safariShim) {\r\n        logging('Safari shim is not included in this adapter release.');\r\n        return adapter;\r\n      }\r\n      logging('adapter.js shimming safari.');\r\n      // Export to the adapter global object visible in the browser.\r\n      adapter.browserShim = safariShim;\r\n      // shim window.URL.createObjectURL Safari (technical preview)\r\n      utils.shimCreateObjectURL(window);\r\n      safariShim.shimRTCIceServerUrls(window);\r\n      safariShim.shimCallbacksAPI(window);\r\n      safariShim.shimLocalStreamsAPI(window);\r\n      safariShim.shimRemoteStreamsAPI(window);\r\n      safariShim.shimGetUserMedia(window);\r\n      break;\r\n    default:\r\n      logging('Unsupported browser!');\r\n      break;\r\n  }\r\n\r\n  return adapter;\r\n};\r\n\r\n},{\"./chrome/chrome_shim\":4,\"./edge/edge_shim\":6,\"./firefox/firefox_shim\":9,\"./safari/safari_shim\":11,\"./utils\":12}],4:[function(require,module,exports){\r\n\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\nvar utils = require('../utils.js');\r\nvar logging = utils.log;\r\n\r\nvar chromeShim = {\r\n  shimMediaStream: function(window) {\r\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\r\n  },\r\n\r\n  shimOnTrack: function(window) {\r\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\r\n        window.RTCPeerConnection.prototype)) {\r\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\r\n        get: function() {\r\n          return this._ontrack;\r\n        },\r\n        set: function(f) {\r\n          var self = this;\r\n          if (this._ontrack) {\r\n            this.removeEventListener('track', this._ontrack);\r\n            this.removeEventListener('addstream', this._ontrackpoly);\r\n          }\r\n          this.addEventListener('track', this._ontrack = f);\r\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\r\n            // onaddstream does not fire when a track is added to an existing\r\n            // stream. But stream.onaddtrack is implemented so we use that.\r\n            e.stream.addEventListener('addtrack', function(te) {\r\n              var receiver;\r\n              if (window.RTCPeerConnection.prototype.getReceivers) {\r\n                receiver = self.getReceivers().find(function(r) {\r\n                  return r.track.id === te.track.id;\r\n                });\r\n              } else {\r\n                receiver = {track: te.track};\r\n              }\r\n\r\n              var event = new Event('track');\r\n              event.track = te.track;\r\n              event.receiver = receiver;\r\n              event.streams = [e.stream];\r\n              self.dispatchEvent(event);\r\n            });\r\n            e.stream.getTracks().forEach(function(track) {\r\n              var receiver;\r\n              if (window.RTCPeerConnection.prototype.getReceivers) {\r\n                receiver = self.getReceivers().find(function(r) {\r\n                  return r.track.id === track.id;\r\n                });\r\n              } else {\r\n                receiver = {track: track};\r\n              }\r\n              var event = new Event('track');\r\n              event.track = track;\r\n              event.receiver = receiver;\r\n              event.streams = [e.stream];\r\n              this.dispatchEvent(event);\r\n            }.bind(this));\r\n          }.bind(this));\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  shimGetSendersWithDtmf: function(window) {\r\n    if (typeof window === 'object' && window.RTCPeerConnection &&\r\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\r\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\r\n      window.RTCPeerConnection.prototype.getSenders = function() {\r\n        return this._senders || [];\r\n      };\r\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\r\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\r\n\r\n      if (!window.RTCPeerConnection.prototype.addTrack) {\r\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\r\n          var pc = this;\r\n          if (pc.signalingState === 'closed') {\r\n            throw new DOMException(\r\n              'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\r\n              'InvalidStateError');\r\n          }\r\n          var streams = [].slice.call(arguments, 1);\r\n          if (streams.length !== 1 ||\r\n              !streams[0].getTracks().find(function(t) {\r\n                return t === track;\r\n              })) {\r\n            // this is not fully correct but all we can manage without\r\n            // [[associated MediaStreams]] internal slot.\r\n            throw new DOMException(\r\n              'The adapter.js addTrack polyfill only supports a single ' +\r\n              ' stream which is associated with the specified track.',\r\n              'NotSupportedError');\r\n          }\r\n\r\n          pc._senders = pc._senders || [];\r\n          var alreadyExists = pc._senders.find(function(t) {\r\n            return t.track === track;\r\n          });\r\n          if (alreadyExists) {\r\n            throw new DOMException('Track already exists.',\r\n                'InvalidAccessError');\r\n          }\r\n\r\n          pc._streams = pc._streams || {};\r\n          var oldStream = pc._streams[stream.id];\r\n          if (oldStream) {\r\n            oldStream.addTrack(track);\r\n            pc.removeStream(oldStream);\r\n            pc.addStream(oldStream);\r\n          } else {\r\n            var newStream = new window.MediaStream([track]);\r\n            pc._streams[stream.id] = newStream;\r\n            pc.addStream(newStream);\r\n          }\r\n\r\n          var sender = {\r\n            track: track,\r\n            get dtmf() {\r\n              if (this._dtmf === undefined) {\r\n                if (track.kind === 'audio') {\r\n                  this._dtmf = pc.createDTMFSender(track);\r\n                } else {\r\n                  this._dtmf = null;\r\n                }\r\n              }\r\n              return this._dtmf;\r\n            }\r\n          };\r\n          pc._senders.push(sender);\r\n          return sender;\r\n        };\r\n      }\r\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\r\n        var pc = this;\r\n        pc._senders = pc._senders || [];\r\n        origAddStream.apply(pc, [stream]);\r\n        stream.getTracks().forEach(function(track) {\r\n          pc._senders.push({\r\n            track: track,\r\n            get dtmf() {\r\n              if (this._dtmf === undefined) {\r\n                if (track.kind === 'audio') {\r\n                  this._dtmf = pc.createDTMFSender(track);\r\n                } else {\r\n                  this._dtmf = null;\r\n                }\r\n              }\r\n              return this._dtmf;\r\n            }\r\n          });\r\n        });\r\n      };\r\n\r\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\r\n        var pc = this;\r\n        pc._senders = pc._senders || [];\r\n        origRemoveStream.apply(pc, [stream]);\r\n        stream.getTracks().forEach(function(track) {\r\n          var sender = pc._senders.find(function(s) {\r\n            return s.track === track;\r\n          });\r\n          if (sender) {\r\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\r\n          }\r\n        });\r\n      };\r\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\r\n               'getSenders' in window.RTCPeerConnection.prototype &&\r\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\r\n               window.RTCRtpSender &&\r\n               !('dtmf' in window.RTCRtpSender.prototype)) {\r\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\r\n      window.RTCPeerConnection.prototype.getSenders = function() {\r\n        var pc = this;\r\n        var senders = origGetSenders.apply(pc, []);\r\n        senders.forEach(function(sender) {\r\n          sender._pc = pc;\r\n        });\r\n        return senders;\r\n      };\r\n\r\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\r\n        get: function() {\r\n          if (this._dtmf === undefined) {\r\n            if (this.track.kind === 'audio') {\r\n              this._dtmf = this._pc.createDTMFSender(this.track);\r\n            } else {\r\n              this._dtmf = null;\r\n            }\r\n          }\r\n          return this._dtmf;\r\n        },\r\n      });\r\n    }\r\n  },\r\n\r\n  shimSourceObject: function(window) {\r\n    var URL = window && window.URL;\r\n\r\n    if (typeof window === 'object') {\r\n      if (window.HTMLMediaElement &&\r\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\r\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\r\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\r\n          get: function() {\r\n            return this._srcObject;\r\n          },\r\n          set: function(stream) {\r\n            var self = this;\r\n            // Use _srcObject as a private property for this shim\r\n            this._srcObject = stream;\r\n            if (this.src) {\r\n              URL.revokeObjectURL(this.src);\r\n            }\r\n\r\n            if (!stream) {\r\n              this.src = '';\r\n              return undefined;\r\n            }\r\n            this.src = URL.createObjectURL(stream);\r\n            // We need to recreate the blob url when a track is added or\r\n            // removed. Doing it manually since we want to avoid a recursion.\r\n            stream.addEventListener('addtrack', function() {\r\n              if (self.src) {\r\n                URL.revokeObjectURL(self.src);\r\n              }\r\n              self.src = URL.createObjectURL(stream);\r\n            });\r\n            stream.addEventListener('removetrack', function() {\r\n              if (self.src) {\r\n                URL.revokeObjectURL(self.src);\r\n              }\r\n              self.src = URL.createObjectURL(stream);\r\n            });\r\n          }\r\n        });\r\n      }\r\n    }\r\n  },\r\n\r\n  shimPeerConnection: function(window) {\r\n    var browserDetails = utils.detectBrowser(window);\r\n\r\n    // The RTCPeerConnection object.\r\n    if (!window.RTCPeerConnection) {\r\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\r\n        // Translate iceTransportPolicy to iceTransports,\r\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\r\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\r\n        logging('PeerConnection');\r\n        if (pcConfig && pcConfig.iceTransportPolicy) {\r\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\r\n        }\r\n\r\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\r\n      };\r\n      window.RTCPeerConnection.prototype =\r\n          window.webkitRTCPeerConnection.prototype;\r\n      // wrap static methods. Currently just generateCertificate.\r\n      if (window.webkitRTCPeerConnection.generateCertificate) {\r\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\r\n          get: function() {\r\n            return window.webkitRTCPeerConnection.generateCertificate;\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\r\n      var OrigPeerConnection = window.RTCPeerConnection;\r\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\r\n        if (pcConfig && pcConfig.iceServers) {\r\n          var newIceServers = [];\r\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\r\n            var server = pcConfig.iceServers[i];\r\n            if (!server.hasOwnProperty('urls') &&\r\n                server.hasOwnProperty('url')) {\r\n              console.warn('RTCIceServer.url is deprecated! Use urls instead.');\r\n              server = JSON.parse(JSON.stringify(server));\r\n              server.urls = server.url;\r\n              newIceServers.push(server);\r\n            } else {\r\n              newIceServers.push(pcConfig.iceServers[i]);\r\n            }\r\n          }\r\n          pcConfig.iceServers = newIceServers;\r\n        }\r\n        return new OrigPeerConnection(pcConfig, pcConstraints);\r\n      };\r\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\r\n      // wrap static methods. Currently just generateCertificate.\r\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\r\n        get: function() {\r\n          return OrigPeerConnection.generateCertificate;\r\n        }\r\n      });\r\n    }\r\n\r\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\r\n    window.RTCPeerConnection.prototype.getStats = function(selector,\r\n        successCallback, errorCallback) {\r\n      var self = this;\r\n      var args = arguments;\r\n\r\n      // If selector is a function then we are in the old style stats so just\r\n      // pass back the original getStats format to avoid breaking old users.\r\n      if (arguments.length > 0 && typeof selector === 'function') {\r\n        return origGetStats.apply(this, arguments);\r\n      }\r\n\r\n      // When spec-style getStats is supported, return those when called with\r\n      // either no arguments or the selector argument is null.\r\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\r\n          typeof arguments[0] !== 'function')) {\r\n        return origGetStats.apply(this, []);\r\n      }\r\n\r\n      var fixChromeStats_ = function(response) {\r\n        var standardReport = {};\r\n        var reports = response.result();\r\n        reports.forEach(function(report) {\r\n          var standardStats = {\r\n            id: report.id,\r\n            timestamp: report.timestamp,\r\n            type: {\r\n              localcandidate: 'local-candidate',\r\n              remotecandidate: 'remote-candidate'\r\n            }[report.type] || report.type\r\n          };\r\n          report.names().forEach(function(name) {\r\n            standardStats[name] = report.stat(name);\r\n          });\r\n          standardReport[standardStats.id] = standardStats;\r\n        });\r\n\r\n        return standardReport;\r\n      };\r\n\r\n      // shim getStats with maplike support\r\n      var makeMapStats = function(stats) {\r\n        return new Map(Object.keys(stats).map(function(key) {\r\n          return [key, stats[key]];\r\n        }));\r\n      };\r\n\r\n      if (arguments.length >= 2) {\r\n        var successCallbackWrapper_ = function(response) {\r\n          args[1](makeMapStats(fixChromeStats_(response)));\r\n        };\r\n\r\n        return origGetStats.apply(this, [successCallbackWrapper_,\r\n          arguments[0]]);\r\n      }\r\n\r\n      // promise-support\r\n      return new Promise(function(resolve, reject) {\r\n        origGetStats.apply(self, [\r\n          function(response) {\r\n            resolve(makeMapStats(fixChromeStats_(response)));\r\n          }, reject]);\r\n      }).then(successCallback, errorCallback);\r\n    };\r\n\r\n    // add promise support -- natively available in Chrome 51\r\n    if (browserDetails.version < 51) {\r\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\r\n          .forEach(function(method) {\r\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\r\n            window.RTCPeerConnection.prototype[method] = function() {\r\n              var args = arguments;\r\n              var self = this;\r\n              var promise = new Promise(function(resolve, reject) {\r\n                nativeMethod.apply(self, [args[0], resolve, reject]);\r\n              });\r\n              if (args.length < 2) {\r\n                return promise;\r\n              }\r\n              return promise.then(function() {\r\n                args[1].apply(null, []);\r\n              },\r\n              function(err) {\r\n                if (args.length >= 3) {\r\n                  args[2].apply(null, [err]);\r\n                }\r\n              });\r\n            };\r\n          });\r\n    }\r\n\r\n    // promise support for createOffer and createAnswer. Available (without\r\n    // bugs) since M52: crbug/619289\r\n    if (browserDetails.version < 52) {\r\n      ['createOffer', 'createAnswer'].forEach(function(method) {\r\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\r\n        window.RTCPeerConnection.prototype[method] = function() {\r\n          var self = this;\r\n          if (arguments.length < 1 || (arguments.length === 1 &&\r\n              typeof arguments[0] === 'object')) {\r\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\r\n            return new Promise(function(resolve, reject) {\r\n              nativeMethod.apply(self, [resolve, reject, opts]);\r\n            });\r\n          }\r\n          return nativeMethod.apply(this, arguments);\r\n        };\r\n      });\r\n    }\r\n\r\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\r\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\r\n        .forEach(function(method) {\r\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\r\n          window.RTCPeerConnection.prototype[method] = function() {\r\n            arguments[0] = new ((method === 'addIceCandidate') ?\r\n                window.RTCIceCandidate :\r\n                window.RTCSessionDescription)(arguments[0]);\r\n            return nativeMethod.apply(this, arguments);\r\n          };\r\n        });\r\n\r\n    // support for addIceCandidate(null or undefined)\r\n    var nativeAddIceCandidate =\r\n        window.RTCPeerConnection.prototype.addIceCandidate;\r\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\r\n      if (!arguments[0]) {\r\n        if (arguments[1]) {\r\n          arguments[1].apply(null);\r\n        }\r\n        return Promise.resolve();\r\n      }\r\n      return nativeAddIceCandidate.apply(this, arguments);\r\n    };\r\n  }\r\n};\r\n\r\n\r\n// Expose public methods.\r\nmodule.exports = {\r\n  shimMediaStream: chromeShim.shimMediaStream,\r\n  shimOnTrack: chromeShim.shimOnTrack,\r\n  shimGetSendersWithDtmf: chromeShim.shimGetSendersWithDtmf,\r\n  shimSourceObject: chromeShim.shimSourceObject,\r\n  shimPeerConnection: chromeShim.shimPeerConnection,\r\n  shimGetUserMedia: require('./getusermedia')\r\n};\r\n\r\n},{\"../utils.js\":12,\"./getusermedia\":5}],5:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\nvar utils = require('../utils.js');\r\nvar logging = utils.log;\r\n\r\n// Expose public methods.\r\nmodule.exports = function(window) {\r\n  var browserDetails = utils.detectBrowser(window);\r\n  var navigator = window && window.navigator;\r\n\r\n  var constraintsToChrome_ = function(c) {\r\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\r\n      return c;\r\n    }\r\n    var cc = {};\r\n    Object.keys(c).forEach(function(key) {\r\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\r\n        return;\r\n      }\r\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\r\n      if (r.exact !== undefined && typeof r.exact === 'number') {\r\n        r.min = r.max = r.exact;\r\n      }\r\n      var oldname_ = function(prefix, name) {\r\n        if (prefix) {\r\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\r\n        }\r\n        return (name === 'deviceId') ? 'sourceId' : name;\r\n      };\r\n      if (r.ideal !== undefined) {\r\n        cc.optional = cc.optional || [];\r\n        var oc = {};\r\n        if (typeof r.ideal === 'number') {\r\n          oc[oldname_('min', key)] = r.ideal;\r\n          cc.optional.push(oc);\r\n          oc = {};\r\n          oc[oldname_('max', key)] = r.ideal;\r\n          cc.optional.push(oc);\r\n        } else {\r\n          oc[oldname_('', key)] = r.ideal;\r\n          cc.optional.push(oc);\r\n        }\r\n      }\r\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\r\n        cc.mandatory = cc.mandatory || {};\r\n        cc.mandatory[oldname_('', key)] = r.exact;\r\n      } else {\r\n        ['min', 'max'].forEach(function(mix) {\r\n          if (r[mix] !== undefined) {\r\n            cc.mandatory = cc.mandatory || {};\r\n            cc.mandatory[oldname_(mix, key)] = r[mix];\r\n          }\r\n        });\r\n      }\r\n    });\r\n    if (c.advanced) {\r\n      cc.optional = (cc.optional || []).concat(c.advanced);\r\n    }\r\n    return cc;\r\n  };\r\n\r\n  var shimConstraints_ = function(constraints, func) {\r\n    constraints = JSON.parse(JSON.stringify(constraints));\r\n    if (constraints && typeof constraints.audio === 'object') {\r\n      var remap = function(obj, a, b) {\r\n        if (a in obj && !(b in obj)) {\r\n          obj[b] = obj[a];\r\n          delete obj[a];\r\n        }\r\n      };\r\n      constraints = JSON.parse(JSON.stringify(constraints));\r\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\r\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\r\n      constraints.audio = constraintsToChrome_(constraints.audio);\r\n    }\r\n    if (constraints && typeof constraints.video === 'object') {\r\n      // Shim facingMode for mobile & surface pro.\r\n      var face = constraints.video.facingMode;\r\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\r\n      var getSupportedFacingModeLies = browserDetails.version < 61;\r\n\r\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\r\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\r\n          !(navigator.mediaDevices.getSupportedConstraints &&\r\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\r\n            !getSupportedFacingModeLies)) {\r\n        delete constraints.video.facingMode;\r\n        var matches;\r\n        if (face.exact === 'environment' || face.ideal === 'environment') {\r\n          matches = ['back', 'rear'];\r\n        } else if (face.exact === 'user' || face.ideal === 'user') {\r\n          matches = ['front'];\r\n        }\r\n        if (matches) {\r\n          // Look for matches in label, or use last cam for back (typical).\r\n          return navigator.mediaDevices.enumerateDevices()\r\n          .then(function(devices) {\r\n            devices = devices.filter(function(d) {\r\n              return d.kind === 'videoinput';\r\n            });\r\n            var dev = devices.find(function(d) {\r\n              return matches.some(function(match) {\r\n                return d.label.toLowerCase().indexOf(match) !== -1;\r\n              });\r\n            });\r\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\r\n              dev = devices[devices.length - 1]; // more likely the back cam\r\n            }\r\n            if (dev) {\r\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\r\n                                                        {ideal: dev.deviceId};\r\n            }\r\n            constraints.video = constraintsToChrome_(constraints.video);\r\n            logging('chrome: ' + JSON.stringify(constraints));\r\n            return func(constraints);\r\n          });\r\n        }\r\n      }\r\n      constraints.video = constraintsToChrome_(constraints.video);\r\n    }\r\n    logging('chrome: ' + JSON.stringify(constraints));\r\n    return func(constraints);\r\n  };\r\n\r\n  var shimError_ = function(e) {\r\n    return {\r\n      name: {\r\n        PermissionDeniedError: 'NotAllowedError',\r\n        InvalidStateError: 'NotReadableError',\r\n        DevicesNotFoundError: 'NotFoundError',\r\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\r\n        TrackStartError: 'NotReadableError',\r\n        MediaDeviceFailedDueToShutdown: 'NotReadableError',\r\n        MediaDeviceKillSwitchOn: 'NotReadableError'\r\n      }[e.name] || e.name,\r\n      message: e.message,\r\n      constraint: e.constraintName,\r\n      toString: function() {\r\n        return this.name + (this.message && ': ') + this.message;\r\n      }\r\n    };\r\n  };\r\n\r\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\r\n    shimConstraints_(constraints, function(c) {\r\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\r\n        onError(shimError_(e));\r\n      });\r\n    });\r\n  };\r\n\r\n  navigator.getUserMedia = getUserMedia_;\r\n\r\n  // Returns the result of getUserMedia as a Promise.\r\n  var getUserMediaPromise_ = function(constraints) {\r\n    return new Promise(function(resolve, reject) {\r\n      navigator.getUserMedia(constraints, resolve, reject);\r\n    });\r\n  };\r\n\r\n  if (!navigator.mediaDevices) {\r\n    navigator.mediaDevices = {\r\n      getUserMedia: getUserMediaPromise_,\r\n      enumerateDevices: function() {\r\n        return new Promise(function(resolve) {\r\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\r\n          return window.MediaStreamTrack.getSources(function(devices) {\r\n            resolve(devices.map(function(device) {\r\n              return {label: device.label,\r\n                kind: kinds[device.kind],\r\n                deviceId: device.id,\r\n                groupId: ''};\r\n            }));\r\n          });\r\n        });\r\n      },\r\n      getSupportedConstraints: function() {\r\n        return {\r\n          deviceId: true, echoCancellation: true, facingMode: true,\r\n          frameRate: true, height: true, width: true\r\n        };\r\n      }\r\n    };\r\n  }\r\n\r\n  // A shim for getUserMedia method on the mediaDevices object.\r\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\r\n  if (!navigator.mediaDevices.getUserMedia) {\r\n    navigator.mediaDevices.getUserMedia = function(constraints) {\r\n      return getUserMediaPromise_(constraints);\r\n    };\r\n  } else {\r\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\r\n    // function which returns a Promise, it does not accept spec-style\r\n    // constraints.\r\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\r\n        bind(navigator.mediaDevices);\r\n    navigator.mediaDevices.getUserMedia = function(cs) {\r\n      return shimConstraints_(cs, function(c) {\r\n        return origGetUserMedia(c).then(function(stream) {\r\n          if (c.audio && !stream.getAudioTracks().length ||\r\n              c.video && !stream.getVideoTracks().length) {\r\n            stream.getTracks().forEach(function(track) {\r\n              track.stop();\r\n            });\r\n            throw new DOMException('', 'NotFoundError');\r\n          }\r\n          return stream;\r\n        }, function(e) {\r\n          return Promise.reject(shimError_(e));\r\n        });\r\n      });\r\n    };\r\n  }\r\n\r\n  // Dummy devicechange event methods.\r\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\r\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\r\n    navigator.mediaDevices.addEventListener = function() {\r\n      logging('Dummy mediaDevices.addEventListener called.');\r\n    };\r\n  }\r\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\r\n    navigator.mediaDevices.removeEventListener = function() {\r\n      logging('Dummy mediaDevices.removeEventListener called.');\r\n    };\r\n  }\r\n};\r\n\r\n},{\"../utils.js\":12}],6:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\n\r\nvar utils = require('../utils');\r\nvar shimRTCPeerConnection = require('./rtcpeerconnection_shim');\r\n\r\nmodule.exports = {\r\n  shimGetUserMedia: require('./getusermedia'),\r\n  shimPeerConnection: function(window) {\r\n    var browserDetails = utils.detectBrowser(window);\r\n\r\n    if (window.RTCIceGatherer) {\r\n      // ORTC defines an RTCIceCandidate object but no constructor.\r\n      // Not implemented in Edge.\r\n      if (!window.RTCIceCandidate) {\r\n        window.RTCIceCandidate = function(args) {\r\n          return args;\r\n        };\r\n      }\r\n      // ORTC does not have a session description object but\r\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\r\n      // in the future might have this defined already.\r\n      if (!window.RTCSessionDescription) {\r\n        window.RTCSessionDescription = function(args) {\r\n          return args;\r\n        };\r\n      }\r\n      // this adds an additional event listener to MediaStrackTrack that signals\r\n      // when a tracks enabled property was changed. Workaround for a bug in\r\n      // addStream, see below. No longer required in 15025+\r\n      if (browserDetails.version < 15025) {\r\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\r\n            window.MediaStreamTrack.prototype, 'enabled');\r\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\r\n          set: function(value) {\r\n            origMSTEnabled.set.call(this, value);\r\n            var ev = new Event('enabled');\r\n            ev.enabled = value;\r\n            this.dispatchEvent(ev);\r\n          }\r\n        });\r\n      }\r\n    }\r\n    window.RTCPeerConnection =\r\n        shimRTCPeerConnection(window, browserDetails.version);\r\n  },\r\n  shimReplaceTrack: function(window) {\r\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\r\n    if (window.RTCRtpSender &&\r\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\r\n      window.RTCRtpSender.prototype.replaceTrack =\r\n          window.RTCRtpSender.prototype.setTrack;\r\n    }\r\n  }\r\n};\r\n\r\n},{\"../utils\":12,\"./getusermedia\":7,\"./rtcpeerconnection_shim\":8}],7:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\n\r\n// Expose public methods.\r\nmodule.exports = function(window) {\r\n  var navigator = window && window.navigator;\r\n\r\n  var shimError_ = function(e) {\r\n    return {\r\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\r\n      message: e.message,\r\n      constraint: e.constraint,\r\n      toString: function() {\r\n        return this.name;\r\n      }\r\n    };\r\n  };\r\n\r\n  // getUserMedia error shim.\r\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\r\n      bind(navigator.mediaDevices);\r\n  navigator.mediaDevices.getUserMedia = function(c) {\r\n    return origGetUserMedia(c).catch(function(e) {\r\n      return Promise.reject(shimError_(e));\r\n    });\r\n  };\r\n};\r\n\r\n},{}],8:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\n\r\nvar SDPUtils = require('sdp');\r\n\r\n// sort tracks such that they follow an a-v-a-v...\r\n// pattern.\r\nfunction sortTracks(tracks) {\r\n  var audioTracks = tracks.filter(function(track) {\r\n    return track.kind === 'audio';\r\n  });\r\n  var videoTracks = tracks.filter(function(track) {\r\n    return track.kind === 'video';\r\n  });\r\n  tracks = [];\r\n  while (audioTracks.length || videoTracks.length) {\r\n    if (audioTracks.length) {\r\n      tracks.push(audioTracks.shift());\r\n    }\r\n    if (videoTracks.length) {\r\n      tracks.push(videoTracks.shift());\r\n    }\r\n  }\r\n  return tracks;\r\n}\r\n\r\n// Edge does not like\r\n// 1) stun:\r\n// 2) turn: that does not have all of turn:host:port?transport=udp\r\n// 3) turn: with ipv6 addresses\r\n// 4) turn: occurring muliple times\r\nfunction filterIceServers(iceServers, edgeVersion) {\r\n  var hasTurn = false;\r\n  iceServers = JSON.parse(JSON.stringify(iceServers));\r\n  return iceServers.filter(function(server) {\r\n    if (server && (server.urls || server.url)) {\r\n      var urls = server.urls || server.url;\r\n      if (server.url && !server.urls) {\r\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\r\n      }\r\n      var isString = typeof urls === 'string';\r\n      if (isString) {\r\n        urls = [urls];\r\n      }\r\n      urls = urls.filter(function(url) {\r\n        var validTurn = url.indexOf('turn:') === 0 &&\r\n            url.indexOf('transport=udp') !== -1 &&\r\n            url.indexOf('turn:[') === -1 &&\r\n            !hasTurn;\r\n\r\n        if (validTurn) {\r\n          hasTurn = true;\r\n          return true;\r\n        }\r\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393;\r\n      });\r\n\r\n      delete server.url;\r\n      server.urls = isString ? urls[0] : urls;\r\n      return !!urls.length;\r\n    }\r\n    return false;\r\n  });\r\n}\r\n\r\n// Determines the intersection of local and remote capabilities.\r\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\r\n  var commonCapabilities = {\r\n    codecs: [],\r\n    headerExtensions: [],\r\n    fecMechanisms: []\r\n  };\r\n\r\n  var findCodecByPayloadType = function(pt, codecs) {\r\n    pt = parseInt(pt, 10);\r\n    for (var i = 0; i < codecs.length; i++) {\r\n      if (codecs[i].payloadType === pt ||\r\n          codecs[i].preferredPayloadType === pt) {\r\n        return codecs[i];\r\n      }\r\n    }\r\n  };\r\n\r\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\r\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\r\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\r\n    return lCodec && rCodec &&\r\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\r\n  };\r\n\r\n  localCapabilities.codecs.forEach(function(lCodec) {\r\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\r\n      var rCodec = remoteCapabilities.codecs[i];\r\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\r\n          lCodec.clockRate === rCodec.clockRate) {\r\n        if (lCodec.name.toLowerCase() === 'rtx' &&\r\n            lCodec.parameters && rCodec.parameters.apt) {\r\n          // for RTX we need to find the local rtx that has a apt\r\n          // which points to the same local codec as the remote one.\r\n          if (!rtxCapabilityMatches(lCodec, rCodec,\r\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\r\n            continue;\r\n          }\r\n        }\r\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\r\n        // number of channels is the highest common number of channels\r\n        rCodec.numChannels = Math.min(lCodec.numChannels,\r\n            rCodec.numChannels);\r\n        // push rCodec so we reply with offerer payload type\r\n        commonCapabilities.codecs.push(rCodec);\r\n\r\n        // determine common feedback mechanisms\r\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\r\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\r\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\r\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\r\n              return true;\r\n            }\r\n          }\r\n          return false;\r\n        });\r\n        // FIXME: also need to determine .parameters\r\n        //  see https://github.com/openpeer/ortc/issues/569\r\n        break;\r\n      }\r\n    }\r\n  });\r\n\r\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\r\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\r\n         i++) {\r\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\r\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\r\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\r\n        break;\r\n      }\r\n    }\r\n  });\r\n\r\n  // FIXME: fecMechanisms\r\n  return commonCapabilities;\r\n}\r\n\r\n// is action=setLocalDescription with type allowed in signalingState\r\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\r\n  return {\r\n    offer: {\r\n      setLocalDescription: ['stable', 'have-local-offer'],\r\n      setRemoteDescription: ['stable', 'have-remote-offer']\r\n    },\r\n    answer: {\r\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\r\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\r\n    }\r\n  }[type][action].indexOf(signalingState) !== -1;\r\n}\r\n\r\nmodule.exports = function(window, edgeVersion) {\r\n  var RTCPeerConnection = function(config) {\r\n    var self = this;\r\n\r\n    var _eventTarget = document.createDocumentFragment();\r\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\r\n        .forEach(function(method) {\r\n          self[method] = _eventTarget[method].bind(_eventTarget);\r\n        });\r\n\r\n    this.needNegotiation = false;\r\n\r\n    this.onicecandidate = null;\r\n    this.onaddstream = null;\r\n    this.ontrack = null;\r\n    this.onremovestream = null;\r\n    this.onsignalingstatechange = null;\r\n    this.oniceconnectionstatechange = null;\r\n    this.onicegatheringstatechange = null;\r\n    this.onnegotiationneeded = null;\r\n    this.ondatachannel = null;\r\n    this.canTrickleIceCandidates = null;\r\n\r\n    this.localStreams = [];\r\n    this.remoteStreams = [];\r\n    this.getLocalStreams = function() {\r\n      return self.localStreams;\r\n    };\r\n    this.getRemoteStreams = function() {\r\n      return self.remoteStreams;\r\n    };\r\n\r\n    this.localDescription = new window.RTCSessionDescription({\r\n      type: '',\r\n      sdp: ''\r\n    });\r\n    this.remoteDescription = new window.RTCSessionDescription({\r\n      type: '',\r\n      sdp: ''\r\n    });\r\n    this.signalingState = 'stable';\r\n    this.iceConnectionState = 'new';\r\n    this.iceGatheringState = 'new';\r\n\r\n    this.iceOptions = {\r\n      gatherPolicy: 'all',\r\n      iceServers: []\r\n    };\r\n    if (config && config.iceTransportPolicy) {\r\n      switch (config.iceTransportPolicy) {\r\n        case 'all':\r\n        case 'relay':\r\n          this.iceOptions.gatherPolicy = config.iceTransportPolicy;\r\n          break;\r\n        default:\r\n          // don't set iceTransportPolicy.\r\n          break;\r\n      }\r\n    }\r\n    this.usingBundle = config && config.bundlePolicy === 'max-bundle';\r\n\r\n    if (config && config.iceServers) {\r\n      this.iceOptions.iceServers = filterIceServers(config.iceServers,\r\n          edgeVersion);\r\n    }\r\n    this._config = config || {};\r\n\r\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\r\n    // everything that is needed to describe a SDP m-line.\r\n    this.transceivers = [];\r\n\r\n    // since the iceGatherer is currently created in createOffer but we\r\n    // must not emit candidates until after setLocalDescription we buffer\r\n    // them in this array.\r\n    this._localIceCandidatesBuffer = [];\r\n\r\n    this._sdpSessionId = SDPUtils.generateSessionId();\r\n  };\r\n\r\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\r\n    var event = new Event('icegatheringstatechange');\r\n    this.dispatchEvent(event);\r\n    if (this.onicegatheringstatechange !== null) {\r\n      this.onicegatheringstatechange(event);\r\n    }\r\n  };\r\n\r\n  RTCPeerConnection.prototype._emitBufferedCandidates = function() {\r\n    var self = this;\r\n    var sections = SDPUtils.splitSections(self.localDescription.sdp);\r\n    // FIXME: need to apply ice candidates in a way which is async but\r\n    // in-order\r\n    this._localIceCandidatesBuffer.forEach(function(event) {\r\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\r\n      if (end) {\r\n        for (var j = 1; j < sections.length; j++) {\r\n          if (sections[j].indexOf('\\r\\na=end-of-candidates\\r\\n') === -1) {\r\n            sections[j] += 'a=end-of-candidates\\r\\n';\r\n          }\r\n        }\r\n      } else {\r\n        sections[event.candidate.sdpMLineIndex + 1] +=\r\n            'a=' + event.candidate.candidate + '\\r\\n';\r\n      }\r\n      self.localDescription.sdp = sections.join('');\r\n      self.dispatchEvent(event);\r\n      if (self.onicecandidate !== null) {\r\n        self.onicecandidate(event);\r\n      }\r\n      if (!event.candidate && self.iceGatheringState !== 'complete') {\r\n        var complete = self.transceivers.every(function(transceiver) {\r\n          return transceiver.iceGatherer &&\r\n              transceiver.iceGatherer.state === 'completed';\r\n        });\r\n        if (complete && self.iceGatheringStateChange !== 'complete') {\r\n          self.iceGatheringState = 'complete';\r\n          self._emitGatheringStateChange();\r\n        }\r\n      }\r\n    });\r\n    this._localIceCandidatesBuffer = [];\r\n  };\r\n\r\n  RTCPeerConnection.prototype.getConfiguration = function() {\r\n    return this._config;\r\n  };\r\n\r\n  // internal helper to create a transceiver object.\r\n  // (whih is not yet the same as the WebRTC 1.0 transceiver)\r\n  RTCPeerConnection.prototype._createTransceiver = function(kind) {\r\n    var hasBundleTransport = this.transceivers.length > 0;\r\n    var transceiver = {\r\n      track: null,\r\n      iceGatherer: null,\r\n      iceTransport: null,\r\n      dtlsTransport: null,\r\n      localCapabilities: null,\r\n      remoteCapabilities: null,\r\n      rtpSender: null,\r\n      rtpReceiver: null,\r\n      kind: kind,\r\n      mid: null,\r\n      sendEncodingParameters: null,\r\n      recvEncodingParameters: null,\r\n      stream: null,\r\n      wantReceive: true\r\n    };\r\n    if (this.usingBundle && hasBundleTransport) {\r\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\r\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\r\n    } else {\r\n      var transports = this._createIceAndDtlsTransports();\r\n      transceiver.iceTransport = transports.iceTransport;\r\n      transceiver.dtlsTransport = transports.dtlsTransport;\r\n    }\r\n    this.transceivers.push(transceiver);\r\n    return transceiver;\r\n  };\r\n\r\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\r\n    var transceiver;\r\n    for (var i = 0; i < this.transceivers.length; i++) {\r\n      if (!this.transceivers[i].track &&\r\n          this.transceivers[i].kind === track.kind) {\r\n        transceiver = this.transceivers[i];\r\n      }\r\n    }\r\n    if (!transceiver) {\r\n      transceiver = this._createTransceiver(track.kind);\r\n    }\r\n\r\n    transceiver.track = track;\r\n    transceiver.stream = stream;\r\n    transceiver.rtpSender = new window.RTCRtpSender(track,\r\n        transceiver.dtlsTransport);\r\n\r\n    this._maybeFireNegotiationNeeded();\r\n    return transceiver.rtpSender;\r\n  };\r\n\r\n  RTCPeerConnection.prototype.addStream = function(stream) {\r\n    var self = this;\r\n    if (edgeVersion >= 15025) {\r\n      this.localStreams.push(stream);\r\n      stream.getTracks().forEach(function(track) {\r\n        self.addTrack(track, stream);\r\n      });\r\n    } else {\r\n      // Clone is necessary for local demos mostly, attaching directly\r\n      // to two different senders does not work (build 10547).\r\n      // Fixed in 15025 (or earlier)\r\n      var clonedStream = stream.clone();\r\n      stream.getTracks().forEach(function(track, idx) {\r\n        var clonedTrack = clonedStream.getTracks()[idx];\r\n        track.addEventListener('enabled', function(event) {\r\n          clonedTrack.enabled = event.enabled;\r\n        });\r\n      });\r\n      clonedStream.getTracks().forEach(function(track) {\r\n        self.addTrack(track, clonedStream);\r\n      });\r\n      this.localStreams.push(clonedStream);\r\n    }\r\n    this._maybeFireNegotiationNeeded();\r\n  };\r\n\r\n  RTCPeerConnection.prototype.removeStream = function(stream) {\r\n    var idx = this.localStreams.indexOf(stream);\r\n    if (idx > -1) {\r\n      this.localStreams.splice(idx, 1);\r\n      this._maybeFireNegotiationNeeded();\r\n    }\r\n  };\r\n\r\n  RTCPeerConnection.prototype.getSenders = function() {\r\n    return this.transceivers.filter(function(transceiver) {\r\n      return !!transceiver.rtpSender;\r\n    })\r\n    .map(function(transceiver) {\r\n      return transceiver.rtpSender;\r\n    });\r\n  };\r\n\r\n  RTCPeerConnection.prototype.getReceivers = function() {\r\n    return this.transceivers.filter(function(transceiver) {\r\n      return !!transceiver.rtpReceiver;\r\n    })\r\n    .map(function(transceiver) {\r\n      return transceiver.rtpReceiver;\r\n    });\r\n  };\r\n\r\n  // Create ICE gatherer and hook it up.\r\n  RTCPeerConnection.prototype._createIceGatherer = function(mid,\r\n      sdpMLineIndex) {\r\n    var self = this;\r\n    var iceGatherer = new window.RTCIceGatherer(self.iceOptions);\r\n    iceGatherer.onlocalcandidate = function(evt) {\r\n      var event = new Event('icecandidate');\r\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\r\n\r\n      var cand = evt.candidate;\r\n      var end = !cand || Object.keys(cand).length === 0;\r\n      // Edge emits an empty object for RTCIceCandidateComplete\r\n      if (end) {\r\n        // polyfill since RTCIceGatherer.state is not implemented in\r\n        // Edge 10547 yet.\r\n        if (iceGatherer.state === undefined) {\r\n          iceGatherer.state = 'completed';\r\n        }\r\n      } else {\r\n        // RTCIceCandidate doesn't have a component, needs to be added\r\n        cand.component = 1;\r\n        event.candidate.candidate = SDPUtils.writeCandidate(cand);\r\n      }\r\n\r\n      // update local description.\r\n      var sections = SDPUtils.splitSections(self.localDescription.sdp);\r\n      if (!end) {\r\n        sections[event.candidate.sdpMLineIndex + 1] +=\r\n            'a=' + event.candidate.candidate + '\\r\\n';\r\n      } else {\r\n        sections[event.candidate.sdpMLineIndex + 1] +=\r\n            'a=end-of-candidates\\r\\n';\r\n      }\r\n      self.localDescription.sdp = sections.join('');\r\n      var transceivers = self._pendingOffer ? self._pendingOffer :\r\n          self.transceivers;\r\n      var complete = transceivers.every(function(transceiver) {\r\n        return transceiver.iceGatherer &&\r\n            transceiver.iceGatherer.state === 'completed';\r\n      });\r\n\r\n      // Emit candidate if localDescription is set.\r\n      // Also emits null candidate when all gatherers are complete.\r\n      switch (self.iceGatheringState) {\r\n        case 'new':\r\n          if (!end) {\r\n            self._localIceCandidatesBuffer.push(event);\r\n          }\r\n          if (end && complete) {\r\n            self._localIceCandidatesBuffer.push(\r\n                new Event('icecandidate'));\r\n          }\r\n          break;\r\n        case 'gathering':\r\n          self._emitBufferedCandidates();\r\n          if (!end) {\r\n            self.dispatchEvent(event);\r\n            if (self.onicecandidate !== null) {\r\n              self.onicecandidate(event);\r\n            }\r\n          }\r\n          if (complete) {\r\n            self.dispatchEvent(new Event('icecandidate'));\r\n            if (self.onicecandidate !== null) {\r\n              self.onicecandidate(new Event('icecandidate'));\r\n            }\r\n            self.iceGatheringState = 'complete';\r\n            self._emitGatheringStateChange();\r\n          }\r\n          break;\r\n        case 'complete':\r\n          // should not happen... currently!\r\n          break;\r\n        default: // no-op.\r\n          break;\r\n      }\r\n    };\r\n    return iceGatherer;\r\n  };\r\n\r\n  // Create ICE transport and DTLS transport.\r\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\r\n    var self = this;\r\n    var iceTransport = new window.RTCIceTransport(null);\r\n    iceTransport.onicestatechange = function() {\r\n      self._updateConnectionState();\r\n    };\r\n\r\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\r\n    dtlsTransport.ondtlsstatechange = function() {\r\n      self._updateConnectionState();\r\n    };\r\n    dtlsTransport.onerror = function() {\r\n      // onerror does not set state to failed by itself.\r\n      Object.defineProperty(dtlsTransport, 'state',\r\n          {value: 'failed', writable: true});\r\n      self._updateConnectionState();\r\n    };\r\n\r\n    return {\r\n      iceTransport: iceTransport,\r\n      dtlsTransport: dtlsTransport\r\n    };\r\n  };\r\n\r\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\r\n  // Without triggering the callbacks.\r\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\r\n      sdpMLineIndex) {\r\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\r\n    if (iceGatherer) {\r\n      delete iceGatherer.onlocalcandidate;\r\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\r\n    }\r\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\r\n    if (iceTransport) {\r\n      delete iceTransport.onicestatechange;\r\n      delete this.transceivers[sdpMLineIndex].iceTransport;\r\n    }\r\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\r\n    if (dtlsTransport) {\r\n      delete dtlsTransport.ondtlssttatechange;\r\n      delete dtlsTransport.onerror;\r\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\r\n    }\r\n  };\r\n\r\n  // Start the RTP Sender and Receiver for a transceiver.\r\n  RTCPeerConnection.prototype._transceive = function(transceiver,\r\n      send, recv) {\r\n    var params = getCommonCapabilities(transceiver.localCapabilities,\r\n        transceiver.remoteCapabilities);\r\n    if (send && transceiver.rtpSender) {\r\n      params.encodings = transceiver.sendEncodingParameters;\r\n      params.rtcp = {\r\n        cname: SDPUtils.localCName,\r\n        compound: transceiver.rtcpParameters.compound\r\n      };\r\n      if (transceiver.recvEncodingParameters.length) {\r\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\r\n      }\r\n      transceiver.rtpSender.send(params);\r\n    }\r\n    if (recv && transceiver.rtpReceiver) {\r\n      // remove RTX field in Edge 14942\r\n      if (transceiver.kind === 'video'\r\n          && transceiver.recvEncodingParameters\r\n          && edgeVersion < 15019) {\r\n        transceiver.recvEncodingParameters.forEach(function(p) {\r\n          delete p.rtx;\r\n        });\r\n      }\r\n      params.encodings = transceiver.recvEncodingParameters;\r\n      params.rtcp = {\r\n        cname: transceiver.rtcpParameters.cname,\r\n        compound: transceiver.rtcpParameters.compound\r\n      };\r\n      if (transceiver.sendEncodingParameters.length) {\r\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\r\n      }\r\n      transceiver.rtpReceiver.receive(params);\r\n    }\r\n  };\r\n\r\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\r\n    var self = this;\r\n\r\n    if (!isActionAllowedInSignalingState('setLocalDescription',\r\n        description.type, this.signalingState)) {\r\n      var e = new Error('Can not set local ' + description.type +\r\n          ' in state ' + this.signalingState);\r\n      e.name = 'InvalidStateError';\r\n      if (arguments.length > 2 && typeof arguments[2] === 'function') {\r\n        window.setTimeout(arguments[2], 0, e);\r\n      }\r\n      return Promise.reject(e);\r\n    }\r\n\r\n    var sections;\r\n    var sessionpart;\r\n    if (description.type === 'offer') {\r\n      // FIXME: What was the purpose of this empty if statement?\r\n      // if (!this._pendingOffer) {\r\n      // } else {\r\n      if (this._pendingOffer) {\r\n        // VERY limited support for SDP munging. Limited to:\r\n        // * changing the order of codecs\r\n        sections = SDPUtils.splitSections(description.sdp);\r\n        sessionpart = sections.shift();\r\n        sections.forEach(function(mediaSection, sdpMLineIndex) {\r\n          var caps = SDPUtils.parseRtpParameters(mediaSection);\r\n          self._pendingOffer[sdpMLineIndex].localCapabilities = caps;\r\n        });\r\n        this.transceivers = this._pendingOffer;\r\n        delete this._pendingOffer;\r\n      }\r\n    } else if (description.type === 'answer') {\r\n      sections = SDPUtils.splitSections(self.remoteDescription.sdp);\r\n      sessionpart = sections.shift();\r\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n          'a=ice-lite').length > 0;\r\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\r\n        var transceiver = self.transceivers[sdpMLineIndex];\r\n        var iceGatherer = transceiver.iceGatherer;\r\n        var iceTransport = transceiver.iceTransport;\r\n        var dtlsTransport = transceiver.dtlsTransport;\r\n        var localCapabilities = transceiver.localCapabilities;\r\n        var remoteCapabilities = transceiver.remoteCapabilities;\r\n\r\n        var rejected = SDPUtils.isRejected(mediaSection);\r\n\r\n        if (!rejected && !transceiver.isDatachannel) {\r\n          var remoteIceParameters = SDPUtils.getIceParameters(\r\n              mediaSection, sessionpart);\r\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\r\n              mediaSection, sessionpart);\r\n          if (isIceLite) {\r\n            remoteDtlsParameters.role = 'server';\r\n          }\r\n\r\n          if (!self.usingBundle || sdpMLineIndex === 0) {\r\n            iceTransport.start(iceGatherer, remoteIceParameters,\r\n                isIceLite ? 'controlling' : 'controlled');\r\n            dtlsTransport.start(remoteDtlsParameters);\r\n          }\r\n\r\n          // Calculate intersection of capabilities.\r\n          var params = getCommonCapabilities(localCapabilities,\r\n              remoteCapabilities);\r\n\r\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\r\n          // transceiver has already been started in setRemoteDescription.\r\n          self._transceive(transceiver,\r\n              params.codecs.length > 0,\r\n              false);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.localDescription = {\r\n      type: description.type,\r\n      sdp: description.sdp\r\n    };\r\n    switch (description.type) {\r\n      case 'offer':\r\n        this._updateSignalingState('have-local-offer');\r\n        break;\r\n      case 'answer':\r\n        this._updateSignalingState('stable');\r\n        break;\r\n      default:\r\n        throw new TypeError('unsupported type \"' + description.type +\r\n            '\"');\r\n    }\r\n\r\n    // If a success callback was provided, emit ICE candidates after it\r\n    // has been executed. Otherwise, emit callback after the Promise is\r\n    // resolved.\r\n    var hasCallback = arguments.length > 1 &&\r\n      typeof arguments[1] === 'function';\r\n    if (hasCallback) {\r\n      var cb = arguments[1];\r\n      window.setTimeout(function() {\r\n        cb();\r\n        if (self.iceGatheringState === 'new') {\r\n          self.iceGatheringState = 'gathering';\r\n          self._emitGatheringStateChange();\r\n        }\r\n        self._emitBufferedCandidates();\r\n      }, 0);\r\n    }\r\n    var p = Promise.resolve();\r\n    p.then(function() {\r\n      if (!hasCallback) {\r\n        if (self.iceGatheringState === 'new') {\r\n          self.iceGatheringState = 'gathering';\r\n          self._emitGatheringStateChange();\r\n        }\r\n        // Usually candidates will be emitted earlier.\r\n        window.setTimeout(self._emitBufferedCandidates.bind(self), 500);\r\n      }\r\n    });\r\n    return p;\r\n  };\r\n\r\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\r\n    var self = this;\r\n\r\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\r\n        description.type, this.signalingState)) {\r\n      var e = new Error('Can not set remote ' + description.type +\r\n          ' in state ' + this.signalingState);\r\n      e.name = 'InvalidStateError';\r\n      if (arguments.length > 2 && typeof arguments[2] === 'function') {\r\n        window.setTimeout(arguments[2], 0, e);\r\n      }\r\n      return Promise.reject(e);\r\n    }\r\n\r\n    var streams = {};\r\n    var receiverList = [];\r\n    var sections = SDPUtils.splitSections(description.sdp);\r\n    var sessionpart = sections.shift();\r\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\r\n        'a=ice-lite').length > 0;\r\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\r\n        'a=group:BUNDLE ').length > 0;\r\n    this.usingBundle = usingBundle;\r\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\r\n        'a=ice-options:')[0];\r\n    if (iceOptions) {\r\n      this.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\r\n          .indexOf('trickle') >= 0;\r\n    } else {\r\n      this.canTrickleIceCandidates = false;\r\n    }\r\n\r\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\r\n      var lines = SDPUtils.splitLines(mediaSection);\r\n      var kind = SDPUtils.getKind(mediaSection);\r\n      var rejected = SDPUtils.isRejected(mediaSection);\r\n      var protocol = lines[0].substr(2).split(' ')[2];\r\n\r\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\r\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\r\n\r\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\r\n\r\n      // Reject datachannels which are not implemented yet.\r\n      if (kind === 'application' && protocol === 'DTLS/SCTP') {\r\n        self.transceivers[sdpMLineIndex] = {\r\n          mid: mid,\r\n          isDatachannel: true\r\n        };\r\n        return;\r\n      }\r\n\r\n      var transceiver;\r\n      var iceGatherer;\r\n      var iceTransport;\r\n      var dtlsTransport;\r\n      var rtpReceiver;\r\n      var sendEncodingParameters;\r\n      var recvEncodingParameters;\r\n      var localCapabilities;\r\n\r\n      var track;\r\n      // FIXME: ensure the mediaSection has rtcp-mux set.\r\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\r\n      var remoteIceParameters;\r\n      var remoteDtlsParameters;\r\n      if (!rejected) {\r\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\r\n            sessionpart);\r\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\r\n            sessionpart);\r\n        remoteDtlsParameters.role = 'client';\r\n      }\r\n      recvEncodingParameters =\r\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\r\n\r\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\r\n\r\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\r\n          'a=end-of-candidates', sessionpart).length > 0;\r\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\r\n          .map(function(cand) {\r\n            return SDPUtils.parseCandidate(cand);\r\n          })\r\n          .filter(function(cand) {\r\n            return cand.component === '1' || cand.component === 1;\r\n          });\r\n\r\n      // Check if we can use BUNDLE and dispose transports.\r\n      if ((description.type === 'offer' || description.type === 'answer') &&\r\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\r\n          self.transceivers[sdpMLineIndex]) {\r\n        self._disposeIceAndDtlsTransports(sdpMLineIndex);\r\n        self.transceivers[sdpMLineIndex].iceGatherer =\r\n            self.transceivers[0].iceGatherer;\r\n        self.transceivers[sdpMLineIndex].iceTransport =\r\n            self.transceivers[0].iceTransport;\r\n        self.transceivers[sdpMLineIndex].dtlsTransport =\r\n            self.transceivers[0].dtlsTransport;\r\n        if (self.transceivers[sdpMLineIndex].rtpSender) {\r\n          self.transceivers[sdpMLineIndex].rtpSender.setTransport(\r\n              self.transceivers[0].dtlsTransport);\r\n        }\r\n        if (self.transceivers[sdpMLineIndex].rtpReceiver) {\r\n          self.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\r\n              self.transceivers[0].dtlsTransport);\r\n        }\r\n      }\r\n      if (description.type === 'offer' && !rejected) {\r\n        transceiver = self.transceivers[sdpMLineIndex] ||\r\n            self._createTransceiver(kind);\r\n        transceiver.mid = mid;\r\n\r\n        if (!transceiver.iceGatherer) {\r\n          transceiver.iceGatherer = usingBundle && sdpMLineIndex > 0 ?\r\n              self.transceivers[0].iceGatherer :\r\n              self._createIceGatherer(mid, sdpMLineIndex);\r\n        }\r\n\r\n        if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\r\n          transceiver.iceTransport.setRemoteCandidates(cands);\r\n        }\r\n\r\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\r\n\r\n        // filter RTX until additional stuff needed for RTX is implemented\r\n        // in adapter.js\r\n        if (edgeVersion < 15019) {\r\n          localCapabilities.codecs = localCapabilities.codecs.filter(\r\n              function(codec) {\r\n                return codec.name !== 'rtx';\r\n              });\r\n        }\r\n\r\n        sendEncodingParameters = [{\r\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\r\n        }];\r\n\r\n        if (direction === 'sendrecv' || direction === 'sendonly') {\r\n          rtpReceiver = new window.RTCRtpReceiver(transceiver.dtlsTransport,\r\n              kind);\r\n\r\n          track = rtpReceiver.track;\r\n          // FIXME: does not work with Plan B.\r\n          if (remoteMsid) {\r\n            if (!streams[remoteMsid.stream]) {\r\n              streams[remoteMsid.stream] = new window.MediaStream();\r\n              Object.defineProperty(streams[remoteMsid.stream], 'id', {\r\n                get: function() {\r\n                  return remoteMsid.stream;\r\n                }\r\n              });\r\n            }\r\n            Object.defineProperty(track, 'id', {\r\n              get: function() {\r\n                return remoteMsid.track;\r\n              }\r\n            });\r\n            streams[remoteMsid.stream].addTrack(track);\r\n            receiverList.push([track, rtpReceiver,\r\n              streams[remoteMsid.stream]]);\r\n          } else {\r\n            if (!streams.default) {\r\n              streams.default = new window.MediaStream();\r\n            }\r\n            streams.default.addTrack(track);\r\n            receiverList.push([track, rtpReceiver, streams.default]);\r\n          }\r\n        }\r\n\r\n        transceiver.localCapabilities = localCapabilities;\r\n        transceiver.remoteCapabilities = remoteCapabilities;\r\n        transceiver.rtpReceiver = rtpReceiver;\r\n        transceiver.rtcpParameters = rtcpParameters;\r\n        transceiver.sendEncodingParameters = sendEncodingParameters;\r\n        transceiver.recvEncodingParameters = recvEncodingParameters;\r\n\r\n        // Start the RTCRtpReceiver now. The RTPSender is started in\r\n        // setLocalDescription.\r\n        self._transceive(self.transceivers[sdpMLineIndex],\r\n            false,\r\n            direction === 'sendrecv' || direction === 'sendonly');\r\n      } else if (description.type === 'answer' && !rejected) {\r\n        transceiver = self.transceivers[sdpMLineIndex];\r\n        iceGatherer = transceiver.iceGatherer;\r\n        iceTransport = transceiver.iceTransport;\r\n        dtlsTransport = transceiver.dtlsTransport;\r\n        rtpReceiver = transceiver.rtpReceiver;\r\n        sendEncodingParameters = transceiver.sendEncodingParameters;\r\n        localCapabilities = transceiver.localCapabilities;\r\n\r\n        self.transceivers[sdpMLineIndex].recvEncodingParameters =\r\n            recvEncodingParameters;\r\n        self.transceivers[sdpMLineIndex].remoteCapabilities =\r\n            remoteCapabilities;\r\n        self.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\r\n\r\n        if ((isIceLite || isComplete) && cands.length) {\r\n          iceTransport.setRemoteCandidates(cands);\r\n        }\r\n        if (!usingBundle || sdpMLineIndex === 0) {\r\n          iceTransport.start(iceGatherer, remoteIceParameters,\r\n              'controlling');\r\n          dtlsTransport.start(remoteDtlsParameters);\r\n        }\r\n\r\n        self._transceive(transceiver,\r\n            direction === 'sendrecv' || direction === 'recvonly',\r\n            direction === 'sendrecv' || direction === 'sendonly');\r\n\r\n        if (rtpReceiver &&\r\n            (direction === 'sendrecv' || direction === 'sendonly')) {\r\n          track = rtpReceiver.track;\r\n          if (remoteMsid) {\r\n            if (!streams[remoteMsid.stream]) {\r\n              streams[remoteMsid.stream] = new window.MediaStream();\r\n            }\r\n            streams[remoteMsid.stream].addTrack(track);\r\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\r\n          } else {\r\n            if (!streams.default) {\r\n              streams.default = new window.MediaStream();\r\n            }\r\n            streams.default.addTrack(track);\r\n            receiverList.push([track, rtpReceiver, streams.default]);\r\n          }\r\n        } else {\r\n          // FIXME: actually the receiver should be created later.\r\n          delete transceiver.rtpReceiver;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.remoteDescription = {\r\n      type: description.type,\r\n      sdp: description.sdp\r\n    };\r\n    switch (description.type) {\r\n      case 'offer':\r\n        this._updateSignalingState('have-remote-offer');\r\n        break;\r\n      case 'answer':\r\n        this._updateSignalingState('stable');\r\n        break;\r\n      default:\r\n        throw new TypeError('unsupported type \"' + description.type +\r\n            '\"');\r\n    }\r\n    Object.keys(streams).forEach(function(sid) {\r\n      var stream = streams[sid];\r\n      if (stream.getTracks().length) {\r\n        self.remoteStreams.push(stream);\r\n        var event = new Event('addstream');\r\n        event.stream = stream;\r\n        self.dispatchEvent(event);\r\n        if (self.onaddstream !== null) {\r\n          window.setTimeout(function() {\r\n            self.onaddstream(event);\r\n          }, 0);\r\n        }\r\n\r\n        receiverList.forEach(function(item) {\r\n          var track = item[0];\r\n          var receiver = item[1];\r\n          if (stream.id !== item[2].id) {\r\n            return;\r\n          }\r\n          var trackEvent = new Event('track');\r\n          trackEvent.track = track;\r\n          trackEvent.receiver = receiver;\r\n          trackEvent.streams = [stream];\r\n          self.dispatchEvent(trackEvent);\r\n          if (self.ontrack !== null) {\r\n            window.setTimeout(function() {\r\n              self.ontrack(trackEvent);\r\n            }, 0);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    // check whether addIceCandidate({}) was called within four seconds after\r\n    // setRemoteDescription.\r\n    window.setTimeout(function() {\r\n      if (!(self && self.transceivers)) {\r\n        return;\r\n      }\r\n      self.transceivers.forEach(function(transceiver) {\r\n        if (transceiver.iceTransport &&\r\n            transceiver.iceTransport.state === 'new' &&\r\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\r\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\r\n              'an end-of-candidates notification');\r\n          transceiver.iceTransport.addRemoteCandidate({});\r\n        }\r\n      });\r\n    }, 4000);\r\n\r\n    if (arguments.length > 1 && typeof arguments[1] === 'function') {\r\n      window.setTimeout(arguments[1], 0);\r\n    }\r\n    return Promise.resolve();\r\n  };\r\n\r\n  RTCPeerConnection.prototype.close = function() {\r\n    this.transceivers.forEach(function(transceiver) {\r\n      /* not yet\r\n      if (transceiver.iceGatherer) {\r\n        transceiver.iceGatherer.close();\r\n      }\r\n      */\r\n      if (transceiver.iceTransport) {\r\n        transceiver.iceTransport.stop();\r\n      }\r\n      if (transceiver.dtlsTransport) {\r\n        transceiver.dtlsTransport.stop();\r\n      }\r\n      if (transceiver.rtpSender) {\r\n        transceiver.rtpSender.stop();\r\n      }\r\n      if (transceiver.rtpReceiver) {\r\n        transceiver.rtpReceiver.stop();\r\n      }\r\n    });\r\n    // FIXME: clean up tracks, local streams, remote streams, etc\r\n    this._updateSignalingState('closed');\r\n  };\r\n\r\n  // Update the signaling state.\r\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\r\n    this.signalingState = newState;\r\n    var event = new Event('signalingstatechange');\r\n    this.dispatchEvent(event);\r\n    if (this.onsignalingstatechange !== null) {\r\n      this.onsignalingstatechange(event);\r\n    }\r\n  };\r\n\r\n  // Determine whether to fire the negotiationneeded event.\r\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\r\n    var self = this;\r\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\r\n      return;\r\n    }\r\n    this.needNegotiation = true;\r\n    window.setTimeout(function() {\r\n      if (self.needNegotiation === false) {\r\n        return;\r\n      }\r\n      self.needNegotiation = false;\r\n      var event = new Event('negotiationneeded');\r\n      self.dispatchEvent(event);\r\n      if (self.onnegotiationneeded !== null) {\r\n        self.onnegotiationneeded(event);\r\n      }\r\n    }, 0);\r\n  };\r\n\r\n  // Update the connection state.\r\n  RTCPeerConnection.prototype._updateConnectionState = function() {\r\n    var self = this;\r\n    var newState;\r\n    var states = {\r\n      'new': 0,\r\n      closed: 0,\r\n      connecting: 0,\r\n      checking: 0,\r\n      connected: 0,\r\n      completed: 0,\r\n      disconnected: 0,\r\n      failed: 0\r\n    };\r\n    this.transceivers.forEach(function(transceiver) {\r\n      states[transceiver.iceTransport.state]++;\r\n      states[transceiver.dtlsTransport.state]++;\r\n    });\r\n    // ICETransport.completed and connected are the same for this purpose.\r\n    states.connected += states.completed;\r\n\r\n    newState = 'new';\r\n    if (states.failed > 0) {\r\n      newState = 'failed';\r\n    } else if (states.connecting > 0 || states.checking > 0) {\r\n      newState = 'connecting';\r\n    } else if (states.disconnected > 0) {\r\n      newState = 'disconnected';\r\n    } else if (states.new > 0) {\r\n      newState = 'new';\r\n    } else if (states.connected > 0 || states.completed > 0) {\r\n      newState = 'connected';\r\n    }\r\n\r\n    if (newState !== self.iceConnectionState) {\r\n      self.iceConnectionState = newState;\r\n      var event = new Event('iceconnectionstatechange');\r\n      this.dispatchEvent(event);\r\n      if (this.oniceconnectionstatechange !== null) {\r\n        this.oniceconnectionstatechange(event);\r\n      }\r\n    }\r\n  };\r\n\r\n  RTCPeerConnection.prototype.createOffer = function() {\r\n    var self = this;\r\n    if (this._pendingOffer) {\r\n      throw new Error('createOffer called while there is a pending offer.');\r\n    }\r\n    var offerOptions;\r\n    if (arguments.length === 1 && typeof arguments[0] !== 'function') {\r\n      offerOptions = arguments[0];\r\n    } else if (arguments.length === 3) {\r\n      offerOptions = arguments[2];\r\n    }\r\n\r\n    var numAudioTracks = this.transceivers.filter(function(t) {\r\n      return t.kind === 'audio';\r\n    }).length;\r\n    var numVideoTracks = this.transceivers.filter(function(t) {\r\n      return t.kind === 'video';\r\n    }).length;\r\n\r\n    // Determine number of audio and video tracks we need to send/recv.\r\n    if (offerOptions) {\r\n      // Reject Chrome legacy constraints.\r\n      if (offerOptions.mandatory || offerOptions.optional) {\r\n        throw new TypeError(\r\n            'Legacy mandatory/optional constraints not supported.');\r\n      }\r\n      if (offerOptions.offerToReceiveAudio !== undefined) {\r\n        if (offerOptions.offerToReceiveAudio === true) {\r\n          numAudioTracks = 1;\r\n        } else if (offerOptions.offerToReceiveAudio === false) {\r\n          numAudioTracks = 0;\r\n        } else {\r\n          numAudioTracks = offerOptions.offerToReceiveAudio;\r\n        }\r\n      }\r\n      if (offerOptions.offerToReceiveVideo !== undefined) {\r\n        if (offerOptions.offerToReceiveVideo === true) {\r\n          numVideoTracks = 1;\r\n        } else if (offerOptions.offerToReceiveVideo === false) {\r\n          numVideoTracks = 0;\r\n        } else {\r\n          numVideoTracks = offerOptions.offerToReceiveVideo;\r\n        }\r\n      }\r\n    }\r\n\r\n    this.transceivers.forEach(function(transceiver) {\r\n      if (transceiver.kind === 'audio') {\r\n        numAudioTracks--;\r\n        if (numAudioTracks < 0) {\r\n          transceiver.wantReceive = false;\r\n        }\r\n      } else if (transceiver.kind === 'video') {\r\n        numVideoTracks--;\r\n        if (numVideoTracks < 0) {\r\n          transceiver.wantReceive = false;\r\n        }\r\n      }\r\n    });\r\n\r\n    // Create M-lines for recvonly streams.\r\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\r\n      if (numAudioTracks > 0) {\r\n        this._createTransceiver('audio');\r\n        numAudioTracks--;\r\n      }\r\n      if (numVideoTracks > 0) {\r\n        this._createTransceiver('video');\r\n        numVideoTracks--;\r\n      }\r\n    }\r\n    // reorder tracks\r\n    var transceivers = sortTracks(this.transceivers);\r\n\r\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId);\r\n    transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n      // For each track, create an ice gatherer, ice transport,\r\n      // dtls transport, potentially rtpsender and rtpreceiver.\r\n      var track = transceiver.track;\r\n      var kind = transceiver.kind;\r\n      var mid = SDPUtils.generateIdentifier();\r\n      transceiver.mid = mid;\r\n\r\n      if (!transceiver.iceGatherer) {\r\n        transceiver.iceGatherer = self.usingBundle && sdpMLineIndex > 0 ?\r\n            transceivers[0].iceGatherer :\r\n            self._createIceGatherer(mid, sdpMLineIndex);\r\n      }\r\n\r\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\r\n      // filter RTX until additional stuff needed for RTX is implemented\r\n      // in adapter.js\r\n      if (edgeVersion < 15019) {\r\n        localCapabilities.codecs = localCapabilities.codecs.filter(\r\n            function(codec) {\r\n              return codec.name !== 'rtx';\r\n            });\r\n      }\r\n      localCapabilities.codecs.forEach(function(codec) {\r\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\r\n        // by adding level-asymmetry-allowed=1\r\n        if (codec.name === 'H264' &&\r\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\r\n          codec.parameters['level-asymmetry-allowed'] = '1';\r\n        }\r\n      });\r\n\r\n      // generate an ssrc now, to be used later in rtpSender.send\r\n      var sendEncodingParameters = [{\r\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\r\n      }];\r\n      if (track) {\r\n        // add RTX\r\n        if (edgeVersion >= 15019 && kind === 'video') {\r\n          sendEncodingParameters[0].rtx = {\r\n            ssrc: (2 * sdpMLineIndex + 1) * 1001 + 1\r\n          };\r\n        }\r\n      }\r\n\r\n      if (transceiver.wantReceive) {\r\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\r\n          transceiver.dtlsTransport,\r\n          kind\r\n        );\r\n      }\r\n\r\n      transceiver.localCapabilities = localCapabilities;\r\n      transceiver.sendEncodingParameters = sendEncodingParameters;\r\n    });\r\n\r\n    // always offer BUNDLE and dispose on return if not supported.\r\n    if (this._config.bundlePolicy !== 'max-compat') {\r\n      sdp += 'a=group:BUNDLE ' + transceivers.map(function(t) {\r\n        return t.mid;\r\n      }).join(' ') + '\\r\\n';\r\n    }\r\n    sdp += 'a=ice-options:trickle\\r\\n';\r\n\r\n    transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n      sdp += SDPUtils.writeMediaSection(transceiver,\r\n          transceiver.localCapabilities, 'offer', transceiver.stream);\r\n      sdp += 'a=rtcp-rsize\\r\\n';\r\n    });\r\n\r\n    this._pendingOffer = transceivers;\r\n    var desc = new window.RTCSessionDescription({\r\n      type: 'offer',\r\n      sdp: sdp\r\n    });\r\n    if (arguments.length && typeof arguments[0] === 'function') {\r\n      window.setTimeout(arguments[0], 0, desc);\r\n    }\r\n    return Promise.resolve(desc);\r\n  };\r\n\r\n  RTCPeerConnection.prototype.createAnswer = function() {\r\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId);\r\n    if (this.usingBundle) {\r\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\r\n        return t.mid;\r\n      }).join(' ') + '\\r\\n';\r\n    }\r\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\r\n      if (transceiver.isDatachannel) {\r\n        sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\r\n            'c=IN IP4 0.0.0.0\\r\\n' +\r\n            'a=mid:' + transceiver.mid + '\\r\\n';\r\n        return;\r\n      }\r\n\r\n      // FIXME: look at direction.\r\n      if (transceiver.stream) {\r\n        var localTrack;\r\n        if (transceiver.kind === 'audio') {\r\n          localTrack = transceiver.stream.getAudioTracks()[0];\r\n        } else if (transceiver.kind === 'video') {\r\n          localTrack = transceiver.stream.getVideoTracks()[0];\r\n        }\r\n        if (localTrack) {\r\n          // add RTX\r\n          if (edgeVersion >= 15019 && transceiver.kind === 'video') {\r\n            transceiver.sendEncodingParameters[0].rtx = {\r\n              ssrc: (2 * sdpMLineIndex + 2) * 1001 + 1\r\n            };\r\n          }\r\n        }\r\n      }\r\n\r\n      // Calculate intersection of capabilities.\r\n      var commonCapabilities = getCommonCapabilities(\r\n          transceiver.localCapabilities,\r\n          transceiver.remoteCapabilities);\r\n\r\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\r\n        return c.name.toLowerCase() === 'rtx';\r\n      }).length;\r\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\r\n        delete transceiver.sendEncodingParameters[0].rtx;\r\n      }\r\n\r\n      sdp += SDPUtils.writeMediaSection(transceiver, commonCapabilities,\r\n          'answer', transceiver.stream);\r\n      if (transceiver.rtcpParameters &&\r\n          transceiver.rtcpParameters.reducedSize) {\r\n        sdp += 'a=rtcp-rsize\\r\\n';\r\n      }\r\n    });\r\n\r\n    var desc = new window.RTCSessionDescription({\r\n      type: 'answer',\r\n      sdp: sdp\r\n    });\r\n    if (arguments.length && typeof arguments[0] === 'function') {\r\n      window.setTimeout(arguments[0], 0, desc);\r\n    }\r\n    return Promise.resolve(desc);\r\n  };\r\n\r\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\r\n    if (!candidate) {\r\n      for (var j = 0; j < this.transceivers.length; j++) {\r\n        this.transceivers[j].iceTransport.addRemoteCandidate({});\r\n        if (this.usingBundle) {\r\n          return Promise.resolve();\r\n        }\r\n      }\r\n    } else {\r\n      var mLineIndex = candidate.sdpMLineIndex;\r\n      if (candidate.sdpMid) {\r\n        for (var i = 0; i < this.transceivers.length; i++) {\r\n          if (this.transceivers[i].mid === candidate.sdpMid) {\r\n            mLineIndex = i;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      var transceiver = this.transceivers[mLineIndex];\r\n      if (transceiver) {\r\n        var cand = Object.keys(candidate.candidate).length > 0 ?\r\n            SDPUtils.parseCandidate(candidate.candidate) : {};\r\n        // Ignore Chrome's invalid candidates since Edge does not like them.\r\n        if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\r\n          return Promise.resolve();\r\n        }\r\n        // Ignore RTCP candidates, we assume RTCP-MUX.\r\n        if (cand.component &&\r\n            !(cand.component === '1' || cand.component === 1)) {\r\n          return Promise.resolve();\r\n        }\r\n        transceiver.iceTransport.addRemoteCandidate(cand);\r\n\r\n        // update the remoteDescription.\r\n        var sections = SDPUtils.splitSections(this.remoteDescription.sdp);\r\n        sections[mLineIndex + 1] += (cand.type ? candidate.candidate.trim()\r\n            : 'a=end-of-candidates') + '\\r\\n';\r\n        this.remoteDescription.sdp = sections.join('');\r\n      }\r\n    }\r\n    if (arguments.length > 1 && typeof arguments[1] === 'function') {\r\n      window.setTimeout(arguments[1], 0);\r\n    }\r\n    return Promise.resolve();\r\n  };\r\n\r\n  RTCPeerConnection.prototype.getStats = function() {\r\n    var promises = [];\r\n    this.transceivers.forEach(function(transceiver) {\r\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\r\n        'dtlsTransport'].forEach(function(method) {\r\n          if (transceiver[method]) {\r\n            promises.push(transceiver[method].getStats());\r\n          }\r\n        });\r\n    });\r\n    var cb = arguments.length > 1 && typeof arguments[1] === 'function' &&\r\n        arguments[1];\r\n    var fixStatsType = function(stat) {\r\n      return {\r\n        inboundrtp: 'inbound-rtp',\r\n        outboundrtp: 'outbound-rtp',\r\n        candidatepair: 'candidate-pair',\r\n        localcandidate: 'local-candidate',\r\n        remotecandidate: 'remote-candidate'\r\n      }[stat.type] || stat.type;\r\n    };\r\n    return new Promise(function(resolve) {\r\n      // shim getStats with maplike support\r\n      var results = new Map();\r\n      Promise.all(promises).then(function(res) {\r\n        res.forEach(function(result) {\r\n          Object.keys(result).forEach(function(id) {\r\n            result[id].type = fixStatsType(result[id]);\r\n            results.set(id, result[id]);\r\n          });\r\n        });\r\n        if (cb) {\r\n          window.setTimeout(cb, 0, results);\r\n        }\r\n        resolve(results);\r\n      });\r\n    });\r\n  };\r\n  return RTCPeerConnection;\r\n};\r\n\r\n},{\"sdp\":1}],9:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\n\r\nvar utils = require('../utils');\r\n\r\nvar firefoxShim = {\r\n  shimOnTrack: function(window) {\r\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\r\n        window.RTCPeerConnection.prototype)) {\r\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\r\n        get: function() {\r\n          return this._ontrack;\r\n        },\r\n        set: function(f) {\r\n          if (this._ontrack) {\r\n            this.removeEventListener('track', this._ontrack);\r\n            this.removeEventListener('addstream', this._ontrackpoly);\r\n          }\r\n          this.addEventListener('track', this._ontrack = f);\r\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\r\n            e.stream.getTracks().forEach(function(track) {\r\n              var event = new Event('track');\r\n              event.track = track;\r\n              event.receiver = {track: track};\r\n              event.streams = [e.stream];\r\n              this.dispatchEvent(event);\r\n            }.bind(this));\r\n          }.bind(this));\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  shimSourceObject: function(window) {\r\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\r\n    if (typeof window === 'object') {\r\n      if (window.HTMLMediaElement &&\r\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\r\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\r\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\r\n          get: function() {\r\n            return this.mozSrcObject;\r\n          },\r\n          set: function(stream) {\r\n            this.mozSrcObject = stream;\r\n          }\r\n        });\r\n      }\r\n    }\r\n  },\r\n\r\n  shimPeerConnection: function(window) {\r\n    var browserDetails = utils.detectBrowser(window);\r\n\r\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\r\n        window.mozRTCPeerConnection)) {\r\n      return; // probably media.peerconnection.enabled=false in about:config\r\n    }\r\n    // The RTCPeerConnection object.\r\n    if (!window.RTCPeerConnection) {\r\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\r\n        if (browserDetails.version < 38) {\r\n          // .urls is not supported in FF < 38.\r\n          // create RTCIceServers with a single url.\r\n          if (pcConfig && pcConfig.iceServers) {\r\n            var newIceServers = [];\r\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\r\n              var server = pcConfig.iceServers[i];\r\n              if (server.hasOwnProperty('urls')) {\r\n                for (var j = 0; j < server.urls.length; j++) {\r\n                  var newServer = {\r\n                    url: server.urls[j]\r\n                  };\r\n                  if (server.urls[j].indexOf('turn') === 0) {\r\n                    newServer.username = server.username;\r\n                    newServer.credential = server.credential;\r\n                  }\r\n                  newIceServers.push(newServer);\r\n                }\r\n              } else {\r\n                newIceServers.push(pcConfig.iceServers[i]);\r\n              }\r\n            }\r\n            pcConfig.iceServers = newIceServers;\r\n          }\r\n        }\r\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\r\n      };\r\n      window.RTCPeerConnection.prototype =\r\n          window.mozRTCPeerConnection.prototype;\r\n\r\n      // wrap static methods. Currently just generateCertificate.\r\n      if (window.mozRTCPeerConnection.generateCertificate) {\r\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\r\n          get: function() {\r\n            return window.mozRTCPeerConnection.generateCertificate;\r\n          }\r\n        });\r\n      }\r\n\r\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\r\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\r\n    }\r\n\r\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\r\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\r\n        .forEach(function(method) {\r\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\r\n          window.RTCPeerConnection.prototype[method] = function() {\r\n            arguments[0] = new ((method === 'addIceCandidate') ?\r\n                window.RTCIceCandidate :\r\n                window.RTCSessionDescription)(arguments[0]);\r\n            return nativeMethod.apply(this, arguments);\r\n          };\r\n        });\r\n\r\n    // support for addIceCandidate(null or undefined)\r\n    var nativeAddIceCandidate =\r\n        window.RTCPeerConnection.prototype.addIceCandidate;\r\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\r\n      if (!arguments[0]) {\r\n        if (arguments[1]) {\r\n          arguments[1].apply(null);\r\n        }\r\n        return Promise.resolve();\r\n      }\r\n      return nativeAddIceCandidate.apply(this, arguments);\r\n    };\r\n\r\n    // shim getStats with maplike support\r\n    var makeMapStats = function(stats) {\r\n      var map = new Map();\r\n      Object.keys(stats).forEach(function(key) {\r\n        map.set(key, stats[key]);\r\n        map[key] = stats[key];\r\n      });\r\n      return map;\r\n    };\r\n\r\n    var modernStatsTypes = {\r\n      inboundrtp: 'inbound-rtp',\r\n      outboundrtp: 'outbound-rtp',\r\n      candidatepair: 'candidate-pair',\r\n      localcandidate: 'local-candidate',\r\n      remotecandidate: 'remote-candidate'\r\n    };\r\n\r\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\r\n    window.RTCPeerConnection.prototype.getStats = function(\r\n      selector,\r\n      onSucc,\r\n      onErr\r\n    ) {\r\n      return nativeGetStats.apply(this, [selector || null])\r\n        .then(function(stats) {\r\n          if (browserDetails.version < 48) {\r\n            stats = makeMapStats(stats);\r\n          }\r\n          if (browserDetails.version < 53 && !onSucc) {\r\n            // Shim only promise getStats with spec-hyphens in type names\r\n            // Leave callback version alone; misc old uses of forEach before Map\r\n            try {\r\n              stats.forEach(function(stat) {\r\n                stat.type = modernStatsTypes[stat.type] || stat.type;\r\n              });\r\n            } catch (e) {\r\n              if (e.name !== 'TypeError') {\r\n                throw e;\r\n              }\r\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\r\n              stats.forEach(function(stat, i) {\r\n                stats.set(i, Object.assign({}, stat, {\r\n                  type: modernStatsTypes[stat.type] || stat.type\r\n                }));\r\n              });\r\n            }\r\n          }\r\n          return stats;\r\n        })\r\n        .then(onSucc, onErr);\r\n    };\r\n  }\r\n};\r\n\r\n// Expose public methods.\r\nmodule.exports = {\r\n  shimOnTrack: firefoxShim.shimOnTrack,\r\n  shimSourceObject: firefoxShim.shimSourceObject,\r\n  shimPeerConnection: firefoxShim.shimPeerConnection,\r\n  shimGetUserMedia: require('./getusermedia')\r\n};\r\n\r\n},{\"../utils\":12,\"./getusermedia\":10}],10:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\n\r\nvar utils = require('../utils');\r\nvar logging = utils.log;\r\n\r\n// Expose public methods.\r\nmodule.exports = function(window) {\r\n  var browserDetails = utils.detectBrowser(window);\r\n  var navigator = window && window.navigator;\r\n  var MediaStreamTrack = window && window.MediaStreamTrack;\r\n\r\n  var shimError_ = function(e) {\r\n    return {\r\n      name: {\r\n        InternalError: 'NotReadableError',\r\n        NotSupportedError: 'TypeError',\r\n        PermissionDeniedError: 'NotAllowedError',\r\n        SecurityError: 'NotAllowedError'\r\n      }[e.name] || e.name,\r\n      message: {\r\n        'The operation is insecure.': 'The request is not allowed by the ' +\r\n        'user agent or the platform in the current context.'\r\n      }[e.message] || e.message,\r\n      constraint: e.constraint,\r\n      toString: function() {\r\n        return this.name + (this.message && ': ') + this.message;\r\n      }\r\n    };\r\n  };\r\n\r\n  // getUserMedia constraints shim.\r\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\r\n    var constraintsToFF37_ = function(c) {\r\n      if (typeof c !== 'object' || c.require) {\r\n        return c;\r\n      }\r\n      var require = [];\r\n      Object.keys(c).forEach(function(key) {\r\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\r\n          return;\r\n        }\r\n        var r = c[key] = (typeof c[key] === 'object') ?\r\n            c[key] : {ideal: c[key]};\r\n        if (r.min !== undefined ||\r\n            r.max !== undefined || r.exact !== undefined) {\r\n          require.push(key);\r\n        }\r\n        if (r.exact !== undefined) {\r\n          if (typeof r.exact === 'number') {\r\n            r. min = r.max = r.exact;\r\n          } else {\r\n            c[key] = r.exact;\r\n          }\r\n          delete r.exact;\r\n        }\r\n        if (r.ideal !== undefined) {\r\n          c.advanced = c.advanced || [];\r\n          var oc = {};\r\n          if (typeof r.ideal === 'number') {\r\n            oc[key] = {min: r.ideal, max: r.ideal};\r\n          } else {\r\n            oc[key] = r.ideal;\r\n          }\r\n          c.advanced.push(oc);\r\n          delete r.ideal;\r\n          if (!Object.keys(r).length) {\r\n            delete c[key];\r\n          }\r\n        }\r\n      });\r\n      if (require.length) {\r\n        c.require = require;\r\n      }\r\n      return c;\r\n    };\r\n    constraints = JSON.parse(JSON.stringify(constraints));\r\n    if (browserDetails.version < 38) {\r\n      logging('spec: ' + JSON.stringify(constraints));\r\n      if (constraints.audio) {\r\n        constraints.audio = constraintsToFF37_(constraints.audio);\r\n      }\r\n      if (constraints.video) {\r\n        constraints.video = constraintsToFF37_(constraints.video);\r\n      }\r\n      logging('ff37: ' + JSON.stringify(constraints));\r\n    }\r\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\r\n      onError(shimError_(e));\r\n    });\r\n  };\r\n\r\n  // Returns the result of getUserMedia as a Promise.\r\n  var getUserMediaPromise_ = function(constraints) {\r\n    return new Promise(function(resolve, reject) {\r\n      getUserMedia_(constraints, resolve, reject);\r\n    });\r\n  };\r\n\r\n  // Shim for mediaDevices on older versions.\r\n  if (!navigator.mediaDevices) {\r\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\r\n      addEventListener: function() { },\r\n      removeEventListener: function() { }\r\n    };\r\n  }\r\n  navigator.mediaDevices.enumerateDevices =\r\n      navigator.mediaDevices.enumerateDevices || function() {\r\n        return new Promise(function(resolve) {\r\n          var infos = [\r\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\r\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\r\n          ];\r\n          resolve(infos);\r\n        });\r\n      };\r\n\r\n  if (browserDetails.version < 41) {\r\n    // Work around http://bugzil.la/1169665\r\n    var orgEnumerateDevices =\r\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\r\n    navigator.mediaDevices.enumerateDevices = function() {\r\n      return orgEnumerateDevices().then(undefined, function(e) {\r\n        if (e.name === 'NotFoundError') {\r\n          return [];\r\n        }\r\n        throw e;\r\n      });\r\n    };\r\n  }\r\n  if (browserDetails.version < 49) {\r\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\r\n        bind(navigator.mediaDevices);\r\n    navigator.mediaDevices.getUserMedia = function(c) {\r\n      return origGetUserMedia(c).then(function(stream) {\r\n        // Work around https://bugzil.la/802326\r\n        if (c.audio && !stream.getAudioTracks().length ||\r\n            c.video && !stream.getVideoTracks().length) {\r\n          stream.getTracks().forEach(function(track) {\r\n            track.stop();\r\n          });\r\n          throw new DOMException('The object can not be found here.',\r\n                                 'NotFoundError');\r\n        }\r\n        return stream;\r\n      }, function(e) {\r\n        return Promise.reject(shimError_(e));\r\n      });\r\n    };\r\n  }\r\n  if (!(browserDetails.version > 55 &&\r\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\r\n    var remap = function(obj, a, b) {\r\n      if (a in obj && !(b in obj)) {\r\n        obj[b] = obj[a];\r\n        delete obj[a];\r\n      }\r\n    };\r\n\r\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\r\n        bind(navigator.mediaDevices);\r\n    navigator.mediaDevices.getUserMedia = function(c) {\r\n      if (typeof c === 'object' && typeof c.audio === 'object') {\r\n        c = JSON.parse(JSON.stringify(c));\r\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\r\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\r\n      }\r\n      return nativeGetUserMedia(c);\r\n    };\r\n\r\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\r\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\r\n      MediaStreamTrack.prototype.getSettings = function() {\r\n        var obj = nativeGetSettings.apply(this, arguments);\r\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\r\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\r\n        return obj;\r\n      };\r\n    }\r\n\r\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\r\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\r\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\r\n        if (this.kind === 'audio' && typeof c === 'object') {\r\n          c = JSON.parse(JSON.stringify(c));\r\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\r\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\r\n        }\r\n        return nativeApplyConstraints.apply(this, [c]);\r\n      };\r\n    }\r\n  }\r\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\r\n    if (browserDetails.version < 44) {\r\n      return getUserMedia_(constraints, onSuccess, onError);\r\n    }\r\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\r\n    console.warn('navigator.getUserMedia has been replaced by ' +\r\n                 'navigator.mediaDevices.getUserMedia');\r\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\r\n  };\r\n};\r\n\r\n},{\"../utils\":12}],11:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n'use strict';\r\nvar utils = require('../utils');\r\n\r\nvar safariShim = {\r\n  // TODO: DrAlex, should be here, double check against LayoutTests\r\n\r\n  // TODO: once the back-end for the mac port is done, add.\r\n  // TODO: check for webkitGTK+\r\n  // shimPeerConnection: function() { },\r\n\r\n  shimLocalStreamsAPI: function(window) {\r\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\r\n      return;\r\n    }\r\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\r\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\r\n        if (!this._localStreams) {\r\n          this._localStreams = [];\r\n        }\r\n        return this._localStreams;\r\n      };\r\n    }\r\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\r\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\r\n        var result = null;\r\n        if (this._localStreams) {\r\n          this._localStreams.forEach(function(stream) {\r\n            if (stream.id === id) {\r\n              result = stream;\r\n            }\r\n          });\r\n        }\r\n        if (this._remoteStreams) {\r\n          this._remoteStreams.forEach(function(stream) {\r\n            if (stream.id === id) {\r\n              result = stream;\r\n            }\r\n          });\r\n        }\r\n        return result;\r\n      };\r\n    }\r\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\r\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\r\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\r\n        if (!this._localStreams) {\r\n          this._localStreams = [];\r\n        }\r\n        if (this._localStreams.indexOf(stream) === -1) {\r\n          this._localStreams.push(stream);\r\n        }\r\n        var self = this;\r\n        stream.getTracks().forEach(function(track) {\r\n          _addTrack.call(self, track, stream);\r\n        });\r\n      };\r\n\r\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\r\n        if (stream) {\r\n          if (!this._localStreams) {\r\n            this._localStreams = [stream];\r\n          } else if (this._localStreams.indexOf(stream) === -1) {\r\n            this._localStreams.push(stream);\r\n          }\r\n        }\r\n        _addTrack.call(this, track, stream);\r\n      };\r\n    }\r\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\r\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\r\n        if (!this._localStreams) {\r\n          this._localStreams = [];\r\n        }\r\n        var index = this._localStreams.indexOf(stream);\r\n        if (index === -1) {\r\n          return;\r\n        }\r\n        this._localStreams.splice(index, 1);\r\n        var self = this;\r\n        var tracks = stream.getTracks();\r\n        this.getSenders().forEach(function(sender) {\r\n          if (tracks.indexOf(sender.track) !== -1) {\r\n            self.removeTrack(sender);\r\n          }\r\n        });\r\n      };\r\n    }\r\n  },\r\n  shimRemoteStreamsAPI: function(window) {\r\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\r\n      return;\r\n    }\r\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\r\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\r\n        return this._remoteStreams ? this._remoteStreams : [];\r\n      };\r\n    }\r\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\r\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\r\n        get: function() {\r\n          return this._onaddstream;\r\n        },\r\n        set: function(f) {\r\n          if (this._onaddstream) {\r\n            this.removeEventListener('addstream', this._onaddstream);\r\n            this.removeEventListener('track', this._onaddstreampoly);\r\n          }\r\n          this.addEventListener('addstream', this._onaddstream = f);\r\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\r\n            var stream = e.streams[0];\r\n            if (!this._remoteStreams) {\r\n              this._remoteStreams = [];\r\n            }\r\n            if (this._remoteStreams.indexOf(stream) >= 0) {\r\n              return;\r\n            }\r\n            this._remoteStreams.push(stream);\r\n            var event = new Event('addstream');\r\n            event.stream = e.streams[0];\r\n            this.dispatchEvent(event);\r\n          }.bind(this));\r\n        }\r\n      });\r\n    }\r\n  },\r\n  shimCallbacksAPI: function(window) {\r\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\r\n      return;\r\n    }\r\n    var prototype = window.RTCPeerConnection.prototype;\r\n    var createOffer = prototype.createOffer;\r\n    var createAnswer = prototype.createAnswer;\r\n    var setLocalDescription = prototype.setLocalDescription;\r\n    var setRemoteDescription = prototype.setRemoteDescription;\r\n    var addIceCandidate = prototype.addIceCandidate;\r\n\r\n    prototype.createOffer = function(successCallback, failureCallback) {\r\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\r\n      var promise = createOffer.apply(this, [options]);\r\n      if (!failureCallback) {\r\n        return promise;\r\n      }\r\n      promise.then(successCallback, failureCallback);\r\n      return Promise.resolve();\r\n    };\r\n\r\n    prototype.createAnswer = function(successCallback, failureCallback) {\r\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\r\n      var promise = createAnswer.apply(this, [options]);\r\n      if (!failureCallback) {\r\n        return promise;\r\n      }\r\n      promise.then(successCallback, failureCallback);\r\n      return Promise.resolve();\r\n    };\r\n\r\n    var withCallback = function(description, successCallback, failureCallback) {\r\n      var promise = setLocalDescription.apply(this, [description]);\r\n      if (!failureCallback) {\r\n        return promise;\r\n      }\r\n      promise.then(successCallback, failureCallback);\r\n      return Promise.resolve();\r\n    };\r\n    prototype.setLocalDescription = withCallback;\r\n\r\n    withCallback = function(description, successCallback, failureCallback) {\r\n      var promise = setRemoteDescription.apply(this, [description]);\r\n      if (!failureCallback) {\r\n        return promise;\r\n      }\r\n      promise.then(successCallback, failureCallback);\r\n      return Promise.resolve();\r\n    };\r\n    prototype.setRemoteDescription = withCallback;\r\n\r\n    withCallback = function(candidate, successCallback, failureCallback) {\r\n      var promise = addIceCandidate.apply(this, [candidate]);\r\n      if (!failureCallback) {\r\n        return promise;\r\n      }\r\n      promise.then(successCallback, failureCallback);\r\n      return Promise.resolve();\r\n    };\r\n    prototype.addIceCandidate = withCallback;\r\n  },\r\n  shimGetUserMedia: function(window) {\r\n    var navigator = window && window.navigator;\r\n\r\n    if (!navigator.getUserMedia) {\r\n      if (navigator.webkitGetUserMedia) {\r\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\r\n      } else if (navigator.mediaDevices &&\r\n          navigator.mediaDevices.getUserMedia) {\r\n        navigator.getUserMedia = function(constraints, cb, errcb) {\r\n          navigator.mediaDevices.getUserMedia(constraints)\r\n          .then(cb, errcb);\r\n        }.bind(navigator);\r\n      }\r\n    }\r\n  },\r\n  shimRTCIceServerUrls: function(window) {\r\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\r\n    var OrigPeerConnection = window.RTCPeerConnection;\r\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\r\n      if (pcConfig && pcConfig.iceServers) {\r\n        var newIceServers = [];\r\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\r\n          var server = pcConfig.iceServers[i];\r\n          if (!server.hasOwnProperty('urls') &&\r\n              server.hasOwnProperty('url')) {\r\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\r\n            server = JSON.parse(JSON.stringify(server));\r\n            server.urls = server.url;\r\n            delete server.url;\r\n            newIceServers.push(server);\r\n          } else {\r\n            newIceServers.push(pcConfig.iceServers[i]);\r\n          }\r\n        }\r\n        pcConfig.iceServers = newIceServers;\r\n      }\r\n      return new OrigPeerConnection(pcConfig, pcConstraints);\r\n    };\r\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\r\n    // wrap static methods. Currently just generateCertificate.\r\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\r\n      get: function() {\r\n        return OrigPeerConnection.generateCertificate;\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\n// Expose public methods.\r\nmodule.exports = {\r\n  shimCallbacksAPI: safariShim.shimCallbacksAPI,\r\n  shimLocalStreamsAPI: safariShim.shimLocalStreamsAPI,\r\n  shimRemoteStreamsAPI: safariShim.shimRemoteStreamsAPI,\r\n  shimGetUserMedia: safariShim.shimGetUserMedia,\r\n  shimRTCIceServerUrls: safariShim.shimRTCIceServerUrls\r\n  // TODO\r\n  // shimPeerConnection: safariShim.shimPeerConnection\r\n};\r\n\r\n},{\"../utils\":12}],12:[function(require,module,exports){\r\n/*\r\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\r\n *\r\n *  Use of this source code is governed by a BSD-style license\r\n *  that can be found in the LICENSE file in the root of the source\r\n *  tree.\r\n */\r\n /* eslint-env node */\r\n'use strict';\r\n\r\nvar logDisabled_ = true;\r\nvar deprecationWarnings_ = true;\r\n\r\n// Utility methods.\r\nvar utils = {\r\n  disableLog: function(bool) {\r\n    if (typeof bool !== 'boolean') {\r\n      return new Error('Argument type: ' + typeof bool +\r\n          '. Please use a boolean.');\r\n    }\r\n    logDisabled_ = bool;\r\n    return (bool) ? 'adapter.js logging disabled' :\r\n        'adapter.js logging enabled';\r\n  },\r\n\r\n  /**\r\n   * Disable or enable deprecation warnings\r\n   * @param {!boolean} bool set to true to disable warnings.\r\n   */\r\n  disableWarnings: function(bool) {\r\n    if (typeof bool !== 'boolean') {\r\n      return new Error('Argument type: ' + typeof bool +\r\n          '. Please use a boolean.');\r\n    }\r\n    deprecationWarnings_ = !bool;\r\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\r\n  },\r\n\r\n  log: function() {\r\n    if (typeof window === 'object') {\r\n      if (logDisabled_) {\r\n        return;\r\n      }\r\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\r\n        console.log.apply(console, arguments);\r\n      }\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\r\n   */\r\n  deprecated: function(oldMethod, newMethod) {\r\n    if (!deprecationWarnings_) {\r\n      return;\r\n    }\r\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\r\n        ' instead.');\r\n  },\r\n\r\n  /**\r\n   * Extract browser version out of the provided user agent string.\r\n   *\r\n   * @param {!string} uastring userAgent string.\r\n   * @param {!string} expr Regular expression used as match criteria.\r\n   * @param {!number} pos position in the version string to be returned.\r\n   * @return {!number} browser version.\r\n   */\r\n  extractVersion: function(uastring, expr, pos) {\r\n    var match = uastring.match(expr);\r\n    return match && match.length >= pos && parseInt(match[pos], 10);\r\n  },\r\n\r\n  /**\r\n   * Browser detector.\r\n   *\r\n   * @return {object} result containing browser and version\r\n   *     properties.\r\n   */\r\n  detectBrowser: function(window) {\r\n    var navigator = window && window.navigator;\r\n\r\n    // Returned result object.\r\n    var result = {};\r\n    result.browser = null;\r\n    result.version = null;\r\n\r\n    // Fail early if it's not a browser\r\n    if (typeof window === 'undefined' || !window.navigator) {\r\n      result.browser = 'Not a browser.';\r\n      return result;\r\n    }\r\n\r\n    // Firefox.\r\n    if (navigator.mozGetUserMedia) {\r\n      result.browser = 'firefox';\r\n      result.version = this.extractVersion(navigator.userAgent,\r\n          /Firefox\\/(\\d+)\\./, 1);\r\n    } else if (navigator.webkitGetUserMedia) {\r\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\r\n      if (window.webkitRTCPeerConnection) {\r\n        result.browser = 'chrome';\r\n        result.version = this.extractVersion(navigator.userAgent,\r\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\r\n      } else { // Safari (in an unpublished version) or unknown webkit-based.\r\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\r\n          result.browser = 'safari';\r\n          result.version = this.extractVersion(navigator.userAgent,\r\n            /AppleWebKit\\/(\\d+)\\./, 1);\r\n        } else { // unknown webkit-based browser.\r\n          result.browser = 'Unsupported webkit-based browser ' +\r\n              'with GUM support but no WebRTC support.';\r\n          return result;\r\n        }\r\n      }\r\n    } else if (navigator.mediaDevices &&\r\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\r\n      result.browser = 'edge';\r\n      result.version = this.extractVersion(navigator.userAgent,\r\n          /Edge\\/(\\d+).(\\d+)$/, 2);\r\n    } else if (navigator.mediaDevices &&\r\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\r\n        // Safari, with webkitGetUserMedia removed.\r\n      result.browser = 'safari';\r\n      result.version = this.extractVersion(navigator.userAgent,\r\n          /AppleWebKit\\/(\\d+)\\./, 1);\r\n    } else { // Default fallthrough: not supported.\r\n      result.browser = 'Not a supported browser.';\r\n      return result;\r\n    }\r\n\r\n    return result;\r\n  },\r\n\r\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\r\n\r\n  shimCreateObjectURL: function(window) {\r\n    var URL = window && window.URL;\r\n\r\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\r\n          'srcObject' in window.HTMLMediaElement.prototype)) {\r\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\r\n      return undefined;\r\n    }\r\n\r\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\r\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\r\n    var streams = new Map(), newId = 0;\r\n\r\n    URL.createObjectURL = function(stream) {\r\n      if ('getTracks' in stream) {\r\n        var url = 'polyblob:' + (++newId);\r\n        streams.set(url, stream);\r\n        utils.deprecated('URL.createObjectURL(stream)',\r\n            'elem.srcObject = stream');\r\n        return url;\r\n      }\r\n      return nativeCreateObjectURL(stream);\r\n    };\r\n    URL.revokeObjectURL = function(url) {\r\n      nativeRevokeObjectURL(url);\r\n      streams.delete(url);\r\n    };\r\n\r\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\r\n                                              'src');\r\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\r\n      get: function() {\r\n        return dsc.get.apply(this);\r\n      },\r\n      set: function(url) {\r\n        this.srcObject = streams.get(url) || null;\r\n        return dsc.set.apply(this, [url]);\r\n      }\r\n    });\r\n\r\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\r\n    window.HTMLMediaElement.prototype.setAttribute = function() {\r\n      if (arguments.length === 2 &&\r\n          ('' + arguments[0]).toLowerCase() === 'src') {\r\n        this.srcObject = streams.get(arguments[1]) || null;\r\n      }\r\n      return nativeSetAttribute.apply(this, arguments);\r\n    };\r\n  }\r\n};\r\n\r\n// Export.\r\nmodule.exports = {\r\n  log: utils.log,\r\n  deprecated: utils.deprecated,\r\n  disableLog: utils.disableLog,\r\n  disableWarnings: utils.disableWarnings,\r\n  extractVersion: utils.extractVersion,\r\n  shimCreateObjectURL: utils.shimCreateObjectURL,\r\n  detectBrowser: utils.detectBrowser.bind(utils)\r\n};\r\n\r\n},{}]},{},[2])(2)\r\n});\r\n// Last time updated at Oct 24, 2015, 08:32:23\r\n\r\n// Latest file can be found here: https://cdn.webrtc-experiment.com/getScreenId.js\r\n\r\n// Muaz Khan         - www.MuazKhan.com\r\n// MIT License       - www.WebRTC-Experiment.com/licence\r\n// Documentation     - https://github.com/muaz-khan/getScreenId.\r\n\r\n// ______________\r\n// getScreenId.js\r\n\r\n/*\r\ngetScreenId(function (error, sourceId, screen_constraints) {\r\n    // error    == null || 'permission-denied' || 'not-installed' || 'installed-disabled' || 'not-chrome'\r\n    // sourceId == null || 'string' || 'firefox'\r\n\r\n    if(sourceId == 'firefox') {\r\n        navigator.mozGetUserMedia(screen_constraints, onSuccess, onFailure);\r\n    }\r\n    else navigator.webkitGetUserMedia(screen_constraints, onSuccess, onFailure);\r\n});\r\n*/\r\n\r\n(function() {\r\n    window.getScreenId = function(callback) {\r\n        // for Firefox:\r\n        // sourceId == 'firefox'\r\n        // screen_constraints = {...}\r\n        if (!!navigator.mozGetUserMedia) {\r\n            callback(null, 'firefox', {\r\n                video: {\r\n                    mozMediaSource: 'window',\r\n                    mediaSource: 'window'\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        postMessage();\r\n\r\n        window.addEventListener('message', onIFrameCallback);\r\n\r\n        function onIFrameCallback(event) {\r\n            if (!event.data) return;\r\n\r\n            if (event.data.chromeMediaSourceId) {\r\n                if (event.data.chromeMediaSourceId === 'PermissionDeniedError') {\r\n                    callback('permission-denied');\r\n                } else callback(null, event.data.chromeMediaSourceId, getScreenConstraints(null, event.data.chromeMediaSourceId));\r\n            }\r\n\r\n            if (event.data.chromeExtensionStatus) {\r\n                callback(event.data.chromeExtensionStatus, null, getScreenConstraints(event.data.chromeExtensionStatus));\r\n            }\r\n\r\n            // this event listener is no more needed\r\n            window.removeEventListener('message', onIFrameCallback);\r\n        }\r\n    };\r\n\r\n    function getScreenConstraints(error, sourceId) {\r\n        var screen_constraints = {\r\n            audio: false,\r\n            video: {\r\n                mandatory: {\r\n                    chromeMediaSource: error ? 'screen' : 'desktop',\r\n                    maxWidth: window.screen.width > 1920 ? window.screen.width : 1920,\r\n                    maxHeight: window.screen.height > 1080 ? window.screen.height : 1080\r\n                },\r\n                optional: []\r\n            }\r\n        };\r\n\r\n        if (sourceId) {\r\n            screen_constraints.video.mandatory.chromeMediaSourceId = sourceId;\r\n        }\r\n\r\n        return screen_constraints;\r\n    }\r\n\r\n    function postMessage() {\r\n        if (!iframe) {\r\n            loadIFrame(postMessage);\r\n            return;\r\n        }\r\n\r\n        if (!iframe.isLoaded) {\r\n            setTimeout(postMessage, 100);\r\n            return;\r\n        }\r\n\r\n        iframe.contentWindow.postMessage({\r\n            captureSourceId: true\r\n        }, '*');\r\n    }\r\n\r\n    function loadIFrame(loadCallback) {\r\n        if (iframe) {\r\n            loadCallback();\r\n            return;\r\n        }\r\n\r\n        iframe = document.createElement('iframe');\r\n        iframe.onload = function() {\r\n            iframe.isLoaded = true;\r\n\r\n            loadCallback();\r\n        };\r\n        iframe.src = 'https://www.webrtc-experiment.com/getSourceId/'; // https://wwww.yourdomain.com/getScreenId.html\r\n        iframe.style.display = 'none';\r\n        (document.body || document.documentElement).appendChild(iframe);\r\n    }\r\n\r\n    var iframe;\r\n\r\n    // this function is used in v3.0\r\n    window.getScreenConstraints = function(callback) {\r\n        loadIFrame(function() {\r\n            getScreenId(function(error, sourceId, screen_constraints) {\r\n                callback(error, screen_constraints.video);\r\n            });\r\n        });\r\n    };\r\n})();\r\n\r\n(function() {\r\n    if(document.domain.indexOf('webrtc-experiment.com') === -1) {\r\n        return;\r\n    }\r\n\r\n    window.getScreenId = function(callback) {\r\n        // for Firefox:\r\n        // sourceId == 'firefox'\r\n        // screen_constraints = {...}\r\n        if (!!navigator.mozGetUserMedia) {\r\n            callback(null, 'firefox', {\r\n                video: {\r\n                    mozMediaSource: 'window',\r\n                    mediaSource: 'window'\r\n                }\r\n            });\r\n            return;\r\n        }\r\n\r\n        postMessage();\r\n\r\n        window.addEventListener('message', onIFrameCallback);\r\n\r\n        function onIFrameCallback(event) {\r\n            if (!event.data) return;\r\n\r\n            if (event.data.chromeMediaSourceId) {\r\n                if (event.data.chromeMediaSourceId === 'PermissionDeniedError') {\r\n                    callback('permission-denied');\r\n                } else callback(null, event.data.chromeMediaSourceId, getScreenConstraints(null, event.data.chromeMediaSourceId));\r\n            }\r\n\r\n            if (event.data.chromeExtensionStatus) {\r\n                callback(event.data.chromeExtensionStatus, null, getScreenConstraints(event.data.chromeExtensionStatus));\r\n            }\r\n\r\n            // this event listener is no more needed\r\n            window.removeEventListener('message', onIFrameCallback);\r\n        }\r\n    };\r\n\r\n    function getScreenConstraints(error, sourceId) {\r\n        var screen_constraints = {\r\n            audio: false,\r\n            video: {\r\n                mandatory: {\r\n                    chromeMediaSource: error ? 'screen' : 'desktop',\r\n                    maxWidth: window.screen.width > 1920 ? window.screen.width : 1920,\r\n                    maxHeight: window.screen.height > 1080 ? window.screen.height : 1080\r\n                },\r\n                optional: []\r\n            }\r\n        };\r\n\r\n        if (sourceId) {\r\n            screen_constraints.video.mandatory.chromeMediaSourceId = sourceId;\r\n        }\r\n\r\n        return screen_constraints;\r\n    }\r\n\r\n    function postMessage() {\r\n        if (!iframe) {\r\n            loadIFrame(postMessage);\r\n            return;\r\n        }\r\n\r\n        if (!iframe.isLoaded) {\r\n            setTimeout(postMessage, 100);\r\n            return;\r\n        }\r\n\r\n        iframe.contentWindow.postMessage({\r\n            captureSourceId: true\r\n        }, '*');\r\n    }\r\n\r\n    function loadIFrame(loadCallback) {\r\n        if (iframe) {\r\n            loadCallback();\r\n            return;\r\n        }\r\n\r\n        iframe = document.createElement('iframe');\r\n        iframe.onload = function() {\r\n            iframe.isLoaded = true;\r\n\r\n            loadCallback();\r\n        };\r\n        iframe.src = 'https://www.webrtc-experiment.com/getSourceId/'; // https://wwww.yourdomain.com/getScreenId.html\r\n        iframe.style.display = 'none';\r\n        (document.body || document.documentElement).appendChild(iframe);\r\n    }\r\n\r\n    var iframe;\r\n\r\n    // this function is used in v3.0\r\n    window.getScreenConstraints = function(callback) {\r\n        loadIFrame(function() {\r\n            getScreenId(function(error, sourceId, screen_constraints) {\r\n                callback(error, screen_constraints.video);\r\n            });\r\n        });\r\n    };\r\n})();\r\n\r\n/*\n * JavaScript MD5 1.0.1\n * https://github.com/blueimp/JavaScript-MD5\n *\n * Copyright 2011, Sebastian Tschan\n * https://blueimp.net\n *\n * Licensed under the MIT license:\n * http://www.opensource.org/licenses/MIT\n *\n * Based on\n * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Digest Algorithm, as defined in RFC 1321.\n * Version 2.2 Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for more info.\n */\n!function(a){\"use strict\";function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c=\"\";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d=\"0123456789abcdef\",e=\"\";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}\"function\"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this);\r\n/*\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2014 Chris Wilson\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n*/\r\n\r\n/*\r\n\r\nUsage:\r\naudioNode = createAudioMeter(audioContext,clipLevel,averaging,clipLag);\r\n\r\naudioContext: the AudioContext you're using.\r\nclipLevel: the level (0 to 1) that you would consider \"clipping\".\r\n   Defaults to 0.98.\r\naveraging: how \"smoothed\" you would like the meter to be over time.\r\n   Should be between 0 and less than 1.  Defaults to 0.95.\r\nclipLag: how long you would like the \"clipping\" indicator to show\r\n   after clipping has occured, in milliseconds.  Defaults to 750ms.\r\n\r\nAccess the clipping through node.checkClipping(); use node.shutdown to get rid of it.\r\n*/\r\n\r\nfunction createAudioMeter(audioContext,clipLevel,averaging,clipLag) {\r\n\tvar processor = audioContext.createScriptProcessor(512);\r\n\tprocessor.onaudioprocess = volumeAudioProcess;\r\n\tprocessor.clipping = false;\r\n\tprocessor.lastClip = 0;\r\n\tprocessor.volume = 0;\r\n\tprocessor.clipLevel = clipLevel || 0.98;\r\n\tprocessor.averaging = averaging || 0.95;\r\n\tprocessor.clipLag = clipLag || 750;\r\n\r\n\t// this will have no effect, since we don't copy the input to the output,\r\n\t// but works around a current Chrome bug.\r\n\tprocessor.connect(audioContext.destination);\r\n\r\n\tprocessor.checkClipping =\r\n\t\tfunction(){\r\n\t\t\tif (!this.clipping)\r\n\t\t\t\treturn false;\r\n\t\t\tif ((this.lastClip + this.clipLag) < window.performance.now())\r\n\t\t\t\tthis.clipping = false;\r\n\t\t\treturn this.clipping;\r\n\t\t};\r\n\r\n\tprocessor.shutdown =\r\n\t\tfunction(){\r\n\t\t\tthis.disconnect();\r\n\t\t\tthis.onaudioprocess = null;\r\n\t\t};\r\n\r\n\treturn processor;\r\n}\r\n\r\nfunction volumeAudioProcess( event ) {\r\n\tvar buf = event.inputBuffer.getChannelData(0);\r\n    var bufLength = buf.length;\r\n\tvar sum = 0;\r\n    var x;\r\n\r\n\t// Do a root-mean-square on the samples: sum up the squares...\r\n    for (var i=0; i<bufLength; i++) {\r\n    \tx = buf[i];\r\n    \tif (Math.abs(x)>=this.clipLevel) {\r\n    \t\tthis.clipping = true;\r\n    \t\tthis.lastClip = window.performance.now();\r\n    \t}\r\n    \tsum += x * x;\r\n    }\r\n\r\n    // ... then take the square root of the sum.\r\n    var rms =  Math.sqrt(sum / bufLength);\r\n\r\n    // Now smooth this out with the averaging factor applied\r\n    // to the previous sample - take the max here because we\r\n    // want \"fast attack, slow release.\"\r\n    this.volume = Math.max(rms, this.volume*this.averaging);\r\n}\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  var vertoApp = angular.module('vertoApp', [\r\n    'timer',\r\n    'ngRoute',\r\n    'vertoControllers',\r\n    'vertoDirectives',\r\n    'vertoFilters',\r\n    'ngStorage',\r\n    'ngAnimate',\r\n    'ngSanitize',\r\n    'toastr',\r\n    'FBAngular',\r\n    'cgPrompt',\r\n    '720kb.tooltips',\r\n    'ui.gravatar',\r\n    'ui.bootstrap',\r\n    'directive.g+signin',\r\n    'pascalprecht.translate',\r\n    'angular-click-outside',\r\n  ]);\r\n\r\n  vertoApp.constant('configLanguages', {\r\n    'languages' : [\r\n         {id: 'en', name: 'English'},\r\n         {id: 'it', name: 'Italiano'},\r\n         {id: 'fr', name: 'Franais'},\r\n         {id: 'de', name: 'Deutsch'},\r\n         {id: 'pt', name: 'Portugus'},\r\n         {id: 'pl', name: 'Polski'},\r\n         {id: 'zh', name: ''},\r\n         {id: 'ru', name: 'P'},\r\n         {id: 'sv', name: 'Svenska'},\r\n         {id: 'da', name: 'Dansk'},\r\n         {id: 'es', name: 'Espaol'},\r\n         {id: 'id', name: 'Indonesia'}\r\n    ],\r\n\r\n    'dialects' : {\r\n        'en': 'en',\r\n        'en_GB': 'en',\r\n        'en_US': 'en',\r\n        'it': 'it',\r\n        'it_IT': 'it',\r\n        'fr': 'fr',\r\n        'fr_FR': 'fr',\r\n        'fr_CA': 'fr',\r\n        'pt': 'pt',\r\n        'pt_BR': 'pt',\r\n        'pt_PT': 'pt',\r\n        'de': 'de',\r\n        'de_DE': 'de',\r\n        'es': 'es',\r\n        'es_ES': 'es',\r\n        'pl': 'pl',\r\n        'pl_PL': 'pl',\r\n        'ru': 'ru',\r\n        'ru_RU': 'ru',\r\n        'sv': 'sv',\r\n        'sv_SV': 'sv',\r\n        'sv_FI': 'sv',\r\n        'da': 'da',\r\n        'da_DK': 'da',\r\n        'id': 'id',\r\n        'id_ID': 'id',\r\n        'zh': 'zh',\r\n        'zh_CN': 'zh',\r\n        'zh_TW': 'zh',\r\n        'zh_HK': 'zh'\r\n    }\r\n  });\r\n\r\n  vertoApp.config(['$routeProvider', 'gravatarServiceProvider', '$translateProvider', 'configLanguages',\r\n    function($routeProvider, gravatarServiceProvider, $translateProvider, configLanguages) {\r\n      $routeProvider.\r\n      when('/', {\r\n        title: 'Loading',\r\n        templateUrl: 'partials/splash_screen.html',\r\n        controller: 'SplashScreenController'\r\n      }).\r\n      when('/login', {\r\n        title: 'Login',\r\n        templateUrl: 'partials/login.html',\r\n        controller: 'LoginController'\r\n      }).\r\n      when('/dialpad', {\r\n        title: 'Dialpad',\r\n        templateUrl: 'partials/dialpad.html',\r\n        controller: 'DialPadController'\r\n      }).\r\n      when('/incall', {\r\n          title: 'In a Call',\r\n          templateUrl: 'partials/incall.html',\r\n          controller: 'InCallController'\r\n        }).\r\n      when('/loading', {\r\n        title: 'Loading Verto Communicator',\r\n        templateUrl: 'partials/loading.html',\r\n        controller: 'LoadingController'\r\n      }).\r\n      when('/preview', {\r\n        title: 'Preview Video',\r\n        templateUrl: 'partials/preview.html',\r\n        controller: 'PreviewController'\r\n      }).\r\n      when('/browser-upgrade', {\r\n        title: '',\r\n        templateUrl: 'partials/browser_upgrade.html',\r\n        controller: 'BrowserUpgradeController'\r\n      }).\r\n      otherwise({\r\n        redirectTo: '/'\r\n      });\r\n\r\n      gravatarServiceProvider.defaults = {\r\n        default: 'mm'  // Mystery man as default for missing avatars\r\n      };\r\n\r\n      var reg_langs = [];\r\n      angular.forEach(configLanguages.languages, function(value, key) {\r\n        reg_langs.push(value.id);\r\n      });\r\n\r\n      $translateProvider\r\n      .useStaticFilesLoader({\r\n        prefix: 'locales/locale-',\r\n        suffix: '.json'\r\n      })\r\n      .registerAvailableLanguageKeys(reg_langs, configLanguages.dialects)\r\n      .preferredLanguage('en')\r\n      .determinePreferredLanguage()\r\n      .fallbackLanguage('en')\r\n      .useSanitizeValueStrategy(null);\r\n    }\r\n  ]);\r\n\r\n  vertoApp.run(['$rootScope', '$location', 'toastr', 'prompt', 'verto',\r\n    function($rootScope, $location, toastr, prompt, verto) {\r\n\r\n      $rootScope.$on( \"$routeChangeStart\", function(event, next, current) {\r\n        if (!verto.data.connected) {\r\n          if ( next.templateUrl === \"partials/login.html\") {\r\n            // pass\r\n          } else {\r\n            $location.path(\"/\");\r\n          }\r\n        }\r\n      });\r\n\r\n      $rootScope.$on('$routeChangeSuccess', function(event, current, previous) {\r\n        $rootScope.title = current.$$route.title;\r\n      });\r\n\r\n      $rootScope.safeProtocol = false;\r\n\r\n      if (window.location.protocol == 'https:') {\r\n        $rootScope.safeProtocol = true;\r\n      }\r\n\r\n\r\n      $rootScope.promptInput = function(title, message, label, callback) {\r\n        var ret = prompt({\r\n          title: title,\r\n          message: message,\r\n          input: true,\r\n          label: label\r\n        }).then(function(ret) {\r\n          if (angular.isFunction(callback)) {\r\n            callback(ret);\r\n          }\r\n        }, function() {\r\n\r\n        });\r\n\r\n      };\r\n\r\n    }\r\n  ]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  var vertoControllers = angular.module('vertoControllers', [\r\n    'ui.bootstrap',\r\n    'vertoService',\r\n    'storageService',\r\n    'ui.gravatar'\r\n  ]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n  .module('vertoControllers')\r\n  .controller('SplashScreenController', ['$scope', '$rootScope', '$location', '$timeout', 'storage', 'splashscreen', 'prompt', 'verto',\r\n    function($scope, $rootScope, $location, $timeout, storage, splashscreen, prompt, verto) {\r\n      console.debug('Executing SplashScreenController.');\r\n\r\n      $scope.progress_percentage = splashscreen.progress_percentage;\r\n      $scope.message = '';\r\n      $scope.interrupt_next = false;\r\n      $scope.errors = [];\r\n\r\n      var redirectTo = function(link, activity) {\r\n        if(activity) {\r\n          if(activity == 'browser-upgrade') {\r\n            link = activity;\r\n          }\r\n        }\r\n\r\n        $location.path(link);\r\n      }\r\n\r\n      var checkProgressState = function(current_progress, status, promise, activity, soft, interrupt, message) {\r\n        $scope.progress_percentage = splashscreen.calculate(current_progress);\r\n        $scope.message = message;\r\n\r\n        if(interrupt && status == 'error') {\r\n          $scope.errors.push(message);\r\n          if(!soft) {\r\n            redirectTo('', activity);\r\n            return;\r\n          } else {\r\n            message = message + '. Continue?';\r\n          };\r\n\r\n          if(!confirm(message)) {\r\n            $scope.interrupt_next = true;\r\n          };\r\n        };\r\n\r\n        if($scope.interrupt_next) {\r\n          return;\r\n        };\r\n\r\n        $scope.message = splashscreen.getProgressMessage(current_progress+1);\r\n\r\n        return true;\r\n      };\r\n\r\n      $rootScope.$on('progress.next', function(ev, current_progress, status, promise, activity, soft, interrupt, message) {\r\n        $timeout(function() {\r\n          if(promise) {\r\n            promise.then(function(response) {\r\n              message = response['message'];\r\n              status = response['status'];\r\n              if(checkProgressState(current_progress, status, promise, activity, soft, interrupt, message)) {\r\n                splashscreen.next();\r\n              };\r\n            });\r\n\r\n            return;\r\n          }\r\n\r\n          if(!checkProgressState(current_progress, status, promise, activity, soft, interrupt, message)) {\r\n            return;\r\n          }\r\n\r\n          splashscreen.next();\r\n        }, 400);\r\n      });\r\n\r\n      $rootScope.$on('progress.complete', function(ev, current_progress) {\r\n        $scope.message = 'Complete';\r\n        if(verto.data.connected) {\r\n          if (0 && storage.data.preview) {\r\n            $location.path('/preview');\r\n          }\r\n          else {\r\n            $location.path('/dialpad');\r\n          }\r\n        } else {\r\n          redirectTo('/login');\r\n          $location.path('/login');\r\n        }\r\n      });\r\n\r\n      splashscreen.next();\r\n\r\n    }]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('BrowserUpgradeController', ['$scope', '$http',\r\n      '$location', 'verto', 'storage', 'Fullscreen',\r\n      function($scope, $http, $location, verto, storage, Fullscreen) {\r\n        console.debug('Executing BrowserUpgradeController.');\r\n\r\n      }\r\n    ]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n  .module('vertoControllers')\r\n  .controller('ChatController', ['$scope', '$rootScope', '$http',\r\n    '$location', '$anchorScroll', '$timeout', 'verto', 'prompt', '$translate',\r\n    function($scope, $rootScope, $http, $location, $anchorScroll, $timeout,\r\n      verto, prompt, $translate) {\r\n      console.debug('Executing ChatController.');\r\n\r\n      function scrollToChatBottom() {\r\n        // Going to the bottom of chat messages.\r\n        var obj = document.querySelector('.chat-messages');\r\n        obj.scrollTop = obj.scrollHeight;\r\n        //var chat_messages_top = jQuery('.chat-messages').scrollTop();\r\n        //var marker_position = jQuery('#chat-message-bottom').position().top;\r\n        //jQuery('.chat-messages').scrollTop(chat_messages_top + marker_position);\r\n      }\r\n\r\n      var CLEAN_MESSAGE = '';\r\n\r\n      function clearConferenceChat() {\r\n        $scope.members = [];\r\n        $scope.messages = [];\r\n        $scope.message = CLEAN_MESSAGE;\r\n      }\r\n      clearConferenceChat();\r\n\r\n      $scope.$watch('activePane', function() {\r\n        if ($scope.activePane == 'chat') {\r\n          $rootScope.chat_counter = 0;\r\n        }\r\n        $rootScope.activePane = $scope.activePane;\r\n      });\r\n\r\n      $rootScope.$on('chat.newMessage', function(event, data) {\r\n        data.created_at = new Date();\r\n        console.log('chat.newMessage', data);\r\n        $scope.$apply(function() {\r\n          $scope.messages.push(data);\r\n          if (data.from != verto.data.name &&\r\n              (!$scope.chatStatus && $scope.activePane != 'chat')) {\r\n            ++$rootScope.chat_counter;\r\n          }\r\n          $timeout(function() {\r\n            scrollToChatBottom();\r\n          }, 300);\r\n        });\r\n      });\r\n\r\n      $rootScope.$on('call.conference', function(event, data) {\r\n        $timeout(function() {\r\n          $scope.conf = verto.data.conf.params.laData;\r\n        });\r\n      });\r\n\r\n      $rootScope.$on('changedVideoLayout', function(event, layout) {\r\n        $scope.resIDs = getResByLayout(layout);\r\n\r\n        // remove resIDs param to clear every members resID.\r\n        // passing $scope.resIDs results in preserving resIDs compatible\r\n        // with the current layout\r\n        clearMembersResID($scope.resIDs);\r\n      });\r\n\r\n      $rootScope.$on('conference.canvasInfo', function(event, data) {\r\n        $scope.currentLayout = data[0].layoutName;\r\n        $scope.resIDs = getResByLayout($scope.currentLayout);\r\n      });\r\n\r\n      function getResByLayout(layout) {\r\n        var layoutsData = verto.data.confLayoutsData;\r\n        for (var i = 0; i < layoutsData.length; i++) {\r\n          if (layoutsData[i].name === layout) {\r\n            return layoutsData[i].resIDS;\r\n          }\r\n        }\r\n      }\r\n\r\n      // @preserve - a array of values to be preserved\r\n      function clearMembersResID(preserve) {\r\n        $scope.members.forEach(function(member) {\r\n          var resID = member.status.video.reservationID;\r\n          console.debug(\"resID to clear: \" + resID);\r\n          if (resID && preserve && preserve.indexOf(resID) !== -1) return;\r\n          if (resID){\r\n            console.debug(\"clearing resid [\" + resID + \"] from [\" + member.id + \"]\");\r\n            $scope.confResID(member.id, resID);\r\n          }\r\n        });\r\n      };\r\n\r\n      function findMemberByUUID(uuid) {\r\n        var found = false;\r\n        for (var idx in $scope.members) {\r\n          var member = $scope.members[idx];\r\n          if (member.uuid == uuid) {\r\n            found = true;\r\n            break;\r\n          }\r\n        }\r\n        if (found) {\r\n          return idx;\r\n        } else {\r\n          return -1;\r\n        }\r\n      }\r\n\r\n      function translateMember(member) {\r\n        return {\r\n          'uuid': member[0],\r\n          'id': member[1][0],\r\n          'number': member[1][1],\r\n          'name': member[1][2],\r\n          'codec': member[1][3],\r\n          'status': JSON.parse(member[1][4]),\r\n          'email': member[1][5].email\r\n        };\r\n      }\r\n\r\n      function addMember(member) {\r\n        $scope.members.push(translateMember(member));\r\n      }\r\n\r\n      $rootScope.$on('hangupCall', function() {\r\n        $scope.openId = null;\r\n      });\r\n\r\n      $rootScope.$on('members.boot', function(event, members) {\r\n        $scope.$apply(function() {\r\n          clearConferenceChat();\r\n          for (var idx in members) {\r\n            var member = members[idx];\r\n            addMember(member);\r\n          }\r\n        })\r\n      });\r\n\r\n      $rootScope.$on('members.add', function(event, member) {\r\n        $scope.$apply(function() {\r\n          addMember(member);\r\n        });\r\n      });\r\n\r\n      $rootScope.$on('members.del', function(event, uuid) {\r\n        if ($rootScope.watcher && $rootScope.master === uuid) {\r\n          verto.hangup();\r\n          window.close();\r\n        }\r\n\r\n        $scope.$apply(function() {\r\n          var memberIdx = findMemberByUUID(uuid);\r\n          if (memberIdx != -1) {\r\n            // Removing the member.\r\n            $scope.members.splice(memberIdx, 1);\r\n          }\r\n        });\r\n      });\r\n\r\n      $rootScope.$on('members.update', function(event, member) {\r\n        member = translateMember(member);\r\n        var memberIdx = findMemberByUUID(member.uuid);\r\n        if (memberIdx < 0) {\r\n          console.log('Didn\\'t find the member uuid ' + member.uuid);\r\n        } else {\r\n          $scope.$apply(function() {\r\n            // console.log('Updating', memberIdx, ' <', $scope.members[memberIdx],\r\n              // '> with <', member, '>');\r\n            // Checking if it's me\r\n            if (parseInt(member.id) == parseInt(verto.data.conferenceMemberID)) {\r\n              verto.data.mutedMic = member.status.audio.muted;\r\n              verto.data.mutedVideo = member.status.video.muted;\r\n\t\t\t  verto.data.call.setMute(member.status.audio.muted ? \"off\" : \"on\");\r\n\t\t\t  verto.data.call.setVideoMute(member.status.video.muted ? \"off\" : \"on\");\r\n            }\r\n            angular.extend($scope.members[memberIdx], member);\r\n          });\r\n        }\r\n      });\r\n\r\n      $rootScope.$on('members.clear', function(event) {\r\n        $scope.$applyAsync(function() {\r\n          clearConferenceChat();\r\n          $scope.closeChat();\r\n        });\r\n      });\r\n\r\n      /**\r\n       * Public methods.\r\n       */\r\n\r\n      $scope.toggleModMenu = function(index) {\r\n        if (verto.data.confRole != 'moderator') return;\r\n        $scope.openId = $scope.openId == index ? null : index;\r\n      };\r\n\r\n      $scope.send = function(event) {\r\n        // Only conferencing chat is supported for now\r\n        // but still calling method with the conference prefix\r\n        // so we know that explicitly.\r\n        if (event && event.type == 'keydown') {\r\n          event.preventDefault();\r\n        }\r\n        verto.sendConferenceChat($scope.message);\r\n        $scope.message = CLEAN_MESSAGE;\r\n      };\r\n\r\n      // Participants moderation.\r\n      $scope.confKick = function(memberID) {\r\n        console.log('$scope.confKick');\r\n        verto.data.conf.kick(memberID);\r\n      };\r\n\r\n      $scope.confMuteMic = function(memberID) {\r\n        if(verto.data.confRole == 'moderator') {\r\n          console.log('$scope.confMuteMic');\r\n          verto.data.conf.muteMic(memberID);\r\n        }\r\n      };\r\n\r\n      $scope.confMuteVideo = function(memberID) {\r\n        if(verto.data.confRole == 'moderator') {\r\n          console.log('$scope.confMuteVideo');\r\n          verto.data.conf.muteVideo(memberID);\r\n        }\r\n      };\r\n\r\n      $scope.confPresenter = function(memberID) {\r\n        console.log('$scope.confPresenter');\r\n        verto.data.conf.presenter(memberID);\r\n      };\r\n\r\n      $scope.confResID = function(memberID, resID) {\r\n        console.log('Set', memberID, 'to', resID);\r\n        verto.setResevartionId(memberID, resID);\r\n      };\r\n\r\n      $scope.confVideoFloor = function(memberID) {\r\n        console.log('$scope.confVideoFloor');\r\n        verto.data.conf.videoFloor(memberID);\r\n      };\r\n\r\n      $scope.confBanner = function(memberID) {\r\n        console.log('$scope.confBanner');\r\n\r\n        prompt({\r\n          title: $translate.instant('TITLE_INSERT_BANNER'),\r\n          input: true,\r\n          label: '',\r\n          value: '',\r\n        }).then(function(text) {\r\n          if (text) {\r\n            verto.data.conf.banner(memberID, text);\r\n          }\r\n        });\r\n      };\r\n\r\n      $scope.confCanvasIn = function(memberID, canvasID) {\r\n        if (canvasID) {\r\n          verto.setCanvasIn(memberID, canvasID);\r\n          return;\r\n        }\r\n\r\n        shortPrompt($translate.instant('TITLE_INSERT_CANVAS_ID'), function(canvasID) {\r\n          console.log(memberID, canvasID);\r\n          verto.setCanvasIn(memberID, canvasID);\r\n        });\r\n\r\n      };\r\n\r\n      $scope.confCanvasOut = function(memberID, canvasID) {\r\n        if (canvasID) {\r\n          verto.setCanvasOut(memberID, canvasID);\r\n          return;\r\n        }\r\n\r\n        shortPrompt($translate.instant('TITLE_INSERT_CANVAS_ID'), function(canvasID) {\r\n          verto.setCanvasOut(memberID, canvasID);\r\n        });\r\n      };\r\n\r\n      $scope.confLayer = function(memberID, canvasID) {\r\n        if (canvasID) {\r\n          verto.setLayer(memberID, canvasID);\r\n          return;\r\n        }\r\n\r\n        shortPrompt($translate.instant('TITLE_INSERT_LAYER'), function(canvasID) {\r\n          verto.setLayer(memberID, canvasID);\r\n        });\r\n      };\r\n\r\n      $scope.confResetBanner = function(memberID) {\r\n        console.log('$scope.confResetBanner');\r\n        var text = 'reset';\r\n        verto.data.conf.banner(memberID, text);\r\n      };\r\n\r\n      $scope.confVolumeDown = function(memberID) {\r\n        console.log('$scope.confVolumeDown');\r\n        verto.data.conf.volumeDown(memberID);\r\n      };\r\n\r\n      $scope.confVolumeUp = function(memberID) {\r\n        console.log('$scope.confVolumeUp');\r\n        verto.data.conf.volumeUp(memberID);\r\n      };\r\n\r\n      $scope.confGainDown = function(memberID) {\r\n        console.log('$scope.confGainDown');\r\n        verto.data.conf.gainDown(memberID);\r\n      };\r\n\r\n      $scope.confGainUp = function(memberID) {\r\n        console.log('$scope.confGainUp');\r\n        verto.data.conf.gainUp(memberID);\r\n      };\r\n\r\n      $scope.confTransfer = function(memberID) {\r\n        console.log('$scope.confTransfer');\r\n        $rootScope.disableOnKeydownDtmf();\r\n        prompt({\r\n          title: $translate.instant('TITLE_TRANSFER'),\r\n          message: $translate.instant('MESSAGE_TRANSFER'),\r\n          input: true,\r\n          label: $translate.instant('LABEL_TRANSFER'),\r\n          value: '',\r\n        }).then(function(exten) {\r\n          $rootScope.enableOnKeydownDtmf();\r\n          if (exten) {\r\n            verto.data.conf.transfer(memberID, exten);\r\n          }\r\n        }).catch(function(){\r\n          $rootScope.enableOnKeydownDtmf();\r\n        });\r\n\r\n      };\r\n\r\n      $scope.confToggleDeaf = function(member) {\r\n        if(verto.data.confRole == 'moderator') {\r\n          console.log('$scope.confToggleDeaf');\r\n\r\n          if (member.status.audio.deaf) {\r\n            verto.data.conf.undeaf(member.id);\r\n          } else {\r\n            verto.data.conf.deaf(member.id);\r\n          }\r\n        }\r\n      };\r\n\r\n      function shortPrompt(text, cb) {\r\n        prompt({\r\n          title: text,\r\n          input: true,\r\n          label: '',\r\n          value: '',\r\n        }).then(function(val) {\r\n          if (val && cb) {\r\n            cb(val);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  ]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('ContributorsController', ['$scope', '$http',\r\n      'toastr',\r\n      function($scope, $http, toastr) {\r\n        var url = window.location.origin + window.location.pathname;\r\n        $http.get(url + 'contributors.txt')\r\n          .success(function(data) {\r\n\r\n            var contributors = [];\r\n\r\n            angular.forEach(data, function(value, key) {\r\n              var re = /(.*) <(.*)>/;\r\n              var name = value.replace(re, \"$1\");\r\n              var email = value.replace(re, \"$2\");\r\n\r\n              this.push({\r\n                'name': name,\r\n                'email': email\r\n              });\r\n            }, contributors);\r\n\r\n            $scope.contributors = contributors;\r\n          })\r\n          .error(function() {\r\n            toastr.error('contributors not found.');\r\n          });\r\n      }\r\n    ]);\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('AboutController', ['$scope', '$http',\r\n      'toastr',\r\n      function($scope, $http, toastr) {\r\n\t    var githash = 'dd0bb0e' || 'something is not right';\r\n            $scope.githash = githash;\r\n\r\n\t/* leave this here for later, but its not needed right now\r\n        $http.get(window.location.pathname + '/contributors.txt')\r\n          .success(function(data) {\r\n\r\n          })\r\n          .error(function() {\r\n            toastr.error('contributors not found.');\r\n          });\r\n\t */\r\n      }\r\n    ]);\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('DialPadController', ['$rootScope', '$scope',\r\n      '$http', '$location', 'toastr', 'verto', 'storage', 'CallHistory', 'eventQueue', '$timeout',\r\n      function($rootScope, $scope, $http, $location, toastr, verto, storage, CallHistory, eventQueue, $timeout) {\r\n        console.debug('Executing DialPadController.');\r\n\r\n        eventQueue.process();\r\n\r\n        if ($location.search().autocall) {\r\n            $rootScope.dialpadNumber = $location.search().autocall;\r\n            delete $location.search().autocall;\r\n            call($rootScope.dialpadNumber);\r\n            if($rootScope.watcher) {\r\n              return;\r\n            }\r\n        }\r\n\r\n        $scope.call_history = CallHistory.all();\r\n        $scope.history_control = CallHistory.all_control();\r\n        $scope.has_history = Object.keys($scope.call_history).length;\r\n        storage.data.videoCall = false;\r\n        storage.data.userStatus = 'connecting';\r\n        storage.data.calling = false;\r\n\r\n        $scope.clearCallHistory = function() {\r\n          CallHistory.clear();\r\n          $scope.call_history = CallHistory.all();\r\n          $scope.history_control = CallHistory.all_control();\r\n          $scope.has_history = Object.keys($scope.call_history).length;\r\n          return $scope.history_control;\r\n        };\r\n\r\n        $scope.viewCallsList = function(calls) {\r\n          return $scope.call_list = calls;\r\n        };\r\n\r\n        /**\r\n         * fill dialpad via querystring [?autocall=\\d+]\r\n         */\r\n\r\n\t/**\r\n\t * fill in dialpad via config.json\r\n\t */\r\n        if ('autocall' in verto.data) {\r\n          $rootScope.dialpadNumber = verto.data.autocall;\r\n\t  delete verto.data.autocall;\r\n          call($rootScope.dialpadNumber);\r\n        }\r\n\r\n        /**\r\n         * used to bind click on number in call history to fill dialpad\r\n         * 'cause inside a ng-repeat the angular isnt in ctrl scope\r\n         */\r\n        $scope.fillDialpadNumber = function(number) {\r\n          $rootScope.dialpadNumber = number;\r\n        };\r\n\r\n        $scope.preview = function() {\r\n          $location.path('/preview');\r\n        };\r\n\r\n        $rootScope.transfer = function() {\r\n          if (!$rootScope.dialpadNumber) {\r\n            return false;\r\n          }\r\n          verto.data.call.transfer($rootScope.dialpadNumber);\r\n        };\r\n\r\n        function call(extension) {\r\n          storage.data.onHold = false;\r\n          storage.data.cur_call = 0;\r\n          $rootScope.dialpadNumber = extension;\r\n          if (!$rootScope.dialpadNumber && storage.data.called_number) {\r\n            $rootScope.dialpadNumber = storage.data.called_number;\r\n            return false;\r\n          } else if (!$rootScope.dialpadNumber && !storage.data.called_number) {\r\n            toastr.warning('Enter an extension, please.');\r\n            return false;\r\n          }\r\n\r\n          if (verto.data.call) {\r\n            console.debug('A call is already in progress.');\r\n            return false;\r\n          }\r\n\r\n          if (extension.indexOf('-canvas-') != -1) {\r\n            $rootScope.watcher = true;\r\n            verto.call($rootScope.dialpadNumber, null,\r\n              {\r\n                useCamera: \"none\",\r\n                useMic: \"none\",\r\n                useSpeak: \"none\",\r\n                caller_id_name: null,\r\n                userVariables: {},\r\n                caller_id_number: null,\r\n                mirrorInput: false\r\n              }\r\n            );\r\n            $location.path('/incall');\r\n            return;\r\n          }\r\n\r\n          storage.data.mutedVideo = false;\r\n          storage.data.mutedMic = false;\r\n\r\n          storage.data.videoCall = false;\r\n          verto.call($rootScope.dialpadNumber);\r\n\r\n          storage.data.called_number = $rootScope.dialpadNumber;\r\n          CallHistory.add($rootScope.dialpadNumber, 'outbound');\r\n          $location.path('/incall');\r\n        }\r\n\r\n        /**\r\n         * Call to the number in the $rootScope.dialpadNumber.\r\n         */\r\n        $scope.loading = false;\r\n        $scope.cancelled = false;\r\n        $rootScope.call = function(extension) {\r\n          if (!storage.data.testSpeedJoin || !$rootScope.dialpadNumber) {\r\n            return call(extension);\r\n          }\r\n          $scope.loading = true;\r\n\r\n          verto.testSpeed(function() {\r\n            if ($scope.cancelled) {\r\n              $scope.cancelled = false;\r\n              $scope.loading = false;\r\n              return;\r\n            } else {\r\n              call(extension);\r\n            }\r\n          });\r\n        }\r\n\r\n        $rootScope.cancel = function() {\r\n          $scope.cancelled = true;\r\n        }\r\n      }\r\n    ]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('InCallController', ['$rootScope', '$scope',\r\n      '$http', '$location', '$modal', '$timeout', 'toastr', 'verto', 'storage', 'prompt', 'Fullscreen', '$translate',\r\n      function($rootScope, $scope, $http, $location, $modal, $timeout, toastr,\r\n        verto, storage, prompt, Fullscreen, $translate) {\r\n\r\n        console.debug('Executing InCallController.');\r\n        $scope.layout = null;\r\n        $rootScope.dialpadNumber = '';\r\n        $scope.callTemplate = 'partials/phone_call.html';\r\n        $scope.dialpadTemplate = '';\r\n        $scope.incall = true;\r\n\r\n        if (storage.data.videoCall) {\r\n          $scope.callTemplate = 'partials/video_call.html';\r\n        }\r\n\r\n        $rootScope.$on('call.conference', function(event, data) {\r\n          $timeout(function() {\r\n            if($scope.chatStatus) {\r\n              $scope.openChat();\r\n            }\r\n            buildCanvasesData();\r\n          });\r\n        });\r\n\r\n        $rootScope.$on('call.video', function(event, data) {\r\n          $timeout(function() {\r\n            $scope.callTemplate = 'partials/video_call.html';\r\n          });\r\n        });\r\n\r\n        /**\r\n         * toggle dialpad in incall page\r\n         */\r\n        $scope.toggleDialpad = function() {\r\n          $scope.openModal('partials/dialpad_widget.html',\r\n            'ModalDialpadController');\r\n\r\n          /*\r\n          if(!$scope.dialpadTemplate) {\r\n            $scope.dialpadTemplate = 'partials/dialpad_widget.html';\r\n          } else {\r\n            $scope.dialpadTemplate = '';\r\n          }\r\n          */\r\n        }\r\n\r\n        /**\r\n         * TODO: useless?\r\n         */\r\n        $scope.videoCall = function() {\r\n          prompt({\r\n            title: $translate.instant('TITLE_ENABLE_VIDEO'),\r\n            message: $translate.instant('MESSAGE_ENABLE_VIDEO')\r\n          }).then(function() {\r\n            storage.data.videoCall = true;\r\n            $scope.callTemplate = 'partials/video_call.html';\r\n          });\r\n        };\r\n\r\n        $scope.cbMuteVideo = function(event, data) {\r\n          storage.data.mutedVideo = !storage.data.mutedVideo;\r\n        }\r\n\r\n        $scope.cbMuteMic = function(event, data) {\r\n          storage.data.mutedMic = !storage.data.mutedMic;\r\n        }\r\n\r\n        $scope.confChangeVideoLayout = function(layout, canvasID) {\r\n          verto.data.conf.setVideoLayout(layout, canvasID);\r\n          $scope.videoLayout = layout;\r\n          $rootScope.$emit('changedVideoLayout', layout);\r\n        };\r\n\r\n        $scope.confChangeSpeaker = function(speakerId) {\r\n          storage.data.selectedSpeaker = speakerId;\r\n          $rootScope.$emit('changedSpeaker', speakerId);\r\n        };\r\n\r\n        $scope.confPopup = function(canvas_id) {\r\n          var video = document.getElementById('webcam');\r\n          var s = window.location.href;\r\n          var curCall = verto.data.call.callID;\r\n          var extension = verto.data.call.params.remote_caller_id_number;\r\n          var width = webcam.offsetWidth;\r\n          var height = webcam.offsetHeight + 100;\r\n          var x = (screen.width - width)/2\r\n          var y = (screen.height - height)/2\r\n\r\n          s = s.replace(/\\#.*/, '');\r\n          s += \"#/?sessid=random&master=\" + curCall + \"&watcher=true&extension=\" + extension+ \"&canvas_id=\" + canvas_id;\r\n\r\n          console.log(\"opening new window to \" + s);\r\n          var popup = window.open(s, \"canvas_window_\" + canvas_id, \"toolbar=0,location=0,menubar=0,directories=0,width=\" + width + \",height=\" + height, + ',left=' + x + ',top=' + y);\r\n          popup.moveTo(x, y);\r\n        };\r\n\r\n        $scope.screenshare = function() {\r\n          if(verto.data.shareCall) {\r\n            verto.screenshareHangup();\r\n            return false;\r\n          }\r\n          if (verto.data.conf) {\r\n            console.log('Screenshare inside conferece: ', verto.data.conf);\r\n            // Setting the destination of the screenshare call as the conference\r\n            // number we last joined\r\n            verto.screenshare(verto.data.conf.params.laData.laName);\r\n          }\r\n          else {\r\n            verto.screenshare(storage.data.called_number);\r\n          }\r\n        };\r\n\r\n        function buildCanvasesData() {\r\n          $scope.conf = verto.data.conf.params.laData;\r\n          $scope.canvases = [{ id: 1, name: 'Super Canvas' }];\r\n          for (var i = 1; i < $scope.conf.canvasCount; i++) {\r\n            $scope.canvases.push({ id: i+1, name: 'Canvas ' + (i+1) });\r\n          }\r\n        }\r\n\r\n        $scope.muteMic = verto.muteMic;\r\n        $scope.muteVideo = verto.muteVideo;\r\n\r\n        $rootScope.$on('ScreenShareExtensionStatus', function(event, error) {\r\n          var pluginUrl = 'https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk';\r\n          switch(error) {\r\n            case 'permission-denied':\r\n              toastr.info('Please allow the plugin in order to use Screen Share', 'Error'); break;\r\n            case 'not-installed':\r\n              toastr.warning('Please <a target=\"_blank\" class=\"install\" href=\"'+ pluginUrl +'\">install</a> the plugin in order to use Screen Share', 'Warning', { allowHtml: true }); break;\r\n            case 'installed-disabled':\r\n              toastr.info('Please enable the plugin in order to use Screen Share', 'Error'); break;\r\n            // case 'not-chrome'\r\n            //   toastr.info('Chrome', 'Error');\r\n          }\r\n        });\r\n\r\n        $timeout(function() {\r\n          console.log('broadcast time-start incall');\r\n          $scope.$broadcast('timer-start');\r\n        }, 1000);\r\n\r\n      }\r\n    ]);\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('LoginController', ['$scope', '$http', '$location', 'verto', \r\n      function($scope, $http, $location, verto) {\r\n        var preRoute = function() {\r\n          if(verto.data.connected) {\r\n            $location.path('/dialpad');\r\n          }\r\n        }\r\n        preRoute();\r\n        \r\n        verto.data.name = $scope.storage.data.name;\r\n        verto.data.email = $scope.storage.data.email;\r\n\r\n        console.debug('Executing LoginController.');\r\n      }\r\n    ]);\r\n\r\n})();\r\n\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('MainController',\r\n      [\"$scope\", \"$rootScope\", \"$location\", \"$modal\", \"$timeout\", \"$q\", \"verto\", \"storage\", \"CallHistory\", \"toastr\", \"Fullscreen\", \"prompt\", \"eventQueue\", \"$translate\", \"$window\", function($scope, $rootScope, $location, $modal, $timeout, $q, verto, storage, CallHistory, toastr, Fullscreen, prompt, eventQueue, $translate, $window) {\r\n\r\n      console.debug('Executing MainController.');\r\n      $rootScope.dtmfHistory = { value: '' };\r\n      $rootScope.onKeydownDtmfEnabled = true;\r\n\r\n      $.verto.haltClosure = function() {\r\n        if (verto.data.callState == 'active') {\r\n          return true;\r\n        }\r\n      };\r\n\r\n      if (storage.data.language && storage.data.language !== 'browser') {\r\n        $translate.use(storage.data.language);\r\n      } else {\r\n        storage.data.language = 'browser';\r\n      }\r\n\r\n      $rootScope.master = $location.search().master;\r\n      if ($location.search().watcher === 'true') {\r\n        $rootScope.watcher = true;\r\n        angular.element(document.body).addClass('watcher');\r\n        var dialpad;\r\n        var extension = dialpad = $location.search().extension;\r\n        var canvasID = $location.search().canvas_id;\r\n\r\n        if (dialpad) {\r\n          if (canvasID) {\r\n            dialpad += '-canvas-' + canvasID;\r\n          }\r\n          $rootScope.extension = extension;\r\n          $rootScope.canvasID = canvasID;\r\n          $location.search().autocall = dialpad;\r\n        }\r\n      }\r\n\r\n      var myVideo = document.getElementById(\"webcam\");\r\n      $scope.verto = verto;\r\n      $scope.storage = storage;\r\n      $scope.call_history = angular.element(\"#call_history\").hasClass('active');\r\n      $rootScope.chatStatus = angular.element('#wrapper').hasClass('toggled');\r\n      $scope.showReconnectModal = true;\r\n      /**\r\n       * (explanation) scope in another controller extends rootScope (singleton)\r\n       */\r\n      $rootScope.chat_counter = 0;\r\n      $rootScope.activePane = 'members';\r\n      /**\r\n       * The number that will be called.\r\n       * @type {string}\r\n       */\r\n      $rootScope.dialpadNumber = '';\r\n\r\n      // If verto is not connected, redirects to login page.\r\n      if (!verto.data.connected) {\r\n        console.debug('MainController: WebSocket not connected. Redirecting to login.');\r\n        $location.path('/');\r\n      }\r\n\r\n      $rootScope.$on('config.http.success', function(ev) {\r\n        $scope.login(false);\r\n      });\r\n\r\n      $rootScope.$on('changedSpeaker', function(event, speakerId) {\r\n        if (verto.data.call) {\r\n          verto.data.call.setAudioPlaybackDevice(speakerId, sinkIdCallback);\r\n        }\r\n      });\r\n\r\n      /**\r\n       * Login the user to verto server and\r\n       * redirects him to dialpad page.\r\n       */\r\n      $scope.login = function(redirect) {\r\n        if(redirect == undefined) {\r\n          redirect = true;\r\n        }\r\n        var connectCallback = function(v, connected) {\r\n          $scope.$apply(function() {\r\n          verto.data.connecting = false;\r\n          if (connected) {\r\n            storage.data.hostname = verto.data.hostname;\r\n            storage.data.wsURL = verto.data.wsURL;\r\n            storage.data.ui_connected = verto.data.connected;\r\n            storage.data.ws_connected = verto.data.connected;\r\n            storage.data.name = verto.data.name;\r\n            storage.data.email = verto.data.email;\r\n            storage.data.login = verto.data.login;\r\n            storage.data.password = verto.data.password;\r\n            if (storage.data.autoBand) {\r\n              verto.testSpeed();\r\n            }\r\n\r\n            if (redirect && storage.data.preview) {\r\n              $location.path('/loading');\r\n            } else if (redirect) {\r\n              $location.path('/dialpad');\r\n            }\r\n          }\r\n          });\r\n        };\r\n\r\n        verto.data.connecting = true;\r\n        verto.connect(connectCallback);\r\n      };\r\n\r\n      /**\r\n       * Logout the user from verto server and\r\n       * redirects him to login page.\r\n       */\r\n      $rootScope.logout = function() {\r\n        var disconnect = function() {\r\n          var disconnectCallback = function(v, connected) {\r\n            console.debug('Redirecting to login page.');\r\n            storage.reset();\r\n\t\t\tif (typeof gapi !== 'undefined'){\r\n\t\t\t\tconsole.debug(gapi);\r\n\t\t\t\tgapi.auth.signOut();\r\n\t\t\t}\r\n            $location.path('/login');\r\n          };\r\n\r\n          if (verto.data.call) {\r\n            verto.hangup();\r\n          }\r\n\r\n          $scope.closeChat();\r\n          $scope.showReconnectModal = false;\r\n          verto.disconnect(disconnectCallback);\r\n\r\n          verto.hangup();\r\n        };\r\n\r\n        if (verto.data.call) {\r\n          prompt({\r\n            title: $translate.instant('TITLE_ACTIVE_CALL'),\r\n            message: $translate.instant('MESSAGE_ACTIVE_CALL_HANGUP')\r\n          }).then(function() {\r\n            disconnect();\r\n          });\r\n        } else {\r\n          disconnect();\r\n        }\r\n\r\n      };\r\n\r\n      /**\r\n       * Shows a modal with the settings.\r\n       */\r\n      $scope.openModalSettings = function() {\r\n        var modalInstance = $modal.open({\r\n          animation: $scope.animationsEnabled,\r\n          templateUrl: 'partials/modal_settings.html',\r\n          controller: 'ModalSettingsController',\r\n        });\r\n\r\n        modalInstance.result.then(\r\n          function(result) {\r\n            console.log(result);\r\n          },\r\n          function() {\r\n            console.info('Modal dismissed at: ' + new Date());\r\n          }\r\n        );\r\n\r\n        modalInstance.rendered.then(\r\n          function() {\r\n            jQuery.material.init();\r\n          }\r\n        );\r\n      };\r\n\r\n      $rootScope.openModal = function(templateUrl, controller, _options) {\r\n        var options = {\r\n          animation: $scope.animationsEnabled,\r\n          templateUrl: templateUrl,\r\n          controller: controller,\r\n        };\r\n\r\n        angular.extend(options, _options);\r\n\r\n        var modalInstance = $modal.open(options);\r\n\r\n        modalInstance.result.then(\r\n          function(result) {\r\n            console.log(result);\r\n          },\r\n          function() {\r\n            console.info('Modal dismissed at: ' + new Date());\r\n          }\r\n        );\r\n\r\n        modalInstance.rendered.then(\r\n          function() {\r\n            jQuery.material.init();\r\n          }\r\n        );\r\n\r\n        return modalInstance;\r\n      };\r\n\r\n      $rootScope.$on('ws.close', onWSClose);\r\n      $rootScope.$on('ws.login', onWSLogin);\r\n\r\n      $rootScope.ws_modalInstance;\r\n\r\n      function onWSClose(ev, data) {\r\n        if($rootScope.ws_modalInstance) {\r\n          return;\r\n        };\r\n        var options = {\r\n          backdrop: 'static',\r\n          keyboard: false\r\n        };\r\n          if ($scope.showReconnectModal) {\r\n            $rootScope.ws_modalInstance = $scope.openModal('partials/ws_reconnect.html', 'ModalWsReconnectController', options);\r\n          };\r\n      };\r\n\r\n      function onWSLogin(ev, data) {\r\n        if(storage.data.autoBand) {\r\n          verto.testSpeed();\r\n        }\r\n        if(!$rootScope.ws_modalInstance) {\r\n          return;\r\n        };\r\n\r\n        $rootScope.ws_modalInstance.close();\r\n        $rootScope.ws_modalInstance = null;\r\n      };\r\n\r\n      $scope.showAbout = function() {\r\n        $scope.openModal('partials/about.html', 'AboutController');\r\n      };\r\n\r\n      $scope.showContributors = function() {\r\n        $scope.openModal('partials/contributors.html', 'ContributorsController');\r\n      };\r\n\r\n      /**\r\n       * Updates the display adding the new number touched.\r\n       *\r\n       * @param {String} number - New touched number.\r\n       */\r\n      $rootScope.dtmf = function(number) {\r\n        console.log('dtmf', number);\r\n        $rootScope.dialpadNumber = $rootScope.dialpadNumber + number;\r\n        if (verto.data.call) {\r\n          verto.dtmf(number);\r\n        }\r\n      };\r\n\r\n      /**\r\n       * Removes the last character from the number.\r\n       */\r\n      $rootScope.backspace = function() {\r\n        var number = $rootScope.dialpadNumber;\r\n        var len = number.length;\r\n        $rootScope.dialpadNumber = number.substring(0, len - 1);\r\n      };\r\n\r\n\r\n      $scope.toggleCallHistory = function() {\r\n        if (!$scope.call_history) {\r\n          angular.element(\"#call_history\").addClass('active');\r\n          angular.element(\"#call-history-wrapper\").addClass('active');\r\n        } else {\r\n          angular.element(\"#call_history\").removeClass('active');\r\n          angular.element(\"#call-history-wrapper\").removeClass('active');\r\n        }\r\n        $scope.call_history = angular.element(\"#call_history\").hasClass('active');\r\n      };\r\n\r\n      $scope.toggleChat = function() {\r\n        if ($rootScope.chatStatus && $rootScope.activePane === 'chat') {\r\n          $rootScope.chat_counter = 0;\r\n        }\r\n        angular.element('#wrapper').toggleClass('toggled');\r\n        $rootScope.chatStatus = angular.element('#wrapper').hasClass('toggled');\r\n        updateVideoSize();\r\n      };\r\n\r\n      $rootScope.openChat = function() {\r\n        $rootScope.chatStatus = false;\r\n        angular.element('#wrapper').removeClass('toggled');\r\n      };\r\n\r\n      $scope.closeChat = function() {\r\n        $rootScope.chatStatus = true;\r\n        angular.element('#wrapper').addClass('toggled');\r\n      };\r\n\r\n      $scope.toggleSettings = function() {\r\n        var settingsEl = angular.element(document.querySelector('#settings'));\r\n        settingsEl.toggleClass('toggled');\r\n        $rootScope.$emit('toggledSettings', settingsEl.hasClass('toggled'));\r\n      };\r\n\r\n      $scope.closeSettings = function() {\r\n        var settingsEl = angular.element(document.querySelector('#settings'));\r\n        if (settingsEl.hasClass('toggled')) {\r\n          settingsEl.removeClass('toggled');\r\n          $rootScope.$emit('toggledSettings', settingsEl.hasClass('toggled'));\r\n        }\r\n      };\r\n\r\n      $scope.goFullscreen = function() {\r\n        if (storage.data.userStatus !== 'connected') {\r\n          return;\r\n        }\r\n        $rootScope.fullscreenEnabled = !Fullscreen.isEnabled();\r\n        if (Fullscreen.isEnabled()) {\r\n          Fullscreen.cancel();\r\n        } else {\r\n          Fullscreen.enable(document.getElementsByTagName('body')[0]);\r\n        }\r\n      };\r\n\r\n      $rootScope.$on('call.video', function(event) {\r\n        storage.data.videoCall = true;\r\n      });\r\n\r\n      $rootScope.$on('call.hangup', function(event, data) {\r\n        if (Fullscreen.isEnabled()) {\r\n          Fullscreen.cancel();\r\n        }\r\n\r\n        if (!$rootScope.chatStatus) {\r\n          angular.element('#wrapper').toggleClass('toggled');\r\n          $rootScope.chatStatus = angular.element('#wrapper').hasClass('toggled');\r\n        }\r\n\r\n        $rootScope.dialpadNumber = '';\r\n        console.debug('Redirecting to dialpad page.');\r\n        $location.path('/dialpad');\r\n\r\n        try {\r\n          $rootScope.$digest();\r\n        } catch (e) {\r\n          console.log('not digest');\r\n        }\r\n      });\r\n\r\n      $rootScope.$on('page.incall', function(event, data) {\r\n        var page_incall = function() {\r\n          return $q(function(resolve, reject) {\r\n            if (storage.data.askRecoverCall) {\r\n              prompt({\r\n                title: $translate.instant('TITLE_ACTIVE_CALL'),\r\n                message: $translate.instant('MESSAGE_ACTIVE_CALL_BACK')\r\n              }).then(function() {\r\n                console.log('redirect to incall page');\r\n                $location.path('/incall');\r\n              }, function() {\r\n                storage.data.userStatus = 'connecting';\r\n                verto.hangup();\r\n              });\r\n            } else {\r\n              console.log('redirect to incall page');\r\n              $location.path('/incall');\r\n            }\r\n            resolve();\r\n          });\r\n        };\r\n        eventQueue.events.push(page_incall);\r\n      });\r\n\r\n      $scope.$on('event:google-plus-signin-success', function (event,authResult) {\r\n        // Send login to server or save into cookie\r\n        console.log('Google+ Login Success');\r\n\tconsole.log(authResult);\r\n\tgapi.client.load('plus', 'v1', gapiClientLoaded);\r\n      });\r\n\r\n      function gapiClientLoaded() {\r\n\tgapi.client.plus.people.get({userId: 'me'}).execute(handleEmailResponse);\r\n      }\r\n\r\n      function handleEmailResponse(resp){\r\n        var primaryEmail;\r\n\tfor (var i=0; i < resp.emails.length; i++) {\r\n\t  if (resp.emails[i].type === 'account') primaryEmail = resp.emails[i].value;\r\n        }\r\n\tconsole.debug(\"Primary Email: \" + primaryEmail );\r\n\tconsole.debug(\"display name: \" + resp.displayName);\r\n\tconsole.debug(\"imageurl: \" + resp.image.url);\r\n\tconsole.debug(resp);\r\n\tconsole.debug(verto.data);\r\n\tverto.data.email = primaryEmail;\r\n\tverto.data.name = resp.displayName;\r\n\tstorage.data.name = verto.data.name;\r\n\tstorage.data.email = verto.data.email;\r\n\r\n\t$scope.login();\r\n      }\r\n\r\n      $scope.$on('event:google-plus-signin-failure', function (event,authResult) {\r\n        // Auth failure or signout detected\r\n        console.log('Google+ Login Failure');\r\n      });\r\n\r\n      $rootScope.callActive = function(data, params) {\r\n        verto.data.mutedMic = storage.data.mutedMic;\r\n        verto.data.mutedVideo = storage.data.mutedVideo;\r\n\r\n        if (!storage.data.cur_call) {\r\n          storage.data.call_start = new Date();\r\n        }\r\n        storage.data.userStatus = 'connected';\r\n        var call_start = new Date(storage.data.call_start);\r\n        $rootScope.start_time = call_start;\r\n\r\n        $timeout(function() {\r\n          $scope.$broadcast('timer-start');\r\n        });\r\n        myVideo.play();\r\n        storage.data.calling = false;\r\n\r\n        storage.data.cur_call = 1;\r\n\r\n        $location.path('/incall');\r\n\r\n        if(params.useVideo) {\r\n          $rootScope.$emit('call.video', 'video');\r\n        }\r\n      };\r\n\r\n      $rootScope.$on('call.active', function(event, data, params) {\r\n        $rootScope.callActive(data, params);\r\n      });\r\n\r\n      $rootScope.$on('call.calling', function(event, data) {\r\n        storage.data.calling = true;\r\n      });\r\n\r\n      $rootScope.$on('call.incoming', function(event, data) {\r\n        console.log('Incoming call from: ' + data);\r\n\r\n        storage.data.cur_call = 0;\r\n        $scope.incomingCall = true;\r\n        storage.data.videoCall = false;\r\n        storage.data.mutedVideo = false;\r\n        storage.data.mutedMic = false;\r\n\r\n        prompt({\r\n          title: $translate.instant('TITLE_INCOMING_CALL'),\r\n          message: $translate.instant('MESSAGE_INCOMING_CALL') + data\r\n        }).then(function() {\r\n          var call_start = new Date(storage.data.call_start);\r\n          $rootScope.start_time = call_start;\r\n          console.log($rootScope.start_time);\r\n\r\n          $scope.answerCall();\r\n          storage.data.called_number = data;\r\n          CallHistory.add(data, 'inbound', true);\r\n          $location.path('/incall');\r\n        }, function() {\r\n          $scope.declineCall();\r\n          CallHistory.add(data, 'inbound', false);\r\n        });\r\n      });\r\n\r\n      $scope.hold = function() {\r\n        storage.data.onHold = !storage.data.onHold;\r\n        verto.data.call.toggleHold();\r\n      };\r\n\r\n      /**\r\n       * Hangup the current call.\r\n       */\r\n      $scope.hangup = function() {\r\n        if (!verto.data.call) {\r\n          toastr.warning($translate.instant('MESSAGE_NO_HANGUP_CALL'));\r\n          $location.path('/dialpad');\r\n          return;\r\n        }\r\n\r\n        if ($rootScope.watcher) {\r\n          window.close();\r\n          return;\r\n        }\r\n\r\n        //var hangupCallback = function(v, hangup) {\r\n        //  if (hangup) {\r\n        //    $location.path('/dialpad');\r\n        //  } else {\r\n        //    console.debug('The call could not be hangup.');\r\n        //  }\r\n        //};\r\n        //\r\n        //verto.hangup(hangupCallback);\r\n        if (verto.data.shareCall) {\r\n          verto.screenshareHangup();\r\n        }\r\n\r\n        verto.hangup();\r\n\r\n        $rootScope.$emit('hangupCall');\r\n        $location.path('/dialpad');\r\n      };\r\n\r\n      $scope.answerCall = function() {\r\n        storage.data.onHold = false;\r\n\r\n        verto.data.call.answer({\r\n          useStereo: storage.data.useStereo,\r\n          useCamera: storage.data.selectedVideo,\r\n          useVideo: storage.data.useVideo,\r\n          useMic: storage.data.useMic,\r\n          callee_id_name: verto.data.name,\r\n          callee_id_number: verto.data.login\r\n        });\r\n\r\n\r\n        $location.path('/incall');\r\n      };\r\n\r\n      $scope.declineCall = function() {\r\n        $scope.hangup();\r\n        $scope.incomingCall = false;\r\n      };\r\n\r\n      $scope.play = function() {\r\n        var file = $scope.promptInput($translate.instant('MESSAGE_ENTER_FILENAME'), '', 'File',\r\n          function(file) {\r\n            verto.data.conf.play(file);\r\n            console.log('play file :', file);\r\n          });\r\n\r\n      };\r\n\r\n      $scope.stop = function() {\r\n        verto.data.conf.stop();\r\n      };\r\n\r\n      $scope.record = function() {\r\n        var file = $scope.promptInput($translate.instant('MESSAGE_ENTER_FILENAME'), '', 'File',\r\n          function(file) {\r\n            verto.data.conf.record(file);\r\n            console.log('recording file :', file);\r\n          });\r\n      };\r\n\r\n      $scope.stopRecord = function() {\r\n        verto.data.conf.stopRecord();\r\n      };\r\n\r\n      $scope.snapshot = function() {\r\n        var file = $scope.promptInput($translate.instant('MESSAGE_ENTER_FILENAME'), '', 'File',\r\n          function(file) {\r\n            verto.data.conf.snapshot(file);\r\n            console.log('snapshot file :', file);\r\n          });\r\n      };\r\n\r\n      function sinkIdCallback(success, deviceName) {\r\n        if (success) {\r\n          toastr.info('Speaker is now <span class=\"install\">' + deviceName + '</a>', 'Success', { allowHtml: true });\r\n        } else {\r\n          toastr.error('Your browser doesn\\'t seem to support this feature', 'Error');\r\n        }\r\n      }\r\n\r\n      $rootScope.dtmfWidget = function(number) {\r\n        $rootScope.dtmfHistory.value = $rootScope.dtmfHistory.value + number;\r\n        if (verto.data.call) {\r\n          verto.dtmf(number);\r\n        }\r\n      }\r\n\r\n      $rootScope.disableOnKeydownDtmf = function() {\r\n        $rootScope.onKeydownDtmfEnabled = false;\r\n      };\r\n\r\n      $rootScope.enableOnKeydownDtmf = function() {\r\n        $rootScope.onKeydownDtmfEnabled = true;\r\n      };\r\n\r\n      $rootScope.$on(\"$routeChangeStart\", function(event, next, current) {\r\n        if (next.$$route.originalPath === '/incall') {\r\n          $rootScope.dtmfHistory.value = '';\r\n          angular.element($window).bind('keydown', onKeydownDtmfHistory);\r\n        } else {\r\n          angular.element($window).unbind('keydown', onKeydownDtmfHistory);\r\n        }\r\n      });\r\n\r\n      function onKeydownDtmfHistory(event) {\r\n        var caracter = event.key;\r\n        if ($rootScope.onKeydownDtmfEnabled && caracter.match(/^(\\*|\\#|[0-9a-dA-D])$/g)) {\r\n          $rootScope.dtmfWidget(caracter);\r\n          $scope.$applyAsync();\r\n        }\r\n      }\r\n\r\n    }]\r\n  );\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n\t.controller('MenuController', ['$scope', '$http', '$location',\r\n\t  'verto', 'storage', '$rootScope',\r\n\t  function($scope, $http, $location, verto, storage, $rootScope) {\r\n\t    console.debug('Executing MenuController.');\r\n      $scope.storage = storage;\r\n\r\n      $rootScope.$on('testSpeed', function(e, data) {\r\n        var vidQual = storage.data.vidQual;\r\n\tvar bwp = 4;\r\n\r\n        $scope.bandDown = data.downKPS;\r\n        $scope.bandUp = data.upKPS;\r\n\r\n        if (data.downKPS < 2000) {\r\n          bwp--;\r\n        }\r\n\r\n        if (data.upKPS < 2000) {\r\n           bwp--;\r\n        }\r\n\r\n        $scope.iconClass = 'mdi-device-signal-wifi-4-bar green';                      \r\n\r\n        if (bwp < 4) {\r\n           $scope.iconClass = 'mdi-device-signal-wifi-3-bar yellow';\r\n        } else if (bwp < 2) {\r\n           $scope.iconClass = 'mdi-device-signal-wifi-1-bar red';\r\n        }\r\n\r\n        verto.videoQuality.forEach(function(vid) {\r\n          if (vid.id == vidQual){\r\n            $scope.vidRes = vid.label;\r\n          }\r\n        });\r\n\r\n        $scope.$apply();\r\n      });\r\n    }\r\n\t]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('ModalDialpadController', ['$scope',\r\n      '$modalInstance',\r\n      function($scope, $modalInstance) {\r\n\r\n        $scope.ok = function() {\r\n          $modalInstance.close('Ok.');\r\n        };\r\n\r\n        $scope.cancel = function() {\r\n          $modalInstance.dismiss('cancel');\r\n        };\r\n\r\n      }\r\n    ]);\r\n})();\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('ModalWsReconnectController', ModalWsReconnectController);\r\n\r\n    ModalWsReconnectController.$inject = ['$rootScope', '$scope', 'storage', 'verto'];\r\n\r\n    function ModalWsReconnectController($rootScope, $scope, storage, verto) {\r\n      console.debug('Executing ModalWsReconnectController'); \r\n\r\n      $scope.closeReconnect = closeReconnect;\r\n\r\n      function closeReconnect() {\r\n        if ($rootScope.ws_modalInstance && verto.data.instance) {\r\n          verto.data.instance.rpcClient.stopRetrying();\r\n          $rootScope.ws_modalInstance.close();\r\n          delete verto.data.instance;\r\n        }\r\n      };\r\n    };\r\n                \r\n                \r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('ModalLoginInformationController', ['$scope',\r\n      '$http', '$location', '$modalInstance', 'verto', 'storage',\r\n      function($scope, $http, $location, $modalInstance, verto, storage) {\r\n        console.debug('Executing ModalLoginInformationController.');\r\n\r\n        $scope.verto = verto;\r\n        $scope.storage = storage;\r\n\r\n        $scope.ok = function() {\r\n          $modalInstance.close('Ok.');\r\n        };\r\n\r\n        $scope.cancel = function() {\r\n          $modalInstance.dismiss('cancel');\r\n        };\r\n\r\n        verto.data.name = storage.data.name;\r\n        verto.data.email = storage.data.email;\r\n\r\n      }\r\n    ]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('SettingsController', ['$scope', '$http',\r\n      '$location', '$rootScope', 'storage', 'verto', '$translate', 'toastr', 'configLanguages',\r\n      function($scope, $http, $location, $rootScope, storage, verto, $translate, toastr, configLanguages) {\r\n        console.debug('Executing ModalSettingsController.');\r\n\r\n        $.material.init();\r\n\r\n        $scope.speakerFeature = typeof document.getElementById('webcam').sinkId !== 'undefined';\r\n        $scope.storage = storage;\r\n        $scope.verto = verto;\r\n        $scope.mydata = angular.copy(storage.data);\r\n        $scope.languages = configLanguages.languages;\r\n        $scope.languages.unshift({id: 'browser', name : $translate.instant('BROWSER_LANGUAGE')});\r\n        $scope.mydata.language = storage.data.language || 'browser';\r\n\r\n        $rootScope.$on('$translateChangeSuccess', function () {\r\n          $translate('BROWSER_LANGUAGE').then(function (translation) {\r\n          $scope.languages[0].name = translation;\r\n          });\r\n        });\r\n\r\n        $rootScope.$on('toggledSettings', function(e, status) {\r\n          if (status) {\r\n            $scope.mydata = angular.copy(storage.data);\r\n          } else {\r\n            $scope.ok();\r\n          }\r\n        });\r\n\r\n        $scope.ok = function() {\r\n          console.log('Camera Selected is', $scope.mydata.selectedVideo, $scope.verto.data.videoDevices);\r\n\r\n          angular.forEach(verto.data.videoDevices, function(video) {\r\n            console.log('checking video ', video);\r\n            if (video.id == $scope.mydata.selectedVideo) {\r\n              $scope.mydata.selectedVideoName = video.label;\r\n              console.log('Setting selectedVideoName to ', video.label);\r\n            }\r\n          })\r\n          if ($scope.mydata.selectedSpeaker != storage.data.selectedSpeaker) {\r\n            $rootScope.$emit('changedSpeaker', $scope.mydata.selectedSpeaker);\r\n          }\r\n          storage.changeData($scope.mydata);\r\n          verto.data.instance.iceServers(storage.data.useSTUN);\r\n\r\n          if (storage.data.autoBand) {\r\n            $scope.testSpeed();\r\n          }\r\n\r\n          var audioParams = {\r\n            googEchoCancellation: storage.data.googEchoCancellation === undefined ? true : storage.data.googEchoCancellation,\r\n            googNoiseSuppression: storage.data.googNoiseSuppression === undefined ? true : storage.data.googNoiseSuppression,\r\n            googHighpassFilter: storage.data.googHighpassFilter === undefined ? true : storage.data.googHighpassFilter,\r\n            googAutoGainControl: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl,\r\n            googAutoGainControl2: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl\r\n          };\r\n          verto.data.instance.options.audioParams = audioParams;\r\n\r\n        };\r\n\r\n        $scope.changedLanguage = function(langKey){\r\n          if (langKey === 'browser'){\r\n           storage.data.language = 'browser';\r\n            var browserlang = $translate.preferredLanguage();\r\n            $translate.use(browserlang).then(\r\n              function(lang) {}, function(fail_lang) {\r\n                $translate.use('en');\r\n               });\r\n          } else {\r\n            $translate.use(langKey);\r\n            storage.data.language = langKey;\r\n          }\r\n        };\r\n\r\n        $scope.refreshDeviceList = function() {\r\n          return verto.refreshDevices();\r\n        };\r\n\r\n        $scope.showPreview = function() {\r\n          var settingsEl = angular.element(document.querySelector('#settings'));\r\n          settingsEl.toggleClass('toggled');\r\n          if (!verto.data.call) {\r\n            $location.path('/preview');\r\n            return;\r\n          }\r\n          else {\r\n            toastr.warning($translate.instant('MESSAGE_DISPLAY_SETTINGS'));\r\n          }\r\n        };\r\n\r\n        $scope.testSpeed = function() {\r\n          $scope.isTestingSpeed = true;\r\n          return verto.testSpeed(cb);\r\n\r\n          function cb(data) {\r\n            $scope.mydata.vidQual = storage.data.vidQual;\r\n            $scope.speedMsg = 'Up: ' + data.upKPS + ' Down: ' + data.downKPS;\r\n            $scope.isTestingSpeed = false;\r\n            $scope.$apply();\r\n          }\r\n        };\r\n\r\n        $scope.resetSettings = function() {\r\n\t  if (confirm('Factory Reset Settings?')) {\r\n            storage.factoryReset();\r\n            $scope.logout();\r\n\t    window.location.reload();\r\n\t  };\r\n        };\r\n\r\n        $scope.checkAutoBand = function(option) {\r\n          $scope.mydata.useDedenc = false;\r\n          var bestres = videoQuality[videoQuality.length-1];\r\n          $scope.mydata.vidQual = bestres.id;\r\n          storage.data.vidQual = bestres.id;\r\n          verto.data.instance.videoParams({\r\n            minWidth: bestres.width,\r\n            minHeight: bestres.height,\r\n            maxWidth: bestres.width,\r\n            maxHeight: bestres.height,\r\n            minFrameRate: 15,\r\n            vertoBestFrameRate: storage.data.bestFrameRate\r\n          });\r\n          storage.data.vidQual = bestres.id;\r\n          if (!option) {\r\n            $scope.mydata.outgoingBandwidth = 'default';\r\n            $scope.mydata.incomingBandwidth = 'default';\r\n            $scope.mydata.testSpeedJoin = false;\r\n\r\n          } else {\r\n            $scope.mydata.testSpeedJoin = true;\r\n          }\r\n        };\r\n\r\n        $scope.checkUseDedRemoteEncoder = function(option) {\r\n          if (['0', 'default', '5120'].indexOf(option) != -1) {\r\n            $scope.mydata.useDedenc = false;\r\n          } else {\r\n            $scope.mydata.useDedenc = true;\r\n          }\r\n        };\r\n\r\n        $scope.checkVideoQuality = function(resolution) {\r\n          var w = videoResolution[resolution]['width'];\r\n          var h = videoResolution[resolution]['height'];\r\n          storage.data.vidQual = resolution;\r\n          verto.data.instance.videoParams({\r\n            minWidth: w,\r\n            minHeight: h,\r\n            maxWidth: w,\r\n            maxHeight: h,\r\n            minFrameRate: 15,\r\n            vertoBestFrameRate: storage.data.bestFrameRate\r\n          });\r\n\r\n        };\r\n\r\n      }\r\n    ]);\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  angular\r\n    .module('vertoControllers')\r\n    .controller('PreviewController', ['$rootScope', '$scope',\r\n      '$http', '$location', '$modal', '$timeout', 'toastr', 'verto', 'storage', 'prompt', 'Fullscreen', '$translate',\r\n      function($rootScope, $scope, $http, $location, $modal, $timeout, toastr,\r\n        verto, storage, prompt, Fullscreen, $translate) {\r\n\r\n        $scope.storage = storage;\r\n        console.debug('Executing PreviewController.');\r\n        var localVideo = document.getElementById('videopreview');\r\n        var volumes = document.querySelector('#mic-meter .volumes');\r\n        if (volumes) {\r\n          volumes = volumes.children;\r\n        }\r\n\r\n        $scope.localVideo = function() {\r\n          var constraints = {\r\n            mirrored: true,\r\n            audio: {\r\n              optional: [{ sourceId: storage.data.selectedAudio }]\r\n            }\r\n          };\r\n\r\n          var newDevice = verto.data.videoDevices.find(function(device) {\r\n            return device.id == storage.data.selectedVideo;\r\n          });\r\n\r\n          storage.data.selectedVideo = newDevice.id;\r\n          storage.data.selectedVideoName = newDevice.label;\r\n\r\n          if (newDevice.id !== 'none') {\r\n            constraints.video = {\r\n              optional: [{ sourceId: newDevice.id }]\r\n            };\r\n          }\r\n\r\n          navigator.getUserMedia(constraints, handleMedia, function(err, data) {\r\n\r\n          });\r\n        };\r\n        var audioContext = null;\r\n        if (typeof AudioContext !== \"undefined\") {\r\n          audioContext = new AudioContext();\r\n        }\r\n\r\n        var mediaStreamSource = null;\r\n        var meter = null;\r\n        var streamObj = {};\r\n\r\n        function stopMedia(stream) {\r\n          if (typeof stream == 'function') {\r\n            stream.stop();\r\n          } else {\r\n            if (stream.active) {\r\n              var tracks = stream.getTracks();\r\n              tracks.forEach(function(track, index) {\r\n                track.stop();\r\n              })\r\n            }\r\n          }\r\n        }\r\n        function handleMedia(stream) {\r\n          if (streamObj) {\r\n            stopMedia(streamObj);\r\n          }\r\n\r\n          streamObj = stream;\r\n          FSRTCattachMediaStream(localVideo, stream);\r\n          if (audioContext) {\r\n            mediaStreamSource = audioContext.createMediaStreamSource(stream);\r\n            meter = createAudioMeter(audioContext);\r\n            mediaStreamSource.connect(meter);\r\n          };\r\n        }\r\n\r\n        function renderMic() {\r\n          // meter.volume;\r\n          var n = Math.round(meter.volume * 25);\r\n          for(var i = volumes.length -1, j = 0; i >= 0; i--, j++) {\r\n            var el = angular.element(volumes[j]);\r\n            if (i >= n) el.removeClass('active');\r\n            else        el.addClass('active');\r\n          }\r\n\r\n          if(!verto.data.call) {\r\n            window.requestAnimationFrame(renderMic);\r\n          }\r\n        }\r\n        /**\r\n         * TODO: useless?\r\n         */\r\n\r\n        $scope.refreshDeviceList = function() {\r\n         return verto.refreshDevices();\r\n        };\r\n\r\n        $scope.videoCall = function() {\r\n          prompt({\r\n            title: $translate.instant('TITLE_ENABLE_VIDEO'),\r\n            message: $translate.instant('MESSAGE_ENABLE_VIDEO')\r\n          }).then(function() {\r\n            storage.data.videoCall = true;\r\n            $scope.callTemplate = 'partials/video_call.html';\r\n          });\r\n        };\r\n\r\n        $scope.cbMuteVideo = function(event, data) {\r\n          storage.data.mutedVideo = !storage.data.mutedVideo;\r\n        }\r\n\r\n        $scope.cbMuteMic = function(event, data) {\r\n          storage.data.mutedMic = !storage.data.mutedMic;\r\n        }\r\n\r\n        $scope.confChangeVideoLayout = function(layout) {\r\n          verto.data.conf.setVideoLayout(layout);\r\n        };\r\n\r\n        $scope.endPreview = function() {\r\n          localVideo.src = null;\r\n          if (audioContext) {\r\n            meter.shutdown();\r\n            meter.onaudioprocess = null;\r\n          };\r\n          stopMedia(streamObj);\r\n          $location.path('/dialpad');\r\n          storage.data.preview = false;\r\n        };\r\n\r\n        $scope.localVideo();\r\n      }\r\n    ]);\r\n})();\r\n\r\n(function() {\r\n    'use strict';\r\n\r\n    angular\r\n        .module('vertoControllers')\r\n        .controller('LoadingController', ['$rootScope', '$scope', '$location', '$interval', 'verto',\r\n            function($rootScope, $scope, $location, $interval, verto) {\r\n                console.log('Loading controller');\r\n                var int_id;\r\n\r\n                $scope.stopInterval = function() {\r\n                    $interval.cancel(int_id);\r\n                };\r\n\r\n                int_id = $interval(function() {\r\n                  if (verto.data.resCheckEnded) {\r\n                    $scope.stopInterval();\r\n                    $location.path('/preview');\r\n                  }\r\n                }, 1000);\r\n\r\n            }\r\n        ]);\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  var vertoDirectives = angular.module('vertoDirectives', []);\r\n})();\r\n\r\n/*\r\nSometimes autofocus HTML5 directive just isn't enough with SPAs.\r\nThis directive will force autofocus to work properly under those circumstances.\r\n*/\r\n(function () {\r\n  'use strict';\r\n\r\n  angular\r\n  .module('vertoDirectives')\r\n  .directive('autofocus', ['$timeout',\r\n    function ($timeout) {\r\n      return {\r\n        restrict: 'A',\r\n        link: function ($scope, $element) {\r\n          $timeout(function () {\r\n            $element[0].focus();\r\n          });\r\n        }\r\n      };\r\n    }\r\n  ]);\r\n})();\r\n(function () {\r\n  'use strict';\r\n\r\n  angular\r\n  .module('vertoDirectives')\r\n  .directive('showControls',\r\n  [\"Fullscreen\", function(Fullscreen) {\r\n    var link = function(scope, element, attrs) {\r\n      var i = null;\r\n      jQuery('.video-footer').fadeIn('slow');\r\n      jQuery('.video-hover-buttons').fadeIn('slow');\r\n      element.parent().bind('mousemove', function() {\r\n        if (Fullscreen.isEnabled()) {\r\n          clearTimeout(i);\r\n          jQuery('.video-footer').fadeIn('slow');\r\n          jQuery('.video-hover-buttons').fadeIn(500);\r\n          i = setTimeout(function() {\r\n            if (Fullscreen.isEnabled()) {\r\n              jQuery('.video-footer').fadeOut('slow');\r\n              jQuery('.video-hover-buttons').fadeOut(500);\r\n            }\r\n          }, 3000);\r\n        }\r\n      });\r\n      element.parent().bind('mouseleave', function() {\r\n        jQuery('.video-footer').fadeIn();\r\n        jQuery('.video-hover-buttons').fadeIn();\r\n      });\r\n    }\r\n\r\n\r\n    return {\r\n      link: link\r\n    };\r\n  }]);\r\n\r\n})();\r\n(function () {\r\n  'use strict';\r\n\r\n  angular\r\n  .module('vertoDirectives').directive('userStatus',\r\n  function() {\r\n    var link = function(scope, element, attrs) {\r\n      scope.$watch('condition', function(condition) {\r\n        element.removeClass('connected');\r\n        element.removeClass('disconnected');\r\n        element.removeClass('connecting');\r\n\r\n        element.addClass(condition);\r\n\r\n      });\r\n    }\r\n\r\n    return {\r\n      scope: {\r\n        'condition': '='\r\n      },\r\n      link: link\r\n    };\r\n\r\n  });\r\n\r\n})();\r\n/**\r\n * To RTC work properly we need to give a <video> tag as soon as possible\r\n * because it needs to attach the video and audio stream to the tag.\r\n *\r\n * This directive is responsible for moving the video tag from the body to\r\n * the right place when a call start and move back to the body when the\r\n * call ends. It also hides and display the tag when its convenient.\r\n */\r\n(function () {\r\n  'use strict';\r\n\r\n  angular\r\n  .module('vertoDirectives')\r\n  .directive('videoTag',\r\n  function() {\r\n\r\n    function link(scope, element, attrs) {\r\n      // Moving the video tag to the new place inside the incall page.\r\n      console.log('Moving the video to element.');\r\n      var videoElem = jQuery('#webcam');\r\n\r\n      var newParent = document.getElementsByClassName('video-tag-wrapper');\r\n\tnewParent[0].appendChild(document.getElementById('webcam'));\r\n\r\n\t$(\"#webcam\").resize(function() {\r\n\t    updateVideoSize();\r\n\t});\r\n\r\n\t$(window).resize(function() {\r\n\t    updateVideoSize();\r\n\t});\r\n\r\n\tupdateVideoSize();\r\n\t\r\n\tvideoElem.removeClass('hide');\r\n\tvideoElem.css('display', 'block');\r\n\r\n      scope.callActive(\"\", {useVideo: true});\r\n\r\n      element.on('$destroy', function() {\r\n        // Move the video back to the body.\r\n        console.log('Moving the video back to body.');\r\n        videoElem.addClass('hide').appendTo(jQuery('body'));\r\n        $(window).unbind('resize');\r\n      });\r\n    }\r\n\r\n    return {\r\n      link: link\r\n    }\r\n  });\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  var vertoFilters = angular.module('vertoFilters', []);\r\n})();\r\n\r\n(function () {\r\n  'use strict';\r\n\r\n  angular\r\n  .module('vertoFilters')\r\n  .filter('picturify', function() {\r\n    var regex = /<a (|target=\"\\s*\\S*\" )href=\"(\\s*\\S*.(png|jpg|svg|gif|webp|bmp))\">\\s*\\S*<\\/a>/i;\r\n    var regex64 = /data:image\\/(\\s*\\S*);base64,((?:[A-Za-z0-9+\\/]{4})*(?:[A-Za-z0-9+\\/]{2}==|[A-Za-z0-9+\\/]{3}=))/g;\r\n\r\n    return function (text, width, n) {\r\n      var i = 0;\r\n      width = width || 150; //default width\r\n      if(regex64.test(text)) {\r\n        text = text.replace(regex64, '<a href=\"$1\" target=\"_blank\"><img class=\"chat-img\" width=\"'+ width +'\" src=\"data:image/png;base64,$2\"/></a>')\r\n      }\r\n\r\n      do {\r\n        text = text.replace(regex, '<a $1href=\"$2\"><img class=\"chat-img\" width=\"'+ width +'\" src=\"$2\"/></a>');\r\n      } while((!n || (n && i++ < n)) && regex.test(text));\r\n\r\n      return text;\r\n    }\r\n\r\n  });\r\n\r\n})();\r\n\r\n(function() {\r\n  'use strict';\r\n  var vertoService = angular.module('vertoService', []);\r\n})();\r\n\r\n'use strict';\r\n\r\n/* Controllers */\r\nvar videoQuality = [];\r\nvar videoQualitySource = [{\r\n  id: 'qqvga',\r\n  label: 'QQVGA 160x120',\r\n  width: 160,\r\n  height: 120\r\n}, {\r\n  id: 'qvga',\r\n  label: 'QVGA 320x240',\r\n  width: 320,\r\n  height: 240\r\n}, {\r\n  id: 'vga',\r\n  label: 'VGA 640x480',\r\n  width: 640,\r\n  height: 480\r\n}, {\r\n  id: 'qvga_wide',\r\n  label: 'QVGA WIDE 320x180',\r\n  width: 320,\r\n  height: 180\r\n}, {\r\n  id: 'vga_wide',\r\n  label: 'VGA WIDE 640x360',\r\n  width: 640,\r\n  height: 360\r\n}, {\r\n  id: 'hd',\r\n  label: 'HD 1280x720',\r\n  width: 1280,\r\n  height: 720\r\n}, {\r\n  id: 'hhd',\r\n  label: 'HHD 1920x1080',\r\n  width: 1920,\r\n  height: 1080\r\n}, ];\r\n\r\nvar videoResolution = {\r\n  qqvga: {\r\n    width: 160,\r\n    height: 120\r\n  },\r\n  qvga: {\r\n    width: 320,\r\n    height: 240\r\n  },\r\n  vga: {\r\n    width: 640,\r\n    height: 480\r\n  },\r\n  qvga_wide: {\r\n    width: 320,\r\n    height: 180\r\n  },\r\n  vga_wide: {\r\n    width: 640,\r\n    height: 360\r\n  },\r\n  hd: {\r\n    width: 1280,\r\n    height: 720\r\n  },\r\n  hhd: {\r\n    width: 1920,\r\n    height: 1080\r\n  },\r\n};\r\n\r\nvar bandwidth = [{\r\n  id: '250',\r\n  label: '250kb'\r\n}, {\r\n  id: '500',\r\n  label: '500kb'\r\n}, {\r\n  id: '1024',\r\n  label: '1mb'\r\n}, {\r\n  id: '1536',\r\n  label: '1.5mb'\r\n}, {\r\n  id: '2048',\r\n  label: '2mb'\r\n}, {\r\n  id: '3196',\r\n  label: '3mb'\r\n}, {\r\n  id: '4192',\r\n  label: '4mb'\r\n}, {\r\n  id: '5120',\r\n  label: '5mb'\r\n}, {\r\n  id: '0',\r\n  label: 'No Limit'\r\n}, {\r\n  id: 'default',\r\n  label: 'Server Default'\r\n}, ];\r\n\r\nvar framerate = [{\r\n  id: '15',\r\n  label: '15 FPS'\r\n}, {\r\n  id: '20',\r\n  label: '20 FPS'\r\n}, {\r\n  id: '30',\r\n  label: '30 FPS'\r\n}, ];\r\n\r\nvar updateReq;\r\n\r\nvar updateVideoSize = function(ms) {\r\n    if (!ms) ms = 500;\r\n\r\n    clearTimeout(updateReq);\r\n    updateReq = setTimeout(function () {\r\n        var videoElem = jQuery('#webcam');\r\n        videoElem.width(\"\");\r\n        videoElem.height(\"\");\r\n\r\n        var w = videoElem.width();\r\n        var h = videoElem.height();\r\n        var new_w, new_h;\r\n        var aspect = w / h;\r\n        var videoContainer = jQuery('div.video-wrapper');\r\n        if (w > h) {\r\n            new_w = videoContainer.width();\r\n            new_h = Math.round(videoContainer.width() / aspect);\r\n        } else {\r\n            new_h = videoContainer.height();\r\n            new_w = Math.round(videoContainer.height() / aspect);\r\n        }\r\n        videoElem.width(new_w);\r\n        videoElem.height(new_h);\r\n        console.log('Setting video size to ' + new_w + '/' + new_h);\r\n    }, ms);\r\n}\r\n\r\nvar vertoService = angular.module('vertoService', ['ngCookies']);\r\n\r\nvertoService.service('verto', ['$rootScope', '$cookieStore', '$location', 'storage',\r\n  function($rootScope, $cookieStore, $location, storage) {\r\n    var data = {\r\n      // Connection data.\r\n      instance: null,\r\n      connected: false,\r\n\r\n      // Call data.\r\n      call: null,\r\n      shareCall: null,\r\n      callState: null,\r\n      conf: null,\r\n      confLayouts: [],\r\n      confRole: null,\r\n      chattingWith: null,\r\n      liveArray: null,\r\n\r\n      // Settings data.\r\n      videoDevices: [],\r\n      audioDevices: [],\r\n      shareDevices: [],\r\n      videoQuality: [],\r\n      extension: $cookieStore.get('verto_demo_ext'),\r\n      name: $cookieStore.get('verto_demo_name'),\r\n      email: $cookieStore.get('verto_demo_email'),\r\n      cid: $cookieStore.get('verto_demo_cid'),\r\n      textTo: $cookieStore.get('verto_demo_textto') || \"1000\",\r\n      login: $cookieStore.get('verto_demo_login') || \"1008\",\r\n      password: $cookieStore.get('verto_demo_passwd') || \"1234\",\r\n      hostname: window.location.hostname,\r\n      wsURL: (\"wss://\" + window.location.hostname + \":8082\"),\r\n      resCheckEnded: false\r\n    };\r\n\r\n    function cleanShareCall(that) {\r\n      data.shareCall = null;\r\n      data.callState = 'active';\r\n      that.refreshDevices();\r\n    }\r\n\r\n    function cleanCall() {\r\n      data.call = null;\r\n      data.callState = null;\r\n      data.conf = null;\r\n      data.confLayouts = [];\r\n      data.confRole = null;\r\n      data.chattingWith = null;\r\n\r\n      $rootScope.$emit('call.hangup', 'hangup');\r\n    }\r\n\r\n    function inCall() {\r\n      $rootScope.$emit('page.incall', 'call');\r\n    }\r\n\r\n    function callActive(last_state, params) {\r\n      $rootScope.$emit('call.active', last_state, params);\r\n    }\r\n\r\n    function calling() {\r\n      $rootScope.$emit('call.calling', 'calling');\r\n    }\r\n\r\n    function incomingCall(number) {\r\n      $rootScope.$emit('call.incoming', number);\r\n    }\r\n\r\n    function updateResolutions(supportedResolutions) {\r\n      console.debug('Attempting to sync supported and available resolutions');\r\n\r\n      //var removed = 0;\r\n\r\n      console.debug(\"VQ length: \" + videoQualitySource.length);\r\n      console.debug(supportedResolutions);\r\n\r\n      angular.forEach(videoQualitySource, function(resolution, id) {\r\n        angular.forEach(supportedResolutions, function(res) {\r\n          var width = res[0];\r\n          var height = res[1];\r\n\r\n          if(resolution.width == width && resolution.height == height) {\r\n            videoQuality.push(resolution);\r\n          }\r\n        });\r\n      });\r\n\r\n      // videoQuality.length = videoQuality.length - removed;\r\n      console.debug(\"VQ length 2: \" + videoQuality.length);\r\n      data.videoQuality = videoQuality;\r\n      console.debug(videoQuality);\r\n      data.vidQual = (videoQuality.length > 0) ? videoQuality[videoQuality.length - 1].id : null;\r\n      console.debug(data.vidQual);\r\n\r\n      return videoQuality;\r\n    };\r\n\r\n    var callState = {\r\n      muteMic: false,\r\n      muteVideo: false\r\n    };\r\n\r\n    return {\r\n      data: data,\r\n      callState: callState,\r\n\r\n      // Options to compose the interface.\r\n      videoQuality: videoQuality,\r\n      videoResolution: videoResolution,\r\n      bandwidth: bandwidth,\r\n      framerate: framerate,\r\n\r\n      refreshDevicesCallback : function refreshDevicesCallback(callback) {\r\n        data.videoDevices = [{\r\n          id: 'none',\r\n          label: 'No Camera'\r\n        }];\r\n        data.shareDevices = [{\r\n          id: 'screen',\r\n          label: 'Screen'\r\n        }];\r\n        data.audioDevices = [{\r\n          id: 'any',\r\n          label: 'Default Microphone'\r\n\t},\r\n\t{\r\n\t    id: 'none',\r\n\t    label: 'No Microphone'\r\n        }];\r\n        data.speakerDevices = [{\r\n\t    id: 'any',\r\n\t    label: 'Default Speaker'\r\n\t}];\r\n\r\n        if(!storage.data.selectedShare) {\r\n          storage.data.selectedShare = data.shareDevices[0]['id'];\r\n        }\r\n\r\n        for (var i in jQuery.verto.videoDevices) {\r\n          var device = jQuery.verto.videoDevices[i];\r\n          if (!device.label) {\r\n            data.videoDevices.push({\r\n              id: 'Camera ' + i,\r\n              label: 'Camera ' + i\r\n            });\r\n          } else {\r\n            data.videoDevices.push({\r\n              id: device.id,\r\n              label: device.label || device.id\r\n            });\r\n          }\r\n\r\n          // Selecting the first source.\r\n          if (i == 0 && !storage.data.selectedVideo) {\r\n            storage.data.selectedVideo = device.id;\r\n          }\r\n\r\n          if (!device.label) {\r\n            data.shareDevices.push({\r\n              id: 'Share Device ' + i,\r\n              label: 'Share Device ' + i\r\n            });\r\n            continue;\r\n          }\r\n\r\n          data.shareDevices.push({\r\n            id: device.id,\r\n            label: device.label || device.id\r\n          });\r\n        }\r\n\r\n        for (var i in jQuery.verto.audioInDevices) {\r\n          var device = jQuery.verto.audioInDevices[i];\r\n          // Selecting the first source.\r\n          if (i == 0 && !storage.data.selectedAudio) {\r\n            storage.data.selectedAudio = device.id;\r\n          }\r\n\r\n          if (!device.label) {\r\n            data.audioDevices.push({\r\n              id: 'Microphone ' + i,\r\n              label: 'Microphone ' + i\r\n            });\r\n            continue;\r\n          }\r\n          data.audioDevices.push({\r\n            id: device.id,\r\n            label: device.label || device.id\r\n          });\r\n        }\r\n\r\n        for (var i in jQuery.verto.audioOutDevices) {\r\n          var device = jQuery.verto.audioOutDevices[i];\r\n          // Selecting the first source.\r\n          if (i == 0 && !storage.data.selectedSpeaker) {\r\n            storage.data.selectedSpeaker = device.id;\r\n          }\r\n\r\n          if (!device.label) {\r\n            data.speakerDevices.push({\r\n              id: 'Speaker ' + i,\r\n              label: 'Speaker ' + i\r\n            });\r\n            continue;\r\n          }\r\n          data.speakerDevices.push({\r\n            id: device.id,\r\n            label: device.label || device.id\r\n          });\r\n        }\r\n        console.debug('Devices were refreshed, checking that we have cameras.');\r\n\r\n        // Verify if selected devices are valid\r\n        var videoFlag = data.videoDevices.some(function(device) {\r\n          console.log('Evaluating device ', device);\r\n          if (device.label == storage.data.selectedVideoName) {\r\n            console.log('Matched video selection by name: ', device.label);\r\n            storage.data.selectedVideo = device.id;\r\n            return true;\r\n          }\r\n          return device.id == storage.data.selectedVideo && storage.data.selectedVideo !== \"none\";\r\n        });\r\n\r\n        var shareFlag = data.shareDevices.some(function(device) {\r\n          return device.id == storage.data.selectedShare;\r\n        });\r\n\r\n        var audioFlag = data.audioDevices.some(function(device) {\r\n          return device.id == storage.data.selectedAudio;\r\n        });\r\n\r\n        var speakerFlag = data.speakerDevices.some(function(device) {\r\n          return device.id == storage.data.selectedSpeaker;\r\n        });\r\n\r\n        console.log('Storage Video: ', storage.data.selectedVideo);\r\n        console.log('Video Flag: ', videoFlag)\r\n\r\n        if (!videoFlag) storage.data.selectedVideo = data.videoDevices[data.videoDevices.length - 1].id;\r\n        if (!shareFlag) storage.data.selectedShare = data.shareDevices[0].id;\r\n        if (!audioFlag) storage.data.selectedAudio = data.audioDevices[0].id;\r\n        if (!speakerFlag && data.speakerDevices.length > 0) storage.data.selectedSpeaker = data.speakerDevices[0].id;\r\n\r\n        // This means that we cannot use video!\r\n        if (data.videoDevices.length === 0) {\r\n          console.log('No camera, disabling video.');\r\n          data.canVideo = false;\r\n          data.videoDevices.push({\r\n            id: 'none',\r\n            label: 'No camera'\r\n          });\r\n        } else {\r\n          data.canVideo = true;\r\n        }\r\n\r\n        if(angular.isFunction(callback)) {\r\n          callback();\r\n        }\r\n      },\r\n\r\n      refreshDevices: function(callback) {\r\n        console.debug('Attempting to refresh the devices.');\r\n        if(callback) {\r\n          jQuery.verto.refreshDevices(callback);\r\n        } else {\r\n          jQuery.verto.refreshDevices(this.refreshDevicesCallback);\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Updates the video resolutions based on settings.\r\n       */\r\n      refreshVideoResolution: function(resolutions) {\r\n        console.debug('Attempting to refresh video resolutions.');\r\n\r\n        if (data.instance) {\r\n          var w = resolutions['bestResSupported'][0];\r\n          var h = resolutions['bestResSupported'][1];\r\n\r\n          if (h === 1080) {\r\n            w = 1280;\r\n            h = 720;\r\n          }\r\n\r\n          updateResolutions(resolutions['validRes']);\r\n          /* Do not touch video device resolution if autoBand is off and we have selected a vidQual */\r\n          if (!storage.data.autoBand && storage.data.vidQual) {\r\n            w = videoResolution[storage.data.vidQual].width;\r\n            h = videoResolution[storage.data.vidQual].height;\r\n          }\r\n          data.instance.videoParams({\r\n            minWidth: w,\r\n            minHeight: h,\r\n            maxWidth: w,\r\n            maxHeight: h,\r\n            minFrameRate: 15,\r\n            vertoBestFrameRate: storage.data.bestFrameRate\r\n          });\r\n          videoQuality.forEach(function(qual){\r\n            if (w === qual.width && h === qual.height) {\r\n              if (storage.data.vidQual !== qual.id || storage.data.vidQual === undefined) {\r\n                storage.data.vidQual = qual.id;\r\n              }\r\n            }\r\n\r\n          });\r\n          data.resCheckEnded = true;\r\n\r\n        } else {\r\n          console.debug('There is no instance of verto.');\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Connects to the verto server. Automatically calls `onWSLogin`\r\n       * callback set in the verto object.\r\n       *\r\n       * @param callback\r\n       */\r\n      connect: function(callback) {\r\n        console.debug('Attempting to connect to verto.');\r\n        var that = this;\r\n\r\n        function startConference(v, dialog, pvtData) {\r\n          $rootScope.$emit('call.video', 'video');\r\n          $rootScope.$emit('call.conference', 'conference');\r\n          data.chattingWith = pvtData.chatID;\r\n          data.confRole = pvtData.role;\r\n          data.conferenceMemberID = pvtData.conferenceMemberID;\r\n          var conf = new $.verto.conf(v, {\r\n            dialog: dialog,\r\n            hasVid: storage.data.useVideo,\r\n            laData: pvtData,\r\n            chatCallback: function(v, e) {\r\n              var from = e.data.fromDisplay || e.data.from || \"Unknown\";\r\n              var message = e.data.message || \"\";\r\n              $rootScope.$emit('chat.newMessage', {\r\n                from: from,\r\n                body: message\r\n              });\r\n            },\r\n            onBroadcast: function(v, conf, message) {\r\n              console.log('>>> conf.onBroadcast:', arguments);\r\n              if (message.action == 'response') {\r\n                // This is a response with the video layouts list.\r\n                if (message['conf-command'] == 'list-videoLayouts') {\r\n                  var rdata = [];\r\n\r\n                  for (var i in message.responseData) {\r\n                    rdata.push(message.responseData[i].name);\r\n                  }\r\n\r\n                  var options = rdata.sort(function(a, b) {\r\n                    var ga = a.substring(0, 6) == \"group:\" ? true : false;\r\n                    var gb = b.substring(0, 6) == \"group:\" ? true : false;\r\n\r\n                    if ((ga || gb) && ga != gb) {\r\n                      return ga ? -1 : 1;\r\n                    }\r\n\r\n                    return ( ( a == b ) ? 0 : ( ( a > b ) ? 1 : -1 ) );\r\n                  });\r\n                  data.confLayoutsData = message.responseData;\r\n                  data.confLayouts = options;\r\n                } else if (message['conf-command'] == 'canvasInfo') {\r\n                  data.canvasInfo = message.responseData;\r\n                  $rootScope.$emit('conference.canvasInfo', message.responseData);\r\n                } else {\r\n                  $rootScope.$emit('conference.broadcast', message);\r\n                }\r\n              }\r\n            }\r\n          });\r\n\r\n          if (data.confRole == \"moderator\") {\r\n            console.log('>>> conf.listVideoLayouts();');\r\n            conf.listVideoLayouts();\r\n            conf.modCommand('canvasInfo');\r\n          }\r\n\r\n          data.conf = conf;\r\n\r\n          data.liveArray = new $.verto.liveArray(\r\n            data.instance, pvtData.laChannel,\r\n            pvtData.laName, {\r\n              subParams: {\r\n                callID: dialog ? dialog.callID : null\r\n              }\r\n            });\r\n\r\n          data.liveArray.onErr = function(obj, args) {\r\n            console.log('liveArray.onErr', obj, args);\r\n          };\r\n\r\n          data.liveArray.onChange = function(obj, args) {\r\n            // console.log('liveArray.onChange', obj, args);\r\n            switch (args.action) {\r\n              case 'bootObj':\r\n                $rootScope.$emit('members.boot', args.data);\r\n                args.data.forEach(function(member){\r\n                  var callId = member[0];\r\n                  var status = angular.fromJson(member[1][4]);\r\n                  if (callId === data.call.callID) {\r\n                    $rootScope.$apply(function(){\r\n                      data.mutedMic = status.audio.muted;\r\n                      data.mutedVideo = status.video.muted;\r\n                    });\r\n                  }\r\n                });\r\n                break;\r\n              case 'add':\r\n                var member = [args.key, args.data];\r\n                $rootScope.$emit('members.add', member);\r\n                break;\r\n              case 'del':\r\n                var uuid = args.key;\r\n                $rootScope.$emit('members.del', uuid);\r\n                break;\r\n              case 'clear':\r\n                $rootScope.$emit('members.clear');\r\n                break;\r\n              case 'modify':\r\n                var member = [args.key, args.data];\r\n                $rootScope.$emit('members.update', member);\r\n                break;\r\n              default:\r\n                console.log('NotImplemented', args.action);\r\n            }\r\n          };\r\n        }\r\n\r\n        function stopConference() {\r\n          console.log('stopConference()');\r\n          if (data.liveArray) {\r\n            data.liveArray.destroy();\r\n            console.log('Has data.liveArray.');\r\n            $rootScope.$emit('members.clear');\r\n            data.liveArray = null;\r\n          } else {\r\n            console.log('Doesn\\'t found data.liveArray.');\r\n          }\r\n\r\n          if (data.conf) {\r\n            data.conf.destroy();\r\n            data.conf = null;\r\n          }\r\n        }\r\n\r\n        var callbacks = {\r\n          onWSLogin: function(v, success) {\r\n            data.connected = success;\r\n            $rootScope.loginFailed = !success;\r\n            $rootScope.$emit('ws.login', success);\r\n            console.debug('Connected to verto server:', success);\r\n\r\n            if (angular.isFunction(callback)) {\r\n              callback(v, success);\r\n            }\r\n          },\r\n\r\n          onMessage: function(v, dialog, msg, params) {\r\n            console.debug('onMessage:', v, dialog, msg, params);\r\n\r\n            switch (msg) {\r\n              case $.verto.enum.message.pvtEvent:\r\n                if (params.pvtData) {\r\n                  switch (params.pvtData.action) {\r\n                    case \"conference-liveArray-join\":\r\n\t\t      if (!params.pvtData.screenShare && !params.pvtData.videoOnly) {\r\n\t\t\t  console.log(\"conference-liveArray-join\");\r\n\t\t\t  stopConference();\r\n\t\t\t  startConference(v, dialog, params.pvtData);\r\n\t\t\t  updateVideoSize();\r\n\t\t      }\r\n                      break;\r\n                    case \"conference-liveArray-part\":\r\n\t\t      if (!params.pvtData.screenShare && !params.pvtData.videoOnly) {\r\n\t\t\t  console.log(\"conference-liveArray-part\");\r\n\t\t\t  stopConference();\r\n\t\t      }\r\n                      break;\r\n                  }\r\n                }\r\n                break;\r\n              /**\r\n                * This is not being used for conferencing chat\r\n                * anymore (see conf.chatCallback for that).\r\n                */\r\n              case $.verto.enum.message.info:\r\n                var body = params.body;\r\n                var from = params.from_msg_name || params.from;\r\n                if (!body) {\r\n                  console.log('Received an empty body: ', params);\r\n                  return;\r\n                }\r\n                $rootScope.$emit('chat.newMessage', {\r\n                  from: from,\r\n                  body: body\r\n                });\r\n                break;\r\n              case $.verto.enum.message.display:\r\n                    $rootScope.$apply(function() {});\r\n                    break;\r\n              case $.verto.enum.message.clientReady:\r\n                    $rootScope.$emit('clientReady', {\r\n                      reattached_sessions: params.reattached_sessions,\r\n                    });\r\n                    break;\r\n              default:\r\n                console.warn('Got a not implemented message:', msg, dialog, params);\r\n                break;\r\n            }\r\n          },\r\n\r\n          onDialogState: function(d) {\r\n            if (!data.call) {\r\n              data.call = d;\r\n\r\n            }\r\n\r\n            console.debug('onDialogState:', d);\r\n            switch (d.state.name) {\r\n              case \"ringing\":\r\n                incomingCall(d.params.caller_id_number);\r\n                break;\r\n              case \"trying\":\r\n                console.debug('Calling:', d.cidString());\r\n                data.callState = 'trying';\r\n                break;\r\n              case \"early\":\r\n                console.debug('Talking to:', d.cidString());\r\n                data.callState = 'active';\r\n                calling();\r\n                break;\r\n              case \"active\":\r\n                console.debug('Talking to:', d.cidString());\r\n                data.callState = 'active';\r\n                callActive(d.lastState.name, d.params);\r\n\t\tupdateVideoSize();\r\n                break;\r\n              case \"hangup\":\r\n                console.debug('Call ended with cause: ' + d.cause);\r\n                data.callState = 'hangup';\r\n                break;\r\n              case \"destroy\":\r\n                console.debug('Destroying: ' + d.cause);\r\n                if (d.params.screenShare) {\r\n                  cleanShareCall(that);\r\n                } else {\r\n                  stopConference();\r\n                  if (!that.reloaded) {\r\n                    cleanCall();\r\n                  }\r\n                }\r\n                break;\r\n              default:\r\n                console.warn('Got a not implemented state:', d);\r\n                break;\r\n            }\r\n          },\r\n\r\n          onWSClose: function(v, success) {\r\n            console.debug('onWSClose:', success);\r\n            $rootScope.$emit('ws.close', success);\r\n          },\r\n\r\n          onEvent: function(v, e) {\r\n            console.debug('onEvent:', e);\r\n          }\r\n        };\r\n\r\n        var that = this;\r\n        function ourBootstrap() {\r\n          var sessid = $location.search().sessid;\r\n          if (sessid === 'random') {\r\n            sessid = $.verto.genUUID();\r\n            $location.search().sessid = sessid;\r\n          }\r\n          // Checking if we have a failed connection attempt before\r\n          // connecting again.\r\n          if (data.instance && !data.instance.rpcClient.socketReady()) {\r\n            data.instance.rpcClient.stopRetrying();\r\n            data.instance.logout();\r\n            data.instance.login();\r\n            return;\r\n          };\r\n          data.instance = new jQuery.verto({\r\n            login: data.login + '@' + data.hostname,\r\n            passwd: data.password,\r\n            socketUrl: data.wsURL,\r\n            tag: \"webcam\",\r\n            ringFile: \"sounds/bell_ring2.wav\",\r\n            audioParams: {\r\n                googEchoCancellation: storage.data.googEchoCancellation === undefined ? true : storage.data.googEchoCancellation,\r\n                googNoiseSuppression: storage.data.googNoiseSuppression === undefined ? true : storage.data.googNoiseSuppression,\r\n                googHighpassFilter: storage.data.googHighpassFilter === undefined ? true : storage.data.googHighpassFilter,\r\n                googAutoGainControl: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl,\r\n                googAutoGainControl2: storage.data.googAutoGainControl === undefined ? true : storage.data.googAutoGainControl\r\n            },\r\n            sessid: sessid,\r\n            iceServers: storage.data.useSTUN\r\n          }, callbacks);\r\n\r\n          // We need to know when user reloaded page and not react to\r\n          // verto events in order to not stop the reload and redirect user back\r\n          // to the dialpad.\r\n          that.reloaded = false;\r\n          jQuery.verto.unloadJobs.push(function() {\r\n            that.reloaded = true;\r\n          });\r\n\r\n          data.instance.deviceParams({\r\n            useCamera: storage.data.selectedVideo,\r\n            useSpeak: storage.data.selectedSpeaker,\r\n            useMic: storage.data.selectedAudio,\r\n            onResCheck: that.refreshVideoResolution\r\n          });\r\n        }\r\n        if (data.mediaPerm) {\r\n          ourBootstrap();\r\n        } else {\r\n          $.FSRTC.checkPerms(ourBootstrap, true, true);\r\n        }\r\n      },\r\n\r\n      mediaPerm: function(callback) {\r\n        $.FSRTC.checkPerms(callback, true, true);\r\n      },\r\n\r\n      /**\r\n       * Login the client.\r\n       *\r\n       * @param callback\r\n       */\r\n      login: function(callback) {\r\n        data.instance.loginData({\r\n          login: data.login + '@' + data.hostname,\r\n          passwd: data.password\r\n        });\r\n        data.instance.login();\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, true);\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Disconnects from the verto server. Automatically calls `onWSClose`\r\n       * callback set in the verto object.\r\n       *\r\n       * @param callback\r\n       */\r\n      disconnect: function(callback) {\r\n        console.debug('Attempting to disconnect to verto.');\r\n\r\n        data.instance.logout();\r\n        data.connected = false;\r\n\r\n        console.debug('Disconnected from verto server.');\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, data.connected);\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Make a call.\r\n       *\r\n       * @param callback\r\n       */\r\n      call: function(destination, callback, custom) {\r\n        console.debug('Attempting to call destination ' + destination + '.');\r\n\r\n        var call = data.instance.newCall(angular.extend({\r\n          destination_number: destination,\r\n          caller_id_name: data.name,\r\n          caller_id_number: data.callerid ? data.callerid : data.email,\r\n          outgoingBandwidth: storage.data.outgoingBandwidth,\r\n          incomingBandwidth: storage.data.incomingBandwidth,\r\n          useVideo: storage.data.useVideo,\r\n          useStereo: storage.data.useStereo,\r\n          useCamera: storage.data.selectedVideo,\r\n          useSpeak: storage.data.selectedSpeaker,\r\n          useMic: storage.data.selectedAudio,\r\n          dedEnc: storage.data.useDedenc,\r\n          mirrorInput: storage.data.mirrorInput,\r\n          userVariables: {\r\n            email : storage.data.email,\r\n            avatar: \"http://gravatar.com/avatar/\" + md5(storage.data.email) + \".png?s=600\"\r\n          }\r\n        }, custom));\r\n\r\n        data.call = call;\r\n\r\n        data.mutedMic = false;\r\n        data.mutedVideo = false;\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, call);\r\n        }\r\n      },\r\n\r\n      screenshare: function(destination, callback) {\r\n\r\n\r\n          var that = this;\r\n\r\n\t  if (storage.data.selectedShare !== \"screen\") {\r\n\r\n              console.log('share screen from device ' + storage.data.selectedShare);\r\n\r\n\t      var call = data.instance.newCall({\r\n\t\t  destination_number: destination + \"-screen\",\r\n\t\t  caller_id_name: data.name + \" (Screen)\",\r\n\t\t  caller_id_number: data.login + \" (screen)\",\r\n\t\t  outgoingBandwidth: storage.data.outgoingBandwidth,\r\n\t\t  incomingBandwidth: storage.data.incomingBandwidth,\r\n\t\t  useCamera: storage.data.selectedShare,\r\n\t\t  useVideo: true,\r\n\t\t  screenShare: true,\r\n\t\t  dedEnc: storage.data.useDedenc,\r\n\t\t  mirrorInput: storage.data.mirrorInput,\r\n\t\t  userVariables: {\r\n\t\t      email : storage.data.email,\r\n\t\t      avatar: \"http://gravatar.com/avatar/\" + md5(storage.data.email) + \".png?s=600\"\r\n\t\t  }\r\n\t      });\r\n\r\n              // Override onStream callback in $.FSRTC instance\r\n              call.rtc.options.callbacks.onStream = function(rtc, stream) {\r\n\t\t  if(stream) {\r\n\t\t      var StreamTrack = stream.getVideoTracks()[0];\r\n\t\t      StreamTrack.addEventListener('ended', stopSharing);\r\n\t\t      // (stream.getVideoTracks()[0]).onended = stopSharing;\r\n\t\t  }\r\n\r\n\t\t  console.log(\"screenshare started\");\r\n\r\n\t\t  function stopSharing() {\r\n\t\t      if(that.data.shareCall) {\r\n\t\t\t  that.screenshareHangup();\r\n\t\t\t  console.log(\"screenshare ended\");\r\n\t\t      }\r\n\t\t  }\r\n              };\r\n\r\n              data.shareCall = call;\r\n\r\n              console.log('shareCall', data);\r\n\r\n              data.mutedMic = false;\r\n              data.mutedVideo = false;\r\n\r\n              that.refreshDevices();\r\n\r\n\t      return;\r\n\t  }\r\n\r\n\r\n        console.log('share screen from plugin ' + storage.data.selectedShare);\r\n\r\n        var screenfunc = function(error, sourceId, screen_constraints) {\r\n\r\n          if(error) {\r\n            $rootScope.$emit('ScreenShareExtensionStatus', error);\r\n            return;\r\n          }\r\n\r\n          var share_call = data.instance.newCall({\r\n            destination_number: destination + '-screen',\r\n            caller_id_name: data.name + ' (Screen)',\r\n            caller_id_number: data.login + ' (Screen)',\r\n            outgoingBandwidth: storage.data.outgoingBandwidth,\r\n            incomingBandwidth: storage.data.incomingBandwidth,\r\n            videoParams: screen_constraints ? screen_constraints.video.mandatory : {},\r\n            useVideo: true,\r\n            screenShare: true,\r\n            dedEnc: storage.data.useDedenc,\r\n            mirrorInput: storage.data.mirrorInput,\r\n            userVariables: {\r\n              email : storage.data.email,\r\n              avatar: \"http://gravatar.com/avatar/\" + md5(storage.data.email) + \".png?s=600\"\r\n            }\r\n          });\r\n\r\n          // Override onStream callback in $.FSRTC instance\r\n          share_call.rtc.options.callbacks.onStream = function(rtc, stream) {\r\n            if(stream) {\r\n              var StreamTrack = stream.getVideoTracks()[0];\r\n              StreamTrack.addEventListener('ended', stopSharing);\r\n              // (stream.getVideoTracks()[0]).onended = stopSharing;\r\n            }\r\n\r\n            console.log(\"screenshare started\");\r\n\r\n            function stopSharing() {\r\n              if(that.data.shareCall) {\r\n                that.screenshareHangup();\r\n                console.log(\"screenshare ended\");\r\n              }\r\n            }\r\n          };\r\n\r\n          data.shareCall = share_call;\r\n\r\n          console.log('shareCall', data);\r\n\r\n          data.mutedMic = false;\r\n          data.mutedVideo = false;\r\n        };\r\n\r\n\t  if (!!navigator.mozGetUserMedia) {\r\n\t      screenfunc();\r\n\t  } else {\r\n              getScreenId(screenfunc);\r\n\t  }\r\n\r\n      },\r\n\r\n      screenshareHangup: function() {\r\n        if (!data.shareCall) {\r\n          console.debug('There is no call to hangup.');\r\n          return false;\r\n        }\r\n\r\n        console.log('shareCall End', data.shareCall);\r\n        data.shareCall.hangup();\r\n\r\n        console.debug('The screencall was hangup.');\r\n\r\n      },\r\n\r\n      /**\r\n       * Hangup the current call.\r\n       *\r\n       * @param callback\r\n       */\r\n      hangup: function(callback) {\r\n        console.debug('Attempting to hangup the current call.');\r\n\r\n        if (!data.call) {\r\n          console.debug('There is no call to hangup.');\r\n          return false;\r\n        }\r\n\r\n        data.call.hangup();\r\n\r\n        if (data.conf) {\r\n          data.conf.destroy();\r\n          data.conf = null;\r\n        }\r\n\r\n        console.debug('The call was hangup.');\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, true);\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Send a DTMF to the current call.\r\n       *\r\n       * @param {string|integer} number\r\n       * @param callback\r\n       */\r\n      dtmf: function(number, callback) {\r\n        console.debug('Attempting to send DTMF \"' + number + '\".');\r\n\r\n        if (!data.call) {\r\n          console.debug('There is no call to send DTMF.');\r\n          return false;\r\n        }\r\n\r\n        data.call.dtmf(number.toString());\r\n        console.debug('The DTMF was sent for the call.');\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, true);\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Do speed test.\r\n       *\r\n       * @param callback\r\n       */\r\n      testSpeed: function(cb) {\r\n\r\n        data.instance.rpcClient.speedTest(1024 * 256, function(e, data) {\r\n          var upBand = Math.ceil(data.upKPS * .75),\r\n              downBand = Math.ceil(data.downKPS * .75);\r\n\r\n\r\n          if (storage.data.autoBand) {\r\n            storage.data.incomingBandwidth = downBand;\r\n            storage.data.outgoingBandwidth = upBand;\r\n            storage.data.useDedenc = false;\r\n            storage.data.vidQual = 'hd';\r\n\r\n            if (upBand < 256) {\r\n              storage.data.vidQual = 'qqvga';\r\n            }\r\n            else if (upBand < 512) {\r\n              storage.data.vidQual = 'qvga';\r\n            }\r\n            else if (upBand < 1024) {\r\n              storage.data.vidQual = 'vga';\r\n            }\r\n          }\r\n\r\n          if(cb) {\r\n            cb(data);\r\n          }\r\n\r\n          $rootScope.$emit('testSpeed', data);\r\n        });\r\n      },\r\n      /**\r\n       * Mute the microphone for the current call.\r\n       *\r\n       * @param callback\r\n       */\r\n      muteMic: function(callback) {\r\n        console.debug('Attempting to mute mic for the current call.');\r\n\r\n        if (!data.call) {\r\n          console.debug('There is no call to mute.');\r\n          return false;\r\n        }\r\n\r\n        data.call.dtmf('0');\r\n        data.mutedMic = !data.mutedMic;\r\n        console.debug('The mic was muted for the call.');\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, true);\r\n        }\r\n      },\r\n\r\n      /**\r\n       * Mute the video for the current call.\r\n       *\r\n       * @param callback\r\n       */\r\n      muteVideo: function(callback) {\r\n        console.debug('Attempting to mute video for the current call.');\r\n\r\n        if (!data.call) {\r\n          console.debug('There is no call to mute.');\r\n          return false;\r\n        }\r\n\r\n        data.call.dtmf('*0');\r\n        data.mutedVideo = !data.mutedVideo;\r\n        console.debug('The video was muted for the call.');\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, true);\r\n        }\r\n      },\r\n      /*\r\n      * Method is used to send conference chats ONLY.\r\n      */\r\n      sendConferenceChat: function(message) {\r\n        data.conf.sendChat(message, \"message\");\r\n      },\r\n      setCanvasIn: function(memberID, canvasID) {\r\n        data.conf.modCommand('vid-canvas', memberID, canvasID);\r\n      },\r\n      setCanvasOut: function(memberID, canvasID) {\r\n        data.conf.modCommand('vid-watching-canvas', memberID, canvasID);\r\n      },\r\n      setLayer: function(memberID, canvasID) {\r\n        data.conf.modCommand('vid-layer', memberID, canvasID);\r\n      },\r\n      /*\r\n      * Method is used to set a member's resevartion Id.\r\n      */\r\n      setResevartionId: function(memberID, resID) {\r\n        data.conf.modCommand('vid-res-id', memberID, resID);\r\n      },\r\n      /*\r\n      * Method is used to send user2user chats.\r\n      * VC does not yet support that.\r\n      */\r\n      sendMessage: function(body, callback) {\r\n        data.call.message({\r\n          to: data.chattingWith,\r\n          body: body,\r\n          from_msg_name: data.name,\r\n          from_msg_number: data.cid\r\n        });\r\n\r\n        if (angular.isFunction(callback)) {\r\n          callback(data.instance, true);\r\n        }\r\n      }\r\n    };\r\n  }\r\n]);\r\n\r\n'use strict';\r\n\r\nvar vertoService = angular.module('vertoService');\r\n\r\nvertoService.service('config', ['$rootScope', '$http', '$location', 'storage', 'verto',\r\n  function($rootScope, $http, $location, storage, verto) {\r\n    var configure = function() {\r\n      /**\r\n       * Load stored user info into verto service\r\n       */\r\n      if(storage.data.name) {\r\n        verto.data.name = storage.data.name;\r\n      }\r\n      if(storage.data.email) {\r\n        verto.data.email = storage.data.email;\r\n      }\r\n      if(storage.data.login) {\r\n        verto.data.login = storage.data.login;\r\n      }\r\n      if(storage.data.password) {\r\n        verto.data.password = storage.data.password;\r\n      }\r\n\r\n      /*\r\n       * Load the Configs before logging in\r\n       * with cache buster\r\n       */\r\n      var url = window.location.origin + window.location.pathname;\r\n      var httpRequest = $http.get(url + 'config.json?cachebuster=' + Math.floor((Math.random()*1000000)+1));\r\n\r\n      var httpReturn = httpRequest.then(function(response) {\r\n        var data = response.data;\r\n\r\n        /* save these for later as we're about to possibly over write them */\r\n        var name = verto.data.name;\r\n        var email = verto.data.email;\r\n\r\n        console.debug(\"googlelogin: \" + data.googlelogin);\r\n        if (data.googlelogin){\r\n          verto.data.googlelogin = data.googlelogin;\r\n          verto.data.googleclientid = data.googleclientid;\r\n        }\r\n\r\n        angular.extend(verto.data, data);\r\n\r\n        /**\r\n         * use stored data (localStorage) for login, allow config.json to take precedence\r\n         */\r\n\r\n        if (name != '' && data.name == '') {\r\n          verto.data.name = name;\r\n        }\r\n        if (email != '' && data.email == '') {\r\n          verto.data.email = email;\r\n        }\r\n        if (verto.data.login == '' && verto.data.password == '' && storage.data.login != '' && storage.data.password != '') {\r\n          verto.data.login = storage.data.login;\r\n          verto.data.password = storage.data.password;\r\n        }\r\n\r\n        if (verto.data.autologin == \"true\" && !verto.data.autologin_done) {\r\n          console.debug(\"auto login per config.json\");\r\n          verto.data.autologin_done = true;\r\n        }\r\n\r\n        if(verto.data.autologin && storage.data.name.length && storage.data.email.length && storage.data.login.length && storage.data.password.length) {\r\n          $rootScope.$emit('config.http.success', data);\r\n        };\r\n        return response;\r\n      }, function(response) {\r\n        $rootScope.$emit('config.http.error', response);\r\n        return response;\r\n      });\r\n\r\n      return httpReturn;\r\n    };\r\n\r\n    return {\r\n      'configure': configure\r\n    };\r\n  }]);\r\n\r\n'use strict';\r\n\r\n  angular\r\n    .module('vertoService')\r\n    .service('eventQueue', ['$rootScope', '$q', 'storage', 'verto',\r\n      function($rootScope, $q, storage, verto) {\r\n        \r\n        var events = [];\r\n        \r\n        var next = function() {\r\n          var fn, fn_return;\r\n          \r\n          fn = events.shift();\r\n          \r\n          if (fn == undefined) {\r\n            $rootScope.$emit('eventqueue.complete');\r\n            return;\r\n          }\r\n          fn_return = fn();\r\n\r\n          var emitNextProgress = function() {\r\n            $rootScope.$emit('eventqueue.next');\r\n          };\r\n\r\n          fn_return.then(\r\n            function() {\r\n              emitNextProgress();\r\n            }, \r\n            function() {\r\n              emitNextProgress();\r\n            }\r\n          );\r\n        };\r\n\r\n        var process = function() {\r\n          $rootScope.$on('eventqueue.next', function (ev){\r\n            next();\r\n          });\r\n          \r\n          next(); \r\n        };\r\n\r\n        return {\r\n          'next': next,\r\n          'process': process,\r\n          'events': events\r\n        };\r\n\r\n      }]);\r\n \r\n\r\n(function() {\r\n  'use strict';\r\n  var vertoService = angular.module('storageService', ['ngStorage']);\r\n})();\r\n\r\n'use strict';\r\n\r\n  angular\r\n  .module('storageService')\r\n  .service('storage', ['$rootScope', '$localStorage',\r\n  function($rootScope, $localStorage) {\r\n    var data = $localStorage,\r\n\tdefaultSettings = {\r\n\t  ui_connected: false,\r\n          ws_connected: false,\r\n          cur_call: 0,\r\n          called_number: '',\r\n          useVideo: true,\r\n          call_history: {},\r\n          history_control: [],\r\n          call_start: false,\r\n          name: '',\r\n          email: '',\r\n          login: '',\r\n          password: '',\r\n          userStatus: 'disconnected',\r\n          mutedVideo: false,\r\n          mutedMic: false,\r\n          preview: true,\r\n          selectedVideo: null,\r\n          selectedVideoName: null,\r\n          selectedAudio: null,\r\n          selectedShare: null,\r\n          selectedSpeaker: null,\r\n          useStereo: true,\r\n          useSTUN: true,\r\n          useDedenc: false,\r\n          mirrorInput: false,\r\n          outgoingBandwidth: 'default',\r\n          incomingBandwidth: 'default',\r\n          vidQual: undefined,\r\n          askRecoverCall: false,\r\n          googNoiseSuppression: true,\r\n          googHighpassFilter: true,\r\n          googEchoCancellation: true,\r\n          googAutoGainControl: true,\r\n          autoBand: true,\r\n          testSpeedJoin: true,\r\n          bestFrameRate: \"15\",\r\n          language: undefined\r\n       };\r\n\r\n    data.$default(defaultSettings);\r\n\r\n    function changeData(verto_data) {\r\n      jQuery.extend(true, data, verto_data);\r\n    }\r\n\r\n    return {\r\n      data: data,\r\n      changeData: changeData,\r\n      reset: function() {\r\n        data.ui_connected = false;\r\n        data.ws_connected = false;\r\n        data.cur_call = 0;\r\n        data.userStatus = 'disconnected';\r\n      },\r\n      factoryReset: function() {\r\n        localStorage.clear();\r\n        // set defaultSettings again\r\n        data.$reset(defaultSettings);\r\n      },\r\n    };\r\n  }\r\n]);\r\n\r\n'use strict';\r\n\r\n  angular\r\n  .module('storageService')\r\n  .factory('CallHistory', [\"storage\", function(storage) {\r\n\r\n    var history = storage.data.call_history;\r\n    var history_control = storage.data.history_control;\r\n\r\n    var addCallToHistory = function(number, direction, status) {\r\n      if(history[number] == undefined) {\r\n        history[number] = [];\r\n      }\r\n\r\n      history[number].unshift({\r\n        'number': number,\r\n        'direction': direction,\r\n        'status': status,\r\n        'call_start': Date()\r\n      });\r\n\r\n      var index = history_control.indexOf(number);\r\n      console.log(index);\r\n      if(index > -1) {\r\n        history_control.splice(index, 1);\r\n      }\r\n\r\n      history_control.unshift(number);\r\n\r\n    };\r\n\r\n    var getCallsFromHistory = function(number) {\r\n      return history[number];\r\n    };\r\n\r\n    return {\r\n      all: function() {\r\n        return history;\r\n      },\r\n      all_control: function() {\r\n        return history_control;\r\n      },\r\n      get: function(number) {\r\n        return getCallsFromHistory(number);\r\n      },\r\n      add: function(number, direction, status) {\r\n        return addCallToHistory(number, direction, status);\r\n      },\r\n      clear: function() {\r\n        storage.data.call_history = {};\r\n        storage.data.history_control = [];\r\n        history = storage.data.call_history;\r\n        history_control = storage.data.history_control;\r\n        return history_control;\r\n      }\r\n    }\r\n}]);\r\n\r\n'use strict';\r\n\r\n  angular\r\n    .module('storageService')\r\n    .service('splashscreen', ['$rootScope', '$q', 'storage', 'config', 'verto', '$translate',\r\n      function($rootScope, $q, storage, config, verto, $translate) {\r\n\r\n        var checkBrowser = function() {\r\n          return $q(function(resolve, reject) {\r\n            var activity = 'browser-upgrade';\r\n            var result = {\r\n              'activity': activity,\r\n              'soft': false,\r\n              'status': 'success',\r\n              'message': $translate.instant('BROWSER_COMPATIBILITY')\r\n            };\r\n            if (!navigator.mediaDevices.getUserMedia) {\r\n              result['status'] = 'error';\r\n              result['message'] = $translate.instant('BROWSER_WITHOUT_WEBRTC');\r\n              reject(result);\r\n            }\r\n\r\n            resolve(result);\r\n\r\n          });\r\n        };\r\n\r\n        var checkMediaPerm = function() {\r\n          return $q(function(resolve, reject) {\r\n            var activity = 'media-perm';\r\n            var result = {\r\n              'activity': activity,\r\n              'soft': false,\r\n              'status': 'success',\r\n              'message': $translate.instant('CHECK_PERMISSION_MEDIA')\r\n            };\r\n\r\n            verto.mediaPerm(function(status) {\r\n              if(!status) {\r\n                result['status'] = 'error';\r\n                result['message'] = $translate.instant('ERROR_PERMISSION_MEDIA');\r\n                verto.data.mediaPerm = false;\r\n                reject(result);\r\n              }\r\n              verto.data.mediaPerm = true;\r\n              resolve(result);\r\n            });\r\n          });\r\n        };\r\n\r\n        var refreshMediaDevices = function() {\r\n          return $q(function(resolve, reject) {\r\n            var activity = 'refresh-devices';\r\n            var result = {\r\n              'status': 'success',\r\n              'soft': true,\r\n              'activity': activity,\r\n              'message': $translate.instant('REFRESH_MEDIA_DEVICES')\r\n            };\r\n\r\n            verto.refreshDevices(function(status) {\r\n              verto.refreshDevicesCallback(function() {\r\n                resolve(result);\r\n              });\r\n            });\r\n\r\n          });\r\n        };\r\n\r\n        var checkConnectionSpeed = function() {\r\n          return $q(function(resolve, reject) {\r\n            var activity = 'check-connection-speed';\r\n            var result = {\r\n              'status': 'success',\r\n              'soft': true,\r\n              'activity': activity,\r\n              'message': $translate.instant('CHECK_CONNECTION_SPEED')\r\n            };\r\n\r\n            if (storage.data.autoBand && verto.data.instance) {\r\n              verto.testSpeed(cb);\r\n            } else {\r\n              resolve(result);\r\n            }\r\n\r\n            function cb(data) {\r\n              resolve(result);\r\n            }\r\n          });\r\n        };\r\n\r\n        var provisionConfig = function() {\r\n          return $q(function(resolve, reject) {\r\n            var activity = 'provision-config';\r\n            var result = {\r\n              'status': 'promise',\r\n              'soft': true,\r\n              'activity': activity,\r\n              'message': $translate.instant('CHECK_PROVISIONING_CONF')\r\n            };\r\n\r\n            var configResponse = config.configure();\r\n\r\n            var configPromise = configResponse.then(\r\n              function(response) {\r\n                /**\r\n                 * from angular docs:\r\n                 * A response status code between 200 and 299 is considered a success status and will result in the success callback being called\r\n                 */\r\n                if(response.status >= 200 && response.status <= 299) {\r\n                  return result;\r\n                } else {\r\n                  result['status'] = 'error';\r\n                  result['message'] = $translate.instant('ERROR_PROVISIONING_CONF');\r\n                  return result;\r\n                }\r\n              });\r\n\r\n              result['promise'] = configPromise;\r\n\r\n              resolve(result);\r\n          });\r\n        };\r\n\r\n        var checkLogin = function() {\r\n          return $q(function(resolve, reject) {\r\n            var activity = 'check-login';\r\n            var result = {\r\n              'status': 'success',\r\n              'soft': true,\r\n              'activity': activity,\r\n              'message': $translate.instant('CHECK_LOGIN'),\r\n            };\r\n\r\n            if(verto.data.connecting || verto.data.connected) {\r\n              resolve(result);\r\n              return;\r\n            };\r\n\r\n            var checkUserStored = function() {\r\n              /**\r\n               * if user data saved, use stored data for logon and not connecting\r\n               * not connecting prevent two connects\r\n               */\r\n              if (storage.data.ui_connected && storage.data.ws_connected && !verto.data.connecting) {\r\n                verto.data.hostname = storage.data.hostname || verto.data.hostname;\r\n                verto.data.wsURL = storage.data.wsURL || verto.data.wsURL;\r\n                verto.data.name = storage.data.name;\r\n                verto.data.email = storage.data.email;\r\n                verto.data.login = storage.data.login;\r\n                verto.data.password = storage.data.password;\r\n\r\n                verto.data.connecting = true;\r\n                verto.connect(function(v, connected) {\r\n                  verto.data.connecting = false;\r\n                  resolve(result);\r\n                });\r\n              };\r\n            };\r\n\r\n            if(storage.data.ui_connected && storage.data.ws_connected) {\r\n              checkUserStored();\r\n            } else {\r\n              resolve(result);\r\n            };\r\n          });\r\n        };\r\n\r\n        var progress = [\r\n          checkBrowser,\r\n          checkMediaPerm,\r\n          refreshMediaDevices,\r\n          provisionConfig,\r\n          checkLogin,\r\n          checkConnectionSpeed\r\n        ];\r\n\r\n        var progress_message = [\r\n          $translate.instant('BROWSER_COMPATIBILITY'),\r\n          $translate.instant('CHECK_PERMISSION_MEDIA'),\r\n          $translate.instant('REFRESH_MEDIA_DEVICES'),\r\n          $translate.instant('CHECK_PROVISIONING_CONF'),\r\n          $translate.instant('CHECK_LOGIN'),\r\n          $translate.instant('CHECK_CONNECTION_SPEED'),\r\n        ];\r\n\r\n        var getProgressMessage = function(current_progress) {\r\n          if(progress_message[current_progress] != undefined) {\r\n            return progress_message[current_progress];\r\n          } else {\r\n            return $translate.instant('PLEASE_WAIT');\r\n          }\r\n        };\r\n\r\n        var current_progress = -1;\r\n        var progress_percentage = 0;\r\n\r\n        var calculateProgress = function(index) {\r\n          var _progress;\r\n\r\n          _progress = index + 1;\r\n          progress_percentage = (_progress / progress.length) * 100;\r\n          return progress_percentage;\r\n        };\r\n\r\n        var nextProgress = function() {\r\n          var fn, fn_return, status, interrupt, activity, soft, message, promise;\r\n          interrupt = false;\r\n          current_progress++;\r\n\r\n          if(current_progress >= progress.length) {\r\n            $rootScope.$emit('progress.complete', current_progress);\r\n            return;\r\n          }\r\n\r\n          fn = progress[current_progress];\r\n          fn_return = fn();\r\n\r\n          var emitNextProgress = function(fn_return) {\r\n            if(fn_return['promise'] != undefined) {\r\n              promise = fn_return['promise'];\r\n            }\r\n\r\n            status = fn_return['status'];\r\n            soft = fn_return['soft'];\r\n            activity = fn_return['activity'];\r\n            message = fn_return['message'];\r\n\r\n            if(status != 'success') {\r\n              interrupt = true;\r\n            }\r\n\r\n            $rootScope.$emit('progress.next', current_progress, status, promise, activity, soft, interrupt, message);\r\n\r\n          };\r\n\r\n          fn_return.then(\r\n            function(fn_return) {\r\n              emitNextProgress(fn_return);\r\n            },\r\n            function(fn_return) {\r\n              emitNextProgress(fn_return);\r\n            }\r\n          );\r\n\r\n        };\r\n\r\n        return {\r\n          'next': nextProgress,\r\n          'getProgressMessage': getProgressMessage,\r\n          'progress_percentage': progress_percentage,\r\n          'calculate': calculateProgress\r\n        };\r\n\r\n      }]);\r\n"]}